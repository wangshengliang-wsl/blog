---
title: App Router æ¦‚è¿°
description: æ·±å…¥ç†è§£ Next.js App Router ä¸ Pages Router çš„æ ¸å¿ƒåŒºåˆ«ï¼ŒæŒæ¡ App Router çš„è®¾è®¡ç†å¿µä¸è¿ç§»ç­–ç•¥
pubDate: 2025-12-03
toc: true
ogImage: true
category: Next
tags: ['Next.js', 'App Router', 'Pages Router', 'è·¯ç”±']
---

ğŸ™‹ Next.js æœ‰ä¸¤å¥—è·¯ç”±ç³»ç»Ÿï¼šApp Router å’Œ Pages Routerã€‚æ–°é¡¹ç›®è¯¥é€‰å“ªä¸ªï¼Ÿè€é¡¹ç›®è¦ä¸è¦è¿ç§»ï¼Ÿ

## ä¸¤ç§è·¯ç”±å™¨çš„å®šä½

Next.js ç›®å‰åŒæ—¶æ”¯æŒä¸¤ç§è·¯ç”±ç³»ç»Ÿï¼š

| ç‰¹æ€§         | App Router         | Pages Router               |
| ------------ | ------------------ | -------------------------- |
| å¼•å…¥ç‰ˆæœ¬     | Next.js 13         | Next.js 1.0                |
| ç›®å½•         | `app/`             | `pages/`                   |
| ç»„ä»¶é»˜è®¤ç±»å‹ | Server Components  | Client Components          |
| æ•°æ®è·å–     | async ç»„ä»¶ / fetch | getServerSideProps ç­‰      |
| å¸ƒå±€         | åµŒå¥— layout.tsx    | \_app.tsx / \_document.tsx |
| çŠ¶æ€         | ç¨³å®šï¼ˆæ¨èï¼‰       | æŒç»­ç»´æŠ¤                   |

ğŸ¯ **ç»“è®º**ï¼šæ–°é¡¹ç›®ä½¿ç”¨ App Routerï¼Œè€é¡¹ç›®å¯ä»¥æ¸è¿›å¼è¿ç§»ã€‚

## App Router æ ¸å¿ƒä¼˜åŠ¿

### 1. React Server Components

App Router æ„å»ºåœ¨ React Server Componentsï¼ˆRSCï¼‰ä¹‹ä¸Šã€‚ç»„ä»¶é»˜è®¤åœ¨æœåŠ¡ç«¯æ‰§è¡Œï¼Œåªæœ‰å¿…è¦æ—¶æ‰å‘é€åˆ°å®¢æˆ·ç«¯ã€‚

```tsx
// app/users/page.tsx - Server Componentï¼ˆé»˜è®¤ï¼‰
// Next.js 15.x

// ç›´æ¥åœ¨ç»„ä»¶ä¸­ await æ•°æ®
async function getUsers() {
  const res = await fetch('https://api.example.com/users')
  return res.json()
}

export default async function UsersPage() {
  const users = await getUsers()

  return (
    <ul>
      {users.map((user: { id: number; name: string }) => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  )
}
```

âœ… **ä¼˜åŠ¿**ï¼š

- å‡å°‘å®¢æˆ·ç«¯ JavaScript ä½“ç§¯
- å¯ä»¥ç›´æ¥è®¿é—®åç«¯èµ„æºï¼ˆæ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿï¼‰
- æ›´å¿«çš„é¦–å±æ¸²æŸ“

### 2. åµŒå¥—å¸ƒå±€

App Router æ”¯æŒçœŸæ­£çš„åµŒå¥—å¸ƒå±€ï¼Œçˆ¶å¸ƒå±€ä¸ä¼šå› ä¸ºå­è·¯ç”±å˜åŒ–è€Œé‡æ–°æ¸²æŸ“ã€‚

```
app/
â”œâ”€â”€ layout.tsx          # æ ¹å¸ƒå±€ï¼ˆåº”ç”¨åˆ°æ‰€æœ‰é¡µé¢ï¼‰
â”œâ”€â”€ page.tsx            # é¦–é¡µ
â””â”€â”€ dashboard/
    â”œâ”€â”€ layout.tsx      # Dashboard å¸ƒå±€ï¼ˆåµŒå¥—ï¼‰
    â”œâ”€â”€ page.tsx        # /dashboard
    â””â”€â”€ settings/
        â””â”€â”€ page.tsx    # /dashboard/settings
```

```tsx
// app/layout.tsx - æ ¹å¸ƒå±€
// Next.js 15.x
export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="zh-CN">
      <body>
        <header>å…¨ç«™å¯¼èˆª</header>
        <main>{children}</main>
        <footer>å…¨ç«™é¡µè„š</footer>
      </body>
    </html>
  )
}
```

```tsx
// app/dashboard/layout.tsx - åµŒå¥—å¸ƒå±€
// Next.js 15.x
export default function DashboardLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <div className="flex">
      <aside>ä¾§è¾¹æ å¯¼èˆª</aside>
      <section className="flex-1">{children}</section>
    </div>
  )
}
```

è®¿é—® `/dashboard/settings` æ—¶ï¼Œä¸¤ä¸ªå¸ƒå±€ä¼šåµŒå¥—æ¸²æŸ“ã€‚å¯¼èˆªæ—¶ï¼Œæ ¹å¸ƒå±€ä¿æŒä¸å˜ï¼Œåªæœ‰å†…å®¹åŒºåŸŸæ›´æ–°ã€‚

### 3. å†…ç½®åŠ è½½ä¸é”™è¯¯çŠ¶æ€

App Router é€šè¿‡ç‰¹æ®Šæ–‡ä»¶çº¦å®šï¼Œè‡ªåŠ¨å¤„ç†åŠ è½½å’Œé”™è¯¯çŠ¶æ€ï¼š

```
app/
â””â”€â”€ dashboard/
    â”œâ”€â”€ layout.tsx
    â”œâ”€â”€ page.tsx
    â”œâ”€â”€ loading.tsx     # åŠ è½½çŠ¶æ€
    â”œâ”€â”€ error.tsx       # é”™è¯¯è¾¹ç•Œ
    â””â”€â”€ not-found.tsx   # 404 é¡µé¢
```

```tsx
// app/dashboard/loading.tsx
// Next.js 15.x
export default function Loading() {
  return (
    <div className="animate-pulse">
      <div className="h-4 bg-gray-200 rounded w-3/4 mb-4"></div>
      <div className="h-4 bg-gray-200 rounded w-1/2"></div>
    </div>
  )
}
```

```tsx
// app/dashboard/error.tsx
// Next.js 15.x
'use client' // é”™è¯¯è¾¹ç•Œå¿…é¡»æ˜¯ Client Component

export default function Error({
  error,
  reset,
}: {
  error: Error & { digest?: string }
  reset: () => void
}) {
  return (
    <div>
      <h2>å‡ºé”™äº†ï¼</h2>
      <p>{error.message}</p>
      <button onClick={() => reset()}>é‡è¯•</button>
    </div>
  )
}
```

## Pages Router å›é¡¾

Pages Router æ˜¯ Next.js çš„åŸå§‹è·¯ç”±ç³»ç»Ÿï¼Œé‡‡ç”¨ä¸åŒçš„çº¦å®šï¼š

```
pages/
â”œâ”€â”€ _app.tsx           # å…¨å±€å¸ƒå±€
â”œâ”€â”€ _document.tsx      # HTML æ–‡æ¡£ç»“æ„
â”œâ”€â”€ index.tsx          # é¦–é¡µ /
â”œâ”€â”€ about.tsx          # /about
â””â”€â”€ users/
    â”œâ”€â”€ index.tsx      # /users
    â””â”€â”€ [id].tsx       # /users/:id
```

æ•°æ®è·å–ä½¿ç”¨ä¸“é—¨çš„å‡½æ•°ï¼š

```tsx
// pages/users/index.tsx - Pages Router
// Next.js 15.x (Pages Router)
import type { GetServerSideProps } from 'next'

interface User {
  id: number
  name: string
}

interface Props {
  users: User[]
}

export const getServerSideProps: GetServerSideProps<Props> = async () => {
  const res = await fetch('https://api.example.com/users')
  const users = await res.json()

  return { props: { users } }
}

export default function UsersPage({ users }: Props) {
  return (
    <ul>
      {users.map((user) => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  )
}
```

ğŸ”¶ **å±€é™æ€§**ï¼š

- å¸ƒå±€èƒ½åŠ›æœ‰é™ï¼Œ\_app.tsx æ˜¯å”¯ä¸€çš„é¡¶å±‚å¸ƒå±€
- æ•°æ®è·å–åªèƒ½åœ¨é¡µé¢çº§åˆ«ï¼Œä¸èƒ½åœ¨ç»„ä»¶ä¸­
- æ‰€æœ‰ç»„ä»¶é»˜è®¤æ˜¯å®¢æˆ·ç«¯ç»„ä»¶

## åŠŸèƒ½å¯¹æ¯”

### æ•°æ®è·å–

| Pages Router         | App Router             | è¯´æ˜             |
| -------------------- | ---------------------- | ---------------- |
| `getStaticProps`     | å¸¦ç¼“å­˜çš„ fetch         | æ„å»ºæ—¶è·å–       |
| `getServerSideProps` | æ— ç¼“å­˜çš„ fetch         | è¯·æ±‚æ—¶è·å–       |
| `getStaticPaths`     | `generateStaticParams` | åŠ¨æ€è·¯ç”±é™æ€ç”Ÿæˆ |
| `getInitialProps`    | ä¸æ¨èä½¿ç”¨             | å·²åºŸå¼ƒ           |

```tsx
// App Router æ–¹å¼
// Next.js 15.x

// ç­‰åŒäº getStaticPropsï¼ˆæ„å»ºæ—¶ç¼“å­˜ï¼‰
async function getData() {
  const res = await fetch('https://api.example.com/data', {
    cache: 'force-cache', // é»˜è®¤è¡Œä¸º
  })
  return res.json()
}

// ç­‰åŒäº getServerSidePropsï¼ˆæ¯æ¬¡è¯·æ±‚ï¼‰
async function getFreshData() {
  const res = await fetch('https://api.example.com/data', {
    cache: 'no-store',
  })
  return res.json()
}

// ISRï¼ˆå¢é‡é™æ€å†ç”Ÿæˆï¼‰
async function getRevalidatedData() {
  const res = await fetch('https://api.example.com/data', {
    next: { revalidate: 60 }, // 60 ç§’åé‡æ–°éªŒè¯
  })
  return res.json()
}
```

### è·¯ç”±é’©å­

```tsx
// Pages Router
import { useRouter } from 'next/router'

function Component() {
  const router = useRouter()
  const { pathname, query } = router

  return (
    <p>
      Path: {pathname}, ID: {query.id}
    </p>
  )
}
```

```tsx
// App Router
// Next.js 15.x
'use client'

import { useRouter, usePathname, useSearchParams } from 'next/navigation'

function Component() {
  const router = useRouter()
  const pathname = usePathname()
  const searchParams = useSearchParams()

  return (
    <p>
      Path: {pathname}, Query: {searchParams.get('q')}
    </p>
  )
}
```

ğŸ”¶ **æ³¨æ„**ï¼šApp Router çš„ `useRouter` æ¥è‡ª `next/navigation`ï¼Œè€Œä¸æ˜¯ `next/router`ã€‚

## è¿ç§»ç­–ç•¥

### æ¸è¿›å¼è¿ç§»

App Router å’Œ Pages Router å¯ä»¥å…±å­˜ï¼Œæ”¯æŒé€é¡µè¿ç§»ï¼š

```
src/
â”œâ”€â”€ app/                    # App Routerï¼ˆæ–°é¡µé¢ï¼‰
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ dashboard/
â”‚       â””â”€â”€ page.tsx        # /dashboard
â””â”€â”€ pages/                  # Pages Routerï¼ˆæ—§é¡µé¢ï¼‰
    â”œâ”€â”€ _app.tsx
    â””â”€â”€ users/
        â””â”€â”€ index.tsx       # /users
```

ğŸ¯ **è¿ç§»æ­¥éª¤**ï¼š

1. **ä¿æŒ pages ç›®å½•è¿è¡Œ**ï¼šç°æœ‰åŠŸèƒ½ä¸å—å½±å“
2. **æ–°åŠŸèƒ½ä½¿ç”¨ app ç›®å½•**ï¼šæ–°é¡µé¢ç›´æ¥ç”¨ App Router
3. **é€æ­¥è¿ç§»æ—§é¡µé¢**ï¼šæŒ‰ä¼˜å…ˆçº§è¿ç§»
4. **å…±äº«ç»„ä»¶å…¼å®¹å¤„ç†**ï¼šä½¿ç”¨ `next/compat/router`

### å…±äº«ç»„ä»¶å…¼å®¹

å¦‚æœæœ‰ç»„ä»¶éœ€è¦åŒæ—¶åœ¨ä¸¤ç§è·¯ç”±å™¨ä¸­ä½¿ç”¨ï¼š

```tsx
// components/SharedComponent.tsx
// Next.js 15.x
'use client'

import { useRouter } from 'next/compat/router'

export default function SharedComponent() {
  const router = useRouter()

  // å…¼å®¹ä¸¤ç§è·¯ç”±å™¨
  const handleClick = () => {
    router?.push('/new-page')
  }

  return <button onClick={handleClick}>å¯¼èˆª</button>
}
```

### è¿ç§»æ£€æŸ¥æ¸…å•

è¿ç§»ä¸€ä¸ªé¡µé¢æ—¶ï¼Œéœ€è¦å¤„ç†ï¼š

- [ ] å°† `getServerSideProps` / `getStaticProps` æ”¹ä¸º async ç»„ä»¶
- [ ] å°† `useRouter` ä» `next/router` æ”¹ä¸º `next/navigation`
- [ ] æ·»åŠ  `"use client"` æŒ‡ä»¤åˆ°éœ€è¦äº¤äº’çš„ç»„ä»¶
- [ ] åˆ›å»ºå¯¹åº”çš„ `layout.tsx`ï¼ˆå¦‚æœéœ€è¦å¸ƒå±€ï¼‰
- [ ] å¤„ç† `loading.tsx` å’Œ `error.tsx`

## é€‰æ‹©å»ºè®®

ğŸ¯ **ä½¿ç”¨ App Router**ï¼š

- æ–°é¡¹ç›®
- éœ€è¦åµŒå¥—å¸ƒå±€
- å¸Œæœ›åˆ©ç”¨ Server Components å‡å°‘ JS ä½“ç§¯
- å›¢é˜Ÿæ„¿æ„å­¦ä¹ æ–°æ¦‚å¿µ

ğŸ”¶ **ç»§ç»­ä½¿ç”¨ Pages Router**ï¼š

- å¤§å‹é—ç•™é¡¹ç›®ï¼Œè¿ç§»æˆæœ¬é«˜
- ä¾èµ–å¤§é‡ Pages Router ç‰¹å®šçš„åº“
- å›¢é˜Ÿå¯¹æ–°æ¨¡å¼ä¸ç†Ÿæ‚‰ï¼Œæ—¶é—´ç´§è¿«

ğŸ¤” **æ¸è¿›å¼è¿ç§»**ï¼š

- ä¸­å‹é¡¹ç›®ï¼Œå¯ä»¥é€æ­¥è¿‡æ¸¡
- æ–°åŠŸèƒ½ç”¨ App Routerï¼Œæ—§åŠŸèƒ½ä¿æŒä¸å˜

---

ä¸‹ä¸€ç¯‡å°†åŠ¨æ‰‹åˆ›å»ºç¬¬ä¸€ä¸ªé¡µé¢ï¼Œæ·±å…¥ç†è§£ `page.tsx` å’Œ `layout.tsx` çš„åä½œå…³ç³»ã€‚

-EOF-
