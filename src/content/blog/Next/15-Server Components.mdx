---
title: Server Components
description: æ·±å…¥ç†è§£ React Server Components çš„å·¥ä½œåŸç†ã€ä½¿ç”¨åœºæ™¯ä¸æœ€ä½³å®è·µ
pubDate: 2025-12-03
toc: true
ogImage: true
category: Next
tags: ['Next.js', 'Server Components', 'RSC', 'æœåŠ¡ç«¯æ¸²æŸ“']
---

ğŸ™‹ Server Components æ˜¯ App Router çš„æ ¸å¿ƒç‰¹æ€§ã€‚ç»„ä»¶åœ¨æœåŠ¡ç«¯æ‰§è¡Œæ„å‘³ç€ä»€ä¹ˆï¼Ÿèƒ½å¸¦æ¥å“ªäº›ä¼˜åŠ¿ï¼Ÿ

## ä»€ä¹ˆæ˜¯ Server Components

React Server Components (RSC) æ˜¯ä¸€ç§æ–°çš„ç»„ä»¶ç±»å‹ï¼Œåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå¹¶æ¸²æŸ“ï¼Œè€Œä¸æ˜¯åœ¨æµè§ˆå™¨ä¸­ã€‚

### æ ¸å¿ƒç‰¹ç‚¹

| ç‰¹æ€§       | Server Components | Client Components |
| ---------- | ----------------- | ----------------- |
| æ‰§è¡Œç¯å¢ƒ   | æœåŠ¡å™¨            | æµè§ˆå™¨            |
| JavaScript | ä¸å‘é€åˆ°å®¢æˆ·ç«¯    | æ‰“åŒ…å‘é€åˆ°å®¢æˆ·ç«¯  |
| æ•°æ®è·å–   | ç›´æ¥è®¿é—®åç«¯èµ„æº  | é€šè¿‡ API è·å–     |
| çŠ¶æ€/äº¤äº’  | âŒ ä¸æ”¯æŒ         | âœ… æ”¯æŒ           |
| ç”Ÿå‘½å‘¨æœŸ   | âŒ ä¸æ”¯æŒ         | âœ… æ”¯æŒ           |

### é»˜è®¤è¡Œä¸º

åœ¨ App Router ä¸­ï¼Œç»„ä»¶**é»˜è®¤æ˜¯ Server Components**ï¼š

```tsx
// app/page.tsx - è¿™æ˜¯ Server Component
// Next.js 15.x

export default function HomePage() {
  console.log('è¿™è¡Œæ—¥å¿—åœ¨æœåŠ¡å™¨ç»ˆç«¯è¾“å‡º')

  return <h1>Hello from Server</h1>
}
```

## Server Components ä¼˜åŠ¿

### 1. å‡å°‘å®¢æˆ·ç«¯ JavaScript

```tsx
// app/page.tsx
// Next.js 15.x

// è¿™äº›ä¾èµ–ä¸ä¼šå‘é€åˆ°å®¢æˆ·ç«¯
import { marked } from 'marked'
import hljs from 'highlight.js'

async function getContent() {
  const res = await fetch('https://api.example.com/content')
  return res.json()
}

export default async function Page() {
  const content = await getContent()

  // åœ¨æœåŠ¡ç«¯å¤„ç† Markdown
  const html = marked(content.markdown, {
    highlight: (code, lang) => hljs.highlight(code, { language: lang }).value,
  })

  return <article dangerouslySetInnerHTML={{ __html: html }} />
}
```

ğŸ¯ **æ•ˆæœ**ï¼š`marked` å’Œ `highlight.js` çš„ä»£ç ä¸ä¼šæ‰“åŒ…åˆ°å®¢æˆ·ç«¯ï¼Œå‡å°‘ bundle ä½“ç§¯ã€‚

### 2. ç›´æ¥è®¿é—®åç«¯èµ„æº

```tsx
// app/users/page.tsx
// Next.js 15.x
import { db } from '@/lib/db'

export default async function UsersPage() {
  // ç›´æ¥æŸ¥è¯¢æ•°æ®åº“
  const users = await db.user.findMany({
    select: { id: true, name: true, email: true },
  })

  return (
    <ul>
      {users.map((user) => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  )
}
```

```tsx
// app/files/page.tsx
// Next.js 15.x
import { readFile } from 'fs/promises'
import { join } from 'path'

export default async function FilesPage() {
  // ç›´æ¥è¯»å–æ–‡ä»¶ç³»ç»Ÿ
  const content = await readFile(
    join(process.cwd(), 'data', 'config.json'),
    'utf-8'
  )
  const config = JSON.parse(content)

  return <pre>{JSON.stringify(config, null, 2)}</pre>
}
```

### 3. æ•æ„Ÿä¿¡æ¯å®‰å…¨

```tsx
// app/admin/page.tsx
// Next.js 15.x

export default async function AdminPage() {
  // API å¯†é’¥ä¸ä¼šæš´éœ²ç»™å®¢æˆ·ç«¯
  const response = await fetch('https://api.stripe.com/v1/charges', {
    headers: {
      Authorization: `Bearer ${process.env.STRIPE_SECRET_KEY}`,
    },
  })

  const charges = await response.json()

  return <div>{/* æ˜¾ç¤ºæ•°æ® */}</div>
}
```

### 4. æ›´å¥½çš„åˆå§‹åŠ è½½

```tsx
// Server Component çš„ HTML å¯ä»¥ç«‹å³æ˜¾ç¤º
// ä¸éœ€è¦ç­‰å¾… JavaScript åŠ è½½å’Œæ‰§è¡Œ

export default async function Page() {
  const data = await getData()

  // ç”¨æˆ·ç«‹å³çœ‹åˆ°å®Œæ•´ HTML
  return <div>{data.content}</div>
}
```

## å¼‚æ­¥æ•°æ®è·å–

Server Components å¯ä»¥æ˜¯å¼‚æ­¥å‡½æ•°ï¼š

### åŸºç¡€ç”¨æ³•

```tsx
// app/posts/page.tsx
// Next.js 15.x

interface Post {
  id: number
  title: string
  body: string
}

async function getPosts(): Promise<Post[]> {
  const res = await fetch('https://jsonplaceholder.typicode.com/posts')

  if (!res.ok) {
    throw new Error('Failed to fetch posts')
  }

  return res.json()
}

export default async function PostsPage() {
  const posts = await getPosts()

  return (
    <ul className="space-y-4">
      {posts.slice(0, 10).map((post) => (
        <li key={post.id} className="border-b pb-4">
          <h2 className="font-bold">{post.title}</h2>
          <p className="text-gray-600">{post.body}</p>
        </li>
      ))}
    </ul>
  )
}
```

### å¹¶è¡Œæ•°æ®è·å–

```tsx
// app/dashboard/page.tsx
// Next.js 15.x

async function getUser() {
  const res = await fetch('https://api.example.com/user')
  return res.json()
}

async function getStats() {
  const res = await fetch('https://api.example.com/stats')
  return res.json()
}

async function getNotifications() {
  const res = await fetch('https://api.example.com/notifications')
  return res.json()
}

export default async function DashboardPage() {
  // å¹¶è¡Œè·å–æ•°æ®
  const [user, stats, notifications] = await Promise.all([
    getUser(),
    getStats(),
    getNotifications(),
  ])

  return (
    <div>
      <h1>æ¬¢è¿, {user.name}</h1>
      <div>è®¿é—®é‡: {stats.visits}</div>
      <div>é€šçŸ¥: {notifications.length} æ¡</div>
    </div>
  )
}
```

### ç€‘å¸ƒæµé¿å…

```tsx
// âŒ ç€‘å¸ƒæµï¼šé¡ºåºè¯·æ±‚ï¼Œæ•ˆç‡ä½
async function Page() {
  const user = await getUser() // 1s
  const posts = await getPosts() // 1s
  const comments = await getComments() // 1s
  // æ€»è®¡ 3s
}

// âœ… å¹¶è¡Œï¼šåŒæ—¶è¯·æ±‚
async function Page() {
  const [user, posts, comments] = await Promise.all([
    getUser(),
    getPosts(),
    getComments(),
  ])
  // æ€»è®¡ ~1s
}
```

## ç»„ä»¶ç»„åˆ

### Server åŒ…å« Server

```tsx
// app/layout.tsx
// Next.js 15.x

import { Header } from '@/components/Header'
import { Footer } from '@/components/Footer'

// Server Component å¯ä»¥å¯¼å…¥å…¶ä»– Server Component
export default function Layout({ children }: { children: React.ReactNode }) {
  return (
    <>
      <Header /> {/* Server Component */}
      {children}
      <Footer /> {/* Server Component */}
    </>
  )
}
```

### Server åŒ…å« Client

```tsx
// app/page.tsx - Server Component
// Next.js 15.x

import { InteractiveButton } from '@/components/InteractiveButton'

async function getData() {
  return { message: 'Hello' }
}

export default async function Page() {
  const data = await getData()

  return (
    <div>
      <h1>{data.message}</h1>
      {/* Client Component ä½œä¸ºå­ç»„ä»¶ */}
      <InteractiveButton />
    </div>
  )
}
```

```tsx
// components/InteractiveButton.tsx - Client Component
'use client'

import { useState } from 'react'

export function InteractiveButton() {
  const [count, setCount] = useState(0)

  return <button onClick={() => setCount(count + 1)}>ç‚¹å‡»æ¬¡æ•°: {count}</button>
}
```

### ä¼ é€’æ•°æ®ç»™ Client

```tsx
// app/page.tsx - Server Component
// Next.js 15.x

import { ProductList } from '@/components/ProductList'

async function getProducts() {
  const res = await fetch('https://api.example.com/products')
  return res.json()
}

export default async function Page() {
  // åœ¨æœåŠ¡ç«¯è·å–æ•°æ®
  const products = await getProducts()

  // ä¼ é€’ç»™ Client Component
  return <ProductList initialProducts={products} />
}
```

```tsx
// components/ProductList.tsx - Client Component
'use client'

import { useState } from 'react'

interface Product {
  id: string
  name: string
  price: number
}

interface Props {
  initialProducts: Product[]
}

export function ProductList({ initialProducts }: Props) {
  const [products, setProducts] = useState(initialProducts)
  const [filter, setFilter] = useState('')

  const filtered = products.filter((p) =>
    p.name.toLowerCase().includes(filter.toLowerCase())
  )

  return (
    <div>
      <input
        value={filter}
        onChange={(e) => setFilter(e.target.value)}
        placeholder="æœç´¢äº§å“..."
      />
      <ul>
        {filtered.map((product) => (
          <li key={product.id}>
            {product.name} - Â¥{product.price}
          </li>
        ))}
      </ul>
    </div>
  )
}
```

ğŸ”¶ **æ³¨æ„**ï¼šä¼ é€’ç»™ Client Component çš„ props å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ï¼ˆä¸èƒ½ä¼ é€’å‡½æ•°ã€ç±»å®ä¾‹ç­‰ï¼‰ã€‚

## ä½¿ç”¨é™åˆ¶

### ä¸èƒ½ä½¿ç”¨çš„åŠŸèƒ½

```tsx
// âŒ Server Component ä¸æ”¯æŒ

// 1. React Hooks
import { useState, useEffect } from 'react'
export default function Page() {
  const [state, setState] = useState(0) // é”™è¯¯ï¼
}

// 2. æµè§ˆå™¨ API
export default function Page() {
  window.localStorage.getItem('key') // é”™è¯¯ï¼
}

// 3. äº‹ä»¶å¤„ç†
export default function Page() {
  return <button onClick={() => {}}>ç‚¹å‡»</button> // é”™è¯¯ï¼
}
```

### ä½•æ—¶éœ€è¦ Client Component

- ä½¿ç”¨ `useState`ã€`useEffect` ç­‰ hooks
- ä½¿ç”¨æµè§ˆå™¨ APIï¼ˆlocalStorageã€window ç­‰ï¼‰
- éœ€è¦äº‹ä»¶ç›‘å¬ï¼ˆonClickã€onChange ç­‰ï¼‰
- ä½¿ç”¨ä¾èµ–çŠ¶æ€çš„ç¬¬ä¸‰æ–¹åº“

## æœ€ä½³å®è·µ

### 1. å°½å¯èƒ½ä½¿ç”¨ Server Components

```tsx
// âœ… å¥½ï¼šåªåœ¨éœ€è¦äº¤äº’çš„åœ°æ–¹ä½¿ç”¨ Client
// app/page.tsx
import { StaticContent } from '@/components/StaticContent'
import { InteractiveWidget } from '@/components/InteractiveWidget'

export default function Page() {
  return (
    <div>
      <StaticContent /> {/* Server */}
      <InteractiveWidget /> {/* Client */}
    </div>
  )
}
```

### 2. å°† Client è¾¹ç•Œæ¨åˆ°å¶å­èŠ‚ç‚¹

```tsx
// âŒ å·®ï¼šæ•´ä¸ªç»„ä»¶æ˜¯ Client
'use client'
export default function Page() {
  const [open, setOpen] = useState(false)
  return (
    <div>
      <h1>æ ‡é¢˜</h1>
      <p>å¤§é‡é™æ€å†…å®¹...</p>
      <button onClick={() => setOpen(!open)}>åˆ‡æ¢</button>
      {open && <Modal />}
    </div>
  )
}

// âœ… å¥½ï¼šåªæœ‰æŒ‰é’®æ˜¯ Client
// page.tsx (Server)
import { ToggleButton } from './ToggleButton'

export default function Page() {
  return (
    <div>
      <h1>æ ‡é¢˜</h1>
      <p>å¤§é‡é™æ€å†…å®¹...</p>
      <ToggleButton />
    </div>
  )
}

// ToggleButton.tsx (Client)
;('use client')
export function ToggleButton() {
  const [open, setOpen] = useState(false)
  return (
    <>
      <button onClick={() => setOpen(!open)}>åˆ‡æ¢</button>
      {open && <Modal />}
    </>
  )
}
```

### 3. ä½¿ç”¨ children æ¨¡å¼

```tsx
// components/ClientWrapper.tsx
'use client'

export function ClientWrapper({ children }: { children: React.ReactNode }) {
  const [mounted, setMounted] = useState(false)

  useEffect(() => {
    setMounted(true)
  }, [])

  if (!mounted) return null

  return <div>{children}</div>
}
```

```tsx
// app/page.tsx
import { ClientWrapper } from '@/components/ClientWrapper'
import { ServerContent } from '@/components/ServerContent'

export default function Page() {
  return (
    <ClientWrapper>
      {/* Server Component ä½œä¸º children ä¼ å…¥ */}
      <ServerContent />
    </ClientWrapper>
  )
}
```

## å¸¸è§é—®é¢˜

ğŸ¤” **Q: å¦‚ä½•åˆ¤æ–­ç»„ä»¶æ˜¯ Server è¿˜æ˜¯ Clientï¼Ÿ**

- æ²¡æœ‰ `"use client"` æŒ‡ä»¤çš„æ˜¯ Server Component
- æœ‰ `"use client"` æˆ–è¢« Client Component å¯¼å…¥çš„æ˜¯ Client Component

ğŸ¤” **Q: Server Component å¯ä»¥è°ƒç”¨ API å—ï¼Ÿ**

å¯ä»¥ç›´æ¥ç”¨ `fetch`ï¼Œä¸éœ€è¦é¢å¤–çš„ API è·¯ç”±ã€‚

ğŸ¤” **Q: Server Component çš„é”™è¯¯å¦‚ä½•å¤„ç†ï¼Ÿ**

ä½¿ç”¨ `error.tsx` æ–‡ä»¶åˆ›å»ºé”™è¯¯è¾¹ç•Œã€‚

---

ä¸‹ä¸€ç¯‡å°†ä»‹ç» Client Componentsï¼Œæ·±å…¥ç†è§£ `"use client"` æŒ‡ä»¤å’Œäº¤äº’å¼ç»„ä»¶çš„å¼€å‘ã€‚

-EOF-
