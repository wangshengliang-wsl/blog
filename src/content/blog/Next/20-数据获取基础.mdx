---
title: æ•°æ®è·å–åŸºç¡€
description: æŒæ¡ Next.js ä¸­çš„æ•°æ®è·å–æ–¹å¼ï¼ŒåŒ…æ‹¬ fetch APIã€å¹¶è¡Œè¯·æ±‚ä¸æ•°æ®ä¼ é€’æ¨¡å¼
pubDate: 2025-12-03
toc: true
ogImage: true
category: Next
tags: ['Next.js', 'æ•°æ®è·å–', 'fetch', 'Server Components']
---

ğŸ™‹ åœ¨ Next.js ä¸­è·å–æ•°æ®æœ‰å¤šç§æ–¹å¼ã€‚ä»€ä¹ˆæ—¶å€™ç”¨ fetchï¼Ÿä»€ä¹ˆæ—¶å€™ç›´æ¥æŸ¥æ•°æ®åº“ï¼Ÿå¦‚ä½•é¿å…è¯·æ±‚ç€‘å¸ƒï¼Ÿ

## æ•°æ®è·å–æ–¹å¼

### 1. Server Components ä¸­çš„ fetch

```tsx
// app/posts/page.tsx
// Next.js 15.x

interface Post {
  id: number
  title: string
  body: string
}

async function getPosts(): Promise<Post[]> {
  const res = await fetch('https://jsonplaceholder.typicode.com/posts')

  if (!res.ok) {
    throw new Error('è·å–æ–‡ç« å¤±è´¥')
  }

  return res.json()
}

export default async function PostsPage() {
  const posts = await getPosts()

  return (
    <ul className="space-y-4">
      {posts.slice(0, 10).map((post) => (
        <li key={post.id}>
          <h2 className="font-bold">{post.title}</h2>
          <p className="text-gray-600">{post.body}</p>
        </li>
      ))}
    </ul>
  )
}
```

### 2. ç›´æ¥è®¿é—®æ•°æ®åº“

```tsx
// app/users/page.tsx
// Next.js 15.x
import { db } from '@/lib/db'

export default async function UsersPage() {
  // ç›´æ¥ä½¿ç”¨ ORM æŸ¥è¯¢
  const users = await db.user.findMany({
    select: {
      id: true,
      name: true,
      email: true,
    },
    orderBy: { createdAt: 'desc' },
    take: 20,
  })

  return (
    <ul>
      {users.map((user) => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  )
}
```

### 3. è¯»å–æ–‡ä»¶ç³»ç»Ÿ

```tsx
// app/docs/page.tsx
// Next.js 15.x
import { readdir, readFile } from 'fs/promises'
import { join } from 'path'
import matter from 'gray-matter'

async function getDocs() {
  const docsDir = join(process.cwd(), 'content', 'docs')
  const files = await readdir(docsDir)

  const docs = await Promise.all(
    files
      .filter((file) => file.endsWith('.md'))
      .map(async (file) => {
        const content = await readFile(join(docsDir, file), 'utf-8')
        const { data, content: body } = matter(content)
        return { slug: file.replace('.md', ''), ...data, body }
      })
  )

  return docs
}

export default async function DocsPage() {
  const docs = await getDocs()
  return <div>{/* æ¸²æŸ“æ–‡æ¡£åˆ—è¡¨ */}</div>
}
```

## è¯·æ±‚æ¨¡å¼

### é¡ºåºè¯·æ±‚ï¼ˆç€‘å¸ƒæµï¼‰

```tsx
// âŒ æ•ˆç‡ä½ï¼šè¯·æ±‚ä¾æ¬¡æ‰§è¡Œ
async function Page() {
  const user = await getUser() // 1ç§’
  const posts = await getPosts() // 1ç§’
  const comments = await getComments() // 1ç§’
  // æ€»è®¡ï¼š3ç§’

  return <div>{/* ... */}</div>
}
```

### å¹¶è¡Œè¯·æ±‚

```tsx
// âœ… é«˜æ•ˆï¼šè¯·æ±‚åŒæ—¶æ‰§è¡Œ
async function Page() {
  const [user, posts, comments] = await Promise.all([
    getUser(),
    getPosts(),
    getComments(),
  ])
  // æ€»è®¡ï¼š~1ç§’ï¼ˆå–å†³äºæœ€æ…¢çš„è¯·æ±‚ï¼‰

  return <div>{/* ... */}</div>
}
```

### é¢„åŠ è½½æ¨¡å¼

```tsx
// lib/data.ts
import { cache } from 'react'

// ä½¿ç”¨ cache åŒ…è£…ç¡®ä¿è¯·æ±‚å»é‡
export const getUser = cache(async (id: string) => {
  const res = await fetch(`https://api.example.com/users/${id}`)
  return res.json()
})

// é¢„åŠ è½½å‡½æ•°
export const preloadUser = (id: string) => {
  void getUser(id)
}
```

```tsx
// app/user/[id]/page.tsx
import { getUser, preloadUser } from '@/lib/data'
import { UserProfile } from '@/components/UserProfile'

export default async function UserPage({
  params,
}: {
  params: Promise<{ id: string }>
}) {
  const { id } = await params

  // æå‰å¼€å§‹è·å–æ•°æ®
  preloadUser(id)

  return <UserProfile userId={id} />
}
```

```tsx
// components/UserProfile.tsx
import { getUser } from '@/lib/data'

export async function UserProfile({ userId }: { userId: string }) {
  // å¤ç”¨å·²ç»å¼€å§‹çš„è¯·æ±‚
  const user = await getUser(userId)

  return <div>{user.name}</div>
}
```

## æ•°æ®ä¼ é€’

### Props ä¼ é€’

```tsx
// app/dashboard/page.tsx
// Next.js 15.x
import { StatsCard } from '@/components/StatsCard'

async function getStats() {
  const res = await fetch('https://api.example.com/stats')
  return res.json()
}

export default async function DashboardPage() {
  const stats = await getStats()

  return (
    <div className="grid grid-cols-3 gap-4">
      <StatsCard title="ç”¨æˆ·æ•°" value={stats.users} />
      <StatsCard title="è®¢å•æ•°" value={stats.orders} />
      <StatsCard title="æ”¶å…¥" value={`Â¥${stats.revenue}`} />
    </div>
  )
}
```

### Server â†’ Client ä¼ é€’

```tsx
// app/products/page.tsx - Server Component
import { ProductFilter } from '@/components/ProductFilter'

async function getProducts() {
  const res = await fetch('https://api.example.com/products')
  return res.json()
}

async function getCategories() {
  const res = await fetch('https://api.example.com/categories')
  return res.json()
}

export default async function ProductsPage() {
  const [products, categories] = await Promise.all([
    getProducts(),
    getCategories(),
  ])

  // ä¼ é€’ç»™ Client Component
  return <ProductFilter initialProducts={products} categories={categories} />
}
```

ğŸ”¶ **æ³¨æ„**ï¼šä¼ é€’çš„æ•°æ®å¿…é¡»å¯åºåˆ—åŒ–ï¼ˆä¸èƒ½ä¼ å‡½æ•°ã€ç±»å®ä¾‹ç­‰ï¼‰ã€‚

### ç»„ä»¶çº§æ•°æ®è·å–

```tsx
// components/UserAvatar.tsx - Server Component
async function getUser(id: string) {
  const res = await fetch(`https://api.example.com/users/${id}`)
  return res.json()
}

export async function UserAvatar({ userId }: { userId: string }) {
  const user = await getUser(userId)

  return (
    <img src={user.avatar} alt={user.name} className="w-10 h-10 rounded-full" />
  )
}
```

```tsx
// app/page.tsx
import { UserAvatar } from '@/components/UserAvatar'

export default function Page() {
  return (
    <div>
      <UserAvatar userId="1" />
      <UserAvatar userId="2" />
      {/* è¯·æ±‚ä¼šè‡ªåŠ¨å»é‡ */}
    </div>
  )
}
```

## è¯·æ±‚å»é‡

### è‡ªåŠ¨å»é‡

Next.js æ‰©å±•äº† fetchï¼Œç›¸åŒè¯·æ±‚è‡ªåŠ¨å»é‡ï¼š

```tsx
// ä»¥ä¸‹ä¸¤ä¸ªè°ƒç”¨å®é™…ä¸Šåªå‘é€ä¸€æ¬¡è¯·æ±‚
async function getUser() {
  return fetch('https://api.example.com/user').then((r) => r.json())
}

async function ComponentA() {
  const user = await getUser()
  return <div>{user.name}</div>
}

async function ComponentB() {
  const user = await getUser() // å¤ç”¨ ComponentA çš„è¯·æ±‚
  return <div>{user.email}</div>
}
```

### ä½¿ç”¨ React cache

å¯¹äºé fetch çš„æ•°æ®è·å–ï¼Œä½¿ç”¨ `cache`ï¼š

```tsx
// lib/data.ts
import { cache } from 'react'
import { db } from './db'

export const getUser = cache(async (id: string) => {
  return db.user.findUnique({ where: { id } })
})
```

## é”™è¯¯å¤„ç†

### try-catch

```tsx
async function getData() {
  try {
    const res = await fetch('https://api.example.com/data')

    if (!res.ok) {
      throw new Error(`HTTP error! status: ${res.status}`)
    }

    return res.json()
  } catch (error) {
    console.error('æ•°æ®è·å–å¤±è´¥:', error)
    return null
  }
}

export default async function Page() {
  const data = await getData()

  if (!data) {
    return <div>æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</div>
  }

  return <div>{data.content}</div>
}
```

### æŠ›å‡ºé”™è¯¯

```tsx
async function getData() {
  const res = await fetch('https://api.example.com/data')

  if (!res.ok) {
    throw new Error('è·å–æ•°æ®å¤±è´¥')
  }

  return res.json()
}

export default async function Page() {
  const data = await getData() // é”™è¯¯ä¼šè¢« error.tsx æ•è·
  return <div>{data.content}</div>
}
```

### ä½¿ç”¨ notFound

```tsx
import { notFound } from 'next/navigation'

async function getPost(slug: string) {
  const res = await fetch(`https://api.example.com/posts/${slug}`)

  if (res.status === 404) {
    notFound()
  }

  if (!res.ok) {
    throw new Error('è·å–æ–‡ç« å¤±è´¥')
  }

  return res.json()
}
```

## å®æˆ˜ç¤ºä¾‹

### åšå®¢åˆ—è¡¨ä¸è¯¦æƒ…

```tsx
// lib/posts.ts
import { cache } from 'react'

export interface Post {
  slug: string
  title: string
  content: string
  publishedAt: string
}

const API_URL = 'https://api.example.com'

export const getPosts = cache(async (): Promise<Post[]> => {
  const res = await fetch(`${API_URL}/posts`, {
    next: { revalidate: 60 },
  })
  return res.json()
})

export const getPost = cache(async (slug: string): Promise<Post | null> => {
  const res = await fetch(`${API_URL}/posts/${slug}`, {
    next: { tags: [`post-${slug}`] },
  })

  if (!res.ok) return null
  return res.json()
})
```

```tsx
// app/blog/page.tsx
import Link from 'next/link'
import { getPosts } from '@/lib/posts'

export default async function BlogPage() {
  const posts = await getPosts()

  return (
    <div className="space-y-6">
      <h1 className="text-3xl font-bold">åšå®¢</h1>
      <ul className="space-y-4">
        {posts.map((post) => (
          <li key={post.slug}>
            <Link
              href={`/blog/${post.slug}`}
              className="block p-4 border rounded hover:bg-gray-50"
            >
              <h2 className="font-semibold">{post.title}</h2>
              <time className="text-sm text-gray-500">{post.publishedAt}</time>
            </Link>
          </li>
        ))}
      </ul>
    </div>
  )
}
```

```tsx
// app/blog/[slug]/page.tsx
import { notFound } from 'next/navigation'
import { getPost, getPosts } from '@/lib/posts'

export async function generateStaticParams() {
  const posts = await getPosts()
  return posts.map((post) => ({ slug: post.slug }))
}

export default async function PostPage({
  params,
}: {
  params: Promise<{ slug: string }>
}) {
  const { slug } = await params
  const post = await getPost(slug)

  if (!post) {
    notFound()
  }

  return (
    <article className="prose max-w-none">
      <h1>{post.title}</h1>
      <time>{post.publishedAt}</time>
      <div dangerouslySetInnerHTML={{ __html: post.content }} />
    </article>
  )
}
```

## å¸¸è§é—®é¢˜

ğŸ¤” **Q: fetch å’Œ axios æ€ä¹ˆé€‰ï¼Ÿ**

æ¨èä½¿ç”¨åŸç”Ÿ fetchï¼Œå› ä¸º Next.js å¯¹å…¶åšäº†æ‰©å±•ï¼ˆç¼“å­˜ã€å»é‡ç­‰ï¼‰ã€‚

ğŸ¤” **Q: æ•°æ®è·å–åº”è¯¥æ”¾åœ¨é¡µé¢è¿˜æ˜¯ç»„ä»¶ä¸­ï¼Ÿ**

- é¡µé¢çº§æ•°æ®ï¼šæ”¾åœ¨é¡µé¢ç»„ä»¶ä¸­
- ç»„ä»¶ä¸“å±æ•°æ®ï¼šå¯ä»¥æ”¾åœ¨ç»„ä»¶ä¸­
- å…±äº«æ•°æ®ï¼šæŠ½å–åˆ°ç‹¬ç«‹å‡½æ•°ï¼Œä½¿ç”¨ cache åŒ…è£…

ğŸ¤” **Q: å¦‚ä½•å¤„ç†åŠ è½½çŠ¶æ€ï¼Ÿ**

ä½¿ç”¨ `loading.tsx` æˆ– `Suspense` è¾¹ç•Œã€‚

---

ä¸‹ä¸€ç¯‡å°†æ·±å…¥ç¼“å­˜ç­–ç•¥ï¼ŒæŒæ¡ fetch ç¼“å­˜ã€æ•°æ®ç¼“å­˜ä¸è·¯ç”±ç¼“å­˜çš„é…ç½®ã€‚

-EOF-
