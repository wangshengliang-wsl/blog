---
title: é”™è¯¯å¤„ç†
description: æŒæ¡ Next.js çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œä½¿ç”¨ error.tsx å’Œ not-found.tsx æ„å»ºå¥å£®çš„åº”ç”¨
pubDate: 2025-12-03
toc: true
ogImage: true
category: Next
tags: ['Next.js', 'é”™è¯¯å¤„ç†', 'error.tsx', 'not-found']
---

ğŸ™‹ ç”¨æˆ·é‡åˆ°é”™è¯¯æ—¶çœ‹åˆ°ç™½å±ï¼Ÿè‰¯å¥½çš„é”™è¯¯å¤„ç†èƒ½æå‡ç”¨æˆ·ä½“éªŒï¼Œä¹Ÿæ–¹ä¾¿å¼€å‘è°ƒè¯•ã€‚

## é”™è¯¯è¾¹ç•Œæ¦‚è¿°

Next.js æä¾›äº†å¤šå±‚é”™è¯¯å¤„ç†æœºåˆ¶ï¼š

| æ–‡ä»¶               | ä½œç”¨           | è§¦å‘æ¡ä»¶                       |
| ------------------ | -------------- | ------------------------------ |
| `error.tsx`        | æ•è·è¿è¡Œæ—¶é”™è¯¯ | ç»„ä»¶æ¸²æŸ“é”™è¯¯ã€æ•°æ®è·å–å¤±è´¥     |
| `not-found.tsx`    | å¤„ç† 404       | è°ƒç”¨ `notFound()` æˆ–è·¯ç”±ä¸å­˜åœ¨ |
| `global-error.tsx` | å…¨å±€é”™è¯¯è¾¹ç•Œ   | æ ¹å¸ƒå±€é”™è¯¯                     |

## error.tsx

### åŸºç¡€ç”¨æ³•

```
app/
â”œâ”€â”€ error.tsx        # å…¨å±€é”™è¯¯è¾¹ç•Œ
â””â”€â”€ dashboard/
    â”œâ”€â”€ error.tsx    # dashboard è·¯ç”±çš„é”™è¯¯è¾¹ç•Œ
    â””â”€â”€ page.tsx
```

```tsx
// app/dashboard/error.tsx
'use client' // å¿…é¡»æ˜¯ Client Component

export default function Error({
  error,
  reset,
}: {
  error: Error & { digest?: string }
  reset: () => void
}) {
  return (
    <div className="p-8 text-center">
      <h2 className="text-2xl font-bold text-red-600 mb-4">å‡ºé”™äº†</h2>
      <p className="text-gray-600 mb-4">{error.message}</p>
      <button
        onClick={reset}
        className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
      >
        é‡è¯•
      </button>
    </div>
  )
}
```

ğŸ”¶ **æ³¨æ„**ï¼š`error.tsx` å¿…é¡»æ˜¯ Client Componentï¼Œå› ä¸ºéœ€è¦ä½¿ç”¨ `reset` å‡½æ•°ã€‚

### é”™è¯¯ä¿¡æ¯å¤„ç†

```tsx
// app/error.tsx
'use client'

import { useEffect } from 'react'

export default function Error({
  error,
  reset,
}: {
  error: Error & { digest?: string }
  reset: () => void
}) {
  useEffect(() => {
    // ä¸ŠæŠ¥é”™è¯¯åˆ°ç›‘æ§æœåŠ¡
    console.error('Error:', error)

    // ä¾‹å¦‚å‘é€åˆ° Sentry
    // Sentry.captureException(error)
  }, [error])

  return (
    <div className="min-h-screen flex items-center justify-center">
      <div className="text-center max-w-md">
        <h1 className="text-6xl font-bold text-gray-200 mb-4">500</h1>
        <h2 className="text-xl font-semibold mb-2">æœåŠ¡å™¨é”™è¯¯</h2>
        <p className="text-gray-500 mb-6">
          {process.env.NODE_ENV === 'development'
            ? error.message
            : 'æŠ±æ­‰ï¼ŒæœåŠ¡å™¨å‡ºç°äº†é—®é¢˜ï¼Œè¯·ç¨åé‡è¯•ã€‚'}
        </p>
        {error.digest && (
          <p className="text-sm text-gray-400 mb-4">é”™è¯¯ä»£ç : {error.digest}</p>
        )}
        <div className="space-x-4">
          <button
            onClick={reset}
            className="px-4 py-2 bg-blue-600 text-white rounded"
          >
            é‡è¯•
          </button>
          <a href="/" className="px-4 py-2 border rounded">
            è¿”å›é¦–é¡µ
          </a>
        </div>
      </div>
    </div>
  )
}
```

### åµŒå¥—é”™è¯¯è¾¹ç•Œ

```
app/
â”œâ”€â”€ error.tsx            # æ•è·æ‰€æœ‰å­è·¯ç”±é”™è¯¯
â”œâ”€â”€ layout.tsx
â””â”€â”€ dashboard/
    â”œâ”€â”€ error.tsx        # åªæ•è· dashboard å†…çš„é”™è¯¯
    â”œâ”€â”€ layout.tsx
    â””â”€â”€ settings/
        â”œâ”€â”€ error.tsx    # åªæ•è· settings å†…çš„é”™è¯¯
        â””â”€â”€ page.tsx
```

é”™è¯¯ä¼šå‘ä¸Šå†’æ³¡ï¼Œç›´åˆ°è¢«æœ€è¿‘çš„ `error.tsx` æ•è·ã€‚

## not-found.tsx

### åŸºç¡€ç”¨æ³•

```tsx
// app/not-found.tsx
import Link from 'next/link'

export default function NotFound() {
  return (
    <div className="min-h-screen flex items-center justify-center">
      <div className="text-center">
        <h1 className="text-9xl font-bold text-gray-200">404</h1>
        <h2 className="text-2xl font-semibold mb-4">é¡µé¢æœªæ‰¾åˆ°</h2>
        <p className="text-gray-500 mb-8">æ‚¨è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤ã€‚</p>
        <Link href="/" className="px-6 py-3 bg-blue-600 text-white rounded-lg">
          è¿”å›é¦–é¡µ
        </Link>
      </div>
    </div>
  )
}
```

### æ‰‹åŠ¨è§¦å‘ 404

```tsx
// app/posts/[slug]/page.tsx
import { notFound } from 'next/navigation'

async function getPost(slug: string) {
  const res = await fetch(`https://api.example.com/posts/${slug}`)

  if (!res.ok) {
    return null
  }

  return res.json()
}

export default async function PostPage({
  params,
}: {
  params: Promise<{ slug: string }>
}) {
  const { slug } = await params
  const post = await getPost(slug)

  if (!post) {
    notFound() // è§¦å‘ not-found.tsx
  }

  return <article>{post.content}</article>
}
```

### è·¯ç”±çº§ not-found

```
app/
â”œâ”€â”€ not-found.tsx        # å…¨å±€ 404
â””â”€â”€ blog/
    â”œâ”€â”€ not-found.tsx    # blog è·¯ç”±çš„ 404
    â””â”€â”€ [slug]/
        â””â”€â”€ page.tsx
```

```tsx
// app/blog/not-found.tsx
import Link from 'next/link'

export default function BlogNotFound() {
  return (
    <div className="p-8 text-center">
      <h2 className="text-2xl font-bold mb-4">æ–‡ç« æœªæ‰¾åˆ°</h2>
      <p className="text-gray-500 mb-4">è¯¥æ–‡ç« å¯èƒ½å·²è¢«åˆ é™¤æˆ–å°šæœªå‘å¸ƒã€‚</p>
      <Link href="/blog" className="text-blue-600">
        æµè§ˆæ‰€æœ‰æ–‡ç« 
      </Link>
    </div>
  )
}
```

## global-error.tsx

ç”¨äºæ•è·æ ¹å¸ƒå±€ä¸­çš„é”™è¯¯ï¼š

```tsx
// app/global-error.tsx
'use client'

export default function GlobalError({
  error,
  reset,
}: {
  error: Error & { digest?: string }
  reset: () => void
}) {
  return (
    <html>
      <body>
        <div className="min-h-screen flex items-center justify-center bg-gray-100">
          <div className="text-center">
            <h2 className="text-2xl font-bold text-red-600 mb-4">
              åº”ç”¨å‘ç”Ÿä¸¥é‡é”™è¯¯
            </h2>
            <p className="text-gray-600 mb-4">è¯·åˆ·æ–°é¡µé¢æˆ–è”ç³»æ”¯æŒã€‚</p>
            <button
              onClick={reset}
              className="px-4 py-2 bg-blue-600 text-white rounded"
            >
              åˆ·æ–°é¡µé¢
            </button>
          </div>
        </div>
      </body>
    </html>
  )
}
```

ğŸ”¶ **æ³¨æ„**ï¼š`global-error.tsx` å¿…é¡»å®šä¹‰è‡ªå·±çš„ `<html>` å’Œ `<body>` æ ‡ç­¾ã€‚

## Server Actions é”™è¯¯å¤„ç†

### è¿”å›é”™è¯¯çŠ¶æ€

```tsx
// app/actions.ts
'use server'

import { z } from 'zod'

const schema = z.object({
  email: z.string().email(),
  password: z.string().min(8),
})

export async function login(prevState: any, formData: FormData) {
  const result = schema.safeParse({
    email: formData.get('email'),
    password: formData.get('password'),
  })

  if (!result.success) {
    return {
      success: false,
      errors: result.error.flatten().fieldErrors,
    }
  }

  try {
    // ç™»å½•é€»è¾‘
    await authenticateUser(result.data)

    return { success: true }
  } catch (error) {
    return {
      success: false,
      message: 'ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥é‚®ç®±å’Œå¯†ç ',
    }
  }
}
```

```tsx
// components/LoginForm.tsx
'use client'

import { useActionState } from 'react'
import { login } from '@/app/actions'

export function LoginForm() {
  const [state, formAction, isPending] = useActionState(login, null)

  return (
    <form action={formAction} className="space-y-4">
      <div>
        <input
          name="email"
          type="email"
          placeholder="é‚®ç®±"
          className="w-full border rounded px-3 py-2"
        />
        {state?.errors?.email && (
          <p className="text-red-500 text-sm">{state.errors.email[0]}</p>
        )}
      </div>

      <div>
        <input
          name="password"
          type="password"
          placeholder="å¯†ç "
          className="w-full border rounded px-3 py-2"
        />
        {state?.errors?.password && (
          <p className="text-red-500 text-sm">{state.errors.password[0]}</p>
        )}
      </div>

      {state?.message && <p className="text-red-500">{state.message}</p>}

      <button
        type="submit"
        disabled={isPending}
        className="w-full bg-blue-600 text-white py-2 rounded disabled:opacity-50"
      >
        {isPending ? 'ç™»å½•ä¸­...' : 'ç™»å½•'}
      </button>
    </form>
  )
}
```

### æŠ›å‡ºé”™è¯¯

```tsx
// app/actions.ts
'use server'

export async function dangerousAction() {
  // æŠ›å‡ºçš„é”™è¯¯ä¼šè¢«æœ€è¿‘çš„ error.tsx æ•è·
  throw new Error('æ“ä½œå¤±è´¥')
}
```

## Route Handlers é”™è¯¯å¤„ç†

```tsx
// app/api/users/[id]/route.ts
import { NextRequest, NextResponse } from 'next/server'

export async function GET(
  request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const { id } = await params
    const user = await db.user.findUnique({ where: { id } })

    if (!user) {
      return NextResponse.json({ error: 'User not found' }, { status: 404 })
    }

    return NextResponse.json(user)
  } catch (error) {
    console.error('Error fetching user:', error)

    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    )
  }
}
```

### ç»Ÿä¸€é”™è¯¯å¤„ç†

```tsx
// lib/api-error.ts
export class ApiError extends Error {
  constructor(
    public statusCode: number,
    message: string
  ) {
    super(message)
  }
}

export function handleApiError(error: unknown) {
  console.error('API Error:', error)

  if (error instanceof ApiError) {
    return NextResponse.json(
      { error: error.message },
      { status: error.statusCode }
    )
  }

  return NextResponse.json({ error: 'Internal server error' }, { status: 500 })
}
```

```tsx
// app/api/posts/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { ApiError, handleApiError } from '@/lib/api-error'

export async function POST(request: NextRequest) {
  try {
    const data = await request.json()

    if (!data.title) {
      throw new ApiError(400, 'Title is required')
    }

    const post = await db.post.create({ data })
    return NextResponse.json(post, { status: 201 })
  } catch (error) {
    return handleApiError(error)
  }
}
```

## æ•°æ®è·å–é”™è¯¯å¤„ç†

### try-catch æ¨¡å¼

```tsx
// app/users/page.tsx
async function getUsers() {
  try {
    const res = await fetch('https://api.example.com/users')

    if (!res.ok) {
      throw new Error(`HTTP error! status: ${res.status}`)
    }

    return { data: await res.json(), error: null }
  } catch (error) {
    console.error('Failed to fetch users:', error)
    return { data: null, error: 'Failed to load users' }
  }
}

export default async function UsersPage() {
  const { data: users, error } = await getUsers()

  if (error) {
    return (
      <div className="p-4 bg-red-50 rounded">
        <p className="text-red-600">{error}</p>
        <p className="text-gray-500 mt-2">è¯·ç¨åé‡è¯•</p>
      </div>
    )
  }

  return (
    <ul>
      {users.map((user: any) => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  )
}
```

### æŠ›å‡ºé”™è¯¯è®© error.tsx å¤„ç†

```tsx
// app/users/page.tsx
async function getUsers() {
  const res = await fetch('https://api.example.com/users')

  if (!res.ok) {
    throw new Error('Failed to fetch users')
  }

  return res.json()
}

export default async function UsersPage() {
  const users = await getUsers() // é”™è¯¯ä¼šè¢« error.tsx æ•è·

  return (
    <ul>
      {users.map((user: any) => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  )
}
```

## é”™è¯¯ç›‘æ§

### é›†æˆ Sentry

```bash
pnpm add @sentry/nextjs
npx @sentry/wizard@latest -i nextjs
```

```tsx
// app/error.tsx
'use client'

import * as Sentry from '@sentry/nextjs'
import { useEffect } from 'react'

export default function Error({
  error,
  reset,
}: {
  error: Error & { digest?: string }
  reset: () => void
}) {
  useEffect(() => {
    Sentry.captureException(error)
  }, [error])

  return (
    <div className="p-8 text-center">
      <h2 className="text-xl font-bold mb-4">å‡ºé”™äº†</h2>
      <button onClick={reset} className="text-blue-600">
        é‡è¯•
      </button>
    </div>
  )
}
```

### è‡ªå®šä¹‰é”™è¯¯æ—¥å¿—

```tsx
// lib/logger.ts
type LogLevel = 'info' | 'warn' | 'error'

interface LogEntry {
  level: LogLevel
  message: string
  timestamp: string
  context?: Record<string, any>
}

export function log(
  level: LogLevel,
  message: string,
  context?: Record<string, any>
) {
  const entry: LogEntry = {
    level,
    message,
    timestamp: new Date().toISOString(),
    context,
  }

  // å¼€å‘ç¯å¢ƒæ‰“å°åˆ°æ§åˆ¶å°
  if (process.env.NODE_ENV === 'development') {
    console[level](JSON.stringify(entry, null, 2))
    return
  }

  // ç”Ÿäº§ç¯å¢ƒå‘é€åˆ°æ—¥å¿—æœåŠ¡
  fetch('/api/logs', {
    method: 'POST',
    body: JSON.stringify(entry),
  }).catch(console.error)
}

export const logger = {
  info: (message: string, context?: Record<string, any>) =>
    log('info', message, context),
  warn: (message: string, context?: Record<string, any>) =>
    log('warn', message, context),
  error: (message: string, context?: Record<string, any>) =>
    log('error', message, context),
}
```

## å®æˆ˜ç¤ºä¾‹

### å®Œæ•´çš„é”™è¯¯å¤„ç†è®¾ç½®

```tsx
// app/error.tsx
'use client'

import { useEffect } from 'react'
import Link from 'next/link'

export default function Error({
  error,
  reset,
}: {
  error: Error & { digest?: string }
  reset: () => void
}) {
  useEffect(() => {
    // é”™è¯¯ä¸ŠæŠ¥
    fetch('/api/error-report', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        message: error.message,
        digest: error.digest,
        stack: error.stack,
        url: window.location.href,
        userAgent: navigator.userAgent,
      }),
    }).catch(console.error)
  }, [error])

  return (
    <div className="min-h-[400px] flex items-center justify-center">
      <div className="text-center max-w-lg px-4">
        <div className="text-6xl mb-4">ğŸ˜µ</div>
        <h1 className="text-2xl font-bold mb-2">å“å‘€ï¼Œå‡ºé”™äº†</h1>
        <p className="text-gray-500 mb-6">
          åˆ«æ‹…å¿ƒï¼Œè¿™ä¸æ˜¯ä½ çš„é—®é¢˜ã€‚æˆ‘ä»¬çš„å›¢é˜Ÿå·²ç»æ”¶åˆ°é€šçŸ¥ï¼Œæ­£åœ¨å¤„ç†ä¸­ã€‚
        </p>

        <div className="flex justify-center gap-4">
          <button
            onClick={reset}
            className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
          >
            é‡è¯•
          </button>
          <Link
            href="/"
            className="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50"
          >
            è¿”å›é¦–é¡µ
          </Link>
        </div>

        {process.env.NODE_ENV === 'development' && (
          <details className="mt-8 text-left bg-gray-100 p-4 rounded">
            <summary className="cursor-pointer font-medium">
              é”™è¯¯è¯¦æƒ…ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
            </summary>
            <pre className="mt-2 text-sm overflow-auto">{error.stack}</pre>
          </details>
        )}
      </div>
    </div>
  )
}
```

```tsx
// app/not-found.tsx
import Link from 'next/link'

export default function NotFound() {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50">
      <div className="text-center">
        <h1 className="text-[150px] font-bold text-gray-200 leading-none">
          404
        </h1>
        <h2 className="text-2xl font-semibold text-gray-800 mb-4">
          é¡µé¢èµ°ä¸¢äº†
        </h2>
        <p className="text-gray-500 mb-8 max-w-md">
          æ‚¨è®¿é—®çš„é¡µé¢å¯èƒ½å·²è¢«ç§»åŠ¨ã€åˆ é™¤ï¼Œæˆ–è€…ä»æœªå­˜åœ¨è¿‡ã€‚
        </p>
        <div className="flex justify-center gap-4">
          <Link
            href="/"
            className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
          >
            è¿”å›é¦–é¡µ
          </Link>
          <Link
            href="/sitemap"
            className="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-100"
          >
            ç«™ç‚¹åœ°å›¾
          </Link>
        </div>
      </div>
    </div>
  )
}
```

## å¸¸è§é—®é¢˜

ğŸ¤” **Q: error.tsx ä¸ºä»€ä¹ˆå¿…é¡»æ˜¯ Client Componentï¼Ÿ**

å› ä¸ºéœ€è¦ä½¿ç”¨ `reset` å‡½æ•°æ¥é‡æ–°æ¸²æŸ“é¡µé¢ï¼Œè¿™éœ€è¦å®¢æˆ·ç«¯çš„ React çŠ¶æ€ç®¡ç†ã€‚

ğŸ¤” **Q: å¦‚ä½•åŒºåˆ†å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒçš„é”™è¯¯æ˜¾ç¤ºï¼Ÿ**

```tsx
// å¼€å‘ç¯å¢ƒæ˜¾ç¤ºè¯¦ç»†é”™è¯¯ï¼Œç”Ÿäº§ç¯å¢ƒæ˜¾ç¤ºå‹å¥½æç¤º
{
  process.env.NODE_ENV === 'development' ? (
    <pre>{error.stack}</pre>
  ) : (
    <p>æŠ±æ­‰ï¼Œå‡ºç°äº†é—®é¢˜</p>
  )
}
```

ğŸ¤” **Q: error.tsx èƒ½æ•è·å¸ƒå±€é”™è¯¯å—ï¼Ÿ**

ä¸èƒ½ã€‚`error.tsx` æ— æ³•æ•è·åŒçº§ `layout.tsx` çš„é”™è¯¯ï¼Œéœ€è¦åœ¨çˆ¶çº§æ·»åŠ  `error.tsx`ã€‚

---

æ­å–œä½ å®Œæˆäº†æ•°æ®å¤„ç†éƒ¨åˆ†ï¼ä¸‹ä¸€ç¯‡å°†è¿›å…¥ä¼˜åŒ–ä¸æ€§èƒ½éƒ¨åˆ†ï¼Œä»‹ç»å›¾ç‰‡ä¼˜åŒ–ã€‚

-EOF-
