---
title: å¼€å‘å·¥å…·ä¸è°ƒè¯•
description: æŒæ¡ Next.js 15 å¼€å‘ç¯å¢ƒé…ç½®ï¼ŒåŒ…æ‹¬ Turbopackã€Fast Refreshã€React DevTools ä¸é”™è¯¯è°ƒè¯•æŠ€å·§
pubDate: 2025-12-03
toc: true
ogImage: true
category: Next
tags: ['Next.js', 'Turbopack', 'è°ƒè¯•', 'å¼€å‘å·¥å…·']
---

ğŸ™‹ é«˜æ•ˆçš„å¼€å‘ä½“éªŒæ˜¯æå‡ç”Ÿäº§åŠ›çš„å…³é”®ã€‚Next.js 15 å¸¦æ¥äº†å“ªäº›å¼€å‘å·¥å…·æ”¹è¿›ï¼Ÿ

## Turbopack

Next.js 15 å°† Turbopack è®¾ä¸ºå¼€å‘æ¨¡å¼çš„é»˜è®¤æ‰“åŒ…å™¨ã€‚å®ƒä½¿ç”¨ Rust ç¼–å†™ï¼Œæ¯” Webpack å¿«å¾—å¤šã€‚

### é»˜è®¤å¯ç”¨

```bash
# å¼€å‘æ¨¡å¼è‡ªåŠ¨ä½¿ç”¨ Turbopack
pnpm dev

# è¾“å‡ºæ˜¾ç¤ºä½¿ç”¨çš„æ‰“åŒ…å™¨
# â–² Next.js 15.x
# - Local: http://localhost:3000
# - Turbopack (default)
```

### æ€§èƒ½å¯¹æ¯”

| æ“ä½œ     | Webpack | Turbopack | æå‡ |
| -------- | ------- | --------- | ---- |
| å†·å¯åŠ¨   | 12s     | 2s        | 6x   |
| HMR      | 500ms   | 50ms      | 10x  |
| è·¯ç”±åˆ‡æ¢ | 200ms   | 30ms      | 6x   |

_æ•°æ®æ¥è‡ªä¸­å‹é¡¹ç›®ï¼ˆ~500 ç»„ä»¶ï¼‰_

### å›é€€åˆ° Webpack

å¦‚æœé¡¹ç›®æœ‰è‡ªå®šä¹‰ Webpack é…ç½®ä¸”æ— æ³•è¿ç§»ï¼š

```bash
# ä½¿ç”¨ Webpack
pnpm dev --webpack
```

æˆ–åœ¨ `package.json` ä¸­é…ç½®ï¼š

```json
{
  "scripts": {
    "dev": "next dev --webpack"
  }
}
```

### Turbopack é…ç½®

```typescript
// next.config.ts
// Next.js 15.x
import type { NextConfig } from 'next'

const nextConfig: NextConfig = {
  turbopack: {
    // è‡ªå®šä¹‰æ–‡ä»¶å¤„ç†è§„åˆ™
    rules: {
      '*.svg': {
        loaders: ['@svgr/webpack'],
        as: '*.js',
      },
    },
    // æ¨¡å—åˆ«å
    resolveAlias: {
      'old-package': 'new-package',
    },
    // æ–‡ä»¶æ‰©å±•åè§£æé¡ºåº
    resolveExtensions: ['.tsx', '.ts', '.jsx', '.js', '.json'],
  },
}

export default nextConfig
```

## Fast Refresh

Fast Refresh æ˜¯ Next.js çš„çƒ­æ›´æ–°æœºåˆ¶ï¼Œå¯ä»¥åœ¨ä¿æŒç»„ä»¶çŠ¶æ€çš„æƒ…å†µä¸‹å®æ—¶é¢„è§ˆä»£ç æ›´æ”¹ã€‚

### å·¥ä½œåŸç†

```tsx
// components/Counter.tsx
// Next.js 15.x
'use client'

import { useState } from 'react'

export default function Counter() {
  const [count, setCount] = useState(0)

  return (
    <div>
      <p>è®¡æ•°: {count}</p>
      <button onClick={() => setCount(count + 1)}>+1</button>
    </div>
  )
}
```

ä¿®æ”¹è¿™ä¸ªç»„ä»¶æ—¶ï¼š

1. âœ… ä¿®æ”¹ JSX ç»“æ„ â†’ çŠ¶æ€ä¿æŒï¼ŒUI æ›´æ–°
2. âœ… ä¿®æ”¹æ ·å¼ â†’ çŠ¶æ€ä¿æŒï¼Œæ ·å¼æ›´æ–°
3. âŒ ä¿®æ”¹ hooks é€»è¾‘ â†’ çŠ¶æ€é‡ç½®

### ä¿æŒçŠ¶æ€çš„æŠ€å·§

```tsx
// ä½¿ç”¨ key å¼ºåˆ¶é‡æ–°æŒ‚è½½
;<Counter key={Date.now()} />

// ä½¿ç”¨ useEffect ä¾èµ–è¿½è¸ªå˜åŒ–
useEffect(() => {
  console.log('ç»„ä»¶å·²æ›´æ–°')
}, [])
```

### Fast Refresh å¤±æ•ˆçš„æƒ…å†µ

ğŸ”¶ ä»¥ä¸‹æƒ…å†µä¼šå¯¼è‡´å®Œå…¨åˆ·æ–°ï¼š

1. ç»„ä»¶å¯¼å‡ºçš„ä¸æ˜¯ React ç»„ä»¶
2. æ–‡ä»¶åŒæ—¶å¯¼å‡ºç»„ä»¶å’Œéç»„ä»¶
3. ä½¿ç”¨ Class ç»„ä»¶
4. é”™è¯¯çš„æ¨¡å—è¾¹ç•Œ

```tsx
// âŒ è¿™ä¼šå¯¼è‡´ Fast Refresh å¤±æ•ˆ
export default function Component() { ... }
export const config = { ... } // éç»„ä»¶å¯¼å‡º

// âœ… æ‹†åˆ†åˆ°ä¸åŒæ–‡ä»¶
// component.tsx
export default function Component() { ... }

// config.ts
export const config = { ... }
```

## é”™è¯¯å¤„ç†ä¸è°ƒè¯•

### é”™è¯¯å åŠ å±‚

å¼€å‘æ¨¡å¼ä¸‹ï¼ŒNext.js æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å åŠ å±‚ï¼š

```tsx
// app/page.tsx
// æ•…æ„å¼•å…¥é”™è¯¯
export default function Page() {
  const user = null
  return <p>{user.name}</p> // TypeError!
}
```

é”™è¯¯å åŠ å±‚æ˜¾ç¤ºï¼š

- é”™è¯¯ç±»å‹å’Œæ¶ˆæ¯
- æºä»£ç ä½ç½®ï¼ˆå¸¦è¡Œå·ï¼‰
- è°ƒç”¨å †æ ˆ
- ä¸€é”®å¤åˆ¶é”™è¯¯ä¿¡æ¯

### console è°ƒè¯•

Server Component çš„ console è¾“å‡ºåœ¨ç»ˆç«¯ï¼ŒClient Component çš„åœ¨æµè§ˆå™¨ï¼š

```tsx
// Server Component - ç»ˆç«¯è¾“å‡º
export default async function Page() {
  console.log('æœåŠ¡ç«¯æ—¥å¿—') // ğŸ‘ˆ ç»ˆç«¯
  const data = await fetch('...')
  return <div>{data}</div>
}
```

```tsx
// Client Component - æµè§ˆå™¨è¾“å‡º
'use client'

export default function Button() {
  console.log('å®¢æˆ·ç«¯æ—¥å¿—') // ğŸ‘ˆ æµè§ˆå™¨æ§åˆ¶å°

  return <button onClick={() => console.log('ç‚¹å‡»')}>æŒ‰é’®</button>
}
```

### æ–­ç‚¹è°ƒè¯•

#### VS Code é…ç½®

```json
// .vscode/launch.json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Next.js: debug server-side",
      "type": "node",
      "request": "attach",
      "port": 9229,
      "restart": true,
      "skipFiles": ["<node_internals>/**"]
    },
    {
      "name": "Next.js: debug client-side",
      "type": "chrome",
      "request": "launch",
      "url": "http://localhost:3000"
    }
  ]
}
```

å¯åŠ¨è°ƒè¯•ï¼š

```bash
# å¼€å¯ Node.js è°ƒè¯•ç«¯å£
NODE_OPTIONS='--inspect' pnpm dev
```

#### æµè§ˆå™¨è°ƒè¯•

1. æ‰“å¼€ Chrome DevTools (F12)
2. Sources é¢æ¿æ‰¾åˆ° `webpack://_N_E/` æˆ– `turbopack://`
3. è®¾ç½®æ–­ç‚¹

### React DevTools

å®‰è£… [React Developer Tools](https://react.dev/learn/react-developer-tools) æµè§ˆå™¨æ‰©å±•ã€‚

ğŸ¯ **åŠŸèƒ½**ï¼š

- ç»„ä»¶æ ‘æŸ¥çœ‹
- Props å’Œ State æ£€æŸ¥
- æ€§èƒ½åˆ†æ
- ç»„ä»¶é«˜äº®

```tsx
// æ·»åŠ  displayName ä¾¿äºè°ƒè¯•
const MyComponent = () => <div>å†…å®¹</div>
MyComponent.displayName = 'MyComponent'

// æˆ–ä½¿ç”¨å…·åå‡½æ•°
export default function MyComponent() {
  return <div>å†…å®¹</div>
}
```

## æ€§èƒ½ç›‘æ§

### å†…ç½®æ€§èƒ½æŒ‡æ ‡

```tsx
// app/layout.tsx
// Next.js 15.x
import { SpeedInsights } from '@vercel/speed-insights/next'

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html>
      <body>
        {children}
        <SpeedInsights />
      </body>
    </html>
  )
}
```

### è‡ªå®šä¹‰æ€§èƒ½è¿½è¸ª

```tsx
// app/page.tsx
// Next.js 15.x
import { unstable_noStore as noStore } from 'next/cache'

export default async function Page() {
  noStore() // ç¦ç”¨ç¼“å­˜ä»¥æµ‹è¯•çœŸå®æ€§èƒ½

  const start = performance.now()
  const data = await fetch('https://api.example.com/slow-endpoint')
  const duration = performance.now() - start

  console.log(`API è¯·æ±‚è€—æ—¶: ${duration}ms`)

  return <div>...</div>
}
```

### Bundle åˆ†æ

```bash
# å®‰è£…åˆ†æå·¥å…·
pnpm add -D @next/bundle-analyzer
```

```typescript
// next.config.ts
// Next.js 15.x
import type { NextConfig } from 'next'
import bundleAnalyzer from '@next/bundle-analyzer'

const withBundleAnalyzer = bundleAnalyzer({
  enabled: process.env.ANALYZE === 'true',
})

const nextConfig: NextConfig = {
  // é…ç½®é¡¹
}

export default withBundleAnalyzer(nextConfig)
```

```bash
# è¿è¡Œåˆ†æ
ANALYZE=true pnpm build
```

ç”Ÿæˆå¯è§†åŒ–æŠ¥å‘Šï¼Œæ˜¾ç¤ºæ¯ä¸ªæ¨¡å—çš„ä½“ç§¯å æ¯”ã€‚

## å¸¸ç”¨å¼€å‘æŠ€å·§

### 1. å¿«é€Ÿé‡å¯

```bash
# æ¸…é™¤ .next ç¼“å­˜åé‡å¯
rm -rf .next && pnpm dev
```

### 2. ç¯å¢ƒå˜é‡çƒ­æ›´æ–°

```bash
# .env.local ä¿®æ”¹åéœ€è¦é‡å¯
# ä½¿ç”¨ dotenv-cli å¯ä»¥é¿å…
pnpm add -D dotenv-cli
```

```json
{
  "scripts": {
    "dev": "dotenv -e .env.local -- next dev"
  }
}
```

### 3. æ¨¡æ‹Ÿæ…¢ç½‘ç»œ

```tsx
// å¼€å‘ç¯å¢ƒæ¨¡æ‹Ÿå»¶è¿Ÿ
async function getData() {
  if (process.env.NODE_ENV === 'development') {
    await new Promise((r) => setTimeout(r, 2000)) // 2ç§’å»¶è¿Ÿ
  }
  return fetch('...')
}
```

### 4. æ¡ä»¶æ—¥å¿—

```tsx
// lib/logger.ts
export const log = (...args: unknown[]) => {
  if (process.env.NODE_ENV === 'development') {
    console.log('[DEV]', ...args)
  }
}

// ä½¿ç”¨
import { log } from '@/lib/logger'
log('è°ƒè¯•ä¿¡æ¯', { data })
```

## å¸¸è§é—®é¢˜

ğŸ¤” **Q: Turbopack æŠ¥é”™æ€ä¹ˆåŠï¼Ÿ**

Turbopack ä»åœ¨å¿«é€Ÿè¿­ä»£ï¼ŒæŸäº› Webpack é…ç½®å¯èƒ½ä¸å…¼å®¹ã€‚ä¸´æ—¶æ–¹æ¡ˆæ˜¯å›é€€åˆ° Webpackï¼š

```bash
pnpm dev --webpack
```

ç„¶åæ£€æŸ¥ [Turbopack å…¼å®¹æ€§æ–‡æ¡£](https://nextjs.org/docs/app/api-reference/turbopack) å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆã€‚

ğŸ¤” **Q: Fast Refresh ä¸ç”Ÿæ•ˆï¼Ÿ**

æ£€æŸ¥ç»„ä»¶æ˜¯å¦ï¼š

- å¯¼å‡ºäº†éç»„ä»¶å†…å®¹
- ä½¿ç”¨äº† Class ç»„ä»¶
- æœ‰è¯­æ³•é”™è¯¯

ğŸ¤” **Q: å¦‚ä½•è°ƒè¯•ç”Ÿäº§æ„å»ºï¼Ÿ**

```bash
# ç”Ÿäº§æ¨¡å¼æ„å»º
pnpm build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
pnpm start

# ä½¿ç”¨ source mapï¼ˆéœ€é…ç½®ï¼‰
```

---

ä¸‹ä¸€ç¯‡å°†æ·±å…¥ TypeScript é…ç½®ï¼ŒåŒ…æ‹¬è·¯å¾„åˆ«åã€ä¸¥æ ¼æ¨¡å¼å’Œç±»å‹å¢å¼ºã€‚

-EOF-
