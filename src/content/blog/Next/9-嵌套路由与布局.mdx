---
title: åµŒå¥—è·¯ç”±ä¸å¸ƒå±€
description: æŒæ¡ Next.js App Router çš„åµŒå¥—è·¯ç”±æœºåˆ¶ï¼Œç†è§£ layoutã€template çš„åŒºåˆ«ä¸çŠ¶æ€å…±äº«ç­–ç•¥
pubDate: 2025-12-03
toc: true
ogImage: true
category: Next
tags: ['Next.js', 'åµŒå¥—è·¯ç”±', 'å¸ƒå±€', 'layout', 'template']
---

ğŸ™‹ åå°ç®¡ç†ç³»ç»Ÿéœ€è¦ä¾§è¾¹æ ä¿æŒä¸å˜ï¼Œåªæ›´æ–°å†…å®¹åŒºã€‚ç”µå•†ç½‘ç«™éœ€è¦é¢åŒ…å±‘å¯¼èˆªã€‚è¿™äº›å¤æ‚å¸ƒå±€å¦‚ä½•å®ç°ï¼Ÿ

## åµŒå¥—è·¯ç”±åŸºç¡€

App Router çš„æ–‡ä»¶å¤¹ç»“æ„å¤©ç„¶æ”¯æŒåµŒå¥—ï¼š

```
app/
â”œâ”€â”€ layout.tsx           # æ ¹å¸ƒå±€
â”œâ”€â”€ page.tsx             # é¦–é¡µ /
â””â”€â”€ dashboard/
    â”œâ”€â”€ layout.tsx       # Dashboard å¸ƒå±€
    â”œâ”€â”€ page.tsx         # /dashboard
    â”œâ”€â”€ analytics/
    â”‚   â””â”€â”€ page.tsx     # /dashboard/analytics
    â””â”€â”€ settings/
        â”œâ”€â”€ layout.tsx   # Settings å¸ƒå±€
        â”œâ”€â”€ page.tsx     # /dashboard/settings
        â””â”€â”€ profile/
            â””â”€â”€ page.tsx # /dashboard/settings/profile
```

æ¸²æŸ“å±‚çº§ï¼š

```tsx
<RootLayout>
  <DashboardLayout>
    <SettingsLayout>
      <ProfilePage />
    </SettingsLayout>
  </DashboardLayout>
</RootLayout>
```

## å¸ƒå±€çš„æ ¸å¿ƒç‰¹æ€§

### 1. çŠ¶æ€ä¿æŒ

å¸ƒå±€åœ¨è·¯ç”±åˆ‡æ¢æ—¶ä¸ä¼šé‡æ–°æŒ‚è½½ï¼š

```tsx
// app/dashboard/layout.tsx
// Next.js 15.x
'use client'

import { useState } from 'react'
import Link from 'next/link'

export default function DashboardLayout({
  children,
}: {
  children: React.ReactNode
}) {
  // è¿™ä¸ªçŠ¶æ€åœ¨å­è·¯ç”±åˆ‡æ¢æ—¶ä¿æŒ
  const [sidebarOpen, setSidebarOpen] = useState(true)

  return (
    <div className="flex">
      <aside className={sidebarOpen ? 'w-64' : 'w-16'}>
        <button onClick={() => setSidebarOpen(!sidebarOpen)}>
          {sidebarOpen ? 'æ”¶èµ·' : 'å±•å¼€'}
        </button>
        <nav>
          <Link href="/dashboard">æ¦‚è§ˆ</Link>
          <Link href="/dashboard/analytics">åˆ†æ</Link>
          <Link href="/dashboard/settings">è®¾ç½®</Link>
        </nav>
      </aside>
      <main className="flex-1">{children}</main>
    </div>
  )
}
```

ğŸ¯ **æ•ˆæœ**ï¼šä» `/dashboard` åˆ‡æ¢åˆ° `/dashboard/analytics`ï¼Œä¾§è¾¹æ çŠ¶æ€ä¸ä¼šä¸¢å¤±ã€‚

### 2. è¯·æ±‚å»é‡

å¸ƒå±€ä¸­çš„æ•°æ®è¯·æ±‚ä¼šè‡ªåŠ¨å»é‡ï¼š

```tsx
// app/dashboard/layout.tsx
// Next.js 15.x

async function getUser() {
  // å³ä½¿å¤šä¸ªç»„ä»¶è°ƒç”¨ï¼Œä¹Ÿåªä¼šå‘é€ä¸€æ¬¡è¯·æ±‚
  const res = await fetch('https://api.example.com/user')
  return res.json()
}

export default async function DashboardLayout({
  children,
}: {
  children: React.ReactNode
}) {
  const user = await getUser()

  return (
    <div>
      <header>æ¬¢è¿, {user.name}</header>
      {children}
    </div>
  )
}
```

### 3. éƒ¨åˆ†æ¸²æŸ“

è·¯ç”±åˆ‡æ¢æ—¶ï¼Œåªæœ‰å˜åŒ–çš„éƒ¨åˆ†ä¼šé‡æ–°æ¸²æŸ“ï¼š

```
/dashboard â†’ /dashboard/analytics

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    DashboardLayout      â”‚  â† ä¸é‡æ–°æ¸²æŸ“
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   å˜åŒ–çš„å†…å®¹åŒºåŸŸ   â”‚  â”‚  â† é‡æ–°æ¸²æŸ“
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å¸ƒå±€æ¨¡å¼

### æ ¹å¸ƒå±€ï¼ˆå¿…éœ€ï¼‰

```tsx
// app/layout.tsx
// Next.js 15.x
import type { Metadata } from 'next'
import { Inter } from 'next/font/google'
import './globals.css'

const inter = Inter({ subsets: ['latin'] })

export const metadata: Metadata = {
  title: {
    template: '%s | My App',
    default: 'My App',
  },
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="zh-CN">
      <body className={inter.className}>{children}</body>
    </html>
  )
}
```

ğŸ”¶ **å¿…é¡»**ï¼šæ ¹å¸ƒå±€å¿…é¡»å®šä¹‰ `<html>` å’Œ `<body>` æ ‡ç­¾ã€‚

### åŒºåŸŸå¸ƒå±€

```tsx
// app/dashboard/layout.tsx
// Next.js 15.x
import { Sidebar } from '@/components/Sidebar'
import { Header } from '@/components/Header'

export default function DashboardLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <div className="min-h-screen flex">
      <Sidebar />
      <div className="flex-1 flex flex-col">
        <Header />
        <main className="flex-1 p-6">{children}</main>
      </div>
    </div>
  )
}
```

### å¸¦å‚æ•°çš„å¸ƒå±€

åŠ¨æ€è·¯ç”±çš„å¸ƒå±€å¯ä»¥æ¥æ”¶å‚æ•°ï¼š

```tsx
// app/shop/[category]/layout.tsx
// Next.js 15.x

interface LayoutProps {
  children: React.ReactNode
  params: Promise<{ category: string }>
}

export default async function CategoryLayout({
  children,
  params,
}: LayoutProps) {
  const { category } = await params

  return (
    <div>
      <nav className="bg-gray-100 p-4">
        <h2 className="text-lg font-bold">{category.toUpperCase()} åˆ†ç±»</h2>
      </nav>
      {children}
    </div>
  )
}
```

## Template æ¨¡æ¿

Template å’Œ Layout ç±»ä¼¼ï¼Œä½†æ¯æ¬¡å¯¼èˆªéƒ½ä¼šé‡æ–°æŒ‚è½½ï¼š

```tsx
// app/dashboard/template.tsx
// Next.js 15.x
'use client'

import { useEffect } from 'react'
import { motion } from 'framer-motion'

export default function DashboardTemplate({
  children,
}: {
  children: React.ReactNode
}) {
  useEffect(() => {
    // æ¯æ¬¡å¯¼èˆªéƒ½ä¼šæ‰§è¡Œ
    console.log('é¡µé¢è¿›å…¥')
    return () => console.log('é¡µé¢ç¦»å¼€')
  }, [])

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      exit={{ opacity: 0, y: -20 }}
      transition={{ duration: 0.3 }}
    >
      {children}
    </motion.div>
  )
}
```

### Layout vs Template

| ç‰¹æ€§       | Layout            | Template       |
| ---------- | ----------------- | -------------- |
| è·¯ç”±åˆ‡æ¢æ—¶ | ä¿æŒæŒ‚è½½          | é‡æ–°æŒ‚è½½       |
| çŠ¶æ€ä¿æŒ   | âœ…                | âŒ             |
| useEffect  | åªæ‰§è¡Œä¸€æ¬¡        | æ¯æ¬¡æ‰§è¡Œ       |
| é€‚ç”¨åœºæ™¯   | å…±äº« UIã€ä¿æŒçŠ¶æ€ | åŠ¨ç”»ã€é¡µé¢ç»Ÿè®¡ |

## çŠ¶æ€å…±äº«

### Context æ–¹å¼

```tsx
// app/dashboard/layout.tsx
// Next.js 15.x
'use client'

import { createContext, useContext, useState, ReactNode } from 'react'

interface DashboardContextType {
  selectedProject: string | null
  setSelectedProject: (id: string | null) => void
}

const DashboardContext = createContext<DashboardContextType | null>(null)

export function useDashboard() {
  const context = useContext(DashboardContext)
  if (!context) {
    throw new Error('useDashboard must be used within DashboardLayout')
  }
  return context
}

export default function DashboardLayout({ children }: { children: ReactNode }) {
  const [selectedProject, setSelectedProject] = useState<string | null>(null)

  return (
    <DashboardContext.Provider value={{ selectedProject, setSelectedProject }}>
      <div className="flex">
        <aside className="w-64">{/* ä¾§è¾¹æ å¯ä»¥ä½¿ç”¨ context */}</aside>
        <main className="flex-1">{children}</main>
      </div>
    </DashboardContext.Provider>
  )
}
```

```tsx
// app/dashboard/page.tsx
// Next.js 15.x
'use client'

import { useDashboard } from './layout'

export default function DashboardPage() {
  const { selectedProject, setSelectedProject } = useDashboard()

  return (
    <div>
      <p>å½“å‰é¡¹ç›®: {selectedProject ?? 'æœªé€‰æ‹©'}</p>
      <button onClick={() => setSelectedProject('project-1')}>
        é€‰æ‹©é¡¹ç›® 1
      </button>
    </div>
  )
}
```

### URL çŠ¶æ€æ–¹å¼

æ›´æ¨èä½¿ç”¨ URL å‚æ•°ç®¡ç†çŠ¶æ€ï¼Œä¾¿äºåˆ†äº«å’Œåˆ·æ–°ä¿æŒï¼š

```tsx
// app/dashboard/page.tsx
// Next.js 15.x
'use client'

import { useSearchParams, useRouter, usePathname } from 'next/navigation'

export default function DashboardPage() {
  const searchParams = useSearchParams()
  const router = useRouter()
  const pathname = usePathname()

  const tab = searchParams.get('tab') ?? 'overview'

  const setTab = (newTab: string) => {
    const params = new URLSearchParams(searchParams.toString())
    params.set('tab', newTab)
    router.push(`${pathname}?${params.toString()}`)
  }

  return (
    <div>
      <nav className="flex gap-4 mb-4">
        {['overview', 'analytics', 'reports'].map((t) => (
          <button
            key={t}
            onClick={() => setTab(t)}
            className={tab === t ? 'font-bold' : ''}
          >
            {t}
          </button>
        ))}
      </nav>
      <div>å½“å‰æ ‡ç­¾: {tab}</div>
    </div>
  )
}
```

## å®æˆ˜ï¼šåå°ç®¡ç†ç³»ç»Ÿ

```
app/
â”œâ”€â”€ layout.tsx                 # æ ¹å¸ƒå±€
â”œâ”€â”€ (auth)/                    # è®¤è¯è·¯ç”±ç»„
â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â””â”€â”€ register/
â”‚       â””â”€â”€ page.tsx
â””â”€â”€ (dashboard)/               # åå°è·¯ç”±ç»„
    â”œâ”€â”€ layout.tsx             # åå°å¸ƒå±€ï¼ˆä¾§è¾¹æ  + é¡¶æ ï¼‰
    â”œâ”€â”€ page.tsx               # é¦–é¡µé‡å®šå‘
    â”œâ”€â”€ overview/
    â”‚   â””â”€â”€ page.tsx           # /overview
    â”œâ”€â”€ projects/
    â”‚   â”œâ”€â”€ layout.tsx         # é¡¹ç›®å¸ƒå±€
    â”‚   â”œâ”€â”€ page.tsx           # /projects
    â”‚   â””â”€â”€ [id]/
    â”‚       â”œâ”€â”€ page.tsx       # /projects/:id
    â”‚       â””â”€â”€ settings/
    â”‚           â””â”€â”€ page.tsx   # /projects/:id/settings
    â””â”€â”€ settings/
        â”œâ”€â”€ layout.tsx         # è®¾ç½®å¸ƒå±€ï¼ˆé€‰é¡¹å¡ï¼‰
        â”œâ”€â”€ page.tsx           # /settings
        â”œâ”€â”€ profile/
        â”‚   â””â”€â”€ page.tsx       # /settings/profile
        â””â”€â”€ team/
            â””â”€â”€ page.tsx       # /settings/team
```

```tsx
// app/(dashboard)/layout.tsx
// Next.js 15.x
import { Sidebar } from '@/components/Sidebar'
import { TopBar } from '@/components/TopBar'

export default function DashboardLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <div className="min-h-screen flex">
      <Sidebar />
      <div className="flex-1 flex flex-col">
        <TopBar />
        <main className="flex-1 overflow-auto p-6 bg-gray-50">{children}</main>
      </div>
    </div>
  )
}
```

```tsx
// app/(dashboard)/settings/layout.tsx
// Next.js 15.x
'use client'

import Link from 'next/link'
import { usePathname } from 'next/navigation'

const tabs = [
  { href: '/settings', label: 'é€šç”¨' },
  { href: '/settings/profile', label: 'ä¸ªäººèµ„æ–™' },
  { href: '/settings/team', label: 'å›¢é˜Ÿ' },
]

export default function SettingsLayout({
  children,
}: {
  children: React.ReactNode
}) {
  const pathname = usePathname()

  return (
    <div>
      <h1 className="text-2xl font-bold mb-6">è®¾ç½®</h1>
      <nav className="flex gap-4 border-b mb-6">
        {tabs.map((tab) => (
          <Link
            key={tab.href}
            href={tab.href}
            className={`pb-2 ${
              pathname === tab.href
                ? 'border-b-2 border-blue-600 text-blue-600'
                : 'text-gray-500'
            }`}
          >
            {tab.label}
          </Link>
        ))}
      </nav>
      {children}
    </div>
  )
}
```

## å¸¸è§é—®é¢˜

ğŸ¤” **Q: å¦‚ä½•åœ¨å¸ƒå±€ä¸­è·å–å½“å‰è·¯å¾„ï¼Ÿ**

```tsx
'use client'
import { usePathname } from 'next/navigation'

export default function Layout({ children }) {
  const pathname = usePathname()
  // ...
}
```

ğŸ¤” **Q: å¸ƒå±€èƒ½è®¿é—®å­é¡µé¢çš„æ•°æ®å—ï¼Ÿ**

ä¸èƒ½ç›´æ¥è®¿é—®ã€‚å¯ä»¥é€šè¿‡ Contextã€URL å‚æ•°æˆ–æœåŠ¡ç«¯æ•°æ®å…±äº«ã€‚

ğŸ¤” **Q: å¦‚ä½•è®©æŸäº›å­è·¯ç”±ä¸ä½¿ç”¨çˆ¶å¸ƒå±€ï¼Ÿ**

ä½¿ç”¨è·¯ç”±ç»„æ¥åˆ›å»ºä¸åŒçš„å¸ƒå±€åˆ†æ”¯ï¼ˆä¸‹ä¸€ç¯‡è¯¦è§£ï¼‰ã€‚

---

ä¸‹ä¸€ç¯‡å°†ä»‹ç»è·¯ç”±ç»„ï¼Œå­¦ä¹ å¦‚ä½•ç”¨ `(folder)` è¯­æ³•ç»„ç»‡è·¯ç”±è€Œä¸å½±å“ URLã€‚

-EOF-
