---
title: Client Components
description: æŒæ¡ Next.js Client Components çš„ä½¿ç”¨ï¼Œç†è§£ "use client" æŒ‡ä»¤ã€äº¤äº’å¤„ç†ä¸æœ€ä½³å®è·µ
pubDate: 2025-12-03
toc: true
ogImage: true
category: Next
tags: ['Next.js', 'Client Components', 'use client', 'äº¤äº’']
---

ğŸ™‹ éœ€è¦ç”¨æˆ·äº¤äº’ã€ä½¿ç”¨ React Hooks æˆ–è®¿é—®æµè§ˆå™¨ APIï¼Ÿè¿™æ—¶å€™å°±éœ€è¦ Client Componentsã€‚

## ä»€ä¹ˆæ˜¯ Client Components

Client Components åœ¨æœåŠ¡ç«¯é¢„æ¸²æŸ“åï¼Œä¼šåœ¨æµè§ˆå™¨ä¸­"æ°´åˆ"ï¼ˆhydrateï¼‰ï¼Œè·å¾—äº¤äº’èƒ½åŠ›ã€‚

### å£°æ˜ Client Component

ä½¿ç”¨ `"use client"` æŒ‡ä»¤ï¼š

```tsx
// components/Counter.tsx
// Next.js 15.x
'use client'

import { useState } from 'react'

export default function Counter() {
  const [count, setCount] = useState(0)

  return <button onClick={() => setCount(count + 1)}>ç‚¹å‡»æ¬¡æ•°: {count}</button>
}
```

ğŸ”¶ **æ³¨æ„**ï¼š`"use client"` å¿…é¡»åœ¨æ–‡ä»¶æœ€é¡¶éƒ¨ï¼Œåœ¨ä»»ä½• import ä¹‹å‰ã€‚

## ä½¿ç”¨åœºæ™¯

### 1. çŠ¶æ€ç®¡ç†

```tsx
// components/Toggle.tsx
// Next.js 15.x
'use client'

import { useState } from 'react'

export default function Toggle() {
  const [isOn, setIsOn] = useState(false)

  return (
    <button
      onClick={() => setIsOn(!isOn)}
      className={`px-4 py-2 rounded ${isOn ? 'bg-green-500' : 'bg-gray-300'}`}
    >
      {isOn ? 'å¼€å¯' : 'å…³é—­'}
    </button>
  )
}
```

### 2. äº‹ä»¶å¤„ç†

```tsx
// components/Form.tsx
// Next.js 15.x
'use client'

import { useState, FormEvent } from 'react'

export default function ContactForm() {
  const [name, setName] = useState('')
  const [email, setEmail] = useState('')
  const [loading, setLoading] = useState(false)

  const handleSubmit = async (e: FormEvent) => {
    e.preventDefault()
    setLoading(true)

    await fetch('/api/contact', {
      method: 'POST',
      body: JSON.stringify({ name, email }),
    })

    setLoading(false)
    alert('æäº¤æˆåŠŸï¼')
  }

  return (
    <form onSubmit={handleSubmit} className="space-y-4">
      <input
        value={name}
        onChange={(e) => setName(e.target.value)}
        placeholder="å§“å"
        className="border rounded px-3 py-2 w-full"
      />
      <input
        value={email}
        onChange={(e) => setEmail(e.target.value)}
        placeholder="é‚®ç®±"
        type="email"
        className="border rounded px-3 py-2 w-full"
      />
      <button
        type="submit"
        disabled={loading}
        className="bg-blue-600 text-white px-4 py-2 rounded disabled:opacity-50"
      >
        {loading ? 'æäº¤ä¸­...' : 'æäº¤'}
      </button>
    </form>
  )
}
```

### 3. å‰¯ä½œç”¨

```tsx
// components/Analytics.tsx
// Next.js 15.x
'use client'

import { useEffect } from 'react'
import { usePathname, useSearchParams } from 'next/navigation'

export default function Analytics() {
  const pathname = usePathname()
  const searchParams = useSearchParams()

  useEffect(() => {
    const url = `${pathname}${searchParams.toString() ? `?${searchParams.toString()}` : ''}`

    // å‘é€é¡µé¢è®¿é—®ç»Ÿè®¡
    console.log('Page view:', url)
    // analytics.pageView(url)
  }, [pathname, searchParams])

  return null
}
```

### 4. æµè§ˆå™¨ API

```tsx
// components/ThemeToggle.tsx
// Next.js 15.x
'use client'

import { useEffect, useState } from 'react'

export default function ThemeToggle() {
  const [theme, setTheme] = useState<'light' | 'dark'>('light')

  useEffect(() => {
    // ä» localStorage è¯»å–ä¸»é¢˜
    const saved = localStorage.getItem('theme') as 'light' | 'dark'
    if (saved) {
      setTheme(saved)
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      setTheme('dark')
    }
  }, [])

  useEffect(() => {
    // æ›´æ–° DOM å’Œ localStorage
    document.documentElement.classList.toggle('dark', theme === 'dark')
    localStorage.setItem('theme', theme)
  }, [theme])

  return (
    <button onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}>
      {theme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸'}
    </button>
  )
}
```

### 5. ç¬¬ä¸‰æ–¹äº¤äº’åº“

```tsx
// components/Map.tsx
// Next.js 15.x
'use client'

import { useEffect, useRef } from 'react'
import mapboxgl from 'mapbox-gl'
import 'mapbox-gl/dist/mapbox-gl.css'

mapboxgl.accessToken = process.env.NEXT_PUBLIC_MAPBOX_TOKEN!

interface MapProps {
  center: [number, number]
  zoom?: number
}

export default function Map({ center, zoom = 10 }: MapProps) {
  const mapContainer = useRef<HTMLDivElement>(null)

  useEffect(() => {
    if (!mapContainer.current) return

    const map = new mapboxgl.Map({
      container: mapContainer.current,
      style: 'mapbox://styles/mapbox/streets-v12',
      center,
      zoom,
    })

    return () => map.remove()
  }, [center, zoom])

  return <div ref={mapContainer} className="w-full h-96" />
}
```

## ä¸ Server Components åä½œ

### æ¥æ”¶æœåŠ¡ç«¯æ•°æ®

```tsx
// app/products/page.tsx - Server Component
// Next.js 15.x
import { ProductFilter } from '@/components/ProductFilter'

async function getProducts() {
  const res = await fetch('https://api.example.com/products')
  return res.json()
}

async function getCategories() {
  const res = await fetch('https://api.example.com/categories')
  return res.json()
}

export default async function ProductsPage() {
  const [products, categories] = await Promise.all([
    getProducts(),
    getCategories(),
  ])

  return <ProductFilter initialProducts={products} categories={categories} />
}
```

```tsx
// components/ProductFilter.tsx - Client Component
// Next.js 15.x
'use client'

import { useState, useMemo } from 'react'

interface Product {
  id: string
  name: string
  category: string
  price: number
}

interface Category {
  id: string
  name: string
}

interface Props {
  initialProducts: Product[]
  categories: Category[]
}

export function ProductFilter({ initialProducts, categories }: Props) {
  const [selectedCategory, setSelectedCategory] = useState<string | null>(null)
  const [sortBy, setSortBy] = useState<'name' | 'price'>('name')

  const filteredProducts = useMemo(() => {
    let result = initialProducts

    if (selectedCategory) {
      result = result.filter((p) => p.category === selectedCategory)
    }

    return result.sort((a, b) => {
      if (sortBy === 'price') return a.price - b.price
      return a.name.localeCompare(b.name)
    })
  }, [initialProducts, selectedCategory, sortBy])

  return (
    <div>
      <div className="flex gap-4 mb-4">
        <select
          value={selectedCategory || ''}
          onChange={(e) => setSelectedCategory(e.target.value || null)}
        >
          <option value="">å…¨éƒ¨åˆ†ç±»</option>
          {categories.map((cat) => (
            <option key={cat.id} value={cat.id}>
              {cat.name}
            </option>
          ))}
        </select>

        <select
          value={sortBy}
          onChange={(e) => setSortBy(e.target.value as 'name' | 'price')}
        >
          <option value="name">æŒ‰åç§°</option>
          <option value="price">æŒ‰ä»·æ ¼</option>
        </select>
      </div>

      <ul className="space-y-2">
        {filteredProducts.map((product) => (
          <li key={product.id}>
            {product.name} - Â¥{product.price}
          </li>
        ))}
      </ul>
    </div>
  )
}
```

### children æ¨¡å¼

å°† Server Components ä½œä¸º children ä¼ å…¥ Client Componentï¼š

```tsx
// app/page.tsx - Server Component
import { Tabs } from '@/components/Tabs'
import { ServerContent } from '@/components/ServerContent'

export default function Page() {
  return (
    <Tabs>
      {/* Server Component ä½œä¸º children */}
      <ServerContent />
    </Tabs>
  )
}
```

```tsx
// components/Tabs.tsx - Client Component
'use client'

import { useState, ReactNode } from 'react'

export function Tabs({ children }: { children: ReactNode }) {
  const [activeTab, setActiveTab] = useState(0)

  return (
    <div>
      <div className="flex gap-2">
        <button onClick={() => setActiveTab(0)}>Tab 1</button>
        <button onClick={() => setActiveTab(1)}>Tab 2</button>
      </div>
      <div className={activeTab === 0 ? '' : 'hidden'}>{children}</div>
    </div>
  )
}
```

## é¢„æ¸²æŸ“è¡Œä¸º

Client Components ä¹Ÿä¼šåœ¨æœåŠ¡ç«¯é¢„æ¸²æŸ“ï¼š

```tsx
// components/ClientComponent.tsx
'use client'

import { useState, useEffect } from 'react'

export default function ClientComponent() {
  const [mounted, setMounted] = useState(false)

  useEffect(() => {
    setMounted(true)
  }, [])

  // æœåŠ¡ç«¯æ¸²æŸ“æ—¶ mounted = false
  // å®¢æˆ·ç«¯æ°´åˆå mounted = true
  if (!mounted) {
    return <div>åŠ è½½ä¸­...</div>
  }

  return <div>å·²æŒ‚è½½</div>
}
```

### å¤„ç†æ°´åˆä¸åŒ¹é…

```tsx
// components/Time.tsx
'use client'

import { useState, useEffect } from 'react'

export default function Time() {
  const [time, setTime] = useState<string | null>(null)

  useEffect(() => {
    // åªåœ¨å®¢æˆ·ç«¯æ‰§è¡Œ
    setTime(new Date().toLocaleTimeString())

    const interval = setInterval(() => {
      setTime(new Date().toLocaleTimeString())
    }, 1000)

    return () => clearInterval(interval)
  }, [])

  // é¿å…æ°´åˆä¸åŒ¹é…
  if (!time) {
    return <span>--:--:--</span>
  }

  return <span>{time}</span>
}
```

## è¾¹ç•Œå’Œå¯¼å…¥è§„åˆ™

### "use client" è¾¹ç•Œ

`"use client"` å£°æ˜ä¸€ä¸ªè¾¹ç•Œï¼Œè¯¥æ–‡ä»¶åŠå…¶å¯¼å…¥çš„æ‰€æœ‰æ¨¡å—éƒ½æˆä¸º Client Bundle çš„ä¸€éƒ¨åˆ†ï¼š

```
ServerComponent.tsx
    â†“ å¯¼å…¥
ClientComponent.tsx ("use client")
    â†“ å¯¼å…¥
ChildComponent.tsx  â† è‡ªåŠ¨æˆä¸º Client Component
    â†“ å¯¼å…¥
utilities.ts        â† ä¹Ÿè¢«æ‰“åŒ…åˆ°å®¢æˆ·ç«¯
```

### ä¸èƒ½åœ¨ Client Component ä¸­å¯¼å…¥ Server Component

```tsx
// âŒ é”™è¯¯
'use client'

import { ServerComponent } from './ServerComponent'

export default function ClientComponent() {
  return <ServerComponent /> // ä¸è¡Œï¼
}

// âœ… æ­£ç¡®ï¼šé€šè¿‡ children ä¼ å…¥
;('use client')

export default function ClientComponent({
  children,
}: {
  children: React.ReactNode
}) {
  return <div>{children}</div>
}
```

## å¸¸è§æ¨¡å¼

### Context Provider

```tsx
// components/Providers.tsx
'use client'

import { ThemeProvider } from 'next-themes'
import { QueryClient, QueryClientProvider } from '@tanstack/react-query'
import { useState, ReactNode } from 'react'

export function Providers({ children }: { children: ReactNode }) {
  const [queryClient] = useState(() => new QueryClient())

  return (
    <QueryClientProvider client={queryClient}>
      <ThemeProvider attribute="class">{children}</ThemeProvider>
    </QueryClientProvider>
  )
}
```

```tsx
// app/layout.tsx - Server Component
import { Providers } from '@/components/Providers'

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html>
      <body>
        <Providers>{children}</Providers>
      </body>
    </html>
  )
}
```

### åŠ¨æ€å¯¼å…¥

```tsx
// app/page.tsx
import dynamic from 'next/dynamic'

// ç¦ç”¨ SSR çš„åŠ¨æ€å¯¼å…¥
const Map = dynamic(() => import('@/components/Map'), {
  ssr: false,
  loading: () => <div className="h-96 bg-gray-200 animate-pulse" />,
})

export default function Page() {
  return <Map center={[116.4, 39.9]} />
}
```

## å¸¸è§é—®é¢˜

ğŸ¤” **Q: ä¸ºä»€ä¹ˆæˆ‘çš„ç»„ä»¶æŠ¥é”™è¯´ä¸èƒ½ä½¿ç”¨ useStateï¼Ÿ**

å¿˜è®°æ·»åŠ  `"use client"` æŒ‡ä»¤äº†ã€‚

ğŸ¤” **Q: Client Component ä¼šå½±å“ SEO å—ï¼Ÿ**

ä¸ä¼šã€‚Client Components é¦–å…ˆåœ¨æœåŠ¡ç«¯é¢„æ¸²æŸ“ä¸º HTMLï¼Œå¯¹çˆ¬è™«å‹å¥½ã€‚

ğŸ¤” **Q: å¦‚ä½•åœ¨ Client Component ä¸­è·å–ç¯å¢ƒå˜é‡ï¼Ÿ**

åªèƒ½è®¿é—® `NEXT_PUBLIC_` å‰ç¼€çš„ç¯å¢ƒå˜é‡ï¼š

```tsx
const apiUrl = process.env.NEXT_PUBLIC_API_URL
```

---

ä¸‹ä¸€ç¯‡å°†ä»‹ç»æ··åˆæ¸²æŸ“æ¨¡å¼ï¼Œå­¦ä¹ å¦‚ä½•åˆç†ç»„åˆ Server å’Œ Client Componentsã€‚

-EOF-
