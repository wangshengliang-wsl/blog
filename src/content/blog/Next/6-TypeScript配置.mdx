---
title: TypeScript é…ç½®
description: æ·±å…¥é…ç½® Next.js 15 çš„ TypeScript æ”¯æŒï¼ŒåŒ…æ‹¬è·¯å¾„åˆ«åã€ä¸¥æ ¼æ¨¡å¼ã€ç±»å‹å¢å¼ºä¸æœ€ä½³å®è·µ
pubDate: 2025-12-03
toc: true
ogImage: true
category: Next
tags: ['Next.js', 'TypeScript', 'é…ç½®', 'ç±»å‹å®‰å…¨']
---

ğŸ™‹ Next.js å¯¹ TypeScript æœ‰ä¸€æµçš„æ”¯æŒã€‚å¦‚ä½•é…ç½®æ‰èƒ½è·å¾—æœ€ä½³çš„ç±»å‹å®‰å…¨å’Œå¼€å‘ä½“éªŒï¼Ÿ

## é»˜è®¤é…ç½®

ä½¿ç”¨ `create-next-app` åˆ›å»ºçš„ TypeScript é¡¹ç›®åŒ…å«å®Œæ•´é…ç½®ï¼š

```json
// tsconfig.json
// Next.js 15.x é»˜è®¤é…ç½®
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
```

ğŸ¯ **å…³é”®é…ç½®**ï¼š

- `strict: true` - å¯ç”¨æ‰€æœ‰ä¸¥æ ¼ç±»å‹æ£€æŸ¥
- `plugins` - Next.js ç±»å‹æ’ä»¶
- `paths` - è·¯å¾„åˆ«å

## è·¯å¾„åˆ«å

### åŸºç¡€é…ç½®

```json
// tsconfig.json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"],
      "@/components/*": ["./src/components/*"],
      "@/lib/*": ["./src/lib/*"],
      "@/hooks/*": ["./src/hooks/*"],
      "@/types/*": ["./src/types/*"]
    }
  }
}
```

ä½¿ç”¨æ–¹å¼ï¼š

```tsx
// ä¹‹å‰
import { Button } from '../../../components/ui/Button'
import { cn } from '../../../lib/utils'

// ä¹‹å
import { Button } from '@/components/ui/Button'
import { cn } from '@/lib/utils'
```

### å¤šæ ¹è·¯å¾„

```json
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./src/*"],
      "~/*": ["./public/*"],
      "#/*": ["./types/*"]
    }
  }
}
```

ğŸ”¶ **æ³¨æ„**ï¼šä¿®æ”¹ `paths` åéœ€è¦é‡å¯å¼€å‘æœåŠ¡å™¨ã€‚

## ä¸¥æ ¼æ¨¡å¼è¯¦è§£

### æ¨èçš„ä¸¥æ ¼é…ç½®

```json
// tsconfig.json
{
  "compilerOptions": {
    "strict": true,
    // strict åŒ…å«ä»¥ä¸‹æ‰€æœ‰é€‰é¡¹ï¼š
    // "noImplicitAny": true,
    // "strictNullChecks": true,
    // "strictFunctionTypes": true,
    // "strictBindCallApply": true,
    // "strictPropertyInitialization": true,
    // "noImplicitThis": true,
    // "alwaysStrict": true,

    // é¢å¤–æ¨èçš„ä¸¥æ ¼é€‰é¡¹
    "noUncheckedIndexedAccess": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true
  }
}
```

### noUncheckedIndexedAccess

è¿™æ˜¯æœ€æœ‰ä»·å€¼çš„é¢å¤–ä¸¥æ ¼é€‰é¡¹ï¼š

```tsx
// æ²¡æœ‰ noUncheckedIndexedAccess
const arr = [1, 2, 3]
const first = arr[0] // number

// æœ‰ noUncheckedIndexedAccess
const arr = [1, 2, 3]
const first = arr[0] // number | undefined

// å¿…é¡»å¤„ç† undefined
if (first !== undefined) {
  console.log(first * 2)
}

// æˆ–ä½¿ç”¨éç©ºæ–­è¨€ï¼ˆç¡®å®šå­˜åœ¨æ—¶ï¼‰
console.log(arr[0]! * 2)
```

## ç±»å‹å®šä¹‰æ–‡ä»¶

### next-env.d.ts

Next.js è‡ªåŠ¨ç”Ÿæˆçš„ç±»å‹å£°æ˜æ–‡ä»¶ï¼š

```typescript
// next-env.d.ts
// ä¸è¦æ‰‹åŠ¨ç¼–è¾‘æ­¤æ–‡ä»¶
/// <reference types="next" />
/// <reference types="next/image-types/global" />
```

ğŸ”¶ **è­¦å‘Š**ï¼šä¸è¦ä¿®æ”¹æ­¤æ–‡ä»¶ï¼Œå®ƒä¼šè¢«è‡ªåŠ¨æ›´æ–°ã€‚

### è‡ªå®šä¹‰ç±»å‹

```typescript
// types/index.ts
// ä¸šåŠ¡ç±»å‹å®šä¹‰

export interface User {
  id: string
  name: string
  email: string
  avatar?: string
  createdAt: Date
}

export interface Post {
  id: string
  title: string
  content: string
  author: User
  publishedAt: Date
}

export interface ApiResponse<T> {
  data: T
  message: string
  success: boolean
}
```

### å…¨å±€ç±»å‹æ‰©å±•

```typescript
// types/global.d.ts

// æ‰©å±• Window å¯¹è±¡
declare global {
  interface Window {
    gtag: (...args: unknown[]) => void
    dataLayer: unknown[]
  }
}

// æ‰©å±•ç¯å¢ƒå˜é‡ç±»å‹
declare global {
  namespace NodeJS {
    interface ProcessEnv {
      DATABASE_URL: string
      NEXT_PUBLIC_API_URL: string
      API_SECRET: string
    }
  }
}

export {}
```

## ç»„ä»¶ç±»å‹

### é¡µé¢ç»„ä»¶

```tsx
// app/users/[id]/page.tsx
// Next.js 15.x

interface PageProps {
  params: Promise<{ id: string }>
  searchParams: Promise<{ [key: string]: string | string[] | undefined }>
}

export default async function UserPage({ params, searchParams }: PageProps) {
  const { id } = await params
  const { tab } = await searchParams

  return (
    <div>
      User {id}, Tab: {tab}
    </div>
  )
}
```

### å¸ƒå±€ç»„ä»¶

```tsx
// app/dashboard/layout.tsx
// Next.js 15.x
import type { ReactNode } from 'react'

interface LayoutProps {
  children: ReactNode
  params: Promise<{ slug: string }>
}

export default async function DashboardLayout({
  children,
  params,
}: LayoutProps) {
  const { slug } = await params

  return (
    <div>
      <nav>Dashboard: {slug}</nav>
      {children}
    </div>
  )
}
```

### æœåŠ¡ç«¯ç»„ä»¶

```tsx
// components/UserList.tsx
// Next.js 15.x

interface User {
  id: string
  name: string
}

interface UserListProps {
  initialUsers?: User[]
}

// å¼‚æ­¥æœåŠ¡ç«¯ç»„ä»¶
export default async function UserList({ initialUsers }: UserListProps) {
  const users = initialUsers ?? (await fetchUsers())

  return (
    <ul>
      {users.map((user) => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  )
}

async function fetchUsers(): Promise<User[]> {
  const res = await fetch('https://api.example.com/users')
  return res.json()
}
```

### å®¢æˆ·ç«¯ç»„ä»¶

```tsx
// components/Counter.tsx
// Next.js 15.x
'use client'

import { useState, type FC, type MouseEvent } from 'react'

interface CounterProps {
  initialValue?: number
  step?: number
  onCountChange?: (count: number) => void
}

const Counter: FC<CounterProps> = ({
  initialValue = 0,
  step = 1,
  onCountChange,
}) => {
  const [count, setCount] = useState(initialValue)

  const handleClick = (e: MouseEvent<HTMLButtonElement>) => {
    e.preventDefault()
    const newCount = count + step
    setCount(newCount)
    onCountChange?.(newCount)
  }

  return <button onClick={handleClick}>è®¡æ•°: {count}</button>
}

export default Counter
```

## API ç±»å‹

### Route Handler

```typescript
// app/api/users/route.ts
// Next.js 15.x
import { NextRequest, NextResponse } from 'next/server'

interface User {
  id: string
  name: string
  email: string
}

interface CreateUserBody {
  name: string
  email: string
}

export async function GET(request: NextRequest) {
  const searchParams = request.nextUrl.searchParams
  const page = searchParams.get('page') ?? '1'

  const users: User[] = [{ id: '1', name: 'Alice', email: 'alice@example.com' }]

  return NextResponse.json({ users, page: parseInt(page) })
}

export async function POST(request: NextRequest) {
  const body: CreateUserBody = await request.json()

  const newUser: User = {
    id: crypto.randomUUID(),
    name: body.name,
    email: body.email,
  }

  return NextResponse.json(newUser, { status: 201 })
}
```

### Server Action

```typescript
// app/actions/user.ts
// Next.js 15.x
'use server'

import { z } from 'zod'

const CreateUserSchema = z.object({
  name: z.string().min(2).max(50),
  email: z.string().email(),
})

type CreateUserInput = z.infer<typeof CreateUserSchema>

interface ActionResult<T> {
  success: boolean
  data?: T
  error?: string
}

export async function createUser(
  formData: FormData
): Promise<ActionResult<{ id: string }>> {
  const rawData = {
    name: formData.get('name'),
    email: formData.get('email'),
  }

  const result = CreateUserSchema.safeParse(rawData)

  if (!result.success) {
    return {
      success: false,
      error: result.error.errors[0].message,
    }
  }

  // åˆ›å»ºç”¨æˆ·...
  const id = crypto.randomUUID()

  return {
    success: true,
    data: { id },
  }
}
```

## å®ç”¨ç±»å‹å·¥å…·

### å¸¸ç”¨è¾…åŠ©ç±»å‹

```typescript
// types/utils.ts

// ä½¿å¯¹è±¡æ‰€æœ‰å±æ€§å¯é€‰ï¼ˆæ·±å±‚ï¼‰
type DeepPartial<T> = {
  [P in keyof T]?: T[P] extends object ? DeepPartial<T[P]> : T[P]
}

// æå– Promise è¿”å›ç±»å‹
type Awaited<T> = T extends Promise<infer U> ? U : T

// è”åˆç±»å‹è½¬äº¤å‰ç±»å‹
type UnionToIntersection<U> = (
  U extends unknown ? (k: U) => void : never
) extends (k: infer I) => void
  ? I
  : never

// è·å–å¯¹è±¡æ‰€æœ‰å€¼çš„ç±»å‹
type ValueOf<T> = T[keyof T]

// å¿…é€‰æŸäº›å­—æ®µ
type RequiredFields<T, K extends keyof T> = T & Required<Pick<T, K>>
```

### ä½¿ç”¨ç¤ºä¾‹

```typescript
interface User {
  id: string
  name: string
  email?: string
  profile?: {
    avatar?: string
    bio?: string
  }
}

// åˆ›å»ºæ—¶å¯ä»¥åªä¼ éƒ¨åˆ†å­—æ®µ
type CreateUserInput = DeepPartial<User>

// æ›´æ–°æ—¶æŸäº›å­—æ®µå¿…å¡«
type UpdateUserInput = RequiredFields<Partial<User>, 'id'>
```

## ç±»å‹æ£€æŸ¥å‘½ä»¤

```bash
# ç±»å‹æ£€æŸ¥ï¼ˆä¸ç”Ÿæˆæ–‡ä»¶ï¼‰
pnpm tsc --noEmit

# Next.js ç±»å‹æ£€æŸ¥
pnpm next build  # æ„å»ºæ—¶è‡ªåŠ¨æ£€æŸ¥

# åœ¨ package.json ä¸­æ·»åŠ è„šæœ¬
```

```json
{
  "scripts": {
    "type-check": "tsc --noEmit",
    "type-check:watch": "tsc --noEmit --watch"
  }
}
```

## å¸¸è§é—®é¢˜

ğŸ¤” **Q: å¦‚ä½•å¤„ç†ç¬¬ä¸‰æ–¹åº“æ²¡æœ‰ç±»å‹å®šä¹‰ï¼Ÿ**

```bash
# å®‰è£…ç¤¾åŒºç±»å‹å®šä¹‰
pnpm add -D @types/lodash

# æˆ–åˆ›å»ºæœ¬åœ°å£°æ˜
```

```typescript
// types/untyped-lib.d.ts
declare module 'untyped-lib' {
  export function doSomething(value: string): number
  export default function main(): void
}
```

ğŸ¤” **Q: import type å’Œ import æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**

```typescript
// import type åªå¯¼å…¥ç±»å‹ï¼Œä¸ä¼šåœ¨è¿è¡Œæ—¶å­˜åœ¨
import type { User } from './types'

// import å¯¼å…¥å€¼å’Œç±»å‹ï¼Œè¿è¡Œæ—¶å¯ç”¨
import { User, createUser } from './user'

// æ¨èï¼šç±»å‹åªç”¨äºç±»å‹æ³¨è§£æ—¶ä½¿ç”¨ import type
import type { FC, ReactNode } from 'react'
```

ğŸ¤” **Q: å¦‚ä½•å¤„ç†åŠ¨æ€å¯¼å…¥çš„ç±»å‹ï¼Ÿ**

```typescript
// ä½¿ç”¨ typeof è·å–åŠ¨æ€æ¨¡å—ç±»å‹
const MyComponent = dynamic(() => import('./MyComponent'))
type MyComponentProps = React.ComponentProps<typeof MyComponent>

// æˆ–é¢„å…ˆå¯¼å‡ºç±»å‹
export type { MyComponentProps } from './MyComponent'
```

---

æ­å–œä½ å®Œæˆäº†ç¬¬ä¸€éƒ¨åˆ†çš„å­¦ä¹ ï¼ä¸‹ä¸€ç¯‡å°†å¼€å§‹è·¯ç”±ç³»ç»Ÿçš„æ·±å…¥æ¢ç´¢ï¼Œä»‹ç»æ–‡ä»¶ç³»ç»Ÿè·¯ç”±çš„å®Œæ•´è§„åˆ™ã€‚

-EOF-
