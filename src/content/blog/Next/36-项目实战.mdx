---
title: é¡¹ç›®å®æˆ˜
description: ç»¼åˆè¿ç”¨ Next.js 15 çŸ¥è¯†ï¼Œä»é›¶æ„å»ºä¸€ä¸ªå®Œæ•´çš„å…¨æ ˆåšå®¢åº”ç”¨
pubDate: 2025-12-03
toc: true
ogImage: true
category: Next
tags: ['Next.js', 'é¡¹ç›®å®æˆ˜', 'å…¨æ ˆå¼€å‘', 'åšå®¢ç³»ç»Ÿ']
---

ğŸ™‹ å­¦å®Œäº†æ‰€æœ‰çŸ¥è¯†ç‚¹ï¼Œå¦‚ä½•ç»¼åˆè¿ç”¨ï¼Ÿè®©æˆ‘ä»¬ä¸€èµ·æ„å»ºä¸€ä¸ªå®Œæ•´çš„åšå®¢åº”ç”¨ã€‚

## é¡¹ç›®æ¦‚è¿°

### åŠŸèƒ½éœ€æ±‚

- ç”¨æˆ·è®¤è¯ï¼ˆGitHub OAuthï¼‰
- æ–‡ç«  CRUD
- Markdown ç¼–è¾‘å™¨
- è¯„è®ºç³»ç»Ÿ
- æ ‡ç­¾åˆ†ç±»
- å…¨æ–‡æœç´¢
- å“åº”å¼è®¾è®¡

### æŠ€æœ¯æ ˆ

| ç±»åˆ«   | æŠ€æœ¯                |
| ------ | ------------------- |
| æ¡†æ¶   | Next.js 15          |
| æ•°æ®åº“ | PostgreSQL + Prisma |
| è®¤è¯   | Auth.js             |
| æ ·å¼   | Tailwind CSS        |
| ç¼–è¾‘å™¨ | MDX                 |
| éƒ¨ç½²   | Vercel              |

## é¡¹ç›®åˆå§‹åŒ–

### åˆ›å»ºé¡¹ç›®

```bash
pnpm create next-app@latest my-blog --typescript --tailwind --eslint --app --src-dir
cd my-blog
```

### å®‰è£…ä¾èµ–

```bash
# æ•°æ®åº“
pnpm add prisma @prisma/client
pnpm add -D prisma

# è®¤è¯
pnpm add next-auth@beta @auth/prisma-adapter

# å·¥å…·
pnpm add zod date-fns
pnpm add -D @types/node

# Markdown
pnpm add @mdx-js/loader @mdx-js/react @next/mdx
pnpm add rehype-highlight remark-gfm
```

### ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ (auth)/
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â””â”€â”€ register/
â”‚   â”œâ”€â”€ (main)/
â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ blog/
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ [slug]/
â”‚   â”‚   â””â”€â”€ dashboard/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ auth/
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ globals.css
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ blog/
â”‚   â””â”€â”€ layout/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ db.ts
â”‚   â”œâ”€â”€ auth.ts
â”‚   â””â”€â”€ utils.ts
â””â”€â”€ types/
```

## æ•°æ®åº“è®¾è®¡

### Prisma Schema

```prisma
// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  image         String?
  role          Role      @default(USER)
  accounts      Account[]
  sessions      Session[]
  posts         Post[]
  comments      Comment[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Post {
  id          String    @id @default(cuid())
  title       String
  slug        String    @unique
  content     String    @db.Text
  excerpt     String?
  coverImage  String?
  published   Boolean   @default(false)
  author      User      @relation(fields: [authorId], references: [id])
  authorId    String
  tags        Tag[]
  comments    Comment[]
  views       Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([authorId])
  @@index([published])
}

model Tag {
  id    String @id @default(cuid())
  name  String @unique
  slug  String @unique
  posts Post[]
}

model Comment {
  id        String   @id @default(cuid())
  content   String
  author    User     @relation(fields: [authorId], references: [id])
  authorId  String
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  postId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([postId])
}

enum Role {
  USER
  ADMIN
}

// Auth.js ç›¸å…³è¡¨
model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}
```

### åˆå§‹åŒ–æ•°æ®åº“

```bash
npx prisma migrate dev --name init
npx prisma generate
```

## è®¤è¯é…ç½®

```tsx
// src/auth.ts
import NextAuth from 'next-auth'
import GitHub from 'next-auth/providers/github'
import { PrismaAdapter } from '@auth/prisma-adapter'
import { prisma } from '@/lib/db'

export const { handlers, auth, signIn, signOut } = NextAuth({
  adapter: PrismaAdapter(prisma),
  providers: [
    GitHub({
      clientId: process.env.GITHUB_ID!,
      clientSecret: process.env.GITHUB_SECRET!,
    }),
  ],
  callbacks: {
    async session({ session, user }) {
      session.user.id = user.id
      session.user.role = user.role
      return session
    },
  },
  pages: {
    signIn: '/login',
  },
})
```

```tsx
// src/lib/db.ts
import { PrismaClient } from '@prisma/client'

const globalForPrisma = globalThis as unknown as {
  prisma: PrismaClient | undefined
}

export const prisma = globalForPrisma.prisma ?? new PrismaClient()

if (process.env.NODE_ENV !== 'production') {
  globalForPrisma.prisma = prisma
}
```

## å¸ƒå±€ç»„ä»¶

### æ ¹å¸ƒå±€

```tsx
// src/app/layout.tsx
import type { Metadata } from 'next'
import { Inter } from 'next/font/google'
import { SessionProvider } from 'next-auth/react'
import { Header } from '@/components/layout/Header'
import { Footer } from '@/components/layout/Footer'
import './globals.css'

const inter = Inter({ subsets: ['latin'] })

export const metadata: Metadata = {
  title: {
    default: 'My Blog',
    template: '%s | My Blog',
  },
  description: 'ä¸€ä¸ªä½¿ç”¨ Next.js 15 æ„å»ºçš„åšå®¢',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="zh-CN">
      <body className={inter.className}>
        <SessionProvider>
          <div className="min-h-screen flex flex-col">
            <Header />
            <main className="flex-1">{children}</main>
            <Footer />
          </div>
        </SessionProvider>
      </body>
    </html>
  )
}
```

### å¤´éƒ¨ç»„ä»¶

```tsx
// src/components/layout/Header.tsx
import Link from 'next/link'
import { auth } from '@/auth'
import { UserMenu } from './UserMenu'

export async function Header() {
  const session = await auth()

  return (
    <header className="border-b">
      <div className="container mx-auto px-4 h-16 flex items-center justify-between">
        <Link href="/" className="text-xl font-bold">
          My Blog
        </Link>

        <nav className="flex items-center gap-6">
          <Link href="/blog" className="hover:text-gray-600">
            åšå®¢
          </Link>
          {session?.user ? (
            <>
              <Link href="/dashboard" className="hover:text-gray-600">
                ä»ªè¡¨ç›˜
              </Link>
              <UserMenu user={session.user} />
            </>
          ) : (
            <Link
              href="/login"
              className="bg-black text-white px-4 py-2 rounded"
            >
              ç™»å½•
            </Link>
          )}
        </nav>
      </div>
    </header>
  )
}
```

## æ–‡ç« åŠŸèƒ½

### æ–‡ç« åˆ—è¡¨é¡µ

```tsx
// src/app/(main)/blog/page.tsx
import Link from 'next/link'
import { prisma } from '@/lib/db'
import { formatDate } from '@/lib/utils'

async function getPosts() {
  return prisma.post.findMany({
    where: { published: true },
    include: {
      author: { select: { name: true, image: true } },
      tags: true,
    },
    orderBy: { createdAt: 'desc' },
  })
}

export default async function BlogPage() {
  const posts = await getPosts()

  return (
    <div className="container mx-auto px-4 py-8">
      <h1 className="text-3xl font-bold mb-8">åšå®¢æ–‡ç« </h1>

      <div className="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
        {posts.map((post) => (
          <article key={post.id} className="border rounded-lg overflow-hidden">
            {post.coverImage && (
              <img
                src={post.coverImage}
                alt={post.title}
                className="w-full h-48 object-cover"
              />
            )}
            <div className="p-4">
              <div className="flex gap-2 mb-2">
                {post.tags.map((tag) => (
                  <span
                    key={tag.id}
                    className="text-xs bg-gray-100 px-2 py-1 rounded"
                  >
                    {tag.name}
                  </span>
                ))}
              </div>
              <h2 className="text-xl font-semibold mb-2">
                <Link
                  href={`/blog/${post.slug}`}
                  className="hover:text-blue-600"
                >
                  {post.title}
                </Link>
              </h2>
              <p className="text-gray-600 mb-4">{post.excerpt}</p>
              <div className="flex items-center justify-between text-sm text-gray-500">
                <span>{post.author.name}</span>
                <time>{formatDate(post.createdAt)}</time>
              </div>
            </div>
          </article>
        ))}
      </div>
    </div>
  )
}
```

### æ–‡ç« è¯¦æƒ…é¡µ

```tsx
// src/app/(main)/blog/[slug]/page.tsx
import { notFound } from 'next/navigation'
import { prisma } from '@/lib/db'
import { formatDate } from '@/lib/utils'
import { CommentSection } from '@/components/blog/CommentSection'

interface Props {
  params: Promise<{ slug: string }>
}

async function getPost(slug: string) {
  const post = await prisma.post.findUnique({
    where: { slug, published: true },
    include: {
      author: { select: { name: true, image: true } },
      tags: true,
      comments: {
        include: { author: { select: { name: true, image: true } } },
        orderBy: { createdAt: 'desc' },
      },
    },
  })

  if (post) {
    // å¢åŠ é˜…è¯»é‡
    await prisma.post.update({
      where: { id: post.id },
      data: { views: { increment: 1 } },
    })
  }

  return post
}

export async function generateMetadata({ params }: Props) {
  const { slug } = await params
  const post = await prisma.post.findUnique({ where: { slug } })

  if (!post) return {}

  return {
    title: post.title,
    description: post.excerpt,
  }
}

export default async function PostPage({ params }: Props) {
  const { slug } = await params
  const post = await getPost(slug)

  if (!post) {
    notFound()
  }

  return (
    <article className="container mx-auto px-4 py-8 max-w-3xl">
      <header className="mb-8">
        <h1 className="text-4xl font-bold mb-4">{post.title}</h1>
        <div className="flex items-center gap-4 text-gray-600">
          <img
            src={post.author.image || '/default-avatar.png'}
            alt={post.author.name || ''}
            className="w-10 h-10 rounded-full"
          />
          <div>
            <div className="font-medium">{post.author.name}</div>
            <time className="text-sm">{formatDate(post.createdAt)}</time>
          </div>
          <span className="ml-auto">{post.views} æ¬¡é˜…è¯»</span>
        </div>
      </header>

      <div className="prose max-w-none mb-12">{post.content}</div>

      <CommentSection postId={post.id} comments={post.comments} />
    </article>
  )
}
```

### åˆ›å»ºæ–‡ç« 

```tsx
// src/app/actions/posts.ts
'use server'

import { z } from 'zod'
import { auth } from '@/auth'
import { prisma } from '@/lib/db'
import { revalidatePath } from 'next/cache'
import { redirect } from 'next/navigation'

const PostSchema = z.object({
  title: z.string().min(1).max(200),
  content: z.string().min(1),
  excerpt: z.string().max(500).optional(),
  coverImage: z.string().url().optional(),
  tags: z.array(z.string()),
  published: z.boolean(),
})

function slugify(text: string) {
  return text
    .toLowerCase()
    .replace(/\s+/g, '-')
    .replace(/[^\w-]+/g, '')
}

export async function createPost(prevState: any, formData: FormData) {
  const session = await auth()

  if (!session?.user) {
    return { error: 'è¯·å…ˆç™»å½•' }
  }

  const data = {
    title: formData.get('title'),
    content: formData.get('content'),
    excerpt: formData.get('excerpt'),
    coverImage: formData.get('coverImage'),
    tags: formData.getAll('tags'),
    published: formData.get('published') === 'true',
  }

  const result = PostSchema.safeParse(data)

  if (!result.success) {
    return { errors: result.error.flatten().fieldErrors }
  }

  const slug = slugify(result.data.title)

  const post = await prisma.post.create({
    data: {
      title: result.data.title,
      slug,
      content: result.data.content,
      excerpt: result.data.excerpt,
      coverImage: result.data.coverImage,
      published: result.data.published,
      authorId: session.user.id,
      tags: {
        connectOrCreate: result.data.tags.map((name) => ({
          where: { name },
          create: { name, slug: slugify(name) },
        })),
      },
    },
  })

  revalidatePath('/blog')
  revalidatePath('/dashboard')
  redirect(`/blog/${post.slug}`)
}
```

## è¯„è®ºåŠŸèƒ½

```tsx
// src/components/blog/CommentSection.tsx
'use client'

import { useActionState } from 'react'
import { useSession } from 'next-auth/react'
import { addComment } from '@/app/actions/comments'
import { formatDate } from '@/lib/utils'

interface Comment {
  id: string
  content: string
  createdAt: Date
  author: { name: string | null; image: string | null }
}

export function CommentSection({
  postId,
  comments,
}: {
  postId: string
  comments: Comment[]
}) {
  const { data: session } = useSession()
  const [state, formAction, isPending] = useActionState(
    addComment.bind(null, postId),
    null
  )

  return (
    <section>
      <h2 className="text-2xl font-bold mb-6">è¯„è®º ({comments.length})</h2>

      {session?.user ? (
        <form action={formAction} className="mb-8">
          <textarea
            name="content"
            placeholder="å†™ä¸‹ä½ çš„è¯„è®º..."
            rows={4}
            className="w-full border rounded-lg p-4"
            required
          />
          {state?.error && <p className="text-red-500 mt-2">{state.error}</p>}
          <button
            type="submit"
            disabled={isPending}
            className="mt-2 bg-blue-600 text-white px-6 py-2 rounded"
          >
            {isPending ? 'æäº¤ä¸­...' : 'å‘è¡¨è¯„è®º'}
          </button>
        </form>
      ) : (
        <p className="mb-8 text-gray-500">
          è¯·
          <a href="/login" className="text-blue-600">
            ç™»å½•
          </a>
          åå‘è¡¨è¯„è®º
        </p>
      )}

      <div className="space-y-6">
        {comments.map((comment) => (
          <div key={comment.id} className="flex gap-4">
            <img
              src={comment.author.image || '/default-avatar.png'}
              alt={comment.author.name || ''}
              className="w-10 h-10 rounded-full"
            />
            <div className="flex-1">
              <div className="flex items-center gap-2">
                <span className="font-medium">{comment.author.name}</span>
                <time className="text-sm text-gray-500">
                  {formatDate(comment.createdAt)}
                </time>
              </div>
              <p className="mt-1">{comment.content}</p>
            </div>
          </div>
        ))}
      </div>
    </section>
  )
}
```

## ä»ªè¡¨ç›˜

```tsx
// src/app/(main)/dashboard/page.tsx
import Link from 'next/link'
import { auth } from '@/auth'
import { redirect } from 'next/navigation'
import { prisma } from '@/lib/db'

export default async function DashboardPage() {
  const session = await auth()

  if (!session?.user) {
    redirect('/login')
  }

  const posts = await prisma.post.findMany({
    where: { authorId: session.user.id },
    orderBy: { createdAt: 'desc' },
  })

  const stats = {
    total: posts.length,
    published: posts.filter((p) => p.published).length,
    drafts: posts.filter((p) => !p.published).length,
    views: posts.reduce((sum, p) => sum + p.views, 0),
  }

  return (
    <div className="container mx-auto px-4 py-8">
      <div className="flex justify-between items-center mb-8">
        <h1 className="text-3xl font-bold">ä»ªè¡¨ç›˜</h1>
        <Link
          href="/dashboard/new"
          className="bg-blue-600 text-white px-4 py-2 rounded"
        >
          å†™æ–‡ç« 
        </Link>
      </div>

      <div className="grid grid-cols-4 gap-4 mb-8">
        <div className="bg-white p-6 rounded-lg border">
          <div className="text-gray-500">æ€»æ–‡ç« </div>
          <div className="text-3xl font-bold">{stats.total}</div>
        </div>
        <div className="bg-white p-6 rounded-lg border">
          <div className="text-gray-500">å·²å‘å¸ƒ</div>
          <div className="text-3xl font-bold">{stats.published}</div>
        </div>
        <div className="bg-white p-6 rounded-lg border">
          <div className="text-gray-500">è‰ç¨¿</div>
          <div className="text-3xl font-bold">{stats.drafts}</div>
        </div>
        <div className="bg-white p-6 rounded-lg border">
          <div className="text-gray-500">æ€»é˜…è¯»</div>
          <div className="text-3xl font-bold">{stats.views}</div>
        </div>
      </div>

      <div className="bg-white rounded-lg border">
        <table className="w-full">
          <thead className="bg-gray-50">
            <tr>
              <th className="px-6 py-3 text-left">æ ‡é¢˜</th>
              <th className="px-6 py-3 text-left">çŠ¶æ€</th>
              <th className="px-6 py-3 text-left">é˜…è¯»</th>
              <th className="px-6 py-3 text-left">æ“ä½œ</th>
            </tr>
          </thead>
          <tbody>
            {posts.map((post) => (
              <tr key={post.id} className="border-t">
                <td className="px-6 py-4">{post.title}</td>
                <td className="px-6 py-4">
                  <span
                    className={`px-2 py-1 rounded text-sm ${
                      post.published
                        ? 'bg-green-100 text-green-800'
                        : 'bg-yellow-100 text-yellow-800'
                    }`}
                  >
                    {post.published ? 'å·²å‘å¸ƒ' : 'è‰ç¨¿'}
                  </span>
                </td>
                <td className="px-6 py-4">{post.views}</td>
                <td className="px-6 py-4">
                  <Link
                    href={`/dashboard/edit/${post.id}`}
                    className="text-blue-600"
                  >
                    ç¼–è¾‘
                  </Link>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  )
}
```

## éƒ¨ç½²æ¸…å•

### ç¯å¢ƒå˜é‡

```bash
# .env.production
DATABASE_URL="postgresql://..."
AUTH_SECRET="..."
GITHUB_ID="..."
GITHUB_SECRET="..."
NEXT_PUBLIC_APP_URL="https://yourdomain.com"
```

### æ„å»ºæ£€æŸ¥

```bash
pnpm build
pnpm start
```

### éƒ¨ç½²åˆ° Vercel

```bash
vercel --prod
```

## æ€»ç»“

æ­å–œä½ å®Œæˆäº† Next.js 15 å…¨éƒ¨è¯¾ç¨‹ï¼ä½ å·²ç»å­¦ä¹ äº†ï¼š

1. **åŸºç¡€å…¥é—¨** - é¡¹ç›®åˆ›å»ºã€App Routerã€TypeScript
2. **è·¯ç”±ç³»ç»Ÿ** - åŠ¨æ€è·¯ç”±ã€åµŒå¥—å¸ƒå±€ã€ä¸­é—´ä»¶
3. **æ¸²æŸ“æ¨¡å¼** - Server/Client Componentsã€Streaming
4. **æ•°æ®å¤„ç†** - æ•°æ®è·å–ã€ç¼“å­˜ã€Server Actions
5. **ä¼˜åŒ–æ€§èƒ½** - å›¾ç‰‡ã€å­—ä½“ã€è„šæœ¬ã€SEO
6. **å…¨æ ˆå¼€å‘** - è®¤è¯ã€æ•°æ®åº“ã€æµ‹è¯•ã€éƒ¨ç½²

ç»§ç»­æ¢ç´¢ï¼Œæ„å»ºæ›´å¤šç²¾å½©çš„åº”ç”¨ï¼

-EOF-
