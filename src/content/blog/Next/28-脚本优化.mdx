---
title: è„šæœ¬ä¼˜åŒ–
description: ä½¿ç”¨ next/script ä¼˜åŒ–ç¬¬ä¸‰æ–¹è„šæœ¬åŠ è½½ï¼ŒæŒæ¡ä¸åŒåŠ è½½ç­–ç•¥å’Œæ€§èƒ½å½±å“
pubDate: 2025-12-03
toc: true
ogImage: true
category: Next
tags: ['Next.js', 'next/script', 'æ€§èƒ½ä¼˜åŒ–', 'ç¬¬ä¸‰æ–¹è„šæœ¬']
---

ğŸ™‹ ç¬¬ä¸‰æ–¹è„šæœ¬æ‹–æ…¢é¡µé¢åŠ è½½ï¼Ÿnext/script æä¾›å¤šç§åŠ è½½ç­–ç•¥ï¼Œè®©ä½ ç²¾ç¡®æ§åˆ¶è„šæœ¬ä¼˜å…ˆçº§ã€‚

## ä¸ºä»€ä¹ˆä½¿ç”¨ next/script

| é—®é¢˜     | åŸç”Ÿ script | next/script |
| -------- | ----------- | ----------- |
| é˜»å¡æ¸²æŸ“ | å¸¸è§        | âœ… å¯æ§     |
| åŠ è½½æ—¶æœº | å›ºå®š        | âœ… å¤šç­–ç•¥   |
| é‡å¤åŠ è½½ | å¯èƒ½        | âœ… è‡ªåŠ¨å»é‡ |
| é”™è¯¯å¤„ç† | æ—           | âœ… å†…ç½®å›è°ƒ |

## åŸºç¡€ç”¨æ³•

```tsx
// app/layout.tsx
import Script from 'next/script'

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="zh-CN">
      <body>
        {children}
        <Script src="https://example.com/analytics.js" />
      </body>
    </html>
  )
}
```

## åŠ è½½ç­–ç•¥

### beforeInteractive

é¡µé¢å¯äº¤äº’å‰åŠ è½½ï¼Œç”¨äºå…³é”®è„šæœ¬ï¼š

```tsx
<Script
  src="https://polyfill.io/v3/polyfill.min.js"
  strategy="beforeInteractive"
/>
```

ğŸ”¶ **æ³¨æ„**ï¼šåªèƒ½åœ¨ `app/layout.tsx` æˆ– `pages/_document.tsx` ä¸­ä½¿ç”¨ã€‚

é€‚ç”¨åœºæ™¯ï¼š

- Polyfills
- Bot æ£€æµ‹
- Cookie åŒæ„ç®¡ç†

### afterInteractiveï¼ˆé»˜è®¤ï¼‰

é¡µé¢å¯äº¤äº’åç«‹å³åŠ è½½ï¼š

```tsx
<Script
  src="https://www.googletagmanager.com/gtag/js?id=GA_ID"
  strategy="afterInteractive"
/>
```

é€‚ç”¨åœºæ™¯ï¼š

- åˆ†æè„šæœ¬
- æ ‡ç­¾ç®¡ç†å™¨
- ç¤¾äº¤åˆ†äº«æŒ‰é’®

### lazyOnload

æµè§ˆå™¨ç©ºé—²æ—¶åŠ è½½ï¼š

```tsx
<Script src="https://connect.facebook.net/en_US/sdk.js" strategy="lazyOnload" />
```

é€‚ç”¨åœºæ™¯ï¼š

- èŠå¤©æ’ä»¶
- ç¤¾äº¤åª’ä½“åµŒå…¥
- éå…³é”®åŠŸèƒ½

### workerï¼ˆå®éªŒæ€§ï¼‰

åœ¨ Web Worker ä¸­è¿è¡Œï¼š

```tsx
// next.config.ts
const config: NextConfig = {
  experimental: {
    nextScriptWorkers: true,
  },
}
```

```tsx
<Script src="https://example.com/heavy-script.js" strategy="worker" />
```

## å†…è”è„šæœ¬

### ä½¿ç”¨ dangerouslySetInnerHTML

```tsx
<Script id="inline-script" strategy="afterInteractive">
  {`
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'GA_MEASUREMENT_ID');
  `}
</Script>
```

### ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²

```tsx
<Script
  id="structured-data"
  type="application/ld+json"
  dangerouslySetInnerHTML={{
    __html: JSON.stringify({
      '@context': 'https://schema.org',
      '@type': 'Organization',
      'name': 'My Company',
      'url': 'https://example.com',
    }),
  }}
/>
```

ğŸ”¶ **é‡è¦**ï¼šå†…è”è„šæœ¬å¿…é¡»æœ‰å”¯ä¸€çš„ `id` å±æ€§ã€‚

## äº‹ä»¶å›è°ƒ

### onLoad

```tsx
<Script
  src="https://maps.googleapis.com/maps/api/js"
  onLoad={() => {
    console.log('Google Maps åŠ è½½å®Œæˆ')
    initMap()
  }}
/>
```

### onReady

æ¯æ¬¡ç»„ä»¶æŒ‚è½½æ—¶è§¦å‘ï¼ˆåŒ…æ‹¬å®¢æˆ·ç«¯å¯¼èˆªåï¼‰ï¼š

```tsx
<Script
  src="https://example.com/widget.js"
  onReady={() => {
    console.log('è„šæœ¬å·²å°±ç»ª')
    // åˆå§‹åŒ–æ’ä»¶
    window.Widget.init()
  }}
/>
```

### onError

```tsx
<Script
  src="https://example.com/script.js"
  onError={(e) => {
    console.error('è„šæœ¬åŠ è½½å¤±è´¥:', e)
    // ä¸ŠæŠ¥é”™è¯¯æˆ–æ˜¾ç¤ºå›é€€ UI
  }}
/>
```

## å¸¸è§ç¬¬ä¸‰æ–¹è„šæœ¬

### Google Analytics

```tsx
// app/layout.tsx
import Script from 'next/script'

const GA_ID = process.env.NEXT_PUBLIC_GA_ID

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="zh-CN">
      <body>
        {children}

        {GA_ID && (
          <>
            <Script
              src={`https://www.googletagmanager.com/gtag/js?id=${GA_ID}`}
              strategy="afterInteractive"
            />
            <Script id="google-analytics" strategy="afterInteractive">
              {`
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
                gtag('config', '${GA_ID}');
              `}
            </Script>
          </>
        )}
      </body>
    </html>
  )
}
```

### Google Tag Manager

```tsx
// app/layout.tsx
import Script from 'next/script'

const GTM_ID = process.env.NEXT_PUBLIC_GTM_ID

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="zh-CN">
      <body>
        {GTM_ID && (
          <noscript>
            <iframe
              src={`https://www.googletagmanager.com/ns.html?id=${GTM_ID}`}
              height="0"
              width="0"
              style={{ display: 'none', visibility: 'hidden' }}
            />
          </noscript>
        )}

        {children}

        {GTM_ID && (
          <Script id="gtm" strategy="afterInteractive">
            {`
              (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
              new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
              j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
              'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
              })(window,document,'script','dataLayer','${GTM_ID}');
            `}
          </Script>
        )}
      </body>
    </html>
  )
}
```

### ç™¾åº¦ç»Ÿè®¡

```tsx
// app/layout.tsx
import Script from 'next/script'

const BAIDU_ID = process.env.NEXT_PUBLIC_BAIDU_ID

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="zh-CN">
      <body>
        {children}

        {BAIDU_ID && (
          <Script id="baidu-analytics" strategy="afterInteractive">
            {`
              var _hmt = _hmt || [];
              (function() {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?${BAIDU_ID}";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
              })();
            `}
          </Script>
        )}
      </body>
    </html>
  )
}
```

### åœ¨çº¿å®¢æœï¼ˆå¦‚ Crispï¼‰

```tsx
// components/CrispChat.tsx
'use client'

import Script from 'next/script'

const CRISP_ID = process.env.NEXT_PUBLIC_CRISP_ID

export function CrispChat() {
  if (!CRISP_ID) return null

  return (
    <Script
      id="crisp-chat"
      strategy="lazyOnload"
      dangerouslySetInnerHTML={{
        __html: `
          window.$crisp=[];
          window.CRISP_WEBSITE_ID="${CRISP_ID}";
          (function(){
            d=document;
            s=d.createElement("script");
            s.src="https://client.crisp.chat/l.js";
            s.async=1;
            d.getElementsByTagName("head")[0].appendChild(s);
          })();
        `,
      }}
    />
  )
}
```

```tsx
// app/layout.tsx
import { CrispChat } from '@/components/CrispChat'

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="zh-CN">
      <body>
        {children}
        <CrispChat />
      </body>
    </html>
  )
}
```

### åœ°å›¾ï¼ˆGoogle Mapsï¼‰

```tsx
// components/GoogleMap.tsx
'use client'

import { useRef, useEffect } from 'react'
import Script from 'next/script'

interface GoogleMapProps {
  center: { lat: number; lng: number }
  zoom: number
}

export function GoogleMap({ center, zoom }: GoogleMapProps) {
  const mapRef = useRef<HTMLDivElement>(null)

  function initMap() {
    if (mapRef.current && window.google) {
      new window.google.maps.Map(mapRef.current, {
        center,
        zoom,
      })
    }
  }

  return (
    <>
      <Script
        src={`https://maps.googleapis.com/maps/api/js?key=${process.env.NEXT_PUBLIC_GOOGLE_MAPS_KEY}`}
        strategy="lazyOnload"
        onReady={initMap}
      />
      <div ref={mapRef} className="w-full h-96" />
    </>
  )
}
```

### ç¤¾äº¤åˆ†äº«

```tsx
// components/TwitterShare.tsx
'use client'

import Script from 'next/script'

export function TwitterShare() {
  return (
    <>
      <Script
        src="https://platform.twitter.com/widgets.js"
        strategy="lazyOnload"
      />
      <a
        className="twitter-share-button"
        href="https://twitter.com/intent/tweet"
        data-size="large"
      >
        Tweet
      </a>
    </>
  )
}
```

## æ¡ä»¶åŠ è½½

### æ ¹æ®ç¯å¢ƒ

```tsx
{
  process.env.NODE_ENV === 'production' && (
    <Script
      src="https://analytics.example.com/script.js"
      strategy="afterInteractive"
    />
  )
}
```

### æ ¹æ®ç”¨æˆ·åŒæ„

```tsx
// components/Analytics.tsx
'use client'

import Script from 'next/script'
import { useConsent } from '@/hooks/useConsent'

export function Analytics() {
  const { hasConsent } = useConsent()

  if (!hasConsent) return null

  return (
    <Script
      src="https://analytics.example.com/script.js"
      strategy="afterInteractive"
    />
  )
}
```

### è·¯ç”±ç‰¹å®šè„šæœ¬

```tsx
// app/checkout/layout.tsx
import Script from 'next/script'

export default function CheckoutLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <>
      {children}
      {/* åªåœ¨ç»“è´¦é¡µé¢åŠ è½½æ”¯ä»˜è„šæœ¬ */}
      <Script src="https://js.stripe.com/v3/" strategy="afterInteractive" />
    </>
  )
}
```

## æ€§èƒ½ä¼˜åŒ–

### æ¨è¿Ÿéå…³é”®è„šæœ¬

```tsx
// âŒ æ‰€æœ‰è„šæœ¬åŒæ—¶åŠ è½½
<Script src="/analytics.js" />
<Script src="/chat.js" />
<Script src="/social.js" />

// âœ… åˆ†ä¼˜å…ˆçº§åŠ è½½
<Script src="/analytics.js" strategy="afterInteractive" />
<Script src="/chat.js" strategy="lazyOnload" />
<Script src="/social.js" strategy="lazyOnload" />
```

### ä½¿ç”¨ DNS é¢„è§£æ

```tsx
// app/layout.tsx
export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="zh-CN">
      <head>
        <link rel="dns-prefetch" href="https://www.googletagmanager.com" />
        <link rel="preconnect" href="https://www.google-analytics.com" />
      </head>
      <body>{children}</body>
    </html>
  )
}
```

### è‡ªæ‰˜ç®¡è„šæœ¬

```tsx
// å°†ç¬¬ä¸‰æ–¹è„šæœ¬ä¸‹è½½åˆ°æœ¬åœ°
<Script src="/scripts/analytics.js" strategy="afterInteractive" />
```

## è„šæœ¬ç»„ä»¶å°è£…

```tsx
// components/ThirdPartyScripts.tsx
import Script from 'next/script'

interface ThirdPartyScriptsProps {
  gtmId?: string
  gaId?: string
  crispId?: string
}

export function ThirdPartyScripts({
  gtmId,
  gaId,
  crispId,
}: ThirdPartyScriptsProps) {
  return (
    <>
      {/* Google Tag Manager */}
      {gtmId && (
        <Script id="gtm" strategy="afterInteractive">
          {`(function(w,d,s,l,i){...})(window,document,'script','dataLayer','${gtmId}');`}
        </Script>
      )}

      {/* Google Analytics */}
      {gaId && (
        <>
          <Script
            src={`https://www.googletagmanager.com/gtag/js?id=${gaId}`}
            strategy="afterInteractive"
          />
          <Script id="ga" strategy="afterInteractive">
            {`window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','${gaId}');`}
          </Script>
        </>
      )}

      {/* Crisp Chat */}
      {crispId && (
        <Script id="crisp" strategy="lazyOnload">
          {`window.$crisp=[];window.CRISP_WEBSITE_ID="${crispId}";...`}
        </Script>
      )}
    </>
  )
}
```

```tsx
// app/layout.tsx
import { ThirdPartyScripts } from '@/components/ThirdPartyScripts'

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="zh-CN">
      <body>
        {children}
        <ThirdPartyScripts
          gtmId={process.env.NEXT_PUBLIC_GTM_ID}
          gaId={process.env.NEXT_PUBLIC_GA_ID}
          crispId={process.env.NEXT_PUBLIC_CRISP_ID}
        />
      </body>
    </html>
  )
}
```

## å¸¸è§é—®é¢˜

ğŸ¤” **Q: è„šæœ¬é‡å¤åŠ è½½æ€ä¹ˆåŠï¼Ÿ**

next/script è‡ªåŠ¨å»é‡ï¼Œç¡®ä¿ä½¿ç”¨ç›¸åŒçš„ `src` æˆ– `id`ï¼š

```tsx
// è¿™ä¸¤ä¸ªåªä¼šåŠ è½½ä¸€æ¬¡
<Script src="https://example.com/script.js" />
<Script src="https://example.com/script.js" />
```

ğŸ¤” **Q: å¦‚ä½•åœ¨è„šæœ¬åŠ è½½åæ‰§è¡Œä»£ç ï¼Ÿ**

ä½¿ç”¨ `onReady` å›è°ƒï¼š

```tsx
<Script
  src="https://example.com/sdk.js"
  onReady={() => {
    window.SDK.init({ key: 'xxx' })
  }}
/>
```

ğŸ¤” **Q: å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒåŠ è½½ä¸åŒè„šæœ¬ï¼Ÿ**

```tsx
const isDev = process.env.NODE_ENV === 'development'

<Script
  src={isDev
    ? 'https://sandbox.example.com/sdk.js'
    : 'https://example.com/sdk.js'
  }
/>
```

---

ä¸‹ä¸€ç¯‡å°†ä»‹ç»å…ƒæ•°æ®ä¸ SEOï¼Œå­¦ä¹ å¦‚ä½•ä¼˜åŒ–ç½‘ç«™çš„æœç´¢å¼•æ“è¡¨ç°ã€‚

-EOF-
