---
title: 'History 基础知识回顾'
pubDate: 2024-01-15
category: 'Vue'
tags: ['VueRouter', '源码']
description: '前端路由实现原理：hash 模式与 history 模式'
---

## history 对象

浏览器 `history` 对象用于管理访问历史：

```js
history.length // 历史记录数量
history.state // 当前状态对象
history.scrollRestoration // 滚动恢复行为
```

## 两种路由模式

### Hash 模式

利用 URL 的 hash 部分（`#` 后面的内容）：

```
example.com/#/home
example.com/#/about
```

**原理**：

- hash 变化不会触发页面刷新
- 通过 `hashchange` 事件监听变化

```js
window.addEventListener('hashchange', () => {
  const hash = window.location.hash
  // 根据 hash 渲染对应视图
})
```

### History 模式

利用 HTML5 History API：

```
example.com/home
example.com/about
```

**核心 API**：

```js
// 添加历史记录
history.pushState(state, title, url)

// 替换当前记录
history.replaceState(state, title, url)

// 监听前进后退
window.addEventListener('popstate', (e) => {
  console.log(e.state)
})
```

**示例**：

```js
// 导航函数
function navigate(route) {
  history.pushState(route, '', route)
  render(route)
}

// 监听浏览器前进后退
window.addEventListener('popstate', (e) => {
  render(e.state)
})
```

## 两种模式对比

|            | Hash 模式 | History 模式      |
| ---------- | --------- | ----------------- |
| URL 形式   | 有 `#` 号 | 无 `#` 号         |
| 服务器配置 | 不需要    | 需要配置 fallback |
| 兼容性     | 更好      | IE10+             |
| SEO        | 较差      | 更好              |

## History 模式的服务器配置

History 模式下刷新页面会 404，需要配置服务器：

**Nginx**：

```nginx
location / {
  try_files $uri /index.html;
}
```

**Express**：

```js
app.get('*', (req, res) => {
  res.sendFile(path.resolve(__dirname, 'public', 'index.html'))
})
```

## location 对象

```js
location.hash // #xxx
location.pathname // /path
location.search // ?query=xxx
location.href // 完整 URL
```
