---
title: 'Vite 环境变量与模式'
pubDate: 2024-01-15
category: 'Vue'
tags: ['Vue3', 'Vite']
description: '使用 .env 文件管理不同环境的配置，理解 Vite 的模式系统'
---

## 内置环境变量

```js
import.meta.env.MODE // 当前模式
import.meta.env.BASE_URL // 基础路径
import.meta.env.PROD // 是否生产环境
import.meta.env.DEV // 是否开发环境
import.meta.env.SSR // 是否 SSR
```

## .env 文件

```
.env                # 所有环境加载
.env.local          # 所有环境加载，git 忽略
.env.development    # 开发环境加载
.env.production     # 生产环境加载
.env.[mode]         # 指定模式加载
```

## 定义环境变量

```
# .env.development
VITE_API_URL=http://localhost:3000/api
VITE_APP_TITLE=开发环境

# .env.production
VITE_API_URL=https://api.example.com
VITE_APP_TITLE=生产环境
```

**注意**：只有 `VITE_` 前缀的变量才会暴露给客户端。

## 使用环境变量

```js
console.log(import.meta.env.VITE_API_URL)
console.log(import.meta.env.VITE_APP_TITLE)
```

## 指定模式

```bash
# 开发（默认 development）
vite

# 生产构建（默认 production）
vite build

# 指定模式
vite --mode staging
vite build --mode testing
```

## 自定义模式

```
# .env.staging
VITE_API_URL=https://staging-api.example.com
NODE_ENV=production
```

```bash
vite build --mode staging
```

## 在配置中使用

```js
// vite.config.js
import { defineConfig, loadEnv } from 'vite'

export default defineConfig(({ mode }) => {
  // 加载环境变量
  const env = loadEnv(mode, process.cwd())

  return {
    define: {
      __APP_ENV__: JSON.stringify(env.VITE_APP_ENV),
    },
  }
})
```

## TypeScript 类型支持

```ts
// env.d.ts
/// <reference types="vite/client" />

interface ImportMetaEnv {
  readonly VITE_API_URL: string
  readonly VITE_APP_TITLE: string
}

interface ImportMeta {
  readonly env: ImportMetaEnv
}
```

## NODE_ENV vs MODE

| 变量     | 说明                              |
| -------- | --------------------------------- |
| NODE_ENV | Node.js 环境，影响工具和库行为    |
| MODE     | Vite 模式，决定加载哪个 .env 文件 |

```bash
# development 模式，NODE_ENV=development
vite

# production 模式，NODE_ENV=production
vite build

# staging 模式，NODE_ENV 取决于 .env.staging 中的设置
vite build --mode staging
```
