---
title: 'Transition 过渡动画'
pubDate: 2024-01-15
category: 'Vue'
tags: ['Vue3', '进阶', '动画']
description: '使用 Transition 组件为元素的进入和离开添加过渡动画'
---

## 基本用法

```vue
<template>
  <button @click="show = !show">切换</button>
  <Transition>
    <p v-if="show">Hello</p>
  </Transition>
</template>

<style>
.v-enter-active,
.v-leave-active {
  transition: opacity 0.5s;
}
.v-enter-from,
.v-leave-to {
  opacity: 0;
}
</style>
```

## 过渡 CSS 类

| 类名           | 时机                     |
| -------------- | ------------------------ |
| v-enter-from   | 进入开始                 |
| v-enter-active | 进入过程（整个进入阶段） |
| v-enter-to     | 进入结束                 |
| v-leave-from   | 离开开始                 |
| v-leave-active | 离开过程（整个离开阶段） |
| v-leave-to     | 离开结束                 |

```
进入：v-enter-from → v-enter-to（v-enter-active 一直存在）
离开：v-leave-from → v-leave-to（v-leave-active 一直存在）
```

## 命名过渡

```vue
<Transition name="fade">
  <p v-if="show">Hello</p>
</Transition>

<style>
/* 前缀从 v- 变成 fade- */
.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.5s;
}
.fade-enter-from,
.fade-leave-to {
  opacity: 0;
}
</style>
```

## 结合 CSS Animation

```vue
<Transition name="bounce">
  <p v-if="show">Hello</p>
</Transition>

<style>
.bounce-enter-active {
  animation: bounce-in 0.5s;
}
.bounce-leave-active {
  animation: bounce-in 0.5s reverse;
}

@keyframes bounce-in {
  0% {
    transform: scale(0);
  }
  50% {
    transform: scale(1.25);
  }
  100% {
    transform: scale(1);
  }
}
</style>
```

## 常用属性

| 属性   | 说明                      |
| ------ | ------------------------- |
| name   | 过渡类名前缀              |
| appear | 初始渲染时应用过渡        |
| mode   | 过渡模式：out-in / in-out |

```vue
<!-- 初始渲染时也有过渡 -->
<Transition appear>
  <p v-if="show">Hello</p>
</Transition>

<!-- 先出后进 -->
<Transition mode="out-in">
  <component :is="currentComponent" />
</Transition>
```

## 使用 key 触发过渡

当元素没有进入/离开，只是内容变化时，需要 key：

```vue
<Transition name="fade" mode="out-in">
  <p :key="count">{{ count }}</p>
</Transition>
```

## JavaScript 钩子

```vue
<Transition
  @before-enter="onBeforeEnter"
  @enter="onEnter"
  @after-enter="onAfterEnter"
  @before-leave="onBeforeLeave"
  @leave="onLeave"
  @after-leave="onAfterLeave"
>
  <p v-if="show">Hello</p>
</Transition>

<script setup>
function onBeforeEnter(el) {
  el.style.opacity = 0
  el.style.transform = 'translateY(-20px)'
}

function onEnter(el, done) {
  // 使用 requestAnimationFrame 确保初始样式被应用
  requestAnimationFrame(() => {
    el.style.transition = 'all 0.5s'
    el.style.opacity = 1
    el.style.transform = 'translateY(0)'
  })

  // 过渡完成后调用 done
  el.addEventListener('transitionend', done)
}

function onLeave(el, done) {
  el.style.transition = 'all 0.5s'
  el.style.opacity = 0
  el.style.transform = 'translateY(20px)'
  el.addEventListener('transitionend', done)
}
</script>
```

## 与第三方库集成

```vue
<script setup>
import gsap from 'gsap'

function onEnter(el, done) {
  gsap.from(el, {
    opacity: 0,
    y: -20,
    duration: 0.5,
    onComplete: done,
  })
}

function onLeave(el, done) {
  gsap.to(el, {
    opacity: 0,
    y: 20,
    duration: 0.5,
    onComplete: done,
  })
}
</script>
```

## 自定义过渡类

```vue
<Transition
  enter-active-class="animate__animated animate__fadeIn"
  leave-active-class="animate__animated animate__fadeOut"
>
  <p v-if="show">Hello</p>
</Transition>
```

## 注意事项

1. **单根元素**：Transition 内部只能有一个根元素
2. **触发条件**：只在 v-if、v-show、component 动态组件时触发
3. **样式类自动移除**：过渡完成后样式类会被移除
