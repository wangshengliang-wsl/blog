---
title: 'setup è¯­æ³•ç³–çš„æ¼”è¿›'
pubDate: 2024-01-15
category: 'Vue'
tags: ['Vue3', 'åŸç†', 'setup']
description: 'ä» Options API åˆ° script setupï¼Œç†è§£ Vue è¯­æ³•çš„æ¼”è¿›å†ç¨‹'
---

Vue3 çš„ `<script setup>` æ˜¯ç›®å‰æœ€æ¨èçš„å†™æ³•ï¼Œä½†å®ƒä¸æ˜¯ä¸€æ­¥åˆ°ä½çš„ï¼Œè€Œæ˜¯é€æ­¥æ¼”è¿›è€Œæ¥ã€‚

## æ¼”è¿›å†ç¨‹

```
Vue2 Options API
      â†“
Vue3 Composition API (setup å‡½æ•°)
      â†“
Vue3 defineComponent (TS æ”¯æŒ)
      â†“
Vue3.2 script setup (è¯­æ³•ç³–)
```

## Vue2ï¼šOptions API

```js
export default {
  data() {
    return { count: 0 }
  },
  computed: {
    double() {
      return this.count * 2
    },
  },
  methods: {
    increment() {
      this.count++
    },
  },
}
```

## Vue3 åˆæœŸï¼šsetup å‡½æ•°

```js
import { ref, computed } from 'vue'

export default {
  setup() {
    const count = ref(0)
    const double = computed(() => count.value * 2)
    const increment = () => count.value++

    // å¿…é¡» return æ‰èƒ½åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨
    return { count, double, increment }
  },
}
```

**ç—›ç‚¹**ï¼šå¿…é¡»æ‰‹åŠ¨ return æ‰€æœ‰å†…å®¹ã€‚

## defineComponentï¼šTS æ”¯æŒ

```ts
import { defineComponent, ref } from 'vue'

export default defineComponent({
  props: {
    msg: String,
  },
  setup(props) {
    const count = ref(0)
    return { count }
  },
})
```

`defineComponent` åªæ˜¯ä¸ªè¾…åŠ©å‡½æ•°ï¼Œè®© TS æœ‰æ›´å¥½çš„ç±»å‹æ¨æ–­ï¼Œ**å†™æ³•æ²¡æœ‰æœ¬è´¨å˜åŒ–**ã€‚

## Vue3.2ï¼šscript setup

```vue
<script setup>
import { ref } from 'vue'

const count = ref(0)
const increment = () => count.value++
</script>
```

**ä¼˜åŠ¿**ï¼š

- ä¸ç”¨å†™ return
- ä¸ç”¨å¯¼å‡ºå¯¹è±¡
- ä»£ç æ›´ç®€æ´
- TS ç±»å‹æ¨æ–­æ›´å¥½

## å®æ˜¯ä»€ä¹ˆ

`<script setup>` ä¸­æœ‰å‡ ä¸ªç‰¹æ®Šçš„"å‡½æ•°"ï¼š

- `defineProps`
- `defineEmits`
- `defineModel`
- `defineExpose`

å®ƒä»¬å«åš**ç¼–è¯‘å™¨å®ï¼ˆCompiler Macrosï¼‰**ã€‚

ğŸ™‹ ä»€ä¹ˆæ˜¯å®ï¼Ÿ

å®æ˜¯åœ¨**ç¼–è¯‘å‰**è¿›è¡Œ**æ–‡æœ¬æ›¿æ¢**çš„æ ‡è®°ã€‚

```vue
<script setup>
const props = defineProps({
  msg: String,
})
</script>
```

ç¼–è¯‘åï¼š

```js
export default {
  props: {
    msg: String,
  },
  setup(props) {
    // ...
  },
}
```

`defineProps` åœ¨ç¼–è¯‘æ—¶è¢«**æ›¿æ¢**æ‰äº†ï¼Œè¿è¡Œæ—¶æ ¹æœ¬ä¸å­˜åœ¨è¿™ä¸ªå‡½æ•°ï¼

## expose çš„åŒºåˆ«

### setup å‡½æ•°å†™æ³•

é»˜è®¤æš´éœ²æ‰€æœ‰å†…å®¹ï¼š

```js
export default {
  setup() {
    const count = ref(0)
    return { count } // count å¯è¢«çˆ¶ç»„ä»¶é€šè¿‡ ref è®¿é—®
  },
}
```

å¦‚éœ€é™åˆ¶ï¼Œè¦æ˜¾å¼è°ƒç”¨ exposeï¼š

```js
setup(props, { expose }) {
  const count = ref(0)
  const privateData = ref('secret')

  expose({ count })  // åªæš´éœ² count
  return { count, privateData }
}
```

### script setup å†™æ³•

**é»˜è®¤ä¸æš´éœ²ä»»ä½•å†…å®¹**ï¼š

```vue
<script setup>
const count = ref(0)
// çˆ¶ç»„ä»¶é€šè¿‡ ref è®¿é—®ä¸åˆ°ä»»ä½•å†…å®¹
</script>
```

å¦‚éœ€æš´éœ²ï¼Œç”¨ `defineExpose`ï¼š

```vue
<script setup>
const count = ref(0)
const privateData = ref('secret')

defineExpose({ count }) // åªæš´éœ² count
</script>
```

## ç¼–è¯‘ç»“æœå¯¹æ¯”

`<script setup>` ç¼–è¯‘åå°±æ˜¯æ™®é€šçš„ Composition APIï¼š

```vue
<!-- æºç  -->
<script setup>
import { ref } from 'vue'
const count = ref(0)
</script>
```

```js
// ç¼–è¯‘ç»“æœ
import { ref } from 'vue'

export default {
  setup() {
    const count = ref(0)
    return { count }
  },
}
```

## å°ç»“

| å†™æ³•            | ç‰¹ç‚¹                |
| --------------- | ------------------- |
| Options API     | Vue2 é£æ ¼ï¼Œé€»è¾‘åˆ†æ•£ |
| setup å‡½æ•°      | éœ€è¦ return         |
| defineComponent | TS æ”¯æŒæ›´å¥½         |
| script setup    | è¯­æ³•ç³–ï¼Œæœ€ç®€æ´      |

| å®           | ä½œç”¨         | ç¼–è¯‘ä¸º        |
| ------------ | ------------ | ------------- |
| defineProps  | å£°æ˜ props   | props é…ç½®é¡¹  |
| defineEmits  | å£°æ˜ emits   | emits é…ç½®é¡¹  |
| defineModel  | v-model æ”¯æŒ | props + emits |
| defineExpose | æš´éœ²æˆå‘˜     | expose è°ƒç”¨   |

ä¸‹ä¸€ç¯‡æˆ‘ä»¬æ¥çœ‹ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æœ¬è´¨ã€‚
