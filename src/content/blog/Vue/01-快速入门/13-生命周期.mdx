---
title: 'Vue3 ç”Ÿå‘½å‘¨æœŸé’©å­'
pubDate: 2024-01-15
category: 'Vue'
tags: ['Vue3', 'ç”Ÿå‘½å‘¨æœŸ', 'onMounted']
description: 'ç†è§£ Vue3 ç»„ä»¶ç”Ÿå‘½å‘¨æœŸï¼ŒæŒæ¡ onMounted ç­‰é’©å­å‡½æ•°çš„ä½¿ç”¨åœºæ™¯'
---

ğŸ™‹ ä»€ä¹ˆæ˜¯ç”Ÿå‘½å‘¨æœŸï¼Ÿ

ç»„ä»¶ä»**åˆ›å»º**åˆ°**é”€æ¯**æ‰€ç»å†çš„ä¸€ç³»åˆ—è¿‡ç¨‹ã€‚Vue åœ¨è¿™äº›è¿‡ç¨‹ä¸­è®¾ç½®äº†ä¸€äº›"æ—¶é—´ç‚¹"ï¼Œè®©ä½ æœ‰æœºä¼šåœ¨ç‰¹å®šé˜¶æ®µæ‰§è¡Œè‡ªå·±çš„ä»£ç ã€‚

## ç”Ÿå‘½å‘¨æœŸå›¾ç¤º

```
åˆ›å»ºé˜¶æ®µ
  â†“
setup() â† ç»„åˆå¼ API åœ¨è¿™é‡Œæ‰§è¡Œ
  â†“
æŒ‚è½½é˜¶æ®µ
  â†“
onBeforeMount â† DOM è¿˜æ²¡åˆ›å»º
  â†“
onMounted â† DOM å·²åˆ›å»ºï¼Œå¯ä»¥è®¿é—® â˜…æœ€å¸¸ç”¨
  â†“
æ›´æ–°é˜¶æ®µï¼ˆæ•°æ®å˜åŒ–æ—¶ï¼‰
  â†“
onBeforeUpdate â† DOM æ›´æ–°å‰
  â†“
onUpdated â† DOM æ›´æ–°å
  â†“
å¸è½½é˜¶æ®µ
  â†“
onBeforeUnmount â† ç»„ä»¶å¸è½½å‰
  â†“
onUnmounted â† ç»„ä»¶å·²å¸è½½
```

## æœ€å¸¸ç”¨ï¼šonMounted

`onMounted` åœ¨ç»„ä»¶æŒ‚è½½å®Œæˆåæ‰§è¡Œï¼Œæ­¤æ—¶ï¼š

- DOM å·²ç»åˆ›å»ºå¥½äº†
- å¯ä»¥è¿›è¡Œ DOM æ“ä½œ
- é€‚åˆå‘èµ·æ•°æ®è¯·æ±‚

```vue
<script setup>
import { ref, onMounted } from 'vue'

const users = ref([])
const loading = ref(true)
const error = ref(null)

onMounted(async () => {
  try {
    const res = await fetch('https://jsonplaceholder.typicode.com/users')
    users.value = await res.json()
  } catch (e) {
    error.value = e.message
  } finally {
    loading.value = false
  }
})
</script>

<template>
  <div v-if="loading">åŠ è½½ä¸­...</div>
  <div v-else-if="error">{{ error }}</div>
  <ul v-else>
    <li v-for="user in users" :key="user.id">
      {{ user.name }}
    </li>
  </ul>
</template>
```

## å¸¸ç”¨é’©å­ä¸€è§ˆ

| é’©å­              | è§¦å‘æ—¶æœº     | å¸¸è§ç”¨é€”                 |
| ----------------- | ------------ | ------------------------ |
| `onMounted`       | DOM æŒ‚è½½å®Œæˆ | è¯·æ±‚æ•°æ®ã€åˆå§‹åŒ–ç¬¬ä¸‰æ–¹åº“ |
| `onUpdated`       | DOM æ›´æ–°å   | æ“ä½œæ›´æ–°åçš„ DOM         |
| `onUnmounted`     | ç»„ä»¶å¸è½½å   | æ¸…ç†å®šæ—¶å™¨ã€å–æ¶ˆè®¢é˜…     |
| `onBeforeMount`   | DOM æŒ‚è½½å‰   | å¾ˆå°‘ç”¨                   |
| `onBeforeUpdate`  | DOM æ›´æ–°å‰   | è·å–æ›´æ–°å‰çš„ DOM çŠ¶æ€    |
| `onBeforeUnmount` | ç»„ä»¶å¸è½½å‰   | æ¸…ç†å·¥ä½œ                 |

## å®æˆ˜åœºæ™¯

### åœºæ™¯ 1ï¼šåˆå§‹åŒ–ç¬¬ä¸‰æ–¹åº“

```vue
<script setup>
import { ref, onMounted, onUnmounted } from 'vue'

const chartRef = ref(null)
let chartInstance = null

onMounted(() => {
  // DOM å·²å­˜åœ¨ï¼Œå¯ä»¥åˆå§‹åŒ–å›¾è¡¨
  chartInstance = new Chart(chartRef.value, {
    // é…ç½®...
  })
})

onUnmounted(() => {
  // ç»„ä»¶å¸è½½æ—¶é”€æ¯å›¾è¡¨å®ä¾‹
  chartInstance?.destroy()
})
</script>

<template>
  <canvas ref="chartRef"></canvas>
</template>
```

### åœºæ™¯ 2ï¼šå®šæ—¶å™¨æ¸…ç†

```vue
<script setup>
import { ref, onMounted, onUnmounted } from 'vue'

const count = ref(0)
let timer = null

onMounted(() => {
  timer = setInterval(() => {
    count.value++
  }, 1000)
})

onUnmounted(() => {
  // å¿…é¡»æ¸…ç†ï¼Œå¦åˆ™å†…å­˜æ³„æ¼
  clearInterval(timer)
})
</script>
```

### åœºæ™¯ 3ï¼šäº‹ä»¶ç›‘å¬

```vue
<script setup>
import { onMounted, onUnmounted } from 'vue'

const handleResize = () => {
  console.log(window.innerWidth)
}

onMounted(() => {
  window.addEventListener('resize', handleResize)
})

onUnmounted(() => {
  window.removeEventListener('resize', handleResize)
})
</script>
```

## æ‰§è¡Œé¡ºåº

åŒä¸€ä¸ªç»„ä»¶ä¸­ï¼Œé’©å­æ‰§è¡Œé¡ºåºï¼š

```
setup() æ‰§è¡Œ
  â†“
onBeforeMount
  â†“
onMounted
  â†“
ï¼ˆæ•°æ®å˜åŒ–ï¼‰
  â†“
onBeforeUpdate
  â†“
onUpdated
  â†“
ï¼ˆç»„ä»¶é”€æ¯ï¼‰
  â†“
onBeforeUnmount
  â†“
onUnmounted
```

çˆ¶å­ç»„ä»¶çš„æ‰§è¡Œé¡ºåºï¼š

```
çˆ¶ setup
çˆ¶ onBeforeMount
  å­ setup
  å­ onBeforeMount
  å­ onMounted
çˆ¶ onMounted
```

## å°ç»“

| éœ€æ±‚              | ç”¨å“ªä¸ªé’©å­    |
| ----------------- | ------------- |
| è¯·æ±‚åˆå§‹æ•°æ®      | `onMounted`   |
| åˆå§‹åŒ– DOM ç›¸å…³åº“ | `onMounted`   |
| æ¸…ç†å®šæ—¶å™¨/äº‹ä»¶   | `onUnmounted` |
| è·å–æ›´æ–°åçš„ DOM  | `onUpdated`   |

ğŸ¯ **æœ€ä½³å®è·µ**ï¼š

- 90% çš„æƒ…å†µåªéœ€è¦ `onMounted` å’Œ `onUnmounted`
- æœ‰ `onMounted` ä¸­åˆ›å»ºçš„èµ„æºï¼Œå°±è¦åœ¨ `onUnmounted` ä¸­æ¸…ç†

ä¸‹ä¸€ç¯‡æˆ‘ä»¬æ¥çœ‹ä¾¦å¬å™¨ watchã€‚
