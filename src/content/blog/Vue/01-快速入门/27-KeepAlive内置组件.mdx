---
title: 'Vue3 KeepAlive ç»„ä»¶ç¼“å­˜'
pubDate: 2024-01-15
category: 'Vue'
tags: ['Vue3', 'KeepAlive', 'ç¼“å­˜']
description: 'ä½¿ç”¨ KeepAlive ç¼“å­˜ç»„ä»¶çŠ¶æ€ï¼Œé¿å…é‡å¤æ¸²æŸ“'
---

`<KeepAlive>` æ˜¯ Vue å†…ç½®ç»„ä»¶ï¼Œç”¨äº**ç¼“å­˜ç»„ä»¶å®ä¾‹**ï¼Œé¿å…åå¤é”€æ¯å’Œåˆ›å»ºã€‚

## é—®é¢˜åœºæ™¯

```vue
<template>
  <button @click="tab = 'A'">Tab A</button>
  <button @click="tab = 'B'">Tab B</button>

  <ComponentA v-if="tab === 'A'" />
  <ComponentB v-if="tab === 'B'" />
</template>
```

åˆ‡æ¢ Tab æ—¶ï¼Œç»„ä»¶ä¼šè¢«**é”€æ¯é‡å»º**ï¼Œä¹‹å‰çš„çŠ¶æ€ï¼ˆè¡¨å•è¾“å…¥ã€æ»šåŠ¨ä½ç½®ç­‰ï¼‰ä¼šä¸¢å¤±ã€‚

## åŸºæœ¬ç”¨æ³•

ç”¨ `<KeepAlive>` åŒ…è£¹åŠ¨æ€ç»„ä»¶ï¼š

```vue
<template>
  <KeepAlive>
    <component :is="currentTab" />
  </KeepAlive>
</template>
```

ç»“åˆè·¯ç”±ï¼š

```vue
<router-view v-slot="{ Component }">
  <KeepAlive>
    <component :is="Component" />
  </KeepAlive>
</router-view>
```

ç°åœ¨åˆ‡æ¢æ—¶ï¼Œç»„ä»¶çŠ¶æ€ä¼šè¢«ä¿ç•™ã€‚

## include / exclude

æŒ‡å®šå“ªäº›ç»„ä»¶éœ€è¦ç¼“å­˜ï¼š

```vue
<!-- åªç¼“å­˜ Counter å’Œ Timer -->
<KeepAlive include="Counter,Timer">
  <component :is="currentTab" />
</KeepAlive>

<!-- ç¼“å­˜é™¤ Settings å¤–çš„æ‰€æœ‰ç»„ä»¶ -->
<KeepAlive exclude="Settings">
  <component :is="currentTab" />
</KeepAlive>

<!-- æ­£åˆ™åŒ¹é… -->
<KeepAlive :include="/^Tab/">
  <component :is="currentTab" />
</KeepAlive>

<!-- æ•°ç»„å½¢å¼ -->
<KeepAlive :include="['Counter', 'Timer']">
  <component :is="currentTab" />
</KeepAlive>
```

ğŸ”¶ **æ³¨æ„**ï¼šåŒ¹é…çš„æ˜¯ç»„ä»¶çš„ `name` é€‰é¡¹ã€‚

```vue
<!-- Counter.vue -->
<script>
export default {
  name: 'Counter', // è¿™ä¸ªåå­—è¦å’Œ include åŒ¹é…
}
</script>

<!-- æˆ– setup è¯­æ³•ç³– -->
<script setup>
defineOptions({
  name: 'Counter',
})
</script>
```

## max é™åˆ¶ç¼“å­˜æ•°é‡

```vue
<KeepAlive :max="5">
  <component :is="currentTab" />
</KeepAlive>
```

è¶…è¿‡ 5 ä¸ªæ—¶ï¼Œ**æœ€ä¹…æœªè®¿é—®**çš„ç»„ä»¶ä¼šè¢«é”€æ¯ï¼ˆLRU ç­–ç•¥ï¼‰ã€‚

## ç”Ÿå‘½å‘¨æœŸé’©å­

è¢«ç¼“å­˜çš„ç»„ä»¶æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„é’©å­ï¼š

| é’©å­            | è§¦å‘æ—¶æœº                   |
| --------------- | -------------------------- |
| `onActivated`   | ç»„ä»¶è¢«æ¿€æ´»ï¼ˆä»ç¼“å­˜ä¸­å–å‡ºï¼‰ |
| `onDeactivated` | ç»„ä»¶è¢«åœç”¨ï¼ˆæ”¾å…¥ç¼“å­˜ï¼‰     |

```vue
<script setup>
import { onActivated, onDeactivated } from 'vue'

onActivated(() => {
  console.log('ç»„ä»¶è¢«æ¿€æ´»')
  // å¯ä»¥åœ¨è¿™é‡Œåˆ·æ–°æ•°æ®
})

onDeactivated(() => {
  console.log('ç»„ä»¶è¢«ç¼“å­˜')
  // å¯ä»¥åœ¨è¿™é‡Œæš‚åœå®šæ—¶å™¨ç­‰
})
</script>
```

## å®æˆ˜ï¼šè·¯ç”±ç¼“å­˜

```vue
<!-- App.vue -->
<script setup>
import { ref } from 'vue'

// éœ€è¦ç¼“å­˜çš„è·¯ç”±
const cachedRoutes = ref(['Home', 'List'])
</script>

<template>
  <router-view v-slot="{ Component, route }">
    <KeepAlive :include="cachedRoutes">
      <component :is="Component" :key="route.path" />
    </KeepAlive>
  </router-view>
</template>
```

æ ¹æ®è·¯ç”± meta åŠ¨æ€ç¼“å­˜ï¼š

```ts
// router/index.ts
const routes = [
  {
    path: '/list',
    component: List,
    meta: { keepAlive: true }, // æ ‡è®°éœ€è¦ç¼“å­˜
  },
  {
    path: '/detail',
    component: Detail,
    meta: { keepAlive: false },
  },
]
```

```vue
<!-- App.vue -->
<router-view v-slot="{ Component, route }">
  <KeepAlive>
    <component 
      v-if="route.meta.keepAlive"
      :is="Component" 
      :key="route.path"
    />
  </KeepAlive>
  <component 
    v-if="!route.meta.keepAlive"
    :is="Component" 
    :key="route.path"
  />
</router-view>
```

## å°ç»“

| å±æ€§      | ä½œç”¨             |
| --------- | ---------------- |
| `include` | æŒ‡å®šè¦ç¼“å­˜çš„ç»„ä»¶ |
| `exclude` | æŒ‡å®šä¸ç¼“å­˜çš„ç»„ä»¶ |
| `max`     | æœ€å¤§ç¼“å­˜æ•°é‡     |

| é’©å­            | ç”¨é€”                 |
| --------------- | -------------------- |
| `onActivated`   | åˆ·æ–°æ•°æ®ã€æ¢å¤çŠ¶æ€   |
| `onDeactivated` | æš‚åœå®šæ—¶å™¨ã€ä¿å­˜çŠ¶æ€ |

ğŸ¯ **é€‚ç”¨åœºæ™¯**ï¼š

- Tab åˆ‡æ¢ä¿æŒçŠ¶æ€
- åˆ—è¡¨é¡µè¿”å›ä¿æŒæ»šåŠ¨ä½ç½®
- è¡¨å•é¡µé¢ä¿æŒå¡«å†™å†…å®¹

ä¸‹ä¸€ç¯‡æˆ‘ä»¬æ¥çœ‹çŠ¶æ€ç®¡ç†åº“ Piniaã€‚
