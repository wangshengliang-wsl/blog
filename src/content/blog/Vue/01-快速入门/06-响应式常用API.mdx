---
title: 'Vue3 å“åº”å¼å·¥å…·å‡½æ•°é€ŸæŸ¥'
pubDate: 2024-01-15
category: 'Vue'
tags: ['Vue3', 'å“åº”å¼', 'API']
description: 'toRefã€toRefsã€readonlyã€isRef ç­‰å“åº”å¼å·¥å…·å‡½æ•°çš„ç”¨æ³•å’Œä½¿ç”¨åœºæ™¯'
---

Vue3 é™¤äº† `ref` å’Œ `reactive`ï¼Œè¿˜æä¾›äº†ä¸€ç³»åˆ—å·¥å…·å‡½æ•°æ¥å¤„ç†å“åº”å¼æ•°æ®ã€‚è¿™ç¯‡æ–‡ç« å¸¦ä½ å¿«é€ŸæŒæ¡è¿™äº› APIã€‚

## toRef ä¸ toRefsï¼šè§£æ„ä¸ä¸¢å“åº”å¼

ğŸ™‹ è¿˜è®°å¾—ä¸Šç¯‡è¯´çš„ reactive è§£æ„ä¼šä¸¢å¤±å“åº”å¼å—ï¼Ÿ

```ts
const state = reactive({ count: 0, name: 'Vue' })
const { count } = state // âŒ count ä¸æ˜¯å“åº”å¼çš„
```

`toRef` å’Œ `toRefs` å°±æ˜¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚

### toRefï¼šæå–å•ä¸ªå±æ€§

```ts
import { reactive, toRef } from 'vue'

const state = reactive({ count: 0, name: 'Vue' })

// æŠŠ state.count è½¬æˆ ref
const countRef = toRef(state, 'count')

countRef.value++
console.log(state.count) // 1ï¼ŒåŒæ­¥å˜åŒ–
```

### toRefsï¼šæ‰¹é‡æå–æ‰€æœ‰å±æ€§

```ts
import { reactive, toRefs } from 'vue'

const state = reactive({ count: 0, name: 'Vue' })

// æŠŠæ‰€æœ‰å±æ€§éƒ½è½¬æˆ ref
const { count, name } = toRefs(state)

count.value++
console.log(state.count) // 1ï¼ŒåŒæ­¥å˜åŒ–
```

ğŸ¯ **å…¸å‹åœºæ™¯**ï¼šåœ¨ Composable å‡½æ•°ä¸­è¿”å›å“åº”å¼æ•°æ®

```ts
// useCounter.ts
export function useCounter() {
  const state = reactive({
    count: 0,
    doubleCount: computed(() => state.count * 2),
  })

  const increment = () => state.count++

  // âœ… ç”¨ toRefs ä¿è¯è§£æ„åä»ç„¶æ˜¯å“åº”å¼çš„
  return {
    ...toRefs(state),
    increment,
  }
}

// ä½¿ç”¨
const { count, doubleCount, increment } = useCounter()
```

## unref ä¸ toValueï¼šç»Ÿä¸€å¤„ç†å€¼

### unrefï¼šref å°±å– .valueï¼Œå¦åˆ™åŸæ ·è¿”å›

```ts
import { ref, unref } from 'vue'

const countRef = ref(10)
const normalValue = 20

console.log(unref(countRef)) // 10
console.log(unref(normalValue)) // 20
```

ç›¸å½“äºï¼š

```ts
val = isRef(val) ? val.value : val
```

### toValueï¼ˆVue 3.3+ï¼‰ï¼šæ”¯æŒ getter å‡½æ•°

```ts
import { ref, toValue } from 'vue'

const countRef = ref(10)
const getter = () => 30

console.log(toValue(countRef)) // 10
console.log(toValue(20)) // 20
console.log(toValue(getter)) // 30ï¼Œä¼šæ‰§è¡Œå‡½æ•°
```

ğŸ¯ **å…¸å‹åœºæ™¯**ï¼šComposable å‡½æ•°å‚æ•°å¯ä»¥æ˜¯ refã€æ™®é€šå€¼æˆ– getter

```ts
// è¿™ä¸ªå‡½æ•°çš„å‚æ•°å¯ä»¥æ˜¯ä»»æ„å½¢å¼
function useFetch(url: MaybeRefOrGetter<string>) {
  watchEffect(() => {
    // toValue ç»Ÿä¸€å¤„ç†å„ç§å½¢å¼çš„å‚æ•°
    fetch(toValue(url))
  })
}

// ä»¥ä¸‹è°ƒç”¨éƒ½å¯ä»¥
useFetch('/api/users')
useFetch(ref('/api/users'))
useFetch(() => `/api/users/${id.value}`)
```

## readonlyï¼šåˆ›å»ºåªè¯»ä»£ç†

æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›æ•°æ®åªèƒ½è¯»ä¸èƒ½æ”¹ï¼š

```ts
import { ref, readonly } from 'vue'

const count = ref(0)
const readonlyCount = readonly(count)

count.value++ // âœ… å¯ä»¥
readonlyCount.value++ // âŒ è­¦å‘Šï¼štarget is readonly
```

ğŸ¯ **å…¸å‹åœºæ™¯**ï¼šæš´éœ²çŠ¶æ€ä½†ç¦æ­¢å¤–éƒ¨ä¿®æ”¹

```ts
// store.ts
const state = reactive({ user: null, token: '' })

export const store = {
  // å¤–éƒ¨åªèƒ½è¯»ï¼Œä¸èƒ½ç›´æ¥æ”¹
  state: readonly(state),

  // åªèƒ½é€šè¿‡æ–¹æ³•ä¿®æ”¹
  setUser(user) {
    state.user = user
  },
}
```

## ç±»å‹åˆ¤æ–­å‡½æ•°

| å‡½æ•°              | ä½œç”¨                                |
| ----------------- | ----------------------------------- |
| `isRef(val)`      | æ˜¯å¦æ˜¯ ref                          |
| `isReactive(val)` | æ˜¯å¦æ˜¯ reactive                     |
| `isReadonly(val)` | æ˜¯å¦æ˜¯ readonly                     |
| `isProxy(val)`    | æ˜¯å¦æ˜¯ reactive/readonly åˆ›å»ºçš„ä»£ç† |

```ts
import { ref, reactive, readonly, isRef, isReactive, isProxy } from 'vue'

const a = ref(1)
const b = reactive({ x: 1 })
const c = readonly(b)

console.log(isRef(a)) // true
console.log(isReactive(b)) // true
console.log(isReadonly(c)) // true
console.log(isProxy(b)) // true
console.log(isProxy(c)) // true
```

ğŸ”¶ **æ³¨æ„**ï¼š`isReactive` å¯¹æ·±å±‚åµŒå¥—å¯¹è±¡ä¹Ÿä¼šè¿”å› true

```ts
const state = reactive({
  nested: { count: 0 },
})

console.log(isReactive(state.nested)) // true
```

ä½† `shallowReactive` ä¸ä¼šï¼š

```ts
const state = shallowReactive({
  nested: { count: 0 },
})

console.log(isReactive(state.nested)) // false
```

## API é€ŸæŸ¥è¡¨

| API               | ç”¨é€”               | ç¤ºä¾‹                    |
| ----------------- | ------------------ | ----------------------- |
| `toRef(obj, key)` | æŠŠå¯¹è±¡å±æ€§è½¬æˆ ref | `toRef(state, 'count')` |
| `toRefs(obj)`     | æŠŠæ‰€æœ‰å±æ€§è½¬æˆ ref | `toRefs(state)`         |
| `unref(val)`      | ref å–å€¼ï¼Œå¦åˆ™åŸæ · | `unref(maybeRef)`       |
| `toValue(val)`    | åŒä¸Šï¼Œæ”¯æŒ getter  | `toValue(maybeGetter)`  |
| `readonly(obj)`   | åˆ›å»ºåªè¯»ä»£ç†       | `readonly(state)`       |
| `isRef(val)`      | åˆ¤æ–­æ˜¯å¦ ref       | `isRef(count)`          |
| `isReactive(val)` | åˆ¤æ–­æ˜¯å¦ reactive  | `isReactive(state)`     |

## å°ç»“

è¿™äº›å·¥å…·å‡½æ•°çš„æ ¸å¿ƒç”¨é€”ï¼š

1. **toRef/toRefs**ï¼šè§£å†³ reactive è§£æ„ä¸¢å¤±å“åº”å¼çš„é—®é¢˜
2. **unref/toValue**ï¼šç»Ÿä¸€å¤„ç†å¯èƒ½æ˜¯ ref ä¹Ÿå¯èƒ½ä¸æ˜¯çš„å€¼
3. **readonly**ï¼šåˆ›å»ºåªè¯»ä»£ç†ï¼Œé˜²æ­¢æ„å¤–ä¿®æ”¹
4. **isXxx**ï¼šè¿è¡Œæ—¶åˆ¤æ–­æ•°æ®ç±»å‹

ä¸‹ä¸€ç¯‡æˆ‘ä»¬æ¥çœ‹ Vue3 çš„è®¡ç®—å±æ€§ `computed`ã€‚
