---
title: 'Vue3 ç»„ä»¶ v-model'
pubDate: 2024-01-15
category: 'Vue'
tags: ['Vue3', 'v-model', 'ç»„ä»¶é€šä¿¡']
description: 'ä½¿ç”¨ v-model å’Œ defineModel å®ç°çˆ¶å­ç»„ä»¶çš„åŒå‘ç»‘å®š'
---

`v-model` ä¸ä»…èƒ½ç”¨äºè¡¨å•ï¼Œè¿˜èƒ½ç”¨äºç»„ä»¶ï¼Œå®ç°çˆ¶å­åŒå‘ç»‘å®šã€‚

## åŸºæœ¬åŸç†

```vue
<!-- è¿™ä¸¤ç§å†™æ³•ç­‰ä»· -->
<MyInput v-model="text" />

<MyInput :modelValue="text" @update:modelValue="text = $event" />
```

`v-model` æ˜¯ props + emit çš„è¯­æ³•ç³–ï¼š

- ä¼ é€’ `modelValue` prop
- ç›‘å¬ `update:modelValue` äº‹ä»¶

## defineModelï¼ˆVue 3.4+ï¼‰

Vue 3.4 æ–°å¢ `defineModel` å®ï¼Œå¤§å¤§ç®€åŒ–å†™æ³•ï¼š

```vue
<!-- MyInput.vue -->
<script setup>
const model = defineModel()
</script>

<template>
  <input v-model="model" />
</template>
```

ä½¿ç”¨ï¼š

```vue
<script setup>
import MyInput from './MyInput.vue'
import { ref } from 'vue'

const text = ref('')
</script>

<template>
  <MyInput v-model="text" />
</template>
```

ğŸ¯ **ä¼˜åŠ¿**ï¼šä¸ç”¨å†™ props + emitï¼Œä¸€è¡Œæå®šã€‚

## 3.4 ä¹‹å‰çš„å†™æ³•

```vue
<!-- MyInput.vue -->
<script setup>
const props = defineProps(['modelValue'])
const emit = defineEmits(['update:modelValue'])
</script>

<template>
  <input
    :value="modelValue"
    @input="emit('update:modelValue', $event.target.value)"
  />
</template>
```

## å¤šä¸ª v-model

ç»™ v-model å‘½åï¼š

```vue
<!-- çˆ¶ç»„ä»¶ -->
<UserForm v-model:firstName="first" v-model:lastName="last" />
```

```vue
<!-- UserForm.vue -->
<script setup>
const firstName = defineModel('firstName')
const lastName = defineModel('lastName')
</script>

<template>
  <input v-model="firstName" placeholder="å" />
  <input v-model="lastName" placeholder="å§“" />
</template>
```

## defineModel é…ç½®

```ts
// å¿…å¡«
const model = defineModel({ required: true })

// é»˜è®¤å€¼
const model = defineModel({ default: 0 })

// ç±»å‹
const model = defineModel({ type: String })

// å‘½å + é…ç½®
const count = defineModel('count', {
  type: Number,
  default: 0,
})
```

## è‡ªå®šä¹‰ä¿®é¥°ç¬¦

çˆ¶ç»„ä»¶ä½¿ç”¨ä¿®é¥°ç¬¦ï¼š

```vue
<MyInput v-model.capitalize="text" />
```

å­ç»„ä»¶å¤„ç†ä¿®é¥°ç¬¦ï¼š

```vue
<script setup>
const [model, modifiers] = defineModel({
  set(value) {
    if (modifiers.capitalize) {
      return value.charAt(0).toUpperCase() + value.slice(1)
    }
    return value
  },
})

// modifiers = { capitalize: true }
</script>

<template>
  <input v-model="model" />
</template>
```

## å®æˆ˜ï¼šè¯„åˆ†ç»„ä»¶

```vue
<!-- Rating.vue -->
<script setup>
const model = defineModel({ type: Number, default: 0 })
</script>

<template>
  <div class="rating">
    <span
      v-for="n in 5"
      :key="n"
      @click="model = n"
      :class="{ active: model >= n }"
    >
      {{ model >= n ? 'â˜…' : 'â˜†' }}
    </span>
  </div>
</template>
```

ä½¿ç”¨ï¼š

```vue
<script setup>
import { ref } from 'vue'
import Rating from './Rating.vue'

const score = ref(3)
</script>

<template>
  <Rating v-model="score" />
  <p>è¯„åˆ†ï¼š{{ score }}</p>
</template>
```

## å¸¦æ ¡éªŒçš„è¾“å…¥æ¡†

```vue
<!-- NumberInput.vue -->
<script setup>
const [model, modifiers] = defineModel({
  type: Number,
  default: 0,
  set(value) {
    // ç¡®ä¿æ˜¯æ•°å­—
    const num = Number(value)
    if (isNaN(num)) return 0

    // é™åˆ¶èŒƒå›´
    if (modifiers.range) {
      return Math.min(100, Math.max(0, num))
    }
    return num
  },
})
</script>

<template>
  <input type="number" v-model="model" />
</template>
```

```vue
<!-- ä½¿ç”¨ï¼šå€¼ä¼šè¢«é™åˆ¶åœ¨ 0-100 -->
<NumberInput v-model.range="value" />
```

## å°ç»“

| æ–¹å¼            | é€‚ç”¨ç‰ˆæœ¬ | ä»£ç é‡ |
| --------------- | -------- | ------ |
| `defineModel()` | Vue 3.4+ | æœ€å°‘   |
| props + emit    | æ‰€æœ‰ç‰ˆæœ¬ | è¾ƒå¤š   |

| åŠŸèƒ½     | è¯­æ³•                          |
| -------- | ----------------------------- |
| åŸºæœ¬ç”¨æ³• | `v-model="value"`             |
| å‘½å     | `v-model:name="value"`        |
| å¤šä¸ª     | `v-model:a="x" v-model:b="y"` |
| ä¿®é¥°ç¬¦   | `v-model.modifier="value"`    |

ä¸‹ä¸€ç¯‡æˆ‘ä»¬æ¥çœ‹æ’æ§½ã€‚
