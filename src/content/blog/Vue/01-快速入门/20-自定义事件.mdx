---
title: 'Vue3 自定义事件 Emits'
pubDate: 2024-01-15
category: 'Vue'
tags: ['Vue3', 'emits', '组件通信']
description: '掌握子组件向父组件传递数据的方式：自定义事件'
---

Props 是父传子，自定义事件（Emits）是**子传父**。

## 基本用法

子组件用 `defineEmits` 声明事件，用 `emit()` 触发：

```vue
<!-- Rating.vue -->
<script setup>
const emit = defineEmits(['update'])

const rate = (star) => {
  emit('update', star) // 触发事件，传递数据
}
</script>

<template>
  <span v-for="n in 5" :key="n" @click="rate(n)">
    {{ n <= 3 ? '★' : '☆' }}
  </span>
</template>
```

父组件用 `@事件名` 监听：

```vue
<script setup>
import Rating from './Rating.vue'
import { ref } from 'vue'

const score = ref(0)
const handleUpdate = (value) => {
  score.value = value
}
</script>

<template>
  <Rating @update="handleUpdate" />
  <p>当前评分：{{ score }}</p>
</template>
```

## 模板中直接触发

简单场景可以用 `$emit`：

```vue
<template>
  <button @click="$emit('click')">点击</button>
  <button @click="$emit('submit', formData)">提交</button>
</template>
```

## TypeScript 写法

```vue
<script setup lang="ts">
const emit = defineEmits<{
  update: [value: number]
  submit: [data: { name: string }]
  cancel: [] // 无参数
}>()

// 使用
emit('update', 5)
emit('submit', { name: 'test' })
emit('cancel')
</script>
```

## 事件校验

可以对传递的数据进行校验：

```ts
const emit = defineEmits({
  // 无校验
  click: null,

  // 有校验
  submit: (payload: { email: string; password: string }) => {
    if (!payload.email || !payload.password) {
      console.warn('邮箱和密码不能为空')
      return false
    }
    return true
  },
})
```

## 命名约定

| 位置        | 风格       | 示例            |
| ----------- | ---------- | --------------- |
| defineEmits | camelCase  | `updateValue`   |
| 模板监听    | kebab-case | `@update-value` |

Vue 会自动转换。

## 实战：评分组件

```vue
<!-- Rating.vue -->
<script setup lang="ts">
import { ref } from 'vue'

const emit = defineEmits<{
  'update:modelValue': [value: number]
}>()

const props = defineProps<{
  modelValue: number
}>()

const hoverStar = ref(0)

const rate = (star: number) => {
  emit('update:modelValue', star)
}
</script>

<template>
  <div class="rating">
    <span
      v-for="n in 5"
      :key="n"
      @click="rate(n)"
      @mouseenter="hoverStar = n"
      @mouseleave="hoverStar = 0"
    >
      {{ (hoverStar || modelValue) >= n ? '★' : '☆' }}
    </span>
  </div>
</template>
```

使用：

```vue
<script setup>
import { ref } from 'vue'
import Rating from './Rating.vue'

const score = ref(0)
</script>

<template>
  <Rating v-model="score" />
</template>
```

## 常见模式

### 更新 Props 的约定

当子组件需要"修改" props 时，触发 `update:propName` 事件：

```ts
// 子组件
const props = defineProps(['visible'])
const emit = defineEmits(['update:visible'])

const close = () => emit('update:visible', false)
```

```vue
<!-- 父组件 -->
<Modal :visible="show" @update:visible="show = $event" />

<!-- 简写：v-model -->
<Modal v-model:visible="show" />
```

### 表单提交

```vue
<!-- Form.vue -->
<script setup>
const emit = defineEmits(['submit'])

const formData = reactive({ name: '', email: '' })

const handleSubmit = () => {
  emit('submit', { ...formData })
}
</script>

<template>
  <form @submit.prevent="handleSubmit">
    <input v-model="formData.name" />
    <input v-model="formData.email" />
    <button type="submit">提交</button>
  </form>
</template>
```

## 小结

| 要点       | 说明                               |
| ---------- | ---------------------------------- |
| 声明       | `defineEmits(['event'])`           |
| 触发       | `emit('event', data)`              |
| 监听       | `@event="handler"`                 |
| 命名       | JS 用 camelCase，模板用 kebab-case |
| 修改 props | 触发 `update:propName` 事件        |

下一篇我们来看组件 v-model。
