---
title: 'å“åº”å¼å¦‚ä½•é©±åŠ¨ç»„ä»¶æ›´æ–°'
pubDate: 2024-01-15
category: 'Vue'
tags: ['Vue3', 'åŸç†', 'æ¸²æŸ“']
description: 'ç†è§£ render å‡½æ•°ä¸å“åº”å¼æ•°æ®çš„å…³è”ï¼Œä»¥åŠ Vue ç²¾å‡†æ›´æ–°å’Œæ•°æ®å…±äº«çš„åŸç†'
---

å›é¡¾ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š

- **æ¨¡æ¿æœ¬è´¨**ï¼šç¼–è¯‘æˆ render å‡½æ•°ï¼Œè¿”å›è™šæ‹Ÿ DOM
- **å“åº”å¼æœ¬è´¨**ï¼šæ•°æ®å˜åŒ–æ—¶ï¼Œç›¸å…³**å‡½æ•°**é‡æ–°æ‰§è¡Œ

ğŸ™‹ å¦‚æœ render å‡½æ•°è¿è¡Œæ—¶ç”¨åˆ°äº†å“åº”å¼æ•°æ®ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

## render å‡½æ•°ä¸å“åº”å¼

```vue
<template>
  <div>{{ name }}</div>
  <div>{{ age }}</div>
</template>

<script setup>
import { ref } from 'vue'
const name = ref('Tom')
const age = ref(18)
</script>
```

ç¼–è¯‘åçš„æ¸²æŸ“å‡½æ•°ï¼ˆç®€åŒ–ï¼‰ï¼š

```js
function render($setup) {
  return h('div', [
    h('div', $setup.name), // è¯»å– name.value
    h('div', $setup.age), // è¯»å– age.value
  ])
}
```

**å…³é”®ç‚¹**ï¼š

1. render å‡½æ•°æ˜¯**è¢«ç›‘æ§çš„å‡½æ•°**
2. è¿è¡Œæ—¶è¯»å–äº† `name.value` å’Œ `age.value`
3. å»ºç«‹äº†**ä¾èµ–å…³ç³»**

å½“ `name` æˆ– `age` å˜åŒ–æ—¶ï¼š

1. å“åº”å¼ç³»ç»Ÿé€šçŸ¥ render å‡½æ•°
2. render é‡æ–°æ‰§è¡Œï¼Œç”Ÿæˆæ–°çš„è™šæ‹Ÿ DOM
3. æ¸²æŸ“å™¨ diff æ–°æ—§è™šæ‹Ÿ DOM
4. æ›´æ–°çœŸå® DOM

```
æ•°æ®å˜åŒ– â†’ render é‡æ–°æ‰§è¡Œ â†’ æ–°è™šæ‹Ÿ DOM â†’ diff â†’ æ›´æ–° DOM
```

## ä¸ºä»€ä¹ˆ Vue èƒ½ç²¾å‡†æ›´æ–°

Vue çš„æ›´æ–°æ˜¯**ç»„ä»¶çº§åˆ«**çš„ï¼š

```
å“åº”å¼ï¼šçŸ¥é“å“ªä¸ªç»„ä»¶çš„æ•°æ®å˜äº† â†’ å®šä½ç»„ä»¶
è™šæ‹Ÿ DOM diffï¼šçŸ¥é“ç»„ä»¶å†…å“ªä¸ªèŠ‚ç‚¹å˜äº† â†’ å®šä½èŠ‚ç‚¹
```

```
App
â”œâ”€â”€ Headerï¼ˆæœªå˜ï¼‰
â”œâ”€â”€ Sidebarï¼ˆæœªå˜ï¼‰
â””â”€â”€ Main
    â””â”€â”€ UserCardï¼ˆæ•°æ®å˜äº†ï¼‰â† åªæ›´æ–°è¿™ä¸ªç»„ä»¶
```

æ•´ä¸ªæµç¨‹ï¼š

1. UserCard çš„ name å˜åŒ–
2. å“åº”å¼ç³»ç»Ÿè§¦å‘ UserCard çš„ render
3. diff UserCard çš„æ–°æ—§è™šæ‹Ÿ DOM
4. åªæ›´æ–° UserCard å†…å˜åŒ–çš„èŠ‚ç‚¹

**å…¶ä»–ç»„ä»¶æ ¹æœ¬ä¸å‚ä¸ï¼**

## ä¸ºä»€ä¹ˆ Vue èƒ½è½»æ¾å®ç°æ•°æ®å…±äº«

åªéœ€è¦æŠŠå“åº”å¼æ•°æ®å•ç‹¬æå‡ºæ¥ï¼š

```ts
// store.ts
import { reactive } from 'vue'

export const store = reactive({
  user: { name: 'Tom', age: 18 },
  setName(name) {
    this.user.name = name
  },
})
```

```vue
<!-- ComponentA.vue -->
<script setup>
import { store } from './store'
</script>
<template>
  <div>{{ store.user.name }}</div>
</template>

<!-- ComponentB.vue -->
<script setup>
import { store } from './store'
</script>
<template>
  <button @click="store.setName('Jerry')">æ”¹å</button>
</template>
```

åŸç†ï¼š

1. ComponentA çš„ render è¯»å–äº† `store.user.name`
2. å»ºç«‹ä¾èµ–ï¼š`store.user.name` â†’ ComponentA çš„ render
3. ComponentB ä¿®æ”¹ `store.user.name`
4. å“åº”å¼è§¦å‘ ComponentA é‡æ–°æ¸²æŸ“

**ä¸éœ€è¦ä»»ä½•é¢å¤–çš„çŠ¶æ€ç®¡ç†åº“ï¼**

## Pinia çš„ä»·å€¼

æ—¢ç„¶ reactive å°±èƒ½å…±äº«æ•°æ®ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ Piniaï¼Ÿ

| ç‰¹æ€§            | çº¯ reactive | Pinia |
| --------------- | ----------- | ----- |
| çŠ¶æ€å…±äº«        | âœ…          | âœ…    |
| å¼€å‘å·¥å…·æ”¯æŒ    | âŒ          | âœ…    |
| çƒ­æ›´æ–°          | âŒ          | âœ…    |
| æ’ä»¶ç³»ç»Ÿ        | âŒ          | âœ…    |
| TypeScript æ”¯æŒ | ä¸€èˆ¬        | ä¼˜ç§€  |
| è¯­ä¹‰åŒ–          | âŒ          | âœ…    |
| SSR æ”¯æŒ        | éœ€è‡ªå·±å¤„ç†  | âœ…    |

Pinia æä¾›äº†æ›´å¥½çš„**å¼€å‘ä½“éªŒ**å’Œ**å·¥ç¨‹åŒ–æ”¯æŒ**ã€‚

## éªŒè¯ï¼šæŸ¥çœ‹ç¼–è¯‘ç»“æœ

ä½¿ç”¨ `vite-plugin-inspect` æ’ä»¶æŸ¥çœ‹ç¼–è¯‘åçš„ä»£ç ï¼š

```ts
// vite.config.ts
import Inspect from 'vite-plugin-inspect'
export default {
  plugins: [Inspect()],
}
```

è®¿é—® `http://localhost:5173/__inspect/` å¯ä»¥çœ‹åˆ°ï¼š

1. setup è¿”å›çš„å“åº”å¼æ•°æ®å˜æˆäº†è®¿é—®å™¨å±æ€§
2. render å‡½æ•°é€šè¿‡ `$setup.xxx` è®¿é—®æ•°æ®
3. è®¿é—®æ—¶è§¦å‘ getterï¼Œæ”¶é›†ä¾èµ–

## å°ç»“

| é—®é¢˜                        | ç­”æ¡ˆ                           |
| --------------------------- | ------------------------------ |
| render ç”¨åˆ°å“åº”å¼æ•°æ®ä¼šæ€æ · | å»ºç«‹ä¾èµ–ï¼Œæ•°æ®å˜åŒ–æ—¶é‡æ–°æ¸²æŸ“   |
| ä¸ºä»€ä¹ˆèƒ½ç²¾å‡†æ›´æ–°            | å“åº”å¼å®šä½ç»„ä»¶ + diff å®šä½èŠ‚ç‚¹ |
| ä¸ºä»€ä¹ˆèƒ½æ•°æ®å…±äº«            | å¤šä¸ªç»„ä»¶ä¾èµ–åŒä¸€ä¸ªå“åº”å¼æ•°æ®   |
| Pinia çš„ä»·å€¼                | å¼€å‘ä½“éªŒã€å·¥ç¨‹åŒ–ã€è¯­ä¹‰åŒ–       |

ä¸‹ä¸€ç¯‡æˆ‘ä»¬æ¥æ‰‹å†™ä¸€ä¸ªç®€æ˜“çš„å“åº”å¼ç³»ç»Ÿã€‚
