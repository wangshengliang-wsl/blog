---
title: 'Teleport 传送门'
pubDate: 2024-01-15
category: 'Vue'
tags: ['Vue3', '进阶']
description: '使用 Teleport 将组件内容渲染到 DOM 的任意位置'
---

## 问题场景

模态框组件通常和触发按钮在同一个组件中，但渲染在深层 DOM 结构中会有问题：

1. **position: fixed 失效**：祖先元素有 transform/filter 时会破坏定位
2. **z-index 受限**：被祖先元素的 z-index 限制

```vue
<!-- 组件结构很深 -->
<div class="app">
  <div class="page">
    <div class="section">
      <MyModal />  <!-- 模态框在这里，样式可能受影响 -->
    </div>
  </div>
</div>
```

## 解决方案：Teleport

将内容"传送"到指定的 DOM 位置：

```vue
<template>
  <button @click="open = true">打开</button>

  <!-- 内容会被渲染到 body 下 -->
  <Teleport to="body">
    <div v-if="open" class="modal">
      <p>模态框内容</p>
      <button @click="open = false">关闭</button>
    </div>
  </Teleport>
</template>

<script setup>
import { ref } from 'vue'
const open = ref(false)
</script>
```

**渲染结果**：

```html
<body>
  <div id="app">
    <button>打开</button>
    <!-- Teleport 的内容不在这里 -->
  </div>

  <!-- 模态框被渲染到 body 下 -->
  <div class="modal">
    <p>模态框内容</p>
    <button>关闭</button>
  </div>
</body>
```

## to 属性

指定目标容器，支持 CSS 选择器或 DOM 元素：

```vue
<!-- CSS 选择器 -->
<Teleport to="body">...</Teleport>
<Teleport to="#modal-container">...</Teleport>
<Teleport to=".popup-wrapper">...</Teleport>

<!-- DOM 元素引用 -->
<Teleport :to="targetElement">...</Teleport>
```

## disabled 属性

条件禁用传送：

```vue
<Teleport to="body" :disabled="isMobile">
  <div class="modal">...</div>
</Teleport>
```

禁用时，内容会正常渲染在组件内部。

## 多个 Teleport 到同一目标

```vue
<Teleport to="#modals">
  <div>模态框 A</div>
</Teleport>

<Teleport to="#modals">
  <div>模态框 B</div>
</Teleport>
```

结果会按顺序追加：

```html
<div id="modals">
  <div>模态框 A</div>
  <div>模态框 B</div>
</div>
```

## 常见用途

| 场景             | 说明                               |
| ---------------- | ---------------------------------- |
| 模态框/对话框    | 避免 z-index 和定位问题            |
| 全局通知/Toast   | 统一渲染到页面顶层                 |
| 下拉菜单/Tooltip | 避免被父元素 overflow: hidden 裁剪 |
| 全屏组件         | 需要脱离当前 DOM 层级              |

## 注意事项

1. **目标元素必须存在**：Teleport 挂载时目标 DOM 必须已存在
2. **保持响应性**：内容虽然被传送，但仍保持与原组件的响应式连接
3. **事件冒泡**：事件会按照 Vue 组件树冒泡，而非 DOM 树

```vue
<!-- 点击事件会冒泡到 App，而非 body -->
<template>
  <div @click="handleClick">
    <Teleport to="body">
      <button>点击</button>
    </Teleport>
  </div>
</template>
```
