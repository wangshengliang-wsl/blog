---
title: 'Vite 生产构建配置'
pubDate: 2024-01-15
category: 'Vue'
tags: ['Vue3', 'Vite']
description: 'Vite 生产构建的常用配置：压缩、分包、库模式等'
---

## 构建工具

生产环境使用 **Rollup**（而非 esbuild），因为：

- 更好的代码分割
- 更强的 Tree Shaking
- 丰富的插件生态

## 常用配置

```js
export default defineConfig({
  build: {
    // 配置项
  },
})
```

### target：目标环境

```js
build: {
  target: 'es2015',          // ES 版本
  // target: 'chrome87',     // 指定浏览器
  // target: ['es2020', 'edge88', 'firefox78']  // 多目标
}
```

### outDir / assetsDir：输出目录

```js
build: {
  outDir: 'dist',           // 输出目录
  assetsDir: 'assets'       // 静态资源目录
}
```

### minify：代码压缩

```js
build: {
  minify: 'esbuild',        // 默认，速度快
  // minify: 'terser',      // 压缩率更高
  // minify: false          // 禁用
}
```

### sourcemap：源码映射

```js
build: {
  sourcemap: true,          // 生成独立文件
  // sourcemap: 'inline',   // 内联到文件
  // sourcemap: 'hidden'    // 生成但不引用
}
```

### rollupOptions：Rollup 配置

```js
build: {
  rollupOptions: {
    // 外部依赖
    external: ['vue'],
    output: {
      // 分包策略
      manualChunks: {
        vue: ['vue', 'vue-router', 'pinia'],
        lodash: ['lodash-es']
      },
      // 全局变量
      globals: {
        vue: 'Vue'
      }
    }
  }
}
```

## base：公共基础路径

```js
export default defineConfig({
  base: '/my-app/', // 部署在子路径
  // base: './'      // 相对路径
})
```

## 库模式

将项目打包为可复用的库：

```js
import { resolve } from 'path'

export default defineConfig({
  build: {
    lib: {
      entry: resolve(__dirname, 'lib/main.js'),
      name: 'MyLib',
      fileName: (format) => `my-lib.${format}.js`,
    },
    rollupOptions: {
      external: ['vue'],
      output: {
        globals: { vue: 'Vue' },
      },
    },
  },
})
```

package.json 配置：

```json
{
  "main": "./dist/my-lib.umd.js",
  "module": "./dist/my-lib.es.js",
  "exports": {
    ".": {
      "import": "./dist/my-lib.es.js",
      "require": "./dist/my-lib.umd.js"
    }
  }
}
```

## 开发环境 vs 生产环境

| 环境 | 构建工具 | 目标     |
| ---- | -------- | -------- |
| 开发 | esbuild  | 速度快   |
| 生产 | rollup   | 代码质量 |
