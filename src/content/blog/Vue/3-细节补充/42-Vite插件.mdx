---
title: 'Vite 插件使用与开发'
pubDate: 2024-01-15
category: 'Vue'
tags: ['Vue3', 'Vite']
description: '了解 Vite 插件的使用方式和常用插件推荐'
---

## 使用插件

```js
// vite.config.js
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import eslint from 'vite-plugin-eslint'

export default defineConfig({
  plugins: [vue(), eslint()],
})
```

## 传入配置

```js
import legacy from '@vitejs/plugin-legacy'

export default defineConfig({
  plugins: [
    legacy({
      targets: ['defaults', 'not IE 11'],
    }),
  ],
})
```

## 执行顺序

按数组顺序依次执行：

```js
plugins: [
  pluginA(), // 先执行
  pluginB(), // 后执行
]
```

## 按需应用

```js
plugins: [
  {
    ...somePlugin(),
    apply: 'build', // 仅在构建时应用
    // apply: 'serve'  // 仅在开发时应用
  },
]
```

## 插件分类

### 官方插件

| 插件                   | 说明           |
| ---------------------- | -------------- |
| @vitejs/plugin-vue     | Vue 3 支持     |
| @vitejs/plugin-vue-jsx | Vue 3 JSX 支持 |
| @vitejs/plugin-react   | React 支持     |
| @vitejs/plugin-legacy  | 旧浏览器支持   |

### 常用社区插件

| 插件                    | 说明                    |
| ----------------------- | ----------------------- |
| vite-plugin-eslint      | ESLint 集成             |
| vite-plugin-compression | 资源压缩（gzip/brotli） |
| vite-plugin-pwa         | PWA 支持                |
| vite-plugin-svg-icons   | SVG 图标                |
| unplugin-auto-import    | 自动导入 API            |
| unplugin-vue-components | 自动导入组件            |

### Rollup 插件

Vite 兼容 Rollup 插件：

```js
import image from '@rollup/plugin-image'
import commonjs from '@rollup/plugin-commonjs'

export default defineConfig({
  plugins: [image(), commonjs()],
})
```

## 插件示例

### 自动导入

```bash
npm install unplugin-auto-import unplugin-vue-components -D
```

```js
import AutoImport from 'unplugin-auto-import/vite'
import Components from 'unplugin-vue-components/vite'

export default defineConfig({
  plugins: [
    AutoImport({
      imports: ['vue', 'vue-router', 'pinia'],
    }),
    Components({
      // 自动导入组件
    }),
  ],
})
```

### 压缩插件

```bash
npm install vite-plugin-compression -D
```

```js
import compression from 'vite-plugin-compression'

export default defineConfig({
  plugins: [
    compression({
      algorithm: 'gzip',
      ext: '.gz',
    }),
  ],
})
```

## 自定义插件

Vite 插件扩展自 Rollup 插件 API：

```js
function myPlugin() {
  return {
    name: 'my-plugin',

    // 配置钩子
    config(config) {
      // 修改配置
    },

    // 转换钩子
    transform(code, id) {
      if (id.endsWith('.custom')) {
        return { code: transformedCode }
      }
    },

    // 构建钩子
    buildStart() {},
    buildEnd() {},
  }
}
```
