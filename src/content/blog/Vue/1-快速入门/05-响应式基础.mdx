---
title: 'ref è‡ªåŠ¨è§£åŒ…è§„åˆ™è¯¦è§£'
pubDate: 2024-01-15
category: 'Vue'
tags: ['Vue3', 'å“åº”å¼', 'ref', 'è§£åŒ…']
description: 'æ·±å…¥ç†è§£ Vue3 ä¸­ ref çš„è‡ªåŠ¨è§£åŒ…æœºåˆ¶ï¼Œé¿å…å¸¸è§çš„å“åº”å¼é™·é˜±'
---

ä¸Šä¸€ç¯‡æˆ‘ä»¬å­¦äº† `ref` å’Œ `reactive` çš„åŸºæœ¬ç”¨æ³•ã€‚è¿™ç¯‡æ¥æ·±å…¥è®²ä¸€ä¸ªå®¹æ˜“è¸©å‘çš„è¯é¢˜ï¼š**ref çš„è‡ªåŠ¨è§£åŒ…**ã€‚

ğŸ™‹ ä»€ä¹ˆæ˜¯"è§£åŒ…"ï¼Ÿ

å°±æ˜¯è‡ªåŠ¨è®¿é—® `.value`ï¼Œä¸ç”¨æ‰‹åŠ¨å†™ã€‚æ¯”å¦‚åœ¨æ¨¡æ¿ä¸­ï¼š

```vue
<script setup>
import { ref } from 'vue'
const count = ref(0)
</script>

<template>
  <!-- è‡ªåŠ¨è§£åŒ…ï¼Œä¸éœ€è¦ count.value -->
  <div>{{ count }}</div>
</template>
```

çœ‹èµ·æ¥å¾ˆæ–¹ä¾¿ï¼Œä½†è§£åŒ…è§„åˆ™æœ‰ç‚¹å¤æ‚ï¼Œä¸åŒåœºæ™¯è¡¨ç°ä¸åŒã€‚æä¸æ¸…æ¥šå°±ä¼šè¸©å‘ã€‚

## è§„åˆ™ä¸€ï¼šæ¨¡æ¿ä¸­åªæœ‰é¡¶çº§ ref ä¼šè§£åŒ…

```vue
<script setup>
import { ref } from 'vue'

const count = ref(0) // é¡¶çº§ ref
const obj = {
  id: ref(1), // éé¡¶çº§ refï¼ˆè—åœ¨æ™®é€šå¯¹è±¡é‡Œï¼‰
}
</script>

<template>
  <div>{{ count }}</div>
  <!-- âœ… è‡ªåŠ¨è§£åŒ…ï¼Œæ˜¾ç¤º 0 -->
  <div>{{ obj.id }}</div>
  <!-- âš ï¸ çœ‹èµ·æ¥æ­£å¸¸ï¼Œæ˜¾ç¤º 1 -->
</template>
```

ç­‰ç­‰ï¼Œ`obj.id` å¥½åƒä¹Ÿæ­£å¸¸æ˜¾ç¤ºäº†ï¼Ÿåˆ«è¢«éª—äº†ï¼Œè¯•è¯•åšè¿ç®—ï¼š

```vue
<template>
  <div>{{ count + 1 }}</div>
  <!-- âœ… æ˜¾ç¤º 1 -->
  <div>{{ obj.id + 1 }}</div>
  <!-- âŒ æ˜¾ç¤º [object Object]1 -->
</template>
```

ğŸ”¶ `obj.id` æ²¡æœ‰è§£åŒ…ï¼Œå®ƒè¿˜æ˜¯ä¸€ä¸ª ref å¯¹è±¡ï¼Œå’Œæ•°å­—ç›¸åŠ å°±å˜æˆå­—ç¬¦ä¸²æ‹¼æ¥äº†ã€‚

**æ­£ç¡®å†™æ³•**ï¼š

```vue
<template>
  <div>{{ obj.id.value + 1 }}</div>
  <!-- âœ… æ‰‹åŠ¨ .value -->
</template>
```

## è§„åˆ™äºŒï¼šreactive å¯¹è±¡ä¸­çš„ ref ä¼šè‡ªåŠ¨è§£åŒ…

æŠŠ ref æ”¾è¿› `reactive` å¯¹è±¡ï¼Œè®¿é—®æ—¶ä¼šè‡ªåŠ¨è§£åŒ…ï¼š

```ts
import { ref, reactive } from 'vue'

const name = ref('Tom')
const state = reactive({ name })

console.log(state.name) // âœ… 'Tom'ï¼Œè‡ªåŠ¨è§£åŒ…
console.log(name.value) // 'Tom'
```

ğŸ”¶ ä½† `shallowReactive` ä¸ä¼šè‡ªåŠ¨è§£åŒ…ï¼š

```ts
import { ref, shallowReactive } from 'vue'

const name = ref('Tom')
const state = shallowReactive({ name })

console.log(state.name) // âŒ è¿”å› ref å¯¹è±¡æœ¬èº«
console.log(state.name.value) // âœ… 'Tom'
```

## è§„åˆ™ä¸‰ï¼šæ•°ç»„/Map/Set ä¸­çš„ ref ä¸ä¼šè§£åŒ…

```ts
import { ref, reactive } from 'vue'

const books = reactive([ref('Vue3 æŒ‡å—')])
console.log(books[0]) // âŒ ref å¯¹è±¡
console.log(books[0].value) // âœ… 'Vue3 æŒ‡å—'

const map = reactive(new Map([['count', ref(0)]]))
console.log(map.get('count')) // âŒ ref å¯¹è±¡
console.log(map.get('count').value) // âœ… 0
```

ğŸ¤” ä¸ºä»€ä¹ˆæ•°ç»„é‡Œä¸è§£åŒ…ï¼Ÿ

å› ä¸ºæ•°ç»„ç´¢å¼•è®¿é—®ï¼ˆ`arr[0]`ï¼‰å’Œå¯¹è±¡å±æ€§è®¿é—®ï¼ˆ`obj.name`ï¼‰åœ¨ Proxy å®ç°ä¸Šä¸åŒã€‚Vue é€‰æ‹©åªå¯¹å¯¹è±¡å±æ€§åšè§£åŒ…ï¼Œæ•°ç»„ä¿æŒåŸæ ·ã€‚

## ç»å…¸è¸©å‘æ¡ˆä¾‹

æ¥çœ‹ä¸€é“"é¢è¯•é¢˜"ï¼š

```vue
<script setup>
import { ref, shallowReactive } from 'vue'

const name = ref('Tom')
const obj = shallowReactive({ name })

setTimeout(() => {
  obj.name = 'Jerry' // ç›´æ¥èµ‹å€¼å­—ç¬¦ä¸²
}, 1000)

setTimeout(() => {
  name.value = 'Spike' // ä¿®æ”¹åŸ ref
}, 2000)
</script>

<template>
  <div>{{ obj.name }}</div>
</template>
```

ğŸ™‹ 2 ç§’åæ˜¾ç¤ºä»€ä¹ˆï¼Ÿ

**ç­”æ¡ˆ**ï¼šè¿˜æ˜¯ `Jerry`ï¼Œä¸æ˜¯ `Spike`ã€‚

**åŸå› **ï¼š

1. 1 ç§’æ—¶ï¼Œ`obj.name = 'Jerry'` æŠŠå±æ€§æ›¿æ¢æˆäº†æ™®é€šå­—ç¬¦ä¸²ï¼Œå’ŒåŸæ¥çš„ `ref` æ–­å¼€äº†è”ç³»
2. 2 ç§’æ—¶ä¿®æ”¹ `name.value`ï¼Œä½† `obj.name` å·²ç»ä¸æŒ‡å‘è¿™ä¸ª ref äº†

**æ­£ç¡®åšæ³•**ï¼š

```ts
// æ–¹å¼ 1ï¼šä¿®æ”¹ ref çš„ value
obj.name.value = 'Jerry'

// æ–¹å¼ 2ï¼šé‡æ–°èµ‹å€¼ä¸€ä¸ªæ–°çš„ ref
obj.name = ref('Jerry')
```

## è§£åŒ…è§„åˆ™é€ŸæŸ¥è¡¨

| åœºæ™¯                     | æ˜¯å¦è‡ªåŠ¨è§£åŒ… | ç¤ºä¾‹                         |
| ------------------------ | ------------ | ---------------------------- |
| æ¨¡æ¿ä¸­é¡¶çº§ ref           | âœ… æ˜¯        | `{{ count }}`                |
| æ¨¡æ¿ä¸­éé¡¶çº§ ref         | âŒ å¦        | `{{ obj.id }}` éœ€è¦ `.value` |
| reactive å¯¹è±¡å±æ€§        | âœ… æ˜¯        | `state.name`                 |
| shallowReactive å¯¹è±¡å±æ€§ | âŒ å¦        | éœ€è¦ `.value`                |
| æ•°ç»„å…ƒç´                  | âŒ å¦        | `arr[0].value`               |
| Map/Set å…ƒç´              | âŒ å¦        | `map.get('key').value`       |

## å®è·µå»ºè®®

æ—¢ç„¶è§£åŒ…è§„åˆ™è¿™ä¹ˆå¤æ‚ï¼Œæ€ä¹ˆé¿å…è¸©å‘ï¼Ÿ

ğŸ¯ **å»ºè®® 1**ï¼šä¼˜å…ˆç”¨ `ref`ï¼Œä¿æŒä¸€è‡´æ€§

```ts
// âœ… ç»Ÿä¸€ç”¨ refï¼Œå¿ƒæ™ºè´Ÿæ‹…å°
const count = ref(0)
const user = ref({ name: 'Tom' })
const list = ref([1, 2, 3])
```

ğŸ¯ **å»ºè®® 2**ï¼šéœ€è¦è§£æ„æ—¶ç”¨ `toRefs`

```ts
import { reactive, toRefs } from 'vue'

const state = reactive({ count: 0, name: 'Vue' })

// âŒ è§£æ„ä¼šä¸¢å¤±å“åº”å¼
const { count, name } = state

// âœ… toRefs ä¿æŒå“åº”å¼
const { count, name } = toRefs(state)
```

ğŸ¯ **å»ºè®® 3**ï¼šä¸ç¡®å®šæ—¶å°±å†™ `.value`

```ts
// å†™äº† .value è‚¯å®šä¸ä¼šé”™
console.log(someRef.value)
```

## å°ç»“

ref è‡ªåŠ¨è§£åŒ…çš„æ ¸å¿ƒè§„åˆ™ï¼š

- **æ¨¡æ¿ä¸­**ï¼šåªæœ‰é¡¶çº§ ref è‡ªåŠ¨è§£åŒ…
- **reactive ä¸­**ï¼šå±æ€§ä¼šè§£åŒ…ï¼Œæ•°ç»„/Map/Set å…ƒç´ ä¸ä¼š
- **shallowReactive ä¸­**ï¼šä¸ä¼šè§£åŒ…

è®°ä¸ä½æ²¡å…³ç³»ï¼Œè¸©ä¸€æ¬¡å‘å°±è®°ä½äº† ğŸ˜…

ä¸‹ä¸€ç¯‡æˆ‘ä»¬æ¥çœ‹ Vue3 æ›´å¤šçš„å“åº”å¼å·¥å…· APIã€‚
