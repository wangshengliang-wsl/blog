---
title: 'Vue3 å“åº”å¼æ•°æ®ï¼šref ä¸ reactive'
pubDate: 2024-01-15
category: 'Vue'
tags: ['Vue3', 'å“åº”å¼', 'ref', 'reactive']
description: 'æ·±å…¥ç†è§£ Vue3 å“åº”å¼ç³»ç»Ÿï¼ŒæŒæ¡ ref å’Œ reactive çš„ä½¿ç”¨åœºæ™¯å’ŒåŒºåˆ«'
---

ğŸ™‹ ä»€ä¹ˆæ˜¯å“åº”å¼ï¼Ÿ

ç®€å•è¯´ï¼š**æ•°æ®å˜äº†ï¼Œè§†å›¾è‡ªåŠ¨æ›´æ–°**ã€‚è¿™æ˜¯ Vue æœ€æ ¸å¿ƒçš„èƒ½åŠ›ã€‚

Vue3 æä¾›äº†ä¸¤ä¸ªåˆ›å»ºå“åº”å¼æ•°æ®çš„ APIï¼š`ref` å’Œ `reactive`ã€‚è¿™ç¯‡æ–‡ç« å¸¦ä½ å½»åº•ææ‡‚å®ƒä»¬ã€‚

## refï¼šé€šç”¨çš„å“åº”å¼æ–¹æ¡ˆ

`ref` å¯ä»¥åŒ…è£…ä»»æ„ç±»å‹çš„å€¼ï¼Œæ˜¯æœ€å¸¸ç”¨çš„å“åº”å¼ APIï¼š

```vue
<script setup>
import { ref } from 'vue'

const count = ref(0)

// åœ¨ JS ä¸­è®¿é—®/ä¿®æ”¹éœ€è¦ç”¨ .value
console.log(count.value) // 0
count.value++
</script>

<template>
  <!-- æ¨¡æ¿ä¸­è‡ªåŠ¨è§£åŒ…ï¼Œä¸éœ€è¦ .value -->
  <button @click="count++">{{ count }}</button>
</template>
```

ğŸ”¶ **æ ¸å¿ƒè¦ç‚¹**ï¼š`ref` è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒçœŸæ­£çš„å€¼åœ¨ `.value` é‡Œã€‚æ¨¡æ¿ä¸­ä¼šè‡ªåŠ¨è§£åŒ…ï¼ŒJS ä¸­å¿…é¡»ç”¨ `.value`ã€‚

### ref å¯ä»¥åŒ…è£…ä»»æ„ç±»å‹

```ts
// åŸºæœ¬ç±»å‹
const name = ref('Vue')
const isLoading = ref(false)

// å¯¹è±¡
const user = ref({
  name: 'Tom',
  age: 18,
})

// æ•°ç»„
const list = ref([1, 2, 3])

// ä¿®æ”¹æ–¹å¼
name.value = 'Vue3'
user.value.age = 20
list.value.push(4)
```

### æ·±å±‚å“åº”å¼

`ref` é»˜è®¤æ˜¯**æ·±å±‚å“åº”å¼**çš„ï¼ŒåµŒå¥—å¯¹è±¡çš„å±æ€§å˜åŒ–ä¹Ÿèƒ½è§¦å‘æ›´æ–°ï¼š

```vue
<script setup>
import { ref } from 'vue'

const state = ref({
  user: {
    profile: {
      name: 'Tom',
    },
  },
})

// æ·±å±‚å±æ€§å˜åŒ–ä¹Ÿä¼šè§¦å‘è§†å›¾æ›´æ–°
state.value.user.profile.name = 'Jerry'
</script>
```

ğŸ¤” ä¸æƒ³è¦æ·±å±‚å“åº”å¼ï¼Ÿ

ç”¨ `shallowRef`ï¼Œåªæœ‰ `.value` æ•´ä½“æ›¿æ¢æ—¶æ‰è§¦å‘æ›´æ–°ï¼š

```ts
import { shallowRef } from 'vue'

const state = shallowRef({ count: 1 })

// âŒ ä¸ä¼šè§¦å‘æ›´æ–°
state.value.count = 2

// âœ… ä¼šè§¦å‘æ›´æ–°
state.value = { count: 2 }
```

## reactiveï¼šå¯¹è±¡ä¸“ç”¨

`reactive` åªèƒ½ç”¨äºå¯¹è±¡ç±»å‹ï¼ˆå¯¹è±¡ã€æ•°ç»„ã€Mapã€Setï¼‰ï¼Œä¸èƒ½ç”¨äºåŸºæœ¬ç±»å‹ï¼š

```vue
<script setup>
import { reactive } from 'vue'

const state = reactive({
  count: 0,
  user: { name: 'Tom' },
})

// ç›´æ¥è®¿é—®ï¼Œä¸éœ€è¦ .value
state.count++
state.user.name = 'Jerry'
</script>

<template>
  <div>{{ state.count }}</div>
  <div>{{ state.user.name }}</div>
</template>
```

çœ‹èµ·æ¥æ¯” `ref` ç®€æ´ï¼Ÿåˆ«æ€¥ï¼Œå®ƒæœ‰å‘ã€‚

### reactive çš„å±€é™æ€§

ğŸ”¶ **é—®é¢˜ 1ï¼šä¸èƒ½æ›¿æ¢æ•´ä¸ªå¯¹è±¡**

```ts
let state = reactive({ count: 0 })

// âŒ å“åº”å¼ä¸¢å¤±ï¼state å˜æˆäº†æ™®é€šå¯¹è±¡
state = { count: 1 }

// âœ… æ­£ç¡®åšæ³•ï¼šé€ä¸ªå±æ€§èµ‹å€¼
state.count = 1
```

ğŸ”¶ **é—®é¢˜ 2ï¼šè§£æ„ä¼šä¸¢å¤±å“åº”å¼**

```ts
const state = reactive({ count: 0, name: 'Vue' })

// âŒ è§£æ„åçš„å˜é‡ä¸æ˜¯å“åº”å¼çš„
const { count, name } = state

// âœ… ç”¨ toRefs ä¿æŒå“åº”å¼
import { toRefs } from 'vue'
const { count, name } = toRefs(state)
```

ğŸ”¶ **é—®é¢˜ 3ï¼šä¼ é€’ç»™å‡½æ•°ä¼šä¸¢å¤±å“åº”å¼**

```ts
const state = reactive({ count: 0 })

// âŒ ä¼ é€’å±æ€§å€¼ä¼šä¸¢å¤±å“åº”å¼
callSomeFunction(state.count)

// âœ… ä¼ é€’æ•´ä¸ªå¯¹è±¡ï¼Œæˆ–è€…ç”¨ ref
callSomeFunction(state)
```

## ref vs reactive æ€ä¹ˆé€‰ï¼Ÿ

| åœºæ™¯                           | æ¨è            |
| ------------------------------ | --------------- |
| åŸºæœ¬ç±»å‹ï¼ˆæ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”ï¼‰ | `ref`           |
| éœ€è¦æ•´ä½“æ›¿æ¢çš„å¯¹è±¡             | `ref`           |
| éœ€è¦è§£æ„çš„å¯¹è±¡                 | `ref` + è§£æ„    |
| ä¸ä¼šæ•´ä½“æ›¿æ¢çš„å¤æ‚å¯¹è±¡         | `reactive` ä¹Ÿè¡Œ |

ğŸ¯ **æˆ‘çš„å»ºè®®**ï¼šç»Ÿä¸€ç”¨ `ref`ï¼Œè™½ç„¶è¦å†™ `.value`ï¼Œä½†å¿ƒæ™ºè´Ÿæ‹…æœ€å°ï¼Œä¸å®¹æ˜“è¸©å‘ã€‚

## DOM æ›´æ–°æ˜¯å¼‚æ­¥çš„

å“åº”å¼æ•°æ®å˜åŒ–åï¼ŒDOM ä¸ä¼šç«‹å³æ›´æ–°ï¼Œè€Œæ˜¯åœ¨ä¸‹ä¸€ä¸ª"tick"æ‰¹é‡æ›´æ–°ï¼š

```ts
import { ref, nextTick } from 'vue'

const count = ref(0)

count.value = 1
console.log(document.querySelector('#count').textContent) // è¿˜æ˜¯ 0ï¼

// ç­‰å¾… DOM æ›´æ–°
await nextTick()
console.log(document.querySelector('#count').textContent) // ç°åœ¨æ˜¯ 1
```

ğŸ¤” ä¸ºä»€ä¹ˆè¦å¼‚æ­¥æ›´æ–°ï¼Ÿ

æ€§èƒ½ä¼˜åŒ–ã€‚å¦‚æœä½ è¿ç»­ä¿®æ”¹ 100 æ¬¡æ•°æ®ï¼ŒåŒæ­¥æ›´æ–°æ„å‘³ç€ DOM è¦æ›´æ–° 100 æ¬¡ã€‚å¼‚æ­¥æ‰¹é‡æ›´æ–°åªéœ€è¦æ›´æ–° 1 æ¬¡ã€‚

## å°ç»“

| API          | é€‚ç”¨ç±»å‹   | è®¿é—®æ–¹å¼ | æ•´ä½“æ›¿æ¢        |
| ------------ | ---------- | -------- | --------------- |
| `ref`        | ä»»æ„ç±»å‹   | `.value` | âœ… æ”¯æŒ         |
| `reactive`   | ä»…å¯¹è±¡ç±»å‹ | ç›´æ¥è®¿é—® | âŒ ä¼šä¸¢å¤±å“åº”å¼ |
| `shallowRef` | ä»»æ„ç±»å‹   | `.value` | æµ…å±‚å“åº”å¼      |

è®°ä½ä¸¤ä¸ªè¦ç‚¹ï¼š

1. **ä¼˜å…ˆç”¨ ref**ï¼Œå¿ƒæ™ºè´Ÿæ‹…æœ€å°
2. **DOM æ›´æ–°æ˜¯å¼‚æ­¥çš„**ï¼Œéœ€è¦æœ€æ–° DOM ç”¨ `nextTick`

ä¸‹ä¸€ç¯‡æˆ‘ä»¬ç»§ç»­çœ‹ Vue3 å“åº”å¼çš„è¿›é˜¶ç”¨æ³•ã€‚
