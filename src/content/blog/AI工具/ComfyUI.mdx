---
title: ComfyUI å®Œå…¨æŒ‡å—
description: ComfyUI æ˜¯ä¸€æ¬¾åŸºäºèŠ‚ç‚¹çš„ Stable Diffusion å›¾å½¢ç•Œé¢ï¼Œæœ¬æ–‡æ¶µç›–å®‰è£…éƒ¨ç½²ã€èŠ‚ç‚¹å·¥ä½œæµã€æ¨¡å‹ç®¡ç†ã€ControlNet åŠå®æˆ˜æ¡ˆä¾‹
pubDate: 2025-11-13
toc: true
ogImage: true
category: AIå·¥å…·
---

ComfyUI æ˜¯ä¸€æ¬¾å¼€æºçš„ã€åŸºäºèŠ‚ç‚¹çš„ Stable Diffusion å›¾å½¢ç•Œé¢å·¥å…·ã€‚ä¸ Automatic1111 WebUI çš„"å¡«è¡¨å¼"äº¤äº’ä¸åŒï¼ŒComfyUI é‡‡ç”¨å¯è§†åŒ–èŠ‚ç‚¹ç¼–æ’ï¼Œè®©ä½ èƒ½ç²¾ç¡®æ§åˆ¶å›¾åƒç”Ÿæˆçš„æ¯ä¸ªç¯èŠ‚ï¼Œé€‚åˆè¿½æ±‚æ·±åº¦å®šåˆ¶çš„åˆ›ä½œè€…å’Œå¼€å‘è€…ã€‚

> æœ¬æ–‡åŸºäº ComfyUI æœ€æ–°ç‰ˆæœ¬ç¼–å†™ï¼Œéœ€è¦ Python 3.10+ å’Œæ”¯æŒ CUDA çš„ NVIDIA æ˜¾å¡ã€‚

## ä¸ºä»€ä¹ˆé€‰æ‹© ComfyUI

| ç‰¹æ€§       | ComfyUI                 | WebUI (A1111)      |
| ---------- | ----------------------- | ------------------ |
| äº¤äº’æ–¹å¼   | èŠ‚ç‚¹å¼ï¼Œå¯è§†åŒ–å·¥ä½œæµ    | è¡¨å•å¼ï¼Œå‚æ•°å¡«å†™   |
| å­¦ä¹ æ›²çº¿   | è¾ƒé™¡                    | å¹³ç¼“               |
| çµæ´»æ€§     | æé«˜ï¼Œå¯è‡ªç”±ç»„åˆ        | ä¸­ç­‰ï¼Œä¾èµ–æ’ä»¶     |
| æ€§èƒ½ä¼˜åŒ–   | ä¼˜ç§€ï¼Œä½æ˜¾å­˜å ç”¨        | ä¸€èˆ¬               |
| å·¥ä½œæµå¤ç”¨ | å¯ä¿å­˜/åˆ†äº« JSON å·¥ä½œæµ | ä¾èµ– Prompt å’Œè®¾ç½® |
| æ‰¹é‡ç”Ÿäº§   | åŸç”Ÿæ”¯æŒ                | éœ€è¦æ’ä»¶           |

ComfyUI ç‰¹åˆ«é€‚åˆï¼š

- éœ€è¦ç²¾ç¡®æ§åˆ¶ç”Ÿå›¾æµç¨‹
- æ„å»ºå¤æ‚çš„å›¾åƒå¤„ç†ç®¡çº¿
- æ‰¹é‡ç”Ÿäº§æˆ–è‡ªåŠ¨åŒ–ç”Ÿå›¾
- å¼€å‘ AI å›¾åƒç›¸å…³åº”ç”¨

## å®‰è£… ComfyUI

### Windowsï¼ˆæ¨èæ–¹å¼ï¼‰

ä¸‹è½½å®˜æ–¹æ•´åˆåŒ…ï¼Œè§£å‹å³ç”¨ï¼š

1. å‰å¾€ [ComfyUI Releases](https://github.com/comfyanonymous/ComfyUI/releases)
2. ä¸‹è½½ `ComfyUI_windows_portable_xxx.7z`
3. è§£å‹åˆ°ä»»æ„ç›®å½•
4. è¿è¡Œ `run_nvidia_gpu.bat`

### æ‰‹åŠ¨å®‰è£…ï¼ˆæ‰€æœ‰å¹³å°ï¼‰

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/comfyanonymous/ComfyUI.git
cd ComfyUI

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121
pip install -r requirements.txt

# å¯åŠ¨
python main.py
```

### Macï¼ˆApple Siliconï¼‰

```bash
# å®‰è£… PyTorch for MPS
pip install torch torchvision torchaudio

# å¯åŠ¨
python main.py --force-fp16
```

å¯åŠ¨åè®¿é—® `http://127.0.0.1:8188` å³å¯çœ‹åˆ°ç•Œé¢ã€‚

## ç•Œé¢ä»‹ç»

ComfyUI ç•Œé¢ä¸»è¦ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    èœå•æ                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚                  èŠ‚ç‚¹ç”»å¸ƒ                        â”‚
â”‚                                                 â”‚
â”‚   [åŠ è½½æ¨¡å‹] â†’ [CLIPç¼–ç ] â†’ [é‡‡æ ·å™¨] â†’ [è§£ç ]    â”‚
â”‚                    â†“                            â”‚
â”‚              [ä¿å­˜å›¾ç‰‡]                          â”‚
â”‚                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Queue Prompt â”‚ ç”Ÿæˆè¿›åº¦ â”‚ å†å²è®°å½•               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŸºæœ¬æ“ä½œ

| æ“ä½œ         | æ–¹å¼                     |
| ------------ | ------------------------ |
| æ·»åŠ èŠ‚ç‚¹     | å³é”®ç”»å¸ƒ â†’ Add Node      |
| è¿æ¥èŠ‚ç‚¹     | æ‹–åŠ¨è¾“å‡ºç«¯å£åˆ°è¾“å…¥ç«¯å£   |
| åˆ é™¤èŠ‚ç‚¹     | é€‰ä¸­ â†’ Delete é”®         |
| æ¡†é€‰å¤šä¸ªèŠ‚ç‚¹ | æ‹–åŠ¨é¼ æ ‡æ¡†é€‰             |
| ç§»åŠ¨ç”»å¸ƒ     | æŒ‰ä½ä¸­é”®æ‹–åŠ¨ / ç©ºæ ¼+å·¦é”® |
| ç¼©æ”¾ç”»å¸ƒ     | æ»šè½®                     |
| è¿è¡Œå·¥ä½œæµ   | ç‚¹å‡» Queue Prompt        |

## æ ¸å¿ƒæ¦‚å¿µ

### èŠ‚ç‚¹ï¼ˆNodeï¼‰

èŠ‚ç‚¹æ˜¯ ComfyUI çš„åŸºæœ¬å•å…ƒï¼Œæ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ç‰¹å®šåŠŸèƒ½ã€‚èŠ‚ç‚¹æœ‰è¾“å…¥ï¼ˆå·¦ä¾§ï¼‰å’Œè¾“å‡ºï¼ˆå³ä¾§ï¼‰ç«¯å£ã€‚

å¸¸ç”¨èŠ‚ç‚¹åˆ†ç±»ï¼š

```text
ğŸ“¦ æ¨¡å‹åŠ è½½
  - Load Checkpointï¼šåŠ è½½ä¸»æ¨¡å‹ï¼ˆSD 1.5/SDXL/Fluxï¼‰
  - Load VAEï¼šåŠ è½½ VAE æ¨¡å‹
  - Load LoRAï¼šåŠ è½½ LoRA æ¨¡å‹

ğŸ“ æ–‡æœ¬å¤„ç†
  - CLIP Text Encodeï¼šæ–‡æœ¬è½¬ Conditioning
  - Conditioning Combineï¼šåˆå¹¶æ¡ä»¶

ğŸ¨ é‡‡æ ·ç”Ÿæˆ
  - KSamplerï¼šæ ¸å¿ƒé‡‡æ ·å™¨
  - KSampler Advancedï¼šé«˜çº§é‡‡æ ·å™¨

ğŸ–¼ï¸ å›¾åƒå¤„ç†
  - VAE Decodeï¼šæ½œç©ºé—´â†’å›¾åƒ
  - VAE Encodeï¼šå›¾åƒâ†’æ½œç©ºé—´
  - Load Imageï¼šåŠ è½½å›¾ç‰‡
  - Save Imageï¼šä¿å­˜å›¾ç‰‡
```

### å·¥ä½œæµï¼ˆWorkflowï¼‰

å·¥ä½œæµæ˜¯ç”±å¤šä¸ªèŠ‚ç‚¹æŒ‰é€»è¾‘è¿æ¥å½¢æˆçš„å›¾åƒç”Ÿæˆç®¡çº¿ã€‚å¯ä»¥ä¿å­˜ä¸º JSON æ–‡ä»¶åˆ†äº«ç»™ä»–äººã€‚

## åŸºç¡€å·¥ä½œæµ

### æ–‡ç”Ÿå›¾ï¼ˆText to Imageï¼‰

æœ€åŸºæœ¬çš„å·¥ä½œæµï¼Œä»æ–‡å­—ç”Ÿæˆå›¾åƒï¼š

```text
èŠ‚ç‚¹è¿æ¥ï¼š
[Load Checkpoint] â†’ model â†’ [KSampler]
                 â†’ clip  â†’ [CLIP Text Encode (æ­£å‘)] â†’ positive â†’ [KSampler]
                         â†’ [CLIP Text Encode (è´Ÿå‘)] â†’ negative â†’ [KSampler]
                 â†’ vae   â†’ [VAE Decode] â† latent â† [KSampler]
                                        â†“
[Empty Latent Image] â†’ latent â†’ [KSampler]
                                        â†“
                              [Save Image]
```

**å…³é”®å‚æ•°**ï¼š

| å‚æ•°         | è¯´æ˜           | æ¨èå€¼          |
| ------------ | -------------- | --------------- |
| steps        | é‡‡æ ·æ­¥æ•°       | 20-30           |
| cfg          | æç¤ºè¯å¼•å¯¼å¼ºåº¦ | 7-8             |
| sampler_name | é‡‡æ ·å™¨         | euler_ancestral |
| scheduler    | è°ƒåº¦å™¨         | normal          |
| denoise      | å»å™ªå¼ºåº¦       | 1.0             |

### å›¾ç”Ÿå›¾ï¼ˆImage to Imageï¼‰

åŸºäºå·²æœ‰å›¾åƒç”Ÿæˆæ–°å›¾åƒï¼š

```text
[Load Image] â†’ [VAE Encode] â†’ latent â†’ [KSampler] (denoise: 0.5-0.8)
                    â†‘
              [Load VAE]
```

denoise å€¼è¶Šä½ï¼Œè¶Šæ¥è¿‘åŸå›¾ï¼›è¶Šé«˜ï¼Œå˜åŒ–è¶Šå¤§ã€‚

### å›¾åƒæ”¾å¤§ï¼ˆUpscaleï¼‰

ä¸¤ç§å¸¸ç”¨æ”¾å¤§æ–¹å¼ï¼š

**1. æ½œç©ºé—´æ”¾å¤§**

```text
[KSampler] â†’ latent â†’ [Upscale Latent] â†’ [KSampler] â†’ [VAE Decode]
```

**2. ä½¿ç”¨æ”¾å¤§æ¨¡å‹**

```text
[VAE Decode] â†’ [Upscale with Model] â†’ [Save Image]
                     â†‘
          [Load Upscale Model]
```

## æ¨¡å‹ç®¡ç†

### ç›®å½•ç»“æ„

```text
ComfyUI/
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ checkpoints/     # ä¸»æ¨¡å‹ (.safetensors)
â”‚   â”œâ”€â”€ vae/             # VAE æ¨¡å‹
â”‚   â”œâ”€â”€ loras/           # LoRA æ¨¡å‹
â”‚   â”œâ”€â”€ controlnet/      # ControlNet æ¨¡å‹
â”‚   â”œâ”€â”€ upscale_models/  # æ”¾å¤§æ¨¡å‹
â”‚   â””â”€â”€ embeddings/      # Textual Inversion
```

### æ¨èæ¨¡å‹

**åŸºç¡€æ¨¡å‹**ï¼š

| æ¨¡å‹      | ç±»å‹   | ç‰¹ç‚¹                   |
| --------- | ------ | ---------------------- |
| SD 1.5    | é€šç”¨   | ç”Ÿæ€æœ€ä¸°å¯Œï¼Œèµ„æºå¤š     |
| SDXL      | é€šç”¨   | è´¨é‡æ›´é«˜ï¼Œéœ€è¦æ›´å¤šæ˜¾å­˜ |
| Flux      | é€šç”¨   | æœ€æ–°æ¨¡å‹ï¼Œæ•ˆæœä¼˜ç§€     |
| Realistic | å†™å®   | çœŸäººç…§ç‰‡é£æ ¼           |
| Anything  | äºŒæ¬¡å…ƒ | åŠ¨æ¼«é£æ ¼               |

**æ”¾å¤§æ¨¡å‹**ï¼š

```text
- RealESRGAN_x4plusï¼šé€šç”¨æ”¾å¤§
- 4x-UltraSharpï¼šç»†èŠ‚å¢å¼º
- 4x_NMKD-Superscaleï¼šå†™å®ç…§ç‰‡
```

## ControlNet

ControlNet å¯ä»¥é€šè¿‡è¾¹ç¼˜ã€æ·±åº¦ã€å§¿åŠ¿ç­‰ä¿¡æ¯ç²¾ç¡®æ§åˆ¶ç”Ÿæˆç»“æœã€‚

### å¸¸ç”¨ ControlNet æ¨¡å‹

| æ¨¡å‹     | è¾“å…¥       | ç”¨é€”          |
| -------- | ---------- | ------------- |
| Canny    | è¾¹ç¼˜æ£€æµ‹å›¾ | ä¿æŒç»“æ„è½®å»“  |
| Depth    | æ·±åº¦å›¾     | æ§åˆ¶ç©ºé—´å±‚æ¬¡  |
| OpenPose | å§¿åŠ¿éª¨æ¶   | æ§åˆ¶äººç‰©å§¿åŠ¿  |
| Lineart  | çº¿ç¨¿       | çº¿ç¨¿ä¸Šè‰²      |
| Tile     | åŸå›¾åˆ†å—   | å›¾åƒä¿®å¤/æ”¾å¤§ |

### ControlNet å·¥ä½œæµ

```text
[Load Image] â†’ [Canny Edge] â†’ image â†’ [Apply ControlNet]
                                            â†“
[Load ControlNet Model] â†’ control_net â†’ [Apply ControlNet]
                                            â†“
                                     â†’ positive â†’ [KSampler]
```

## è‡ªå®šä¹‰èŠ‚ç‚¹

ComfyUI æ”¯æŒå®‰è£…ç¤¾åŒºå¼€å‘çš„è‡ªå®šä¹‰èŠ‚ç‚¹æ‰©å±•åŠŸèƒ½ã€‚

### ComfyUI Manager

æ¨èå®‰è£… ComfyUI Managerï¼Œå¯ä»¥æ–¹ä¾¿åœ°ç®¡ç†è‡ªå®šä¹‰èŠ‚ç‚¹ï¼š

```bash
cd ComfyUI/custom_nodes
git clone https://github.com/ltdrdata/ComfyUI-Manager.git
```

é‡å¯ååœ¨èœå•ä¸­ä¼šå‡ºç° Manager æŒ‰é’®ã€‚

### å¸¸ç”¨è‡ªå®šä¹‰èŠ‚ç‚¹

```text
- ComfyUI-Impact-Packï¼šé«˜çº§å›¾åƒå¤„ç†
- ComfyUI-AnimateDiffï¼šè§†é¢‘ç”Ÿæˆ
- ComfyUI-VideoHelperSuiteï¼šè§†é¢‘å¤„ç†
- ComfyUI-Advanced-ControlNetï¼šé«˜çº§ ControlNet
- ComfyUI-Custom-Scriptsï¼šå®ç”¨è„šæœ¬
```

## å·¥ä½œæµåˆ†äº«

### å¯¼å‡ºå·¥ä½œæµ

1. åœ¨ç”»å¸ƒå³é”® â†’ Save
2. ä¿å­˜ä¸º `.json` æ–‡ä»¶

### å¯¼å…¥å·¥ä½œæµ

1. å°† `.json` æ–‡ä»¶æ‹–å…¥ç”»å¸ƒ
2. æˆ–å³é”® â†’ Load

### å·¥ä½œæµèµ„æº

```text
- https://openart.ai/workflows - å¤§é‡å…è´¹å·¥ä½œæµ
- https://civitai.com - æ¨¡å‹å’Œå·¥ä½œæµ
- GitHub æœç´¢ "ComfyUI workflow"
```

## æ€§èƒ½ä¼˜åŒ–

### æ˜¾å­˜ä¸è¶³

```bash
# å¯ç”¨ä½æ˜¾å­˜æ¨¡å¼
python main.py --lowvram

# æ›´æ¿€è¿›çš„ä½æ˜¾å­˜
python main.py --novram

# ä½¿ç”¨ CPUï¼ˆå¾ˆæ…¢ï¼‰
python main.py --cpu
```

### æå‡é€Ÿåº¦

```bash
# å¯ç”¨ FP16ï¼ˆæ¨èï¼‰
python main.py --force-fp16

# ä½¿ç”¨ xformersï¼ˆéœ€è¦å•ç‹¬å®‰è£…ï¼‰
pip install xformers
```

### å¸¸è§å¯åŠ¨å‚æ•°

| å‚æ•°                    | è¯´æ˜          |
| ----------------------- | ------------- |
| `--listen`              | å…è®¸è¿œç¨‹è®¿é—®  |
| `--port 8188`           | æŒ‡å®šç«¯å£      |
| `--force-fp16`          | å¼ºåˆ¶ä½¿ç”¨ FP16 |
| `--lowvram`             | ä½æ˜¾å­˜æ¨¡å¼    |
| `--preview-method auto` | å¯ç”¨é¢„è§ˆ      |

## å¸¸è§é—®é¢˜

### èŠ‚ç‚¹æŠ¥é”™ "Required input missing"

æ£€æŸ¥èŠ‚ç‚¹çš„å¿…éœ€è¾“å…¥æ˜¯å¦éƒ½å·²è¿æ¥ã€‚

### ç”Ÿæˆçš„å›¾åƒå…¨é»‘/å…¨ç™½

å¯èƒ½åŸå› ï¼š

1. VAE æ¨¡å‹é—®é¢˜ â†’ å°è¯•åŠ è½½å¤–ç½® VAE
2. CFG å€¼è¿‡é«˜ â†’ é™ä½åˆ° 7-8
3. æ¨¡å‹ä¸å…¼å®¹ â†’ ç¡®è®¤æ¨¡å‹ç±»å‹åŒ¹é…

### æ‰¾ä¸åˆ°æ¨¡å‹

ç¡®è®¤æ¨¡å‹æ”¾ç½®åœ¨æ­£ç¡®ç›®å½•ï¼Œåˆ·æ–°é¡µé¢æˆ–é‡å¯ ComfyUIã€‚

### è‡ªå®šä¹‰èŠ‚ç‚¹ä¸æ˜¾ç¤º

```bash
# è¿›å…¥ custom_nodes ç›®å½•
cd custom_nodes/xxx

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

## å‚è€ƒèµ„æ–™

- [ComfyUI GitHub](https://github.com/comfyanonymous/ComfyUI)
- [ComfyUI å®˜æ–¹ç¤ºä¾‹](https://comfyanonymous.github.io/ComfyUI_examples/)
- [ComfyUI Manager](https://github.com/ltdrdata/ComfyUI-Manager)
- [OpenArt å·¥ä½œæµ](https://openart.ai/workflows)
