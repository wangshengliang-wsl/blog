---
title: 'é”™è¯¯å¤„ç†'
description: 'æŒæ¡ JavaScript é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œå­¦ä¼šä½¿ç”¨ try/catch å’Œè‡ªå®šä¹‰é”™è¯¯'
pubDate: 2025-12-03
toc: true
ogImage: true
category: 'JavaScript'
tags: ['JavaScript', 'é”™è¯¯å¤„ç†', 'try-catch', 'Error']
---

é”™è¯¯å¤„ç†æ˜¯ç¼–å†™å¥å£®ç¨‹åºçš„é‡è¦éƒ¨åˆ†ã€‚JavaScript æä¾›äº†å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œå¸®åŠ©æˆ‘ä»¬ä¼˜é›…åœ°å¤„ç†å¼‚å¸¸æƒ…å†µã€‚

## ğŸ¯ é”™è¯¯ç±»å‹

### å†…ç½®é”™è¯¯ç±»å‹

```javascript
// Error - é€šç”¨é”™è¯¯
throw new Error('å‡ºé”™äº†')

// SyntaxError - è¯­æ³•é”™è¯¯
// JSON.parse('{invalid}')  // SyntaxError

// ReferenceError - å¼•ç”¨é”™è¯¯
// console.log(notDefined)  // ReferenceError

// TypeError - ç±»å‹é”™è¯¯
// null.toString()  // TypeError

// RangeError - èŒƒå›´é”™è¯¯
// new Array(-1)  // RangeError

// URIError - URI é”™è¯¯
// decodeURI('%')  // URIError

// EvalError - eval é”™è¯¯ï¼ˆå·²å¾ˆå°‘ä½¿ç”¨ï¼‰
```

### Error å¯¹è±¡å±æ€§

```javascript
try {
  throw new Error('å‡ºé”™äº†')
} catch (error) {
  console.log(error.name) // "Error"
  console.log(error.message) // "å‡ºé”™äº†"
  console.log(error.stack) // è°ƒç”¨æ ˆä¿¡æ¯
}

// ä¸åŒé”™è¯¯ç±»å‹çš„ name
try {
  JSON.parse('invalid')
} catch (error) {
  console.log(error.name) // "SyntaxError"
  console.log(error.message) // å…·ä½“é”™è¯¯ä¿¡æ¯
}
```

## try...catch...finally

### åŸºæœ¬ç”¨æ³•

```javascript
try {
  // å¯èƒ½å‡ºé”™çš„ä»£ç 
  const data = JSON.parse('invalid json')
  console.log(data)
} catch (error) {
  // é”™è¯¯å¤„ç†
  console.error('è§£æå¤±è´¥:', error.message)
} finally {
  // æ— è®ºæ˜¯å¦å‡ºé”™éƒ½ä¼šæ‰§è¡Œ
  console.log('æ¸…ç†å·¥ä½œ')
}
```

### æ•è·ç‰¹å®šé”™è¯¯

```javascript
try {
  // æŸäº›æ“ä½œ
} catch (error) {
  if (error instanceof SyntaxError) {
    console.log('è¯­æ³•é”™è¯¯')
  } else if (error instanceof TypeError) {
    console.log('ç±»å‹é”™è¯¯')
  } else if (error instanceof ReferenceError) {
    console.log('å¼•ç”¨é”™è¯¯')
  } else {
    // æœªçŸ¥é”™è¯¯ï¼Œç»§ç»­æŠ›å‡º
    throw error
  }
}
```

### finally çš„ç‰¹æ®Šæ€§

```javascript
// finally ä¸­çš„ return ä¼šè¦†ç›–å…¶ä»–è¿”å›å€¼
function test() {
  try {
    return 'try'
  } finally {
    return 'finally' // è¿™ä¸ªä¼šè¦†ç›–
  }
}
console.log(test()) // "finally"

// finally ä¸€å®šä¼šæ‰§è¡Œ
function test2() {
  try {
    throw new Error('é”™è¯¯')
  } catch (error) {
    return 'catch'
  } finally {
    console.log('finally æ‰§è¡Œ')
  }
}
test2() // å…ˆæ‰“å° "finally æ‰§è¡Œ"ï¼Œè¿”å› "catch"
```

### åµŒå¥— try...catch

```javascript
try {
  try {
    throw new Error('å†…éƒ¨é”™è¯¯')
  } finally {
    console.log('å†…éƒ¨ finally')
  }
} catch (error) {
  // å†…éƒ¨æ²¡æœ‰ catchï¼Œé”™è¯¯ä¼šè¢«å¤–éƒ¨æ•è·
  console.log('å¤–éƒ¨æ•è·:', error.message)
}
// è¾“å‡ºï¼š
// å†…éƒ¨ finally
// å¤–éƒ¨æ•è·: å†…éƒ¨é”™è¯¯
```

## throw è¯­å¥

### æŠ›å‡ºé”™è¯¯

```javascript
// æŠ›å‡º Error å¯¹è±¡ï¼ˆæ¨èï¼‰
throw new Error('å‡ºé”™äº†')

// æŠ›å‡ºå­—ç¬¦ä¸²ï¼ˆä¸æ¨èï¼Œæ²¡æœ‰å †æ ˆä¿¡æ¯ï¼‰
throw 'å‡ºé”™äº†'

// æŠ›å‡ºæ•°å­—ï¼ˆä¸æ¨èï¼‰
throw 404

// æŠ›å‡ºå¯¹è±¡
throw { code: 'INVALID_INPUT', message: 'è¾“å…¥æ— æ•ˆ' }
```

### æ¡ä»¶æŠ›å‡º

```javascript
function divide(a, b) {
  if (typeof a !== 'number' || typeof b !== 'number') {
    throw new TypeError('å‚æ•°å¿…é¡»æ˜¯æ•°å­—')
  }
  if (b === 0) {
    throw new Error('é™¤æ•°ä¸èƒ½ä¸ºé›¶')
  }
  return a / b
}

try {
  divide(10, 0)
} catch (error) {
  console.log(error.message) // "é™¤æ•°ä¸èƒ½ä¸ºé›¶"
}
```

## è‡ªå®šä¹‰é”™è¯¯

### ç»§æ‰¿ Error

```javascript
class ValidationError extends Error {
  constructor(message, field) {
    super(message)
    this.name = 'ValidationError'
    this.field = field
  }
}

class NetworkError extends Error {
  constructor(message, status) {
    super(message)
    this.name = 'NetworkError'
    this.status = status
  }
}

// ä½¿ç”¨
function validateEmail(email) {
  if (!email.includes('@')) {
    throw new ValidationError('é‚®ç®±æ ¼å¼æ— æ•ˆ', 'email')
  }
}

try {
  validateEmail('invalid')
} catch (error) {
  if (error instanceof ValidationError) {
    console.log(`å­—æ®µ ${error.field}: ${error.message}`)
  }
}
```

### é”™è¯¯å±‚æ¬¡ç»“æ„

```javascript
// åŸºç¡€åº”ç”¨é”™è¯¯
class AppError extends Error {
  constructor(message, code) {
    super(message)
    this.name = this.constructor.name
    this.code = code
  }
}

// ä¸šåŠ¡é”™è¯¯
class BusinessError extends AppError {
  constructor(message) {
    super(message, 'BUSINESS_ERROR')
  }
}

// éªŒè¯é”™è¯¯
class ValidationError extends AppError {
  constructor(message, fields) {
    super(message, 'VALIDATION_ERROR')
    this.fields = fields
  }
}

// æƒé™é”™è¯¯
class AuthError extends AppError {
  constructor(message) {
    super(message, 'AUTH_ERROR')
  }
}

// ä½¿ç”¨
function handleError(error) {
  if (error instanceof AuthError) {
    // é‡å®šå‘åˆ°ç™»å½•é¡µ
  } else if (error instanceof ValidationError) {
    // æ˜¾ç¤ºè¡¨å•é”™è¯¯
  } else if (error instanceof BusinessError) {
    // æ˜¾ç¤ºä¸šåŠ¡æç¤º
  } else {
    // é€šç”¨é”™è¯¯å¤„ç†
  }
}
```

## å¼‚æ­¥é”™è¯¯å¤„ç†

### Promise é”™è¯¯

```javascript
// Promise ä¸­çš„é”™è¯¯
const promise = new Promise((resolve, reject) => {
  throw new Error('åŒæ­¥é”™è¯¯') // ä¼šè¢« reject
})

promise.catch((error) => {
  console.log(error.message) // "åŒæ­¥é”™è¯¯"
})

// ä½¿ç”¨ reject
const promise2 = new Promise((resolve, reject) => {
  setTimeout(() => {
    reject(new Error('å¼‚æ­¥é”™è¯¯'))
  }, 100)
})

// .catch æ•è·é”™è¯¯
fetch('/api/data')
  .then((response) => response.json())
  .catch((error) => {
    console.log('è¯·æ±‚å¤±è´¥:', error)
  })

// é“¾å¼è°ƒç”¨ä¸­çš„é”™è¯¯ä¼šä¼ é€’
fetch('/api/data')
  .then((response) => {
    if (!response.ok) {
      throw new Error('HTTP é”™è¯¯')
    }
    return response.json()
  })
  .then((data) => {
    // å¤„ï¿½ï¿½ï¿½æ•°æ®
  })
  .catch((error) => {
    // æ•è·ä¸Šé¢ä»»ä½•ä¸€æ­¥çš„é”™è¯¯
    console.log('é”™è¯¯:', error.message)
  })
```

### async/await é”™è¯¯

```javascript
// try...catch å¤„ç†å¼‚æ­¥é”™è¯¯
async function fetchData() {
  try {
    const response = await fetch('/api/data')
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}`)
    }
    const data = await response.json()
    return data
  } catch (error) {
    console.log('è¯·æ±‚å¤±è´¥:', error.message)
    throw error // å¯ä»¥é‡æ–°æŠ›å‡º
  }
}

// è°ƒç”¨æ–¹å¤„ç†
async function main() {
  try {
    const data = await fetchData()
    console.log(data)
  } catch (error) {
    console.log('è·å–æ•°æ®å¤±è´¥')
  }
}

// ä¸ç”¨ try...catch çš„æ–¹å¼
fetchData()
  .then((data) => console.log(data))
  .catch((error) => console.log('é”™è¯¯:', error))
```

### å¹¶è¡Œè¯·æ±‚çš„é”™è¯¯å¤„ç†

```javascript
// Promise.all - ä¸€ä¸ªå¤±è´¥å…¨éƒ¨å¤±è´¥
async function fetchAll() {
  try {
    const [users, posts] = await Promise.all([
      fetch('/api/users').then((r) => r.json()),
      fetch('/api/posts').then((r) => r.json()),
    ])
    return { users, posts }
  } catch (error) {
    console.log('è‡³å°‘ä¸€ä¸ªè¯·æ±‚å¤±è´¥')
  }
}

// Promise.allSettled - è·å–æ‰€æœ‰ç»“æœ
async function fetchAllSettled() {
  const results = await Promise.allSettled([
    fetch('/api/users').then((r) => r.json()),
    fetch('/api/posts').then((r) => r.json()),
  ])

  results.forEach((result, index) => {
    if (result.status === 'fulfilled') {
      console.log(`è¯·æ±‚ ${index} æˆåŠŸ:`, result.value)
    } else {
      console.log(`è¯·æ±‚ ${index} å¤±è´¥:`, result.reason)
    }
  })
}
```

## å…¨å±€é”™è¯¯å¤„ç†

### window.onerror

```javascript
// æ•è·æœªå¤„ç†çš„é”™è¯¯
window.onerror = function (message, source, lineno, colno, error) {
  console.log('é”™è¯¯:', message)
  console.log('æ¥æº:', source)
  console.log('è¡Œå·:', lineno)
  console.log('åˆ—å·:', colno)
  console.log('é”™è¯¯å¯¹è±¡:', error)

  // è¿”å› true é˜»æ­¢é»˜è®¤å¤„ç†
  return true
}

// æˆ–ä½¿ç”¨ addEventListener
window.addEventListener('error', function (event) {
  console.log('é”™è¯¯:', event.message)
  event.preventDefault() // é˜»æ­¢é»˜è®¤å¤„ç†
})
```

### unhandledrejection

```javascript
// æ•è·æœªå¤„ç†çš„ Promise æ‹’ç»
window.addEventListener('unhandledrejection', function (event) {
  console.log('æœªå¤„ç†çš„ Promise æ‹’ç»:', event.reason)
  event.preventDefault() // é˜»æ­¢é»˜è®¤å¤„ç†
})

// è§¦å‘ç¤ºä¾‹
Promise.reject(new Error('æœªæ•è·çš„é”™è¯¯'))
```

### é”™è¯¯ä¸ŠæŠ¥

```javascript
// ç®€å•çš„é”™è¯¯ä¸ŠæŠ¥
function reportError(error) {
  const errorInfo = {
    message: error.message,
    stack: error.stack,
    url: window.location.href,
    userAgent: navigator.userAgent,
    timestamp: Date.now(),
  }

  // å‘é€åˆ°æœåŠ¡å™¨
  navigator.sendBeacon('/api/errors', JSON.stringify(errorInfo))
}

window.onerror = function (message, source, lineno, colno, error) {
  reportError(error || new Error(message))
}

window.addEventListener('unhandledrejection', function (event) {
  reportError(event.reason)
})
```

## æœ€ä½³å®è·µ

### å…·ä½“çš„é”™è¯¯ä¿¡æ¯

```javascript
// ğŸ”¶ ä¸å¥½ï¼šæ¨¡ç³Šçš„é”™è¯¯ä¿¡æ¯
throw new Error('å‡ºé”™äº†')

// âœ… å¥½ï¼šå…·ä½“çš„é”™è¯¯ä¿¡æ¯
throw new Error(`ç”¨æˆ· ${userId} ä¸å­˜åœ¨`)
throw new Error(`è¯·æ±‚ ${url} å¤±è´¥ï¼ŒçŠ¶æ€ç : ${status}`)
```

### æå‰è¿”å›

```javascript
// ğŸ”¶ æ·±å±‚åµŒå¥—
function processData(data) {
  if (data) {
    if (data.items) {
      if (data.items.length > 0) {
        // å¤„ç†
      }
    }
  }
}

// âœ… æå‰è¿”å›
function processData(data) {
  if (!data) throw new Error('æ•°æ®ä¸ºç©º')
  if (!data.items) throw new Error('ç¼ºå°‘ items')
  if (data.items.length === 0) throw new Error('items ä¸ºç©º')

  // å¤„ç†
}
```

### é”™è¯¯è¾¹ç•Œ

```javascript
// å°è£…å¯èƒ½å‡ºé”™çš„æ“ä½œ
function safeJSON(str) {
  try {
    return { data: JSON.parse(str), error: null }
  } catch (error) {
    return { data: null, error }
  }
}

const { data, error } = safeJSON('invalid')
if (error) {
  console.log('è§£æå¤±è´¥')
} else {
  console.log(data)
}

// async ç‰ˆæœ¬
async function safeFetch(url) {
  try {
    const response = await fetch(url)
    const data = await response.json()
    return { data, error: null }
  } catch (error) {
    return { data: null, error }
  }
}
```

### æœ‰æ„ä¹‰çš„é‡æ–°æŠ›å‡º

```javascript
async function getUserData(userId) {
  try {
    const response = await fetch(`/api/users/${userId}`)
    return await response.json()
  } catch (error) {
    // æ·»åŠ ä¸Šä¸‹æ–‡ä¿¡æ¯åé‡æ–°æŠ›å‡º
    throw new Error(`è·å–ç”¨æˆ· ${userId} æ•°æ®å¤±è´¥: ${error.message}`)
  }
}
```

## æ€»ç»“

| é”™è¯¯ç±»å‹       | åœºæ™¯           |
| -------------- | -------------- |
| Error          | é€šç”¨é”™è¯¯       |
| TypeError      | ç±»å‹é”™è¯¯       |
| ReferenceError | å¼•ç”¨æœªå®šä¹‰å˜é‡ |
| SyntaxError    | è¯­æ³•é”™è¯¯       |
| RangeError     | æ•°å€¼è¶…å‡ºèŒƒå›´   |
| è‡ªå®šä¹‰é”™è¯¯     | ä¸šåŠ¡ç‰¹å®šé”™è¯¯   |

| å¤„ç†æ–¹å¼           | é€‚ç”¨åœºæ™¯         |
| ------------------ | ---------------- |
| try...catch        | åŒæ­¥ä»£ç          |
| .catch()           | Promise          |
| try + await        | async å‡½æ•°       |
| window.onerror     | å…¨å±€åŒæ­¥é”™è¯¯     |
| unhandledrejection | æœªå¤„ç†çš„ Promise |

**æ ¸å¿ƒè¦ç‚¹**ï¼š

- ä½¿ç”¨å…·ä½“çš„é”™è¯¯ç±»å‹å’Œä¿¡æ¯
- è‡ªå®šä¹‰é”™è¯¯ç±»å¤„ç†ä¸šåŠ¡å¼‚å¸¸
- å¼‚æ­¥ä»£ç æ³¨æ„é”™è¯¯æ•è·æ–¹å¼
- è®¾ç½®å…¨å±€é”™è¯¯å¤„ç†ä½œä¸ºå…œåº•
- é”™è¯¯ä¸ŠæŠ¥å¸®åŠ©è¿½è¸ªç”Ÿäº§é—®é¢˜
