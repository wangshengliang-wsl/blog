---
title: 'é—­åŒ…'
description: 'æ·±å…¥ç†è§£ JavaScript é—­åŒ…çš„åŸç†ã€åº”ç”¨åœºæ™¯ä¸å†…å­˜ç®¡ç†'
pubDate: 2025-12-03
toc: true
ogImage: true
category: 'JavaScript'
tags: ['JavaScript', 'é—­åŒ…', 'ä½œç”¨åŸŸ', 'å†…å­˜']
---

é—­åŒ…æ˜¯ JavaScript æœ€å¼ºå¤§çš„ç‰¹æ€§ä¹‹ä¸€ã€‚å‡½æ•°å¯ä»¥"è®°ä½"å¹¶è®¿é—®å…¶å®šä¹‰æ—¶çš„è¯æ³•ä½œç”¨åŸŸï¼Œå³ä½¿åœ¨è¯¥ä½œç”¨åŸŸä¹‹å¤–æ‰§è¡Œã€‚

## ğŸ¯ ä»€ä¹ˆæ˜¯é—­åŒ…

é—­åŒ… = å‡½æ•° + å‡½æ•°å®šä¹‰æ—¶çš„è¯æ³•ç¯å¢ƒ

```javascript
function outer() {
  const message = 'ä½ å¥½'

  function inner() {
    console.log(message) // è®¿é—®å¤–å±‚å˜é‡
  }

  return inner
}

const fn = outer()
fn() // "ä½ å¥½"

// inner å‡½æ•°è¢«è¿”å›åï¼Œmessage å˜é‡ä»ç„¶å¯ä»¥è®¿é—®
// è¿™å°±æ˜¯é—­åŒ…
```

### ç†è§£é—­åŒ…

```javascript
function createCounter() {
  let count = 0 // è¿™ä¸ªå˜é‡è¢«é—­åŒ…"æ•è·"

  return {
    increment() {
      count++
      return count
    },
    decrement() {
      count--
      return count
    },
    getCount() {
      return count
    },
  }
}

const counter = createCounter()
console.log(counter.increment()) // 1
console.log(counter.increment()) // 2
console.log(counter.decrement()) // 1
console.log(counter.getCount()) // 1

// count å˜é‡å¯¹å¤–éƒ¨ä¸å¯è§ï¼Œä½†å‡½æ•°å¯ä»¥è®¿é—®
// console.log(count)  // ReferenceError
```

### æ¯æ¬¡è°ƒç”¨åˆ›å»ºæ–°çš„é—­åŒ…

```javascript
function createGreeter(name) {
  return function () {
    console.log(`ä½ å¥½ï¼Œ${name}`)
  }
}

const greetZhang = createGreeter('å¼ ä¸‰')
const greetLi = createGreeter('æå››')

greetZhang() // "ä½ å¥½ï¼Œå¼ ä¸‰"
greetLi() // "ä½ å¥½ï¼Œæå››"

// ä¸¤ä¸ªå‡½æ•°å„è‡ªæœ‰ç‹¬ç«‹çš„é—­åŒ…ï¼Œä¿å­˜ä¸åŒçš„ name
```

## é—­åŒ…çš„åº”ç”¨åœºæ™¯

### 1. æ•°æ®å°è£…

```javascript
function createBankAccount(initialBalance) {
  let balance = initialBalance // ç§æœ‰å˜é‡

  return {
    deposit(amount) {
      if (amount <= 0) throw new Error('é‡‘é¢å¿…é¡»å¤§äº0')
      balance += amount
      return balance
    },

    withdraw(amount) {
      if (amount <= 0) throw new Error('é‡‘é¢å¿…é¡»å¤§äº0')
      if (amount > balance) throw new Error('ä½™é¢ä¸è¶³')
      balance -= amount
      return balance
    },

    getBalance() {
      return balance
    },
  }
}

const account = createBankAccount(1000)
account.deposit(500) // 1500
account.withdraw(200) // 1300
console.log(account.getBalance()) // 1300
// account.balance  // undefinedï¼ˆæ— æ³•ç›´æ¥è®¿é—®ï¼‰
```

### 2. å‡½æ•°å·¥å‚

```javascript
// åˆ›å»ºä¹˜æ³•å‡½æ•°
function createMultiplier(factor) {
  return function (number) {
    return number * factor
  }
}

const double = createMultiplier(2)
const triple = createMultiplier(3)
const tenTimes = createMultiplier(10)

console.log(double(5)) // 10
console.log(triple(5)) // 15
console.log(tenTimes(5)) // 50

// åˆ›å»ºéªŒè¯å‡½æ•°
function createValidator(min, max) {
  return function (value) {
    return value >= min && value <= max
  }
}

const isValidAge = createValidator(0, 150)
const isValidScore = createValidator(0, 100)

console.log(isValidAge(25)) // true
console.log(isValidScore(101)) // false
```

### 3. æ¨¡å—æ¨¡å¼

```javascript
const Calculator = (function () {
  // ç§æœ‰å˜é‡
  let result = 0

  // ç§æœ‰æ–¹æ³•
  function validate(n) {
    if (typeof n !== 'number') throw new Error('å¿…é¡»æ˜¯æ•°å­—')
  }

  // å…¬å¼€æ¥å£
  return {
    add(n) {
      validate(n)
      result += n
      return this
    },

    subtract(n) {
      validate(n)
      result -= n
      return this
    },

    multiply(n) {
      validate(n)
      result *= n
      return this
    },

    getResult() {
      return result
    },

    reset() {
      result = 0
      return this
    },
  }
})()

Calculator.add(10).subtract(3).multiply(2)
console.log(Calculator.getResult()) // 14
```

### 4. è®°å¿†åŒ–ï¼ˆç¼“å­˜ï¼‰

```javascript
function memoize(fn) {
  const cache = {} // é—­åŒ…ä¿å­˜ç¼“å­˜

  return function (...args) {
    const key = JSON.stringify(args)
    if (key in cache) {
      console.log('ä»ç¼“å­˜è·å–')
      return cache[key]
    }
    console.log('è®¡ç®—ä¸­...')
    const result = fn.apply(this, args)
    cache[key] = result
    return result
  }
}

// è®¡ç®—æ–æ³¢é‚£å¥‘
const fibonacci = memoize(function (n) {
  if (n <= 1) return n
  return fibonacci(n - 1) + fibonacci(n - 2)
})

console.log(fibonacci(40)) // å¿«é€Ÿè®¡ç®—
console.log(fibonacci(40)) // ä»ç¼“å­˜è·å–
```

### 5. æŸ¯é‡ŒåŒ–

```javascript
function curry(fn) {
  return function curried(...args) {
    if (args.length >= fn.length) {
      return fn.apply(this, args)
    }
    return function (...moreArgs) {
      return curried.apply(this, [...args, ...moreArgs])
    }
  }
}

function add(a, b, c) {
  return a + b + c
}

const curriedAdd = curry(add)

console.log(curriedAdd(1)(2)(3)) // 6
console.log(curriedAdd(1, 2)(3)) // 6
console.log(curriedAdd(1)(2, 3)) // 6
console.log(curriedAdd(1, 2, 3)) // 6

// å®é™…åº”ç”¨
const log = curry((level, message, data) => {
  console.log(`[${level}] ${message}`, data)
})

const logError = log('ERROR')
const logInfo = log('INFO')

logError('è¯·æ±‚å¤±è´¥', { code: 500 })
logInfo('ç”¨æˆ·ç™»å½•', { user: 'å¼ ä¸‰' })
```

### 6. é˜²æŠ–ä¸èŠ‚æµ

```javascript
// é˜²æŠ–ï¼šå»¶è¿Ÿæ‰§è¡Œï¼Œé‡å¤è°ƒç”¨ä¼šé‡ç½®è®¡æ—¶å™¨
function debounce(fn, delay) {
  let timer = null

  return function (...args) {
    clearTimeout(timer)
    timer = setTimeout(() => {
      fn.apply(this, args)
    }, delay)
  }
}

// èŠ‚æµï¼šå›ºå®šé¢‘ç‡æ‰§è¡Œ
function throttle(fn, interval) {
  let lastTime = 0

  return function (...args) {
    const now = Date.now()
    if (now - lastTime >= interval) {
      lastTime = now
      fn.apply(this, args)
    }
  }
}

// ä½¿ç”¨
const debouncedSearch = debounce((query) => {
  console.log('æœç´¢:', query)
}, 300)

const throttledScroll = throttle(() => {
  console.log('æ»šåŠ¨ä½ç½®:', window.scrollY)
}, 100)
```

### 7. once å‡½æ•°

```javascript
function once(fn) {
  let called = false
  let result

  return function (...args) {
    if (called) return result
    called = true
    result = fn.apply(this, args)
    return result
  }
}

const initialize = once(() => {
  console.log('åˆå§‹åŒ–å®Œæˆ')
  return { initialized: true }
})

initialize() // æ‰“å°"åˆå§‹åŒ–å®Œæˆ"ï¼Œè¿”å›å¯¹è±¡
initialize() // ç›´æ¥è¿”å›ä¹‹å‰çš„ç»“æœï¼Œä¸å†æ‰§è¡Œ
initialize() // åŒä¸Š
```

## å¾ªç¯ä¸­çš„é—­åŒ…

### ç»å…¸é—®é¢˜

```javascript
// é—®é¢˜ä»£ç 
for (var i = 0; i < 3; i++) {
  setTimeout(function () {
    console.log(i)
  }, 100)
}
// è¾“å‡ºï¼š3, 3, 3

// ä¸ºä»€ä¹ˆï¼Ÿ
// 1. var æ²¡æœ‰å—çº§ä½œç”¨åŸŸï¼Œi æ˜¯åŒä¸€ä¸ªå˜é‡
// 2. setTimeout å›è°ƒåœ¨å¾ªç¯ç»“æŸåæ‰§è¡Œ
// 3. æ­¤æ—¶ i å·²ç»æ˜¯ 3
```

### è§£å†³æ–¹æ¡ˆ

```javascript
// æ–¹æ¡ˆ1ï¼šä½¿ç”¨ letï¼ˆæ¨èï¼‰
for (let i = 0; i < 3; i++) {
  setTimeout(() => console.log(i), 100)
}
// è¾“å‡ºï¼š0, 1, 2

// æ–¹æ¡ˆ2ï¼šIIFE åˆ›å»ºé—­åŒ…
for (var i = 0; i < 3; i++) {
  ;(function (j) {
    setTimeout(() => console.log(j), 100)
  })(i)
}

// æ–¹æ¡ˆ3ï¼šåˆ›å»ºå‡½æ•°è¿”å›å‡½æ•°
for (var i = 0; i < 3; i++) {
  setTimeout(
    (function (j) {
      return function () {
        console.log(j)
      }
    })(i),
    100
  )
}

// æ–¹æ¡ˆ4ï¼šbind é¢„è®¾å‚æ•°
for (var i = 0; i < 3; i++) {
  setTimeout(
    function (j) {
      console.log(j)
    }.bind(null, i),
    100
  )
}
```

## é—­åŒ…ä¸å†…å­˜

### å†…å­˜æ³„æ¼é£é™©

```javascript
// ğŸ”¶ é—­åŒ…ä¼šä¿æŒå¯¹å¤–éƒ¨å˜é‡çš„å¼•ç”¨
function createHeavyClosure() {
  const largeData = new Array(1000000).fill('x') // å¤§æ•°ç»„

  return function () {
    // å³ä½¿åªä½¿ç”¨ lengthï¼Œæ•´ä¸ª largeData éƒ½ä¼šè¢«ä¿ç•™
    console.log(largeData.length)
  }
}

const fn = createHeavyClosure()
// largeData æ— æ³•è¢«åƒåœ¾å›æ”¶

// âœ… åªä¿å­˜éœ€è¦çš„æ•°æ®
function createLightClosure() {
  const largeData = new Array(1000000).fill('x')
  const length = largeData.length // åªä¿å­˜éœ€è¦çš„

  return function () {
    console.log(length)
  }
}
```

### DOM å¼•ç”¨

```javascript
// ğŸ”¶ é—­åŒ…å¼•ç”¨ DOM å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼
function attachHandler() {
  const button = document.getElementById('myButton')

  button.addEventListener('click', function () {
    // è¿™ä¸ªé—­åŒ…å¼•ç”¨äº† button
    console.log(button.id)
  })

  // å³ä½¿ button ä» DOM ç§»é™¤ï¼Œé—­åŒ…ä»æŒæœ‰å¼•ç”¨
}

// âœ… ä½¿ç”¨äº‹ä»¶å§”æ‰˜ï¿½ï¿½åœ¨ç§»é™¤æ—¶è§£ç»‘
function attachHandlerSafe() {
  const button = document.getElementById('myButton')

  function handleClick() {
    console.log(this.id)
  }

  button.addEventListener('click', handleClick)

  // æä¾›æ¸…ç†æ–¹æ³•
  return function cleanup() {
    button.removeEventListener('click', handleClick)
  }
}
```

### è§£é™¤é—­åŒ…

```javascript
function createClosure() {
  let data = { heavy: new Array(10000) }

  return {
    getData() {
      return data
    },
    // æä¾›é‡Šæ”¾æ–¹æ³•
    dispose() {
      data = null
    },
  }
}

const obj = createClosure()
console.log(obj.getData()) // ä½¿ç”¨æ•°æ®
obj.dispose() // é‡Šæ”¾å¼•ç”¨
```

## é—­åŒ…çš„æœ¬è´¨

### ä½œç”¨åŸŸé“¾

```javascript
function outer() {
  const a = 1

  function middle() {
    const b = 2

    function inner() {
      const c = 3
      console.log(a, b, c) // é€šè¿‡ä½œç”¨åŸŸé“¾è®¿é—®
    }

    return inner
  }

  return middle
}

const middle = outer()
const inner = middle()
inner() // 1, 2, 3

// inner å‡½æ•°ä¿å­˜äº†å®Œæ•´çš„ä½œç”¨åŸŸé“¾ï¼š
// inner [[Scope]] -> middle å˜é‡ç¯å¢ƒ -> outer å˜é‡ç¯å¢ƒ -> å…¨å±€
```

### å˜é‡ç”Ÿå‘½å‘¨æœŸ

```javascript
// æ™®é€šæƒ…å†µï¼šå‡½æ•°æ‰§è¡Œå®Œï¼Œå±€éƒ¨å˜é‡é”€æ¯
function normal() {
  const x = 1
  console.log(x)
} // x è¢«é”€æ¯

// é—­åŒ…æƒ…å†µï¼šè¢«å¼•ç”¨çš„å˜é‡ä¸ä¼šé”€æ¯
function closure() {
  const x = 1
  return function () {
    console.log(x)
  }
}

const fn = closure()
// x ä¸ä¼šè¢«é”€æ¯ï¼Œå› ä¸º fn å¼•ç”¨äº†å®ƒ
fn() // 1
```

## å¸¸è§é¢è¯•é¢˜

### ğŸ™‹ å®ç° add(1)(2)(3)

```javascript
function add(a) {
  return function (b) {
    return function (c) {
      return a + b + c
    }
  }
}

console.log(add(1)(2)(3)) // 6

// é€šç”¨ç‰ˆæœ¬
function sum(a) {
  return function (b) {
    if (b === undefined) return a
    return sum(a + b)
  }
}

sum(1)(2)(3)() // 6
sum(1)(2)(3)(4)() // 10
```

### ğŸ™‹ å®ç°ç§æœ‰å˜é‡

```javascript
function Person(name) {
  // ç§æœ‰å˜é‡
  let _age = 0

  this.name = name

  this.getAge = function () {
    return _age
  }

  this.setAge = function (age) {
    if (age < 0 || age > 150) {
      throw new Error('æ— æ•ˆå¹´é¾„')
    }
    _age = age
  }
}

const p = new Person('å¼ ä¸‰')
p.setAge(25)
console.log(p.getAge()) // 25
// console.log(p._age)  // undefined
```

### ğŸ™‹ è§£é‡Šè¾“å‡º

```javascript
function fun(n, o) {
  console.log(o)
  return {
    fun: function (m) {
      return fun(m, n)
    },
  }
}

var a = fun(0) // undefined
a.fun(1) // 0
a.fun(2) // 0
a.fun(3) // 0

var b = fun(0).fun(1).fun(2).fun(3)
// undefined, 0, 1, 2

var c = fun(0).fun(1)
c.fun(2) // 1
c.fun(3) // 1
```

## æ€»ç»“

| åº”ç”¨åœºæ™¯ | è¯´æ˜                     |
| -------- | ------------------------ |
| æ•°æ®å°è£… | åˆ›å»ºç§æœ‰å˜é‡å’Œæ–¹æ³•       |
| å‡½æ•°å·¥å‚ | ç”Ÿæˆé¢„é…ç½®çš„å‡½æ•°         |
| æ¨¡å—æ¨¡å¼ | å®ç°æ¨¡ï¿½ï¿½åŒ–ï¼Œæš´éœ²å…¬å¼€æ¥å£ |
| è®°å¿†åŒ–   | ç¼“å­˜è®¡ç®—ç»“æœ             |
| æŸ¯é‡ŒåŒ–   | å‚æ•°å¤ç”¨å’Œå»¶è¿Ÿæ‰§è¡Œ       |
| é˜²æŠ–èŠ‚æµ | æ§åˆ¶å‡½æ•°æ‰§è¡Œé¢‘ç‡         |

**æ ¸å¿ƒè¦ç‚¹**ï¼š

- é—­åŒ… = å‡½æ•° + å‡½æ•°å®šä¹‰æ—¶çš„è¯æ³•ç¯å¢ƒ
- é—­åŒ…è®©å‡½æ•°å¯ä»¥è®¿é—®å®šä¹‰æ—¶çš„ä½œç”¨åŸŸ
- æ³¨æ„é—­åŒ…å¯èƒ½å¯¼è‡´çš„å†…å­˜æ³„æ¼
- å¾ªç¯ä¸­ä½¿ç”¨ `let` é¿å…é—­åŒ…é™·é˜±
- é—­åŒ…æ˜¯å®ç°æ•°æ®å°è£…çš„é‡è¦æ‰‹æ®µ
