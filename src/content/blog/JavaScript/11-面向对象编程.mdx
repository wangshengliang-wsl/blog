---
title: 'é¢å‘å¯¹è±¡ç¼–ç¨‹'
description: 'æŒæ¡ JavaScript é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œç†è§£æ„é€ å‡½æ•°ã€åŸå‹ç»§æ‰¿ä¸ ES6 Class è¯­æ³•'
pubDate: 2025-12-03
toc: true
ogImage: true
category: 'JavaScript'
tags: ['JavaScript', 'é¢å‘å¯¹è±¡', 'Class', 'ç»§æ‰¿']
---

JavaScript ä½¿ç”¨åŸå‹å®ç°é¢å‘å¯¹è±¡ç¼–ç¨‹ã€‚ES6 çš„ Class è¯­æ³•è®©ä»£ç æ›´æ¸…æ™°ï¼Œä½†æœ¬è´¨ä»æ˜¯åŸå‹ç»§æ‰¿ã€‚

## ğŸ¯ æ„é€ å‡½æ•°

### åŸºæœ¬ç”¨æ³•

```javascript
// æ„é€ å‡½æ•°ï¼ˆé¦–å­—æ¯å¤§å†™ï¼‰
function Person(name, age) {
  this.name = name
  this.age = age
}

// åŸå‹æ–¹æ³•
Person.prototype.greet = function () {
  return `ä½ å¥½ï¼Œæˆ‘æ˜¯${this.name}ï¼Œä»Šå¹´${this.age}å²`
}

// åˆ›å»ºå®ä¾‹
const p1 = new Person('å¼ ä¸‰', 25)
const p2 = new Person('æå››', 30)

console.log(p1.greet()) // "ä½ å¥½ï¼Œæˆ‘æ˜¯å¼ ä¸‰ï¼Œä»Šå¹´25å²"
console.log(p1.greet === p2.greet) // trueï¼ˆå…±äº«æ–¹æ³•ï¼‰
```

### å®ä¾‹å±æ€§ vs åŸå‹å±æ€§

```javascript
function Car(brand) {
  // å®ä¾‹å±æ€§ï¼šæ¯ä¸ªå®ä¾‹ç‹¬ç«‹
  this.brand = brand
  this.mileage = 0
}

// åŸå‹å±æ€§ï¼šæ‰€æœ‰å®ä¾‹å…±äº«
Car.prototype.wheels = 4
Car.prototype.drive = function (km) {
  this.mileage += km
}

const car1 = new Car('Toyota')
const car2 = new Car('Honda')

car1.drive(100)
console.log(car1.mileage) // 100
console.log(car2.mileage) // 0ï¼ˆç‹¬ç«‹ï¼‰
console.log(car1.wheels === car2.wheels) // trueï¼ˆå…±äº«ï¼‰
```

### é™æ€æ–¹æ³•

```javascript
function MathHelper() {}

// é™æ€æ–¹æ³•ï¼šç›´æ¥æŒ‚åœ¨æ„é€ å‡½æ•°ä¸Š
MathHelper.add = function (a, b) {
  return a + b
}

MathHelper.multiply = function (a, b) {
  return a * b
}

// è°ƒç”¨é™æ€æ–¹æ³•
console.log(MathHelper.add(1, 2)) // 3
console.log(MathHelper.multiply(3, 4)) // 12

// å®ä¾‹æ— æ³•è®¿é—®é™æ€æ–¹æ³•
const helper = new MathHelper()
// helper.add(1, 2)  // TypeError
```

## ES6 Class

### åŸºæœ¬è¯­æ³•

```javascript
class Person {
  // æ„é€ å‡½æ•°
  constructor(name, age) {
    this.name = name
    this.age = age
  }

  // å®ä¾‹æ–¹æ³•ï¼ˆåœ¨åŸå‹ä¸Šï¼‰
  greet() {
    return `ä½ å¥½ï¼Œæˆ‘æ˜¯${this.name}`
  }

  // getter
  get info() {
    return `${this.name}, ${this.age}å²`
  }

  // setter
  set info(value) {
    const [name, age] = value.split(',')
    this.name = name
    this.age = parseInt(age)
  }

  // é™æ€æ–¹æ³•
  static create(name, age) {
    return new Person(name, age)
  }

  // é™æ€å±æ€§
  static species = 'Homo sapiens'
}

const p = new Person('å¼ ä¸‰', 25)
console.log(p.greet()) // "ä½ å¥½ï¼Œæˆ‘æ˜¯å¼ ä¸‰"
console.log(p.info) // "å¼ ä¸‰, 25å²"
console.log(Person.species) // "Homo sapiens"
console.log(Person.create('æå››', 30)) // Person { name: "æå››", age: 30 }
```

### ç±»å­—æ®µ

```javascript
class Counter {
  // å…¬å…±å­—æ®µ
  count = 0
  name = 'counter'

  // ç§æœ‰å­—æ®µï¼ˆES2022ï¼‰
  #privateCount = 0

  increment() {
    this.count++
    this.#privateCount++
  }

  getPrivateCount() {
    return this.#privateCount
  }
}

const counter = new Counter()
counter.increment()
console.log(counter.count) // 1
console.log(counter.getPrivateCount()) // 1
// console.log(counter.#privateCount)  // SyntaxError
```

### ç§æœ‰æ–¹æ³•

```javascript
class BankAccount {
  #balance = 0

  constructor(initialBalance) {
    this.#balance = initialBalance
  }

  // ç§æœ‰æ–¹æ³•
  #validate(amount) {
    if (amount <= 0) throw new Error('é‡‘é¢å¿…é¡»å¤§äº0')
  }

  deposit(amount) {
    this.#validate(amount)
    this.#balance += amount
  }

  withdraw(amount) {
    this.#validate(amount)
    if (amount > this.#balance) throw new Error('ä½™é¢ä¸è¶³')
    this.#balance -= amount
  }

  get balance() {
    return this.#balance
  }
}

const account = new BankAccount(1000)
account.deposit(500)
console.log(account.balance) // 1500
```

## ç»§æ‰¿

### ES6 extends

```javascript
class Animal {
  constructor(name) {
    this.name = name
  }

  eat() {
    return `${this.name}åœ¨åƒä¸œè¥¿`
  }

  sleep() {
    return `${this.name}åœ¨ç¡è§‰`
  }
}

class Dog extends Animal {
  constructor(name, breed) {
    super(name) // å¿…é¡»å…ˆè°ƒç”¨ super
    this.breed = breed
  }

  // æ–°å¢æ–¹æ³•
  bark() {
    return 'æ±ªæ±ªï¼'
  }

  // é‡å†™æ–¹æ³•
  eat() {
    return `${this.name}åœ¨åƒç‹—ç²®`
  }

  // è°ƒç”¨çˆ¶ç±»æ–¹æ³•
  sleep() {
    return super.sleep() + 'ï¼Œåšç€ç¾æ¢¦'
  }
}

const dog = new Dog('å°é»‘', 'æ‹‰å¸ƒæ‹‰å¤š')
console.log(dog.eat()) // "å°é»‘åœ¨åƒç‹—ç²®"
console.log(dog.sleep()) // "å°é»‘åœ¨ç¡è§‰ï¼Œåšç€ç¾æ¢¦"
console.log(dog.bark()) // "æ±ªæ±ªï¼"
console.log(dog instanceof Dog) // true
console.log(dog instanceof Animal) // true
```

### super å…³é”®å­—

```javascript
class Parent {
  constructor(x) {
    this.x = x
  }

  static staticMethod() {
    return 'parent static'
  }

  instanceMethod() {
    return 'parent instance'
  }
}

class Child extends Parent {
  constructor(x, y) {
    // æ„é€ å‡½æ•°ä¸­ï¼Œsuper å¿…é¡»åœ¨ä½¿ç”¨ this ä¹‹å‰è°ƒç”¨
    super(x)
    this.y = y
  }

  static staticMethod() {
    // é™æ€æ–¹æ³•ä¸­è°ƒç”¨çˆ¶ç±»é™æ€æ–¹æ³•
    return super.staticMethod() + ' -> child static'
  }

  instanceMethod() {
    // å®ä¾‹æ–¹æ³•ä¸­è°ƒç”¨çˆ¶ç±»æ–¹æ³•
    return super.instanceMethod() + ' -> child instance'
  }
}

const child = new Child(1, 2)
console.log(child.instanceMethod()) // "parent instance -> child instance"
console.log(Child.staticMethod()) // "parent static -> child static"
```

### ç»§æ‰¿å†…ç½®ç±»

```javascript
// æ‰©å±• Array
class MyArray extends Array {
  first() {
    return this[0]
  }

  last() {
    return this[this.length - 1]
  }

  sum() {
    return this.reduce((a, b) => a + b, 0)
  }
}

const arr = new MyArray(1, 2, 3, 4, 5)
console.log(arr.first()) // 1
console.log(arr.last()) // 5
console.log(arr.sum()) // 15
console.log(arr.map((x) => x * 2)) // MyArray [2, 4, 6, 8, 10]

// æ‰©å±• Error
class ValidationError extends Error {
  constructor(message, field) {
    super(message)
    this.name = 'ValidationError'
    this.field = field
  }
}

try {
  throw new ValidationError('å¿…å¡«é¡¹', 'username')
} catch (e) {
  console.log(e.name) // "ValidationError"
  console.log(e.field) // "username"
}
```

## æŠ½è±¡ä¸å°è£…

### æ¨¡æ‹ŸæŠ½è±¡ç±»

```javascript
class Shape {
  constructor() {
    if (new.target === Shape) {
      throw new Error('Shape æ˜¯æŠ½è±¡ç±»ï¼Œä¸èƒ½ç›´æ¥å®ä¾‹åŒ–')
    }
  }

  // æŠ½è±¡æ–¹æ³•
  area() {
    throw new Error('å­ç±»å¿…é¡»å®ç° area æ–¹æ³•')
  }

  // å…·ä½“æ–¹æ³•
  describe() {
    return `è¿™æ˜¯ä¸€ä¸ªé¢ç§¯ä¸º ${this.area()} çš„å›¾å½¢`
  }
}

class Rectangle extends Shape {
  constructor(width, height) {
    super()
    this.width = width
    this.height = height
  }

  area() {
    return this.width * this.height
  }
}

// const shape = new Shape()  // Error
const rect = new Rectangle(10, 5)
console.log(rect.area()) // 50
console.log(rect.describe()) // "è¿™æ˜¯ä¸€ä¸ªé¢ç§¯ä¸º 50 çš„å›¾å½¢"
```

### å°è£…ä¸ä¿¡æ¯éšè—

```javascript
// ä½¿ç”¨é—­åŒ…ï¼ˆES6 ä¹‹å‰ï¼‰
function createPerson(name) {
  let _age = 0 // ç§æœ‰å˜é‡

  return {
    getName() {
      return name
    },
    getAge() {
      return _age
    },
    setAge(age) {
      if (age < 0) throw new Error('å¹´é¾„ä¸èƒ½ä¸ºè´Ÿ')
      _age = age
    },
  }
}

// ä½¿ç”¨ WeakMapï¼ˆES6ï¼‰
const _private = new WeakMap()

class Person {
  constructor(name) {
    _private.set(this, { name, age: 0 })
  }

  get name() {
    return _private.get(this).name
  }

  get age() {
    return _private.get(this).age
  }

  set age(value) {
    if (value < 0) throw new Error('å¹´é¾„ä¸èƒ½ä¸ºè´Ÿ')
    _private.get(this).age = value
  }
}

// ä½¿ç”¨ç§æœ‰å­—æ®µï¼ˆES2022ï¼‰
class User {
  #password

  constructor(username, password) {
    this.username = username
    this.#password = password
  }

  checkPassword(input) {
    return this.#password === input
  }
}
```

## å¤šæ€

```javascript
class Animal {
  speak() {
    return 'åŠ¨ç‰©å‘å‡ºå£°éŸ³'
  }
}

class Dog extends Animal {
  speak() {
    return 'æ±ªæ±ªï¼'
  }
}

class Cat extends Animal {
  speak() {
    return 'å–µå–µï¼'
  }
}

class Bird extends Animal {
  speak() {
    return 'å½å½ï¼'
  }
}

// å¤šæ€ï¼šåŒä¸€æ¥å£ï¼Œä¸åŒå®ç°
function makeAllSpeak(animals) {
  animals.forEach((animal) => {
    console.log(animal.speak())
  })
}

makeAllSpeak([new Dog(), new Cat(), new Bird()])
// ï¿½ï¿½ï¿½æ±ªï¼
// å–µå–µï¼
// å½å½ï¼
```

## ç»„åˆä¼˜äºç»§æ‰¿

```javascript
// è¿‡æ·±çš„ç»§æ‰¿å±‚æ¬¡ä¼šå¯¼è‡´é—®é¢˜
// ä½¿ç”¨ç»„åˆæ›´çµæ´»

// å¯å¤ç”¨çš„è¡Œä¸º
const canSwim = {
  swim() {
    return `${this.name}åœ¨æ¸¸æ³³`
  },
}

const canFly = {
  fly() {
    return `${this.name}åœ¨é£ç¿”`
  },
}

const canWalk = {
  walk() {
    return `${this.name}åœ¨è¡Œèµ°`
  },
}

// ç»„åˆè¡Œä¸º
class Duck {
  constructor(name) {
    this.name = name
  }
}

Object.assign(Duck.prototype, canSwim, canFly, canWalk)

const duck = new Duck('å”è€é¸­')
console.log(duck.swim()) // "å”è€é¸­åœ¨æ¸¸æ³³"
console.log(duck.fly()) // "å”è€é¸­åœ¨é£ç¿”"
console.log(duck.walk()) // "å”è€é¸­åœ¨è¡Œèµ°"

// ä½¿ç”¨å·¥å‚å‡½æ•°
function createDuck(name) {
  const duck = { name }
  return Object.assign(duck, canSwim, canFly, canWalk)
}
```

## è®¾è®¡æ¨¡å¼ç¤ºä¾‹

### å•ä¾‹æ¨¡å¼

```javascript
class Database {
  static #instance = null

  constructor() {
    if (Database.#instance) {
      return Database.#instance
    }
    this.connection = this.connect()
    Database.#instance = this
  }

  connect() {
    console.log('å»ºç«‹æ•°æ®åº“è¿æ¥')
    return { connected: true }
  }

  static getInstance() {
    if (!Database.#instance) {
      Database.#instance = new Database()
    }
    return Database.#instance
  }
}

const db1 = Database.getInstance()
const db2 = Database.getInstance()
console.log(db1 === db2) // true
```

### å·¥å‚æ¨¡å¼

```javascript
class Car {
  constructor(brand) {
    this.brand = brand
  }
}

class Bike {
  constructor(brand) {
    this.brand = brand
  }
}

class VehicleFactory {
  static create(type, brand) {
    switch (type) {
      case 'car':
        return new Car(brand)
      case 'bike':
        return new Bike(brand)
      default:
        throw new Error(`æœªçŸ¥ç±»å‹: ${type}`)
    }
  }
}

const car = VehicleFactory.create('car', 'Toyota')
const bike = VehicleFactory.create('bike', 'Giant')
```

### è§‚å¯Ÿè€…æ¨¡å¼

```javascript
class EventEmitter {
  #events = {}

  on(event, callback) {
    if (!this.#events[event]) {
      this.#events[event] = []
    }
    this.#events[event].push(callback)
  }

  off(event, callback) {
    if (!this.#events[event]) return
    this.#events[event] = this.#events[event].filter((cb) => cb !== callback)
  }

  emit(event, ...args) {
    if (!this.#events[event]) return
    this.#events[event].forEach((callback) => {
      callback(...args)
    })
  }

  once(event, callback) {
    const wrapper = (...args) => {
      callback(...args)
      this.off(event, wrapper)
    }
    this.on(event, wrapper)
  }
}

const emitter = new EventEmitter()
emitter.on('message', (msg) => console.log('æ”¶åˆ°:', msg))
emitter.emit('message', 'ä½ å¥½') // "æ”¶åˆ°: ä½ å¥½"
```

## Class vs æ„é€ å‡½æ•°

```javascript
// æ„é€ å‡½æ•°
function PersonFn(name) {
  this.name = name
}
PersonFn.prototype.greet = function () {
  return `ä½ å¥½ï¼Œ${this.name}`
}

// Class
class PersonClass {
  constructor(name) {
    this.name = name
  }
  greet() {
    return `ä½ å¥½ï¼Œ${this.name}`
  }
}

// ä¸»è¦åŒºåˆ«ï¼š
// 1. Class å¿…é¡»ç”¨ new è°ƒç”¨
// PersonClass('å¼ ä¸‰')  // TypeError

// 2. Class ä¸ä¼šæå‡
// new Foo()  // ReferenceError
// class Foo {}

// 3. Class å†…éƒ¨é»˜è®¤ä¸¥æ ¼æ¨¡å¼

// 4. Class çš„æ–¹æ³•ä¸å¯æšä¸¾
console.log(Object.keys(PersonFn.prototype)) // ["greet"]
console.log(Object.keys(PersonClass.prototype)) // []
```

## æ€»ç»“

| ç‰¹æ€§     | æ„é€ å‡½æ•°          | ES6 Class     |
| -------- | ----------------- | ------------- |
| è¯­æ³•     | function          | class         |
| ç»§æ‰¿     | æ‰‹åŠ¨è®¾ç½®åŸå‹      | extends       |
| super    | Parent.call(this) | super()       |
| ç§æœ‰æˆå‘˜ | é—­åŒ… / WeakMap    | # å‰ç¼€        |
| é™æ€æˆå‘˜ | ç›´æ¥æŒ‚è½½          | static å…³é”®å­— |
| ä¸¥æ ¼æ¨¡å¼ | éœ€æ‰‹åŠ¨å£°æ˜        | é»˜è®¤          |

**æ ¸å¿ƒè¦ç‚¹**ï¼š

- Class æ˜¯æ„é€ å‡½æ•°çš„è¯­æ³•ç³–ï¼Œæœ¬è´¨æ˜¯åŸå‹ç»§æ‰¿
- ä½¿ç”¨ `extends` å’Œ `super` å®ç°ç»§æ‰¿
- `#` å‰ç¼€å®šä¹‰çœŸæ­£çš„ç§æœ‰æˆå‘˜
- ç»„åˆä¼˜äºç»§æ‰¿ï¼Œä¿æŒç»§æ‰¿å±‚æ¬¡æ‰å¹³
