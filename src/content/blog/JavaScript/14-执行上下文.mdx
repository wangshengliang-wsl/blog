---
title: 'æ‰§è¡Œä¸Šä¸‹æ–‡'
description: 'æ·±å…¥ç†è§£ JavaScript æ‰§è¡Œï¿½ï¿½ï¿½ä¸‹æ–‡ã€è°ƒç”¨æ ˆä¸å˜é‡å¯¹è±¡çš„å·¥ä½œåŸç†'
pubDate: 2025-12-03
toc: true
ogImage: true
category: 'JavaScript'
tags: ['JavaScript', 'æ‰§è¡Œä¸Šä¸‹æ–‡', 'è°ƒç”¨æ ˆ', 'å˜é‡æå‡']
---

æ‰§è¡Œä¸Šä¸‹æ–‡æ˜¯ JavaScript ä»£ç æ‰§è¡Œæ—¶çš„ç¯å¢ƒã€‚ç†è§£æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œèƒ½å¸®ä½ æ·±å…¥ç†è§£ä½œç”¨åŸŸã€é—­åŒ…å’Œ this çš„è¡Œä¸ºã€‚

## ğŸ¯ ä»€ä¹ˆæ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡

æ‰§è¡Œä¸Šä¸‹æ–‡æ˜¯ JavaScript å¼•æ“åœ¨æ‰§è¡Œä»£ç æ—¶åˆ›å»ºçš„å†…éƒ¨æ•°æ®ç»“æ„ï¼ŒåŒ…å«äº†ä»£ç æ‰§è¡Œæ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚

```javascript
// å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡
const global = 'å…¨å±€å˜é‡'

function outer() {
  // outer å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡
  const outerVar = 'å¤–å±‚å˜é‡'

  function inner() {
    // inner å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡
    const innerVar = 'å†…å±‚å˜é‡'
    console.log(global, outerVar, innerVar)
  }

  inner()
}

outer()
```

## æ‰§è¡Œä¸Šä¸‹æ–‡ç±»å‹

### 1. å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡

```javascript
// ç¨‹åºå¯åŠ¨æ—¶åˆ›å»º
// åªæœ‰ä¸€ä¸ª
// æµè§ˆå™¨ä¸­ this æŒ‡å‘ window

console.log(this) // windowï¼ˆæµè§ˆå™¨ï¼‰

var globalVar = 'å…¨å±€'
function globalFn() {}

// å…¨å±€å˜é‡å’Œå‡½æ•°æˆä¸ºå…¨å±€å¯¹è±¡çš„å±æ€§
console.log(window.globalVar) // "å…¨å±€"
console.log(window.globalFn) // Æ’ globalFn()
```

### 2. å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡

```javascript
// æ¯æ¬¡è°ƒç”¨å‡½æ•°éƒ½ä¼šåˆ›å»ºæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡
function greet(name) {
  const greeting = 'ä½ å¥½'
  console.log(`${greeting}ï¼Œ${name}`)
}

greet('å¼ ä¸‰') // åˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡1
greet('æå››') // åˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡2ï¼ˆä¸åŒçš„ä¸Šä¸‹æ–‡ï¼‰
```

### 3. eval æ‰§è¡Œä¸Šä¸‹æ–‡

```javascript
// eval åˆ›å»ºç‹¬ç«‹çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆä¸æ¨èä½¿ç”¨ï¼‰
eval('var x = 1')
```

## è°ƒç”¨æ ˆ

è°ƒç”¨æ ˆï¼ˆCall Stackï¼‰ç®¡ç†æ‰§è¡Œä¸Šä¸‹æ–‡çš„åˆ›å»ºå’Œé”€æ¯ã€‚

### æ ˆçš„å·¥ä½œåŸç†

```javascript
function first() {
  console.log('first å¼€å§‹')
  second()
  console.log('first ç»“æŸ')
}

function second() {
  console.log('second å¼€å§‹')
  third()
  console.log('second ç»“æŸ')
}

function third() {
  console.log('third')
}

first()

// è°ƒç”¨æ ˆå˜åŒ–ï¼š
// 1. [Global]
// 2. [Global, first]
// 3. [Global, first, second]
// 4. [Global, first, second, third]
// 5. [Global, first, second]ï¼ˆthird å‡ºæ ˆï¼‰
// 6. [Global, first]ï¼ˆsecond å‡ºæ ˆï¼‰
// 7. [Global]ï¼ˆfirst å‡ºæ ˆï¼‰

// è¾“å‡ºé¡ºåºï¼š
// first å¼€å§‹
// second å¼€å§‹
// third
// second ç»“æŸ
// first ç»“æŸ
```

### æ ˆæº¢å‡º

```javascript
// é€’å½’è¿‡æ·±ä¼šå¯¼è‡´æ ˆæº¢å‡º
function recursive() {
  recursive() // æ— é™é€’å½’
}

// recursive()  // RangeError: Maximum call stack size exceeded

// è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨è¿­ä»£æˆ–å°¾é€’å½’
function factorial(n, acc = 1) {
  if (n <= 1) return acc
  return factorial(n - 1, n * acc) // å°¾é€’å½’
}
```

### æµè§ˆå™¨ä¸­æŸ¥çœ‹è°ƒç”¨æ ˆ

```javascript
function a() {
  b()
}

function b() {
  c()
}

function c() {
  console.trace() // æ‰“å°è°ƒç”¨æ ˆ
  debugger // åœ¨å¼€å‘è€…å·¥å…·ä¸­æš‚åœ
}

a()

// Console è¾“å‡ºï¼š
// c @ script.js:10
// b @ script.js:6
// a @ script.js:2
```

## æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç»„æˆ

### å˜é‡ç¯å¢ƒï¼ˆVariable Environmentï¼‰

å­˜å‚¨ var å£°æ˜å’Œå‡½æ•°å£°æ˜ï¼š

```javascript
// åˆ›å»ºé˜¶æ®µ
function example() {
  console.log(a) // undefinedï¼ˆå·²å£°æ˜ä½†æœªèµ‹å€¼ï¼‰
  console.log(fn) // Æ’ fn()ï¼ˆå‡½æ•°å£°æ˜å®Œæ•´æå‡ï¼‰
  // console.log(b)  // ReferenceError

  var a = 1
  let b = 2
  function fn() {}
}

// å˜é‡ç¯å¢ƒï¼š
// {
//   a: undefined,
//   fn: <function>
// }
```

### è¯æ³•ç¯å¢ƒï¼ˆLexical Environmentï¼‰

å­˜å‚¨ letã€const å£°æ˜å’Œå—çº§ä½œç”¨åŸŸï¼š

```javascript
function example() {
  let x = 1
  const y = 2

  {
    let x = 10 // æ–°çš„è¯æ³•ç¯å¢ƒ
    const z = 20
    console.log(x, y, z) // 10, 2, 20
  }

  console.log(x) // 1
  // console.log(z)  // ReferenceError
}
```

### this ç»‘å®š

```javascript
// å…¨å±€ä¸Šä¸‹æ–‡
console.log(this) // window

// å‡½æ•°ä¸Šä¸‹æ–‡
function fn() {
  console.log(this)
}
fn() // windowï¼ˆéä¸¥æ ¼æ¨¡å¼ï¼‰

const obj = {
  method() {
    console.log(this)
  },
}
obj.method() // obj
```

## æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç”Ÿå‘½å‘¨æœŸ

### 1. åˆ›å»ºé˜¶æ®µ

```javascript
function example(a, b) {
  var c = 3
  function inner() {}
  var d = function () {}
}

example(1, 2)

// åˆ›å»ºé˜¶æ®µçš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼š
// {
//   VariableEnvironment: {
//     a: 1,          // å‚æ•°
//     b: 2,          // å‚æ•°
//     c: undefined,  // var å£°æ˜
//     inner: <func>, // å‡½æ•°å£°æ˜
//     d: undefined   // var å£°æ˜
//   },
//   LexicalEnvironment: { ... },
//   ThisBinding: window
// }
```

### 2. æ‰§è¡Œé˜¶æ®µ

```javascript
function example(a, b) {
  console.log(a) // 1
  console.log(c) // undefined
  var c = 3
  console.log(c) // 3

  function inner() {}
  var d = function () {}
}

example(1, 2)

// æ‰§è¡Œé˜¶æ®µï¼šé€è¡Œæ‰§è¡Œä»£ç ï¼Œæ›´æ–°å˜é‡å€¼
```

### 3. å›æ”¶é˜¶æ®µ

```javascript
function outer() {
  const data = new Array(10000)

  function inner() {
    // ä½¿ç”¨ data
  }

  // æ‰§è¡Œå®Œæ¯•ï¼Œå¦‚æœ inner æ²¡æœ‰è¢«å¼•ç”¨
  // outer çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¼šè¢«é”€æ¯ï¼Œdata è¢«å›æ”¶
}

outer()

// å¦‚æœè¿”å› innerï¼Œå½¢æˆé—­åŒ…
function outerWithClosure() {
  const data = new Array(10000)

  return function inner() {
    return data.length
  }
}

const fn = outerWithClosure()
// outer çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„ data ä¸ä¼šè¢«å›æ”¶
```

## å˜é‡æå‡è¯¦è§£

### var çš„æå‡

```javascript
console.log(a) // undefined
var a = 1
console.log(a) // 1

// ç›¸å½“äº
var a
console.log(a) // undefined
a = 1
console.log(a) // 1

// å‡½æ•°å†…éƒ¨
function fn() {
  console.log(x) // undefined
  var x = 10

  if (false) {
    var y = 20 // è™½ç„¶ä¸æ‰§è¡Œï¼Œä½†å£°æ˜ä¼šæå‡
  }
  console.log(y) // undefined
}
```

### å‡½æ•°æå‡

```javascript
// å‡½æ•°å£°æ˜å®Œæ•´æå‡
fn() // "fn"

function fn() {
  console.log('fn')
}

// å‡½æ•°è¡¨è¾¾å¼åªæå‡å˜é‡å£°æ˜
// expr()  // TypeError: expr is not a function
var expr = function () {
  console.log('expr')
}
expr() // "expr"

// åŒåæ—¶ï¼Œå‡½æ•°ä¼˜å…ˆ
console.log(typeof foo) // "function"
var foo = 'variable'
function foo() {}
console.log(typeof foo) // "string"
```

### let/const çš„ TDZ

```javascript
// let/const æœ‰"æš‚æ—¶æ€§æ­»åŒº"
// console.log(x)  // ReferenceError
let x = 1

// TDZ ä»å—çš„å¼€å§‹åˆ°å£°æ˜è¯­å¥
{
  // TDZ å¼€å§‹
  // console.log(y)  // ReferenceError
  let y = 2 // TDZ ç»“æŸ
  console.log(y) // 2
}
```

## ä½œç”¨åŸŸé“¾

### ä½œç”¨åŸŸé“¾çš„å½¢æˆ

```javascript
const global = 'global'

function outer() {
  const outerVar = 'outer'

  function inner() {
    const innerVar = 'inner'

    // ä½œç”¨åŸŸé“¾ï¼šinner -> outer -> global
    console.log(innerVar) // å½“å‰ä½œç”¨åŸŸ
    console.log(outerVar) // å¤–å±‚ä½œç”¨åŸŸ
    console.log(global) // å…¨å±€ä½œç”¨åŸŸ
  }

  inner()
}

outer()
```

### ä½œç”¨åŸŸé“¾æŸ¥æ‰¾

```javascript
const x = 'global x'

function outer() {
  const y = 'outer y'

  function inner() {
    const z = 'inner z'

    // æŸ¥æ‰¾é¡ºåºï¼šinner -> outer -> global
    console.log(z) // æ‰¾åˆ° inner ä¸­çš„ z
    console.log(y) // æ‰¾åˆ° outer ä¸­çš„ y
    console.log(x) // æ‰¾åˆ° global ä¸­çš„ x
    console.log(w) // æŠ›å‡º ReferenceError
  }

  inner()
}
```

### è¯æ³•ä½œç”¨åŸŸ vs åŠ¨æ€ä½œç”¨åŸŸ

```javascript
const x = 'global'

function foo() {
  console.log(x)
}

function bar() {
  const x = 'bar'
  foo() // JavaScript æ˜¯è¯æ³•ä½œç”¨åŸŸï¼Œè¾“å‡º "global"
}

bar()

// è¯æ³•ä½œç”¨åŸŸï¼šç”±ä»£ç å®šä¹‰ä½ç½®å†³å®š
// åŠ¨æ€ä½œç”¨åŸŸï¼šç”±è°ƒç”¨ä½ç½®å†³å®šï¼ˆJavaScript ä¸æ˜¯ï¼‰
```

## å®é™…åº”ç”¨

### ç†è§£é—­åŒ…çš„åŸç†

```javascript
function createCounter() {
  let count = 0

  return function () {
    return ++count
  }
}

const counter = createCounter()

// createCounter æ‰§è¡Œå®Œæ¯•ï¼Œä½†å…¶æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„ count
// è¢«è¿”å›çš„å‡½æ•°å¼•ç”¨ï¼Œå› æ­¤ä¸ä¼šè¢«é”€æ¯

console.log(counter()) // 1
console.log(counter()) // 2
```

### ç†è§£ this çš„è¡Œä¸º

```javascript
const obj = {
  name: 'å¯¹è±¡',
  method: function () {
    console.log(this.name) // "å¯¹è±¡"

    // åµŒå¥—å‡½æ•°
    function nested() {
      console.log(this.name) // undefinedï¼ˆæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼‰
    }
    nested()

    // ç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ this
    const arrow = () => {
      console.log(this.name) // "å¯¹è±¡"ï¼ˆç»§æ‰¿å¤–å±‚ï¼‰
    }
    arrow()
  },
}

obj.method()
```

### ç†è§£å˜é‡è¦†ç›–

```javascript
var x = 1

function foo() {
  console.log(x) // undefinedï¼ˆä¸æ˜¯1ï¼ï¼‰
  var x = 2
  console.log(x) // 2
}

foo()

// å› ä¸º var x è¢«æå‡åˆ°å‡½æ•°é¡¶éƒ¨
// ç›¸å½“äºï¼š
function foo() {
  var x // æå‡ï¼Œé®è”½å¤–å±‚ x
  console.log(x) // undefined
  x = 2
  console.log(x) // 2
}
```

## å¸¸è§é¢è¯•é¢˜

### ğŸ™‹ è¾“å‡ºä»€ä¹ˆï¼Ÿ

```javascript
var a = 1
function fn() {
  console.log(a) // undefined
  var a = 2
  console.log(a) // 2
}
fn()
console.log(a) // 1
```

### ğŸ™‹ å‡½æ•°å’Œå˜é‡åŒå

```javascript
console.log(foo) // Æ’ foo()
var foo = 1
function foo() {}
console.log(foo) // 1

// åˆ›å»ºé˜¶æ®µï¼š
// 1. foo = undefinedï¼ˆvarï¼‰
// 2. foo = functionï¼ˆå‡½æ•°å£°æ˜è¦†ç›–ï¼‰
// æ‰§è¡Œé˜¶æ®µï¼š
// 3. foo = 1
```

### ğŸ™‹ å¤æ‚æå‡

```javascript
function example() {
  console.log(typeof fn) // "function"
  console.log(typeof bar) // "undefined"

  var fn = 'variable'
  function fn() {}

  var bar = function () {}

  console.log(typeof fn) // "string"
  console.log(typeof bar) // "function"
}
```

## æ€»ç»“

| æ¦‚å¿µ       | è¯´æ˜                           |
| ---------- | ------------------------------ |
| æ‰§è¡Œä¸Šä¸‹æ–‡ | ä»£ç æ‰§è¡Œæ—¶çš„ç¯å¢ƒ               |
| è°ƒç”¨æ ˆ     | ç®¡ç†æ‰§è¡Œä¸Šä¸‹æ–‡çš„ LIFO ç»“æ„     |
| å˜é‡ç¯å¢ƒ   | å­˜å‚¨ var å’Œå‡½æ•°å£°æ˜            |
| è¯æ³•ç¯å¢ƒ   | å­˜å‚¨ let/const å’Œå—çº§ä½œç”¨åŸŸ    |
| ä½œç”¨åŸŸé“¾   | å˜é‡æŸ¥æ‰¾çš„é“¾å¼ç»“æ„             |
| å˜é‡æå‡   | var/function å£°æ˜ç§»åˆ°é¡¶éƒ¨      |
| TDZ        | let/const å£°æ˜å‰çš„ä¸å¯è®¿é—®åŒºåŸŸ |

**æ ¸å¿ƒè¦ç‚¹**ï¼š

- ä»£ç æ‰§è¡Œå‰ä¼šåˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡
- æ¯æ¬¡å‡½æ•°è°ƒç”¨åˆ›å»ºæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡
- ä½œç”¨åŸŸé“¾åœ¨å‡½æ•°å®šä¹‰æ—¶ç¡®å®šï¼ˆè¯æ³•ä½œç”¨åŸŸï¼‰
- var ä¼šæå‡ï¼Œlet/const æœ‰æš‚æ—¶æ€§æ­»åŒº
- ç†è§£æ‰§è¡Œä¸Šä¸‹æ–‡æœ‰åŠ©äºç†è§£é—­åŒ…å’Œ this
