---
title: 'DOM æ“ä½œ'
description: 'æŒæ¡ JavaScript DOM èŠ‚ç‚¹çš„åˆ›å»ºã€æ’å…¥ã€åˆ é™¤ä¸ä¿®æ”¹æ“ä½œ'
pubDate: 2025-12-03
toc: true
ogImage: true
category: 'JavaScript'
tags: ['JavaScript', 'DOM', 'èŠ‚ç‚¹æ“ä½œ', 'å…ƒç´ ']
---

DOM æ“ä½œæ˜¯å‰ç«¯å¼€å‘çš„åŸºç¡€ã€‚æŒæ¡å¦‚ä½•åˆ›å»ºã€ä¿®æ”¹å’Œåˆ é™¤ DOM èŠ‚ç‚¹ï¼Œæ‰èƒ½åŠ¨æ€æ„å»ºé¡µé¢å†…å®¹ã€‚

## ğŸ¯ åˆ›å»ºèŠ‚ç‚¹

### createElement

åˆ›å»ºå…ƒç´ èŠ‚ç‚¹ï¼š

```javascript
// åˆ›å»º div å…ƒç´ 
const div = document.createElement('div')
div.textContent = 'æ–°å…ƒç´ '
div.className = 'box'
div.id = 'myDiv'

// åˆ›å»ºå¸¦å±æ€§çš„å…ƒç´ 
const link = document.createElement('a')
link.href = 'https://example.com'
link.textContent = 'é“¾æ¥'
link.target = '_blank'

// åˆ›å»ºè¡¨å•å…ƒç´ 
const input = document.createElement('input')
input.type = 'text'
input.name = 'username'
input.placeholder = 'è¯·è¾“å…¥ç”¨æˆ·å'
```

### createTextNode

åˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹ï¼š

```javascript
const text = document.createTextNode('è¿™æ˜¯æ–‡æœ¬å†…å®¹')

// é€šå¸¸ç›´æ¥ç”¨ textContent
const div = document.createElement('div')
div.textContent = 'è¿™æ˜¯æ–‡æœ¬å†…å®¹' // æ›´ç®€æ´
```

### createDocumentFragment

åˆ›å»ºæ–‡æ¡£ç‰‡æ®µï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰ï¼š

```javascript
// åˆ›å»ºæ–‡æ¡£ç‰‡æ®µ
const fragment = document.createDocumentFragment()

// æ‰¹é‡æ·»åŠ å…ƒç´ åˆ°ç‰‡æ®µ
for (let i = 0; i < 1000; i++) {
  const li = document.createElement('li')
  li.textContent = `é¡¹ç›® ${i}`
  fragment.appendChild(li)
}

// ä¸€æ¬¡æ€§æ’å…¥ DOMï¼ˆåªè§¦å‘ä¸€æ¬¡é‡æ’ï¼‰
document.getElementById('list').appendChild(fragment)

// å¯¹æ¯”ç›´æ¥æ’å…¥ï¼ˆä¼šè§¦å‘å¤šæ¬¡é‡æ’ï¼‰
const list = document.getElementById('list')
for (let i = 0; i < 1000; i++) {
  const li = document.createElement('li')
  li.textContent = `é¡¹ç›® ${i}`
  list.appendChild(li) // æ¯æ¬¡éƒ½è§¦å‘é‡æ’
}
```

### cloneNode

å…‹éš†èŠ‚ç‚¹ï¼š

```javascript
const original = document.getElementById('template')

// æµ…å…‹éš†ï¼ˆåªå…‹éš†èŠ‚ç‚¹æœ¬èº«ï¼‰
const shallow = original.cloneNode(false)

// æ·±å…‹éš†ï¼ˆåŒ…å«æ‰€æœ‰å­èŠ‚ç‚¹ï¼‰
const deep = original.cloneNode(true)

// æ³¨æ„ï¼šå…‹éš†çš„èŠ‚ç‚¹æ²¡æœ‰äº‹ä»¶ç›‘å¬å™¨
// éœ€è¦é‡æ–°æ·»åŠ äº‹ä»¶
```

## æ’å…¥èŠ‚ç‚¹

### appendChild

åœ¨æœ«å°¾æ·»åŠ å­èŠ‚ç‚¹ï¼š

```javascript
const parent = document.getElementById('container')
const child = document.createElement('div')
child.textContent = 'æ–°å­å…ƒç´ '

parent.appendChild(child)

// å¦‚æœèŠ‚ç‚¹å·²å­˜åœ¨äº DOMï¼Œä¼šç§»åŠ¨è€Œä¸æ˜¯å¤åˆ¶
const existing = document.getElementById('existing')
parent.appendChild(existing) // ç§»åŠ¨åˆ° parent æœ«å°¾
```

### insertBefore

åœ¨æŒ‡å®šèŠ‚ç‚¹å‰æ’å…¥ï¼š

```javascript
const parent = document.getElementById('container')
const newNode = document.createElement('div')
const reference = document.getElementById('reference')

// åœ¨ reference å‰æ’å…¥ newNode
parent.insertBefore(newNode, reference)

// å¦‚æœ reference æ˜¯ nullï¼Œæ•ˆæœç­‰åŒäº appendChild
parent.insertBefore(newNode, null)
```

### ç°ä»£æ’å…¥æ–¹æ³•

```javascript
const element = document.getElementById('target')

// prependï¼šåœ¨å¼€å¤´æ’å…¥
element.prepend('æ–‡æœ¬', document.createElement('span'))

// appendï¼šåœ¨æœ«å°¾æ’å…¥
element.append('æ–‡æœ¬', document.createElement('span'))

// beforeï¼šåœ¨å…ƒç´ å‰æ’å…¥
element.before(document.createElement('div'))

// afterï¼šåœ¨å…ƒç´ åæ’å…¥
element.after(document.createElement('div'))

// è¿™äº›æ–¹æ³•æ”¯æŒå¤šä¸ªå‚æ•°ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²
```

### insertAdjacentHTML

æ’å…¥ HTML å­—ç¬¦ä¸²ï¼š

```javascript
const element = document.getElementById('target')

// åœ¨å…ƒç´ å‰
element.insertAdjacentHTML('beforebegin', '<p>ä¹‹å‰</p>')

// åœ¨å…ƒç´ å†…éƒ¨å¼€å¤´
element.insertAdjacentHTML('afterbegin', '<p>å†…éƒ¨å¼€å¤´</p>')

// åœ¨å…ƒç´ å†…éƒ¨æœ«å°¾
element.insertAdjacentHTML('beforeend', '<p>å†…éƒ¨æœ«å°¾</p>')

// åœ¨å…ƒç´ å
element.insertAdjacentHTML('afterend', '<p>ä¹‹å</p>')

// ç»“æœç»“æ„ï¼š
// <p>ä¹‹å‰</p>
// <div id="target">
//   <p>å†…éƒ¨å¼€å¤´</p>
//   åŸæœ‰å†…å®¹
//   <p>å†…éƒ¨æœ«å°¾</p>
// </div>
// <p>ä¹‹å</p>
```

### insertAdjacentElement / insertAdjacentText

```javascript
const element = document.getElementById('target')
const newElement = document.createElement('span')

// æ’å…¥å…ƒç´ 
element.insertAdjacentElement('beforebegin', newElement)

// æ’å…¥æ–‡æœ¬
element.insertAdjacentText('afterend', 'çº¯æ–‡æœ¬')
```

## åˆ é™¤èŠ‚ç‚¹

### removeChild

åˆ é™¤å­èŠ‚ç‚¹ï¼š

```javascript
const parent = document.getElementById('container')
const child = document.getElementById('child')

// åˆ é™¤å¹¶è¿”å›è¢«åˆ é™¤çš„èŠ‚ç‚¹
const removed = parent.removeChild(child)

// å¯ä»¥é‡æ–°æ’å…¥
document.body.appendChild(removed)
```

### remove

ç›´æ¥åˆ é™¤å…ƒç´ ï¼š

```javascript
const element = document.getElementById('target')

// ç›´æ¥åˆ é™¤è‡ªå·±
element.remove()

// ä¸è¿”å›ä»»ä½•å€¼
```

### æ¸…ç©ºæ‰€æœ‰å­ï¿½ï¿½ç‚¹

```javascript
const container = document.getElementById('container')

// æ–¹æ³•1ï¼šinnerHTML
container.innerHTML = ''

// æ–¹æ³•2ï¼šå¾ªç¯åˆ é™¤
while (container.firstChild) {
  container.removeChild(container.firstChild)
}

// æ–¹æ³•3ï¼šreplaceChildrenï¼ˆç°ä»£æ–¹æ³•ï¼‰
container.replaceChildren()

// æ–¹æ³•4ï¼štextContent
container.textContent = ''
```

## æ›¿æ¢èŠ‚ç‚¹

### replaceChild

æ›¿æ¢å­èŠ‚ç‚¹ï¼š

```javascript
const parent = document.getElementById('container')
const oldChild = document.getElementById('old')
const newChild = document.createElement('div')
newChild.textContent = 'æ–°å…ƒç´ '

parent.replaceChild(newChild, oldChild)
```

### replaceWith

æ›¿æ¢è‡ªèº«ï¼š

```javascript
const element = document.getElementById('target')
const newElement = document.createElement('div')

element.replaceWith(newElement)

// æ”¯æŒå¤šä¸ªå‚æ•°
element.replaceWith(
  document.createElement('span'),
  'æ–‡æœ¬',
  document.createElement('div')
)
```

### replaceChildren

æ›¿æ¢æ‰€æœ‰å­èŠ‚ç‚¹ï¼š

```javascript
const container = document.getElementById('container')

// æ¸…ç©ºå¹¶æ·»åŠ æ–°å­èŠ‚ç‚¹
container.replaceChildren(
  document.createElement('div'),
  document.createElement('span')
)

// ä¸ä¼ å‚æ•°åˆ™æ¸…ç©º
container.replaceChildren()
```

## ä¿®æ”¹å±æ€§

### æ ‡å‡†å±æ€§

```javascript
const element = document.getElementById('target')

// ç›´æ¥è®¿é—®æ ‡å‡†å±æ€§
element.id = 'newId'
element.className = 'new-class'
element.title = 'æç¤ºæ–‡æœ¬'

// ç‰¹æ®Šå±æ€§
const link = document.querySelector('a')
link.href = 'https://example.com'
link.target = '_blank'

const img = document.querySelector('img')
img.src = 'image.jpg'
img.alt = 'æè¿°'

const input = document.querySelector('input')
input.value = 'è¾“å…¥å€¼'
input.disabled = true
input.checked = true // checkbox/radio
```

### getAttribute / setAttribute

```javascript
const element = document.getElementById('target')

// è·å–å±æ€§
const value = element.getAttribute('data-id')

// è®¾ç½®å±æ€§
element.setAttribute('data-id', '123')
element.setAttribute('aria-label', 'æ ‡ç­¾')

// ç§»é™¤å±æ€§
element.removeAttribute('data-id')

// æ£€æŸ¥å±æ€§æ˜¯å¦å­˜åœ¨
if (element.hasAttribute('data-id')) {
  // ...
}

// è·å–æ‰€æœ‰å±æ€§
const attrs = element.attributes
for (const attr of attrs) {
  console.log(attr.name, attr.value)
}
```

### dataset

è®¿é—® data-\* å±æ€§ï¼š

```javascript
// <div id="user" data-user-id="123" data-role="admin">

const element = document.getElementById('user')

// è¯»å–ï¼ˆé©¼å³°å‘½åï¼‰
console.log(element.dataset.userId) // "123"
console.log(element.dataset.role) // "admin"

// è®¾ç½®
element.dataset.status = 'active'
// ç»“æœï¼šdata-status="active"

// åˆ é™¤
delete element.dataset.role
```

## ä¿®æ”¹æ ·å¼

### style å±æ€§

```javascript
const element = document.getElementById('target')

// è®¾ç½®å•ä¸ªæ ·å¼
element.style.color = 'red'
element.style.fontSize = '16px'
element.style.backgroundColor = '#f0f0f0'

// å¸¦è¿å­—ç¬¦çš„å±æ€§ç”¨é©¼å³°
element.style.marginTop = '10px'
element.style.borderRadius = '5px'

// è®¾ç½®å¤šä¸ªæ ·å¼
Object.assign(element.style, {
  width: '100px',
  height: '100px',
  border: '1px solid black',
})

// ä½¿ç”¨ cssText ä¸€æ¬¡æ€§è®¾ç½®
element.style.cssText = 'color: red; font-size: 16px;'

// ç§»é™¤æ ·å¼
element.style.color = ''
element.style.removeProperty('font-size')

// è¯»å–è®¡ç®—åçš„æ ·å¼
const computed = getComputedStyle(element)
console.log(computed.width)
console.log(computed.getPropertyValue('font-size'))
```

### classList

æ“ä½œç±»åï¼š

```javascript
const element = document.getElementById('target')

// æ·»åŠ ç±»
element.classList.add('active')
element.classList.add('highlight', 'visible') // å¤šä¸ª

// ç§»é™¤ç±»
element.classList.remove('active')
element.classList.remove('highlight', 'visible')

// åˆ‡æ¢ç±»
element.classList.toggle('active')
element.classList.toggle('hidden', condition) // æ ¹æ®æ¡ä»¶

// æ›¿æ¢ç±»
element.classList.replace('old-class', 'new-class')

// æ£€æŸ¥ç±»æ˜¯å¦å­˜åœ¨
if (element.classList.contains('active')) {
  // ...
}

// è·å–æ‰€æœ‰ç±»
console.log(element.classList.length)
console.log(element.classList[0])
console.log([...element.classList])
```

## ä¿®æ”¹å†…å®¹

### textContent vs innerHTML

```javascript
const element = document.getElementById('target')

// textContentï¼šçº¯æ–‡æœ¬ï¼Œæ›´å®‰å…¨
element.textContent = 'æ–‡æœ¬å†…å®¹'
element.textContent = '<script>alert("xss")</script>'
// æ˜¾ç¤ºåŸæ–‡æœ¬ï¼Œä¸ä¼šæ‰§è¡Œ

// innerHTMLï¼šè§£æ HTML
element.innerHTML = '<strong>ç²—ä½“</strong>'
// âš ï¸ æœ‰ XSS é£é™©ï¼Œä¸è¦æ’å…¥ç”¨æˆ·è¾“å…¥

// innerTextï¼šç±»ä¼¼ textContentï¼Œä½†è€ƒè™‘ CSS
// ï¼ˆéšè—å…ƒç´ çš„æ–‡æœ¬ä¸ä¼šè¿”å›ï¼‰

// è¯»å–å†…å®¹
console.log(element.textContent) // æ‰€æœ‰æ–‡æœ¬
console.log(element.innerHTML) // HTML å­—ç¬¦ä¸²
```

### outerHTML

```javascript
const element = document.getElementById('target')

// è¯»å–åŒ…å«è‡ªèº«çš„ HTML
console.log(element.outerHTML)

// æ›¿æ¢æ•´ä¸ªå…ƒç´ 
element.outerHTML = '<div class="new">æ–°å…ƒç´ </div>'
// element å˜é‡ä»æŒ‡å‘æ—§å…ƒç´ ï¼ˆå·²ä» DOM ç§»é™¤ï¼‰
```

## æ€§èƒ½ä¼˜åŒ–

### æ‰¹é‡æ“ä½œ

```javascript
// ğŸ”¶ ä¸å¥½ï¼šå¤šæ¬¡ DOM æ“ä½œ
const list = document.getElementById('list')
for (let i = 0; i < 100; i++) {
  list.innerHTML += `<li>é¡¹ç›® ${i}</li>` // æ¯æ¬¡éƒ½é‡æ–°è§£æ
}

// âœ… å¥½ï¼šä¸€æ¬¡æ€§è®¾ç½®
let html = ''
for (let i = 0; i < 100; i++) {
  html += `<li>é¡¹ç›® ${i}</li>`
}
list.innerHTML = html

// âœ… æ›´å¥½ï¼šä½¿ç”¨ DocumentFragment
const fragment = document.createDocumentFragment()
for (let i = 0; i < 100; i++) {
  const li = document.createElement('li')
  li.textContent = `é¡¹ç›® ${i}`
  fragment.appendChild(li)
}
list.appendChild(fragment)
```

### ç¦»çº¿æ“ä½œ

```javascript
// å°†å…ƒç´ ä» DOM ç§»é™¤åæ“ä½œï¼Œå†æ’å›
const element = document.getElementById('target')
const parent = element.parentNode
const nextSibling = element.nextSibling

// ç§»é™¤
parent.removeChild(element)

// å¤§é‡æ“ä½œ
for (let i = 0; i < 1000; i++) {
  element.appendChild(document.createElement('div'))
}

// æ’å›
parent.insertBefore(element, nextSibling)
```

### é¿å…å¼ºåˆ¶åŒæ­¥å¸ƒå±€

```javascript
// ğŸ”¶ ä¸å¥½ï¼šè¯»å†™äº¤æ›¿å¯¼è‡´å¤šæ¬¡é‡æ’
for (const el of elements) {
  el.style.width = el.offsetWidth + 10 + 'px' // è¯» -> å†™
}

// âœ… å¥½ï¼šæ‰¹é‡è¯»ï¼Œæ‰¹é‡å†™
const widths = elements.map((el) => el.offsetWidth)
elements.forEach((el, i) => {
  el.style.width = widths[i] + 10 + 'px'
})
```

## å®ç”¨å‡½æ•°

```javascript
// åˆ›å»ºå…ƒç´ çš„å·¥å…·å‡½æ•°
function createElement(tag, options = {}) {
  const element = document.createElement(tag)

  if (options.className) {
    element.className = options.className
  }

  if (options.id) {
    element.id = options.id
  }

  if (options.text) {
    element.textContent = options.text
  }

  if (options.html) {
    element.innerHTML = options.html
  }

  if (options.attrs) {
    for (const [key, value] of Object.entries(options.attrs)) {
      element.setAttribute(key, value)
    }
  }

  if (options.styles) {
    Object.assign(element.style, options.styles)
  }

  if (options.children) {
    options.children.forEach((child) => {
      if (typeof child === 'string') {
        element.appendChild(document.createTextNode(child))
      } else {
        element.appendChild(child)
      }
    })
  }

  return element
}

// ä½¿ç”¨
const card = createElement('div', {
  className: 'card',
  children: [
    createElement('h2', { text: 'æ ‡é¢˜' }),
    createElement('p', { text: 'å†…å®¹' }),
  ],
})
```

## æ€»ç»“

| æ“ä½œ | æ–¹æ³•                     | è¯´æ˜       |
| ---- | ------------------------ | ---------- |
| åˆ›å»º | `createElement`          | åˆ›å»ºå…ƒç´    |
| åˆ›å»º | `createDocumentFragment` | åˆ›å»ºç‰‡æ®µ   |
| æ’å…¥ | `appendChild`            | æœ«å°¾æ·»åŠ    |
| æ’å…¥ | `insertBefore`           | æŒ‡å®šä½ç½®å‰ |
| æ’å…¥ | `append/prepend`         | ç°ä»£æ–¹æ³•   |
| åˆ é™¤ | `removeChild`            | åˆ é™¤å­èŠ‚ç‚¹ |
| åˆ é™¤ | `remove`                 | åˆ é™¤è‡ªèº«   |
| æ›¿æ¢ | `replaceChild`           | æ›¿æ¢å­èŠ‚ç‚¹ |
| æ›¿æ¢ | `replaceWith`            | æ›¿æ¢è‡ªèº«   |

**æ ¸å¿ƒè¦ç‚¹**ï¼š

- ä½¿ç”¨ `DocumentFragment` æ‰¹é‡æ“ä½œ
- `textContent` æ¯” `innerHTML` æ›´å®‰å…¨
- ç”¨ `classList` æ“ä½œç±»å
- é¿å…è¯»å†™äº¤æ›¿å¯¼è‡´çš„é‡æ’
- å¤§é‡æ“ä½œæ—¶è€ƒè™‘ç¦»çº¿æ“ä½œ
