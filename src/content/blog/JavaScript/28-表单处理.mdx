---
title: 'è¡¨å•å¤„ç†'
description: 'æŒæ¡ JavaScript è¡¨å•æ“ä½œï¼Œå­¦ä¼šè¡¨å•éªŒè¯å’Œæ•°æ®æäº¤'
pubDate: 2025-12-03
toc: true
ogImage: true
category: 'JavaScript'
tags: ['JavaScript', 'è¡¨å•', 'éªŒè¯', 'FormData']
---

è¡¨å•æ˜¯ Web åº”ç”¨è·å–ç”¨æˆ·è¾“å…¥çš„ä¸»è¦æ–¹å¼ã€‚æŒæ¡è¡¨å•å¤„ç†æŠ€å·§ï¼Œèƒ½å¤Ÿæ„å»ºæ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚

## ğŸ¯ è·å–è¡¨å•å…ƒç´ 

### è·å–è¡¨å•

```javascript
// é€šè¿‡ ID
const form = document.getElementById('myForm')

// é€šè¿‡ name
const form2 = document.forms['loginForm']

// é€šè¿‡ç´¢å¼•
const form3 = document.forms[0]

// ä½¿ç”¨ querySelector
const form4 = document.querySelector('form.login')
```

### è·å–è¡¨å•å…ƒç´ 

```javascript
const form = document.getElementById('myForm')

// é€šè¿‡ name å±æ€§
const username = form.elements['username']
const password = form.elements['password']

// é€šè¿‡ç´¢å¼•
const firstInput = form.elements[0]

// æ‰€æœ‰è¡¨å•å…ƒç´ 
console.log(form.elements.length)

// ç®€å†™æ–¹å¼
const email = form.email // ç­‰åŒäº form.elements['email']
```

## è¡¨å•å…ƒç´ æ“ä½œ

### æ–‡æœ¬è¾“å…¥

```javascript
const input = document.getElementById('username')

// è·å–/è®¾ç½®å€¼
console.log(input.value)
input.value = 'æ–°å€¼'

// è·å–å±æ€§
input.type // 'text'
input.name // 'username'
input.placeholder // 'è¯·è¾“å…¥ç”¨æˆ·å'
input.maxLength // 20
input.disabled // false
input.readOnly // false

// è®¾ç½®å±æ€§
input.disabled = true
input.readOnly = true

// ç„¦ç‚¹æ§åˆ¶
input.focus()
input.blur()

// é€‰ä¸­æ–‡æœ¬
input.select()
input.setSelectionRange(0, 5) // é€‰ä¸­å‰5ä¸ªå­—ç¬¦
```

### å¤é€‰æ¡†å’Œå•é€‰æ¡†

```javascript
// å¤é€‰æ¡†
const checkbox = document.getElementById('agree')
console.log(checkbox.checked) // true/false
checkbox.checked = true

// è·å–æ‰€æœ‰é€‰ï¿½ï¿½çš„å¤é€‰æ¡†
const checked = document.querySelectorAll('input[name="hobbies"]:checked')
const values = [...checked].map((cb) => cb.value)

// å•é€‰æ¡†
const radios = document.querySelectorAll('input[name="gender"]')
let selectedValue
radios.forEach((radio) => {
  if (radio.checked) {
    selectedValue = radio.value
  }
})

// æˆ–ä½¿ç”¨ :checked
const selected = document.querySelector('input[name="gender"]:checked')
console.log(selected?.value)
```

### ä¸‹æ‹‰é€‰æ‹©

```javascript
const select = document.getElementById('city')

// è·å–é€‰ä¸­å€¼
console.log(select.value)

// è·å–é€‰ä¸­çš„ option
console.log(select.selectedIndex)
console.log(select.options[select.selectedIndex])
console.log(select.selectedOptions) // å¤šé€‰æ—¶

// è®¾ç½®é€‰ä¸­
select.value = 'beijing'
select.selectedIndex = 2

// è·å–æ‰€æœ‰é€‰é¡¹
for (const option of select.options) {
  console.log(option.value, option.text)
}

// åŠ¨æ€æ·»åŠ é€‰é¡¹
const newOption = new Option('ä¸Šæµ·', 'shanghai')
select.add(newOption)
// æˆ–
select.innerHTML += '<option value="shenzhen">æ·±åœ³</option>'

// å¤šé€‰ä¸‹æ‹‰æ¡†
const multiSelect = document.getElementById('skills')
const selectedValues = [...multiSelect.selectedOptions].map((o) => o.value)
```

### æ–‡æœ¬åŸŸ

```javascript
const textarea = document.getElementById('content')

// è·å–/è®¾ç½®å†…å®¹
console.log(textarea.value)
textarea.value = 'æ–°å†…å®¹'

// è¡Œæ•°å’Œåˆ—æ•°
console.log(textarea.rows)
console.log(textarea.cols)

// è‡ªåŠ¨è°ƒæ•´é«˜åº¦
textarea.addEventListener('input', function () {
  this.style.height = 'auto'
  this.style.height = this.scrollHeight + 'px'
})
```

## è¡¨å•äº‹ä»¶

### å¸¸ç”¨äº‹ä»¶

```javascript
const form = document.getElementById('myForm')
const input = document.getElementById('username')

// è¡¨å•æäº¤
form.addEventListener('submit', (e) => {
  e.preventDefault() // é˜»æ­¢é»˜è®¤æäº¤
  console.log('è¡¨å•æäº¤')
})

// è¡¨å•é‡ç½®
form.addEventListener('reset', (e) => {
  console.log('è¡¨å•é‡ç½®')
})

// è¾“å…¥äº‹ä»¶ï¼ˆå®æ—¶è§¦å‘ï¼‰
input.addEventListener('input', (e) => {
  console.log('è¾“å…¥:', e.target.value)
})

// æ”¹å˜äº‹ä»¶ï¼ˆå¤±ç„¦åè§¦å‘ï¼‰
input.addEventListener('change', (e) => {
  console.log('æ”¹å˜:', e.target.value)
})

// è·å¾—ç„¦ç‚¹
input.addEventListener('focus', () => {
  console.log('è·å¾—ç„¦ç‚¹')
})

// å¤±å»ç„¦ç‚¹
input.addEventListener('blur', () => {
  console.log('å¤±å»ç„¦ç‚¹')
})

// æŒ‰é”®äº‹ä»¶
input.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    console.log('æŒ‰ä¸‹å›è½¦')
  }
})
```

### ä½¿ç”¨äº‹ä»¶å§”æ‰˜

```javascript
const form = document.getElementById('myForm')

// ç»Ÿä¸€å¤„ç†æ‰€æœ‰è¾“å…¥
form.addEventListener('input', (e) => {
  const { name, value } = e.target
  console.log(`${name}: ${value}`)

  // å®æ—¶éªŒè¯
  validateField(e.target)
})

// ç»Ÿä¸€å¤„ç†å¤±ç„¦éªŒè¯
form.addEventListener('focusout', (e) => {
  if (e.target.matches('input, textarea, select')) {
    validateField(e.target)
  }
})
```

## è¡¨å•éªŒè¯

### HTML5 åŸç”ŸéªŒè¯

```html
<form id="myForm">
  <!-- å¿…å¡« -->
  <input type="text" name="username" required />

  <!-- é‚®ç®±æ ¼å¼ -->
  <input type="email" name="email" required />

  <!-- æœ€å°/æœ€å¤§é•¿åº¦ -->
  <input type="text" name="password" minlength="6" maxlength="20" />

  <!-- æ•°å­—èŒƒå›´ -->
  <input type="number" name="age" min="0" max="150" />

  <!-- æ­£åˆ™æ¨¡å¼ -->
  <input type="text" name="phone" pattern="1[3-9]\d{9}" />

  <button type="submit">æäº¤</button>
</form>
```

```javascript
const form = document.getElementById('myForm')

form.addEventListener('submit', (e) => {
  // æ£€æŸ¥è¡¨å•æ˜¯å¦æœ‰æ•ˆ
  if (!form.checkValidity()) {
    e.preventDefault()
    // æ˜¾ç¤ºéªŒè¯é”™è¯¯
    form.reportValidity()
  }
})

// æ£€æŸ¥å•ä¸ªå­—æ®µ
const input = form.username
console.log(input.validity.valid) // æ˜¯å¦æœ‰æ•ˆ
console.log(input.validity.valueMissing) // æ˜¯å¦ç¼ºå°‘å€¼
console.log(input.validity.typeMismatch) // ç±»å‹ä¸åŒ¹é…
console.log(input.validity.patternMismatch) // æ¨¡å¼ä¸åŒ¹é…
console.log(input.validity.tooShort) // å¤ªçŸ­
console.log(input.validity.tooLong) // å¤ªé•¿
console.log(input.validity.rangeUnderflow) // å°äºæœ€å°å€¼
console.log(input.validity.rangeOverflow) // å¤§äºæœ€å¤§å€¼

// è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯
input.setCustomValidity('ç”¨æˆ·åå·²å­˜åœ¨')
input.setCustomValidity('') // æ¸…é™¤è‡ªå®šä¹‰é”™è¯¯
```

### è‡ªå®šä¹‰éªŒè¯

```javascript
const validators = {
  required(value) {
    return value.trim() !== '' || 'æ­¤å­—æ®µå¿…å¡«'
  },

  email(value) {
    const regex = /^[\w.-]+@[\w.-]+\.\w+$/
    return regex.test(value) || 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±'
  },

  phone(value) {
    const regex = /^1[3-9]\d{9}$/
    return regex.test(value) || 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·'
  },

  minLength(min) {
    return (value) => value.length >= min || `è‡³å°‘éœ€è¦ ${min} ä¸ªå­—ç¬¦`
  },

  maxLength(max) {
    return (value) => value.length <= max || `æœ€å¤š ${max} ä¸ªå­—ç¬¦`
  },

  pattern(regex, message) {
    return (value) => regex.test(value) || message
  },

  match(fieldName) {
    return (value, form) => {
      const other = form.elements[fieldName].value
      return value === other || 'ä¸¤æ¬¡è¾“å…¥ä¸ä¸€è‡´'
    }
  },
}

// éªŒè¯å‡½æ•°
function validateField(field, form) {
  const rules = field.dataset.validate?.split('|') || []
  const value = field.value

  for (const rule of rules) {
    let validator
    let params

    if (rule.includes(':')) {
      const [name, param] = rule.split(':')
      validator = validators[name]
      params = param
    } else {
      validator = validators[rule]
    }

    if (typeof validator === 'function') {
      const fn = params ? validator(params) : validator
      const result = fn(value, form)

      if (result !== true) {
        return result // è¿”å›é”™è¯¯æ¶ˆæ¯
      }
    }
  }

  return true
}

// ä½¿ç”¨
// <input name="email" data-validate="required|email">
// <input name="password" data-validate="required|minLength:6">
```

### å®Œæ•´éªŒè¯ç¤ºä¾‹

```javascript
class FormValidator {
  constructor(form) {
    this.form = form
    this.errors = {}
    this.setupListeners()
  }

  setupListeners() {
    this.form.addEventListener('submit', (e) => {
      if (!this.validate()) {
        e.preventDefault()
      }
    })

    this.form.addEventListener(
      'blur',
      (e) => {
        if (e.target.matches('input, textarea, select')) {
          this.validateField(e.target)
          this.showFieldError(e.target)
        }
      },
      true
    )
  }

  validate() {
    this.errors = {}

    for (const field of this.form.elements) {
      if (field.name) {
        this.validateField(field)
      }
    }

    this.showErrors()
    return Object.keys(this.errors).length === 0
  }

  validateField(field) {
    const { name, value } = field
    const rules = this.getRules(field)

    delete this.errors[name]

    for (const { validator, message } of rules) {
      if (!validator(value)) {
        this.errors[name] = message
        break
      }
    }
  }

  getRules(field) {
    const rules = []

    if (field.required) {
      rules.push({
        validator: (v) => v.trim() !== '',
        message: 'æ­¤å­—æ®µå¿…å¡«',
      })
    }

    if (field.type === 'email') {
      rules.push({
        validator: (v) => /^[\w.-]+@[\w.-]+\.\w+$/.test(v),
        message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±',
      })
    }

    if (field.minLength > 0) {
      rules.push({
        validator: (v) => v.length >= field.minLength,
        message: `è‡³å°‘ ${field.minLength} ä¸ªå­—ç¬¦`,
      })
    }

    return rules
  }

  showErrors() {
    // æ¸…é™¤æ‰€æœ‰é”™è¯¯
    this.form.querySelectorAll('.error-message').forEach((el) => el.remove())
    this.form.querySelectorAll('.is-invalid').forEach((el) => {
      el.classList.remove('is-invalid')
    })

    // æ˜¾ç¤ºæ–°é”™è¯¯
    for (const [name, message] of Object.entries(this.errors)) {
      const field = this.form.elements[name]
      this.showFieldError(field, message)
    }
  }

  showFieldError(field, message = this.errors[field.name]) {
    field.classList.toggle('is-invalid', !!message)

    const existing = field.parentNode.querySelector('.error-message')
    if (existing) existing.remove()

    if (message) {
      const errorEl = document.createElement('div')
      errorEl.className = 'error-message'
      errorEl.textContent = message
      field.parentNode.appendChild(errorEl)
    }
  }
}

// ä½¿ç”¨
const validator = new FormValidator(document.getElementById('myForm'))
```

## FormData

### åŸºæœ¬ç”¨æ³•

```javascript
const form = document.getElementById('myForm')

// ä»è¡¨å•åˆ›å»º
const formData = new FormData(form)

// è·å–å€¼
formData.get('username')
formData.getAll('hobbies') // å¤šä¸ªåŒåå­—æ®µ

// è®¾ç½®å€¼
formData.set('username', 'æ–°ç”¨æˆ·å')
formData.append('extra', 'é¢å¤–æ•°æ®')

// åˆ é™¤
formData.delete('password')

// æ£€æŸ¥æ˜¯å¦å­˜åœ¨
formData.has('username')

// éå†
for (const [key, value] of formData) {
  console.log(`${key}: ${value}`)
}

// è½¬ä¸ºå¯¹è±¡
const data = Object.fromEntries(formData)

// è½¬ä¸º JSONï¼ˆéœ€å¤„ç†å¤šå€¼æƒ…å†µï¼‰
function formDataToJson(formData) {
  const obj = {}
  for (const [key, value] of formData) {
    if (obj[key]) {
      // å¤„ç†å¤šå€¼
      if (!Array.isArray(obj[key])) {
        obj[key] = [obj[key]]
      }
      obj[key].push(value)
    } else {
      obj[key] = value
    }
  }
  return JSON.stringify(obj)
}
```

### æ–‡ä»¶ä¸Šä¼ 

```javascript
const form = document.getElementById('uploadForm')

form.addEventListener('submit', async (e) => {
  e.preventDefault()

  const formData = new FormData(form)
  const fileInput = form.querySelector('input[type="file"]')

  // æ£€æŸ¥æ–‡ä»¶
  const file = fileInput.files[0]
  if (file) {
    console.log('æ–‡ä»¶å:', file.name)
    console.log('å¤§å°:', file.size)
    console.log('ç±»å‹:', file.type)

    // éªŒè¯æ–‡ä»¶ç±»å‹
    const allowedTypes = ['image/jpeg', 'image/png', 'image/gif']
    if (!allowedTypes.includes(file.type)) {
      alert('åªæ”¯æŒ JPGã€PNGã€GIF å›¾ç‰‡')
      return
    }

    // éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆ2MBï¼‰
    if (file.size > 2 * 1024 * 1024) {
      alert('æ–‡ä»¶ä¸èƒ½è¶…è¿‡ 2MB')
      return
    }
  }

  // ä¸Šä¼ 
  try {
    const response = await fetch('/api/upload', {
      method: 'POST',
      body: formData, // ä¸è¦è®¾ç½® Content-Type
    })
    const result = await response.json()
    console.log('ä¸Šä¼ æˆåŠŸ:', result)
  } catch (error) {
    console.error('ä¸Šä¼ å¤±è´¥:', error)
  }
})
```

### è¿›åº¦ç›‘æ§

```javascript
function uploadWithProgress(url, formData, onProgress) {
  return new Promise((resolve, reject) => {
    const xhr = new XMLHttpRequest()

    xhr.upload.addEventListener('progress', (e) => {
      if (e.lengthComputable) {
        const percent = (e.loaded / e.total) * 100
        onProgress(percent)
      }
    })

    xhr.addEventListener('load', () => {
      if (xhr.status >= 200 && xhr.status < 300) {
        resolve(JSON.parse(xhr.responseText))
      } else {
        reject(new Error(`HTTP ${xhr.status}`))
      }
    })

    xhr.addEventListener('error', () => reject(new Error('ç½‘ç»œé”™è¯¯')))

    xhr.open('POST', url)
    xhr.send(formData)
  })
}

// ä½¿ç”¨
const formData = new FormData(form)
uploadWithProgress('/api/upload', formData, (percent) => {
  progressBar.style.width = `${percent}%`
  progressText.textContent = `${Math.round(percent)}%`
}).then((result) => {
  console.log('å®Œæˆ:', result)
})
```

## å®é™…åº”ç”¨

### è¡¨å•åºåˆ—åŒ–

```javascript
function serializeForm(form) {
  const data = {}

  for (const field of form.elements) {
    if (!field.name || field.disabled) continue

    switch (field.type) {
      case 'checkbox':
        if (field.checked) {
          if (data[field.name]) {
            data[field.name] = [].concat(data[field.name], field.value)
          } else {
            data[field.name] = field.value
          }
        }
        break

      case 'radio':
        if (field.checked) {
          data[field.name] = field.value
        }
        break

      case 'select-multiple':
        data[field.name] = [...field.selectedOptions].map((o) => o.value)
        break

      case 'file':
        // è·³è¿‡æ–‡ä»¶å­—æ®µ
        break

      default:
        data[field.name] = field.value
    }
  }

  return data
}
```

### è¡¨å•çŠ¶æ€ç®¡ç†

```javascript
class FormState {
  constructor(form) {
    this.form = form
    this.initialState = this.getState()
  }

  getState() {
    return serializeForm(this.form)
  }

  isDirty() {
    const current = this.getState()
    return JSON.stringify(current) !== JSON.stringify(this.initialState)
  }

  reset() {
    this.form.reset()
    this.initialState = this.getState()
  }

  save() {
    this.initialState = this.getState()
  }
}

// ä½¿ç”¨
const formState = new FormState(form)

// ç¦»å¼€é¡µé¢å‰æ£€æŸ¥
window.addEventListener('beforeunload', (e) => {
  if (formState.isDirty()) {
    e.preventDefault()
    e.returnValue = ''
  }
})
```

### åŠ¨æ€è¡¨å•å­—æ®µ

```javascript
// åŠ¨æ€æ·»åŠ å­—æ®µ
function addField(form, name, type = 'text') {
  const wrapper = document.createElement('div')
  wrapper.className = 'form-field'
  wrapper.innerHTML = `
    <input type="${type}" name="${name}" placeholder="${name}">
    <button type="button" class="remove-field">åˆ é™¤</button>
  `

  wrapper.querySelector('.remove-field').addEventListener('click', () => {
    wrapper.remove()
  })

  form.insertBefore(wrapper, form.querySelector('[type="submit"]'))
}

// åŠ¨æ€å­—æ®µéªŒè¯
document.getElementById('addFieldBtn').addEventListener('click', () => {
  const fieldCount = form.querySelectorAll('.form-field').length
  addField(form, `field_${fieldCount + 1}`)
})
```

## æ€»ç»“

| äº‹ä»¶     | è§¦å‘æ—¶æœº         |
| -------- | ---------------- |
| `input`  | å€¼æ”¹å˜ï¼ˆå®æ—¶ï¼‰   |
| `change` | å€¼æ”¹å˜ï¼ˆå¤±ç„¦åï¼‰ |
| `focus`  | è·å¾—ç„¦ç‚¹         |
| `blur`   | å¤±å»ç„¦ç‚¹         |
| `submit` | è¡¨å•æäº¤         |
| `reset`  | è¡¨å•é‡ç½®         |

| æ–¹æ³•                        | è¯´æ˜             |
| --------------------------- | ---------------- |
| `form.elements`             | è·å–æ‰€æœ‰è¡¨å•å…ƒç´  |
| `form.checkValidity()`      | æ£€æŸ¥è¡¨å•æ˜¯å¦æœ‰æ•ˆ |
| `form.reportValidity()`     | æ˜¾ç¤ºéªŒè¯é”™è¯¯     |
| `input.setCustomValidity()` | è®¾ç½®è‡ªå®šä¹‰é”™è¯¯   |
| `new FormData(form)`        | åˆ›å»ºè¡¨å•æ•°æ®å¯¹è±¡ |

**æ ¸å¿ƒè¦ç‚¹**ï¼š

- ä½¿ç”¨äº‹ä»¶å§”æ‰˜å¤„ç†è¡¨å•äº‹ä»¶
- ç»“åˆ HTML5 éªŒè¯å’Œè‡ªå®šä¹‰éªŒè¯
- FormData é€‚åˆå¤„ç†åŒ…å«æ–‡ä»¶çš„è¡¨å•
- æ³¨æ„è¡¨å•çŠ¶æ€ç®¡ç†å’Œç”¨æˆ·ä½“éªŒ
- æ–‡ä»¶ä¸Šä¼ éœ€è¦éªŒè¯ç±»å‹å’Œå¤§å°
