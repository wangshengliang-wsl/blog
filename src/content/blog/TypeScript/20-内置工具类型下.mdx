---
title: 'å†…ç½®å·¥å…·ç±»å‹ï¼ˆä¸‹ï¼‰'
description: 'TypeScript å†…ç½®å·¥å…·ç±»å‹è¯¦è§£ï¼šRecordã€Excludeã€Extractã€NonNullableã€ReturnTypeã€Parameters çš„ç”¨æ³•'
pubDate: 2024-02-03
toc: true
ogImage: true
category: 'TypeScript'
tags: ['TypeScript', 'å·¥å…·ç±»å‹', 'Record', 'ReturnType', 'Parameters']
---

ç»§ç»­å­¦ä¹  TypeScript çš„å†…ç½®å·¥å…·ç±»å‹ï¼Œæœ¬ç¯‡ä»‹ç» Recordã€Excludeã€Extractã€NonNullableã€ReturnTypeã€Parameters ç­‰ç±»å‹ã€‚

## Record\<K, V\>

åˆ›å»ºé”®å€¼å¯¹ç±»å‹ï¼š

```typescript
// TypeScript 5.x

// åŸºæœ¬ç”¨æ³•
type StringRecord = Record<string, number>
const scores: StringRecord = {
  math: 90,
  english: 85,
}

// é™å®šé”®
type Role = 'admin' | 'user' | 'guest'
type RolePermissions = Record<Role, string[]>

const permissions: RolePermissions = {
  admin: ['read', 'write', 'delete'],
  user: ['read', 'write'],
  guest: ['read'],
}

// å®ç°åŸç†
type MyRecord<K extends keyof any, V> = {
  [P in K]: V
}
```

## Exclude\<T, U\>

ä»è”åˆç±»å‹ä¸­æ’é™¤æŸäº›ç±»å‹ï¼š

```typescript
type All = 'a' | 'b' | 'c' | 'd'

type WithoutA = Exclude<All, 'a'>
// 'b' | 'c' | 'd'

type WithoutAB = Exclude<All, 'a' | 'b'>
// 'c' | 'd'

// è¿‡æ»¤ null å’Œ undefined
type Values = string | number | null | undefined
type NonNullValues = Exclude<Values, null | undefined>
// string | number

// å®ç°åŸç†
type MyExclude<T, U> = T extends U ? never : T
```

## Extract\<T, U\>

ä»è”åˆç±»å‹ä¸­æå–æŸäº›ç±»å‹ï¼ˆä¸ Exclude ç›¸åï¼‰ï¼š

```typescript
type All = 'a' | 'b' | 'c' | 1 | 2

type OnlyStrings = Extract<All, string>
// 'a' | 'b' | 'c'

type OnlyNumbers = Extract<All, number>
// 1 | 2

// æå–å…¬å…±ç±»å‹
type A = 'a' | 'b' | 'c'
type B = 'b' | 'c' | 'd'
type Common = Extract<A, B>
// 'b' | 'c'

// å®ç°åŸç†
type MyExtract<T, U> = T extends U ? T : never
```

## NonNullable\<T\>

æ’é™¤ null å’Œ undefinedï¼š

```typescript
type MaybeString = string | null | undefined

type DefiniteString = NonNullable<MaybeString>
// string

// å¸¸ç”¨äºå¤„ç†å¯é€‰å€¼
function process(value: string | null | undefined) {
  const definite: NonNullable<typeof value> = value!
  return definite.toUpperCase()
}

// å®ç°åŸç†
type MyNonNullable<T> = T extends null | undefined ? never : T
```

## ReturnType\<T\>

è·å–å‡½æ•°è¿”å›ç±»å‹ï¼š

```typescript
function getUser() {
  return { id: 1, name: 'å¼ ä¸‰', age: 25 }
}

type User = ReturnType<typeof getUser>
// { id: number; name: string; age: number }

// å¼‚æ­¥å‡½æ•°
async function fetchData() {
  return { data: 'hello' }
}

type FetchResult = ReturnType<typeof fetchData>
// Promise<{ data: string }>

// è·å– Promise å†…éƒ¨ç±»å‹
type UnwrappedResult = Awaited<ReturnType<typeof fetchData>>
// { data: string }

// å®ç°åŸç†
type MyReturnType<T extends (...args: any) => any> = T extends (
  ...args: any
) => infer R
  ? R
  : any
```

## Parameters\<T\>

è·å–å‡½æ•°å‚æ•°ç±»å‹ï¼ˆå…ƒç»„ï¼‰ï¼š

```typescript
function greet(name: string, age: number, active: boolean) {
  console.log(name, age, active)
}

type GreetParams = Parameters<typeof greet>
// [name: string, age: number, active: boolean]

// ä½¿ç”¨
const args: GreetParams = ['å¼ ä¸‰', 25, true]
greet(...args)

// è·å–ç‰¹å®šå‚æ•°
type FirstParam = Parameters<typeof greet>[0] // string
type SecondParam = Parameters<typeof greet>[1] // number

// å®ç°åŸç†
type MyParameters<T extends (...args: any) => any> = T extends (
  ...args: infer P
) => any
  ? P
  : never
```

## ConstructorParameters\<T\>

è·å–æ„é€ å‡½æ•°å‚æ•°ç±»å‹ï¼š

```typescript
class User {
  constructor(
    public name: string,
    public age: number
  ) {}
}

type UserConstructorParams = ConstructorParameters<typeof User>
// [name: string, age: number]

// å·¥å‚å‡½æ•°
function createInstance<T extends new (...args: any) => any>(
  Ctor: T,
  ...args: ConstructorParameters<T>
): InstanceType<T> {
  return new Ctor(...args)
}

const user = createInstance(User, 'å¼ ä¸‰', 25)
```

## InstanceType\<T\>

è·å–æ„é€ å‡½æ•°å®ä¾‹ç±»å‹ï¼š

```typescript
class User {
  name = 'å¼ ä¸‰'
  age = 25
}

type UserInstance = InstanceType<typeof User>
// User

// ç»“åˆä½¿ç”¨
function createAndLog<T extends new (...args: any) => any>(
  Ctor: T,
  ...args: ConstructorParameters<T>
): InstanceType<T> {
  const instance = new Ctor(...args)
  console.log('Created:', instance)
  return instance
}
```

## ThisParameterType å’Œ OmitThisParameter

å¤„ç† this å‚æ•°ï¼š

```typescript
function greet(this: { name: string }, greeting: string) {
  return `${greeting}, ${this.name}!`
}

type GreetThis = ThisParameterType<typeof greet>
// { name: string }

type GreetWithoutThis = OmitThisParameter<typeof greet>
// (greeting: string) => string
```

## ç»„åˆåº”ç”¨

```typescript
// API å¤„ç†å™¨ç±»å‹
type ApiHandler<T extends (...args: any) => Promise<any>> = {
  handler: T
  params: Parameters<T>
  result: Awaited<ReturnType<T>>
}

async function fetchUser(id: string) {
  return { id, name: 'å¼ ä¸‰' }
}

type FetchUserHandler = ApiHandler<typeof fetchUser>
// {
//   handler: (id: string) => Promise<{ id: string; name: string }>
//   params: [id: string]
//   result: { id: string; name: string }
// }

// äº‹ä»¶æ˜ å°„
type EventHandlers = {
  click: (x: number, y: number) => void
  input: (value: string) => void
  submit: (data: Record<string, unknown>) => void
}

type EventParams = {
  [K in keyof EventHandlers]: Parameters<EventHandlers[K]>
}
// {
//   click: [x: number, y: number]
//   input: [value: string]
//   submit: [data: Record<string, unknown>]
// }
```

## å¸¸è§é—®é¢˜

### ğŸ™‹ ReturnType å’Œ Awaited æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

```typescript
async function fn() {
  return 'hello'
}

type A = ReturnType<typeof fn> // Promise<string>
type B = Awaited<ReturnType<typeof fn>> // string
```

### ğŸ™‹ å¦‚ä½•è·å–å‡½æ•°çš„ç¬¬ N ä¸ªå‚æ•°ç±»å‹ï¼Ÿ

```typescript
type SecondArg<T extends (...args: any) => any> = Parameters<T>[1]

function example(a: string, b: number, c: boolean) {}

type Second = SecondArg<typeof example> // number
```

## æ€»ç»“

| å·¥å…·ç±»å‹                   | ä½œç”¨                |
| -------------------------- | ------------------- |
| `Record<K, V>`             | åˆ›å»ºé”®å€¼å¯¹ç±»å‹      |
| `Exclude<T, U>`            | ä» T ä¸­æ’é™¤ U       |
| `Extract<T, U>`            | ä» T ä¸­æå– U       |
| `NonNullable<T>`           | æ’é™¤ null/undefined |
| `ReturnType<T>`            | è·å–å‡½æ•°è¿”å›ç±»å‹    |
| `Parameters<T>`            | è·å–å‡½æ•°å‚æ•°ç±»å‹    |
| `ConstructorParameters<T>` | è·å–æ„é€ å‡½æ•°å‚æ•°    |
| `InstanceType<T>`          | è·å–å®ä¾‹ç±»å‹        |

ä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†å­¦ä¹ æ³›å‹çš„å®æˆ˜åº”ç”¨ã€‚
