---
title: 'ç±»åŸºç¡€'
description: 'TypeScript ç±»åŸºç¡€è¯¦è§£ï¼šå±æ€§å£°æ˜ã€æ–¹æ³•å®šä¹‰ã€æ„é€ å‡½æ•°ã€this ç±»å‹çš„ä½¿ç”¨æ–¹æ³•'
pubDate: 2024-01-26
toc: true
ogImage: true
category: 'TypeScript'
tags: ['TypeScript', 'ç±»', 'class', 'æ„é€ å‡½æ•°', 'thisç±»å‹']
---

TypeScript å¯¹ ES6 çš„ç±»è¯­æ³•è¿›è¡Œäº†å¢å¼ºï¼Œæ·»åŠ äº†ç±»å‹æ³¨è§£ã€è®¿é—®ä¿®é¥°ç¬¦ç­‰ç‰¹æ€§ã€‚è¿™ç¯‡æ–‡ç« å°†ä»‹ç» TypeScript ç±»çš„åŸºç¡€ç”¨æ³•ã€‚

## ç±»çš„åŸºæœ¬ç»“æ„

```typescript
// TypeScript 5.x

class Person {
  // å±æ€§å£°æ˜ï¼ˆå¿…é¡»å£°æ˜ç±»å‹ï¼‰
  name: string
  age: number

  // æ„é€ å‡½æ•°
  constructor(name: string, age: number) {
    this.name = name
    this.age = age
  }

  // æ–¹æ³•
  greet(): string {
    return `ä½ å¥½ï¼Œæˆ‘æ˜¯ ${this.name}ï¼Œä»Šå¹´ ${this.age} å²`
  }
}

const person = new Person('å¼ ä¸‰', 25)
console.log(person.greet()) // ä½ å¥½ï¼Œæˆ‘æ˜¯ å¼ ä¸‰ï¼Œä»Šå¹´ 25 å²
```

## å±æ€§å£°æ˜

### å¿…é¡»åˆå§‹åŒ–

TypeScript ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå±æ€§å¿…é¡»åœ¨å£°æ˜æ—¶æˆ–æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–ï¼š

```typescript
class User {
  name: string // âŒ ä¸¥æ ¼æ¨¡å¼ä¸‹æŠ¥é”™ï¼šæœªåˆå§‹åŒ–
  age: number = 0 // âœ… å£°æ˜æ—¶åˆå§‹åŒ–

  constructor(name: string) {
    this.name = name // âœ… æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–
  }
}
```

### å¯é€‰å±æ€§

```typescript
class Config {
  host: string
  port: number
  timeout?: number // å¯é€‰å±æ€§

  constructor(host: string, port: number, timeout?: number) {
    this.host = host
    this.port = port
    this.timeout = timeout
  }
}

const config = new Config('localhost', 3000)
// config.timeout çš„ç±»å‹æ˜¯ number | undefined
```

### åªè¯»å±æ€§

```typescript
class Circle {
  readonly PI = 3.14159
  readonly radius: number

  constructor(radius: number) {
    this.radius = radius // åªèƒ½åœ¨æ„é€ å‡½æ•°ä¸­èµ‹å€¼
  }

  getArea(): number {
    return this.PI * this.radius ** 2
  }
}

const circle = new Circle(10)
// circle.radius = 20;  // âŒ é”™è¯¯ï¼šåªè¯»å±æ€§
```

### å‚æ•°å±æ€§ï¼ˆç®€å†™è¯­æ³•ï¼‰

```typescript
// ä¼ ç»Ÿå†™æ³•
class Person1 {
  name: string
  age: number

  constructor(name: string, age: number) {
    this.name = name
    this.age = age
  }
}

// å‚æ•°å±æ€§ç®€å†™
class Person2 {
  constructor(
    public name: string,
    public age: number
  ) {
    // ä¸éœ€è¦é¢å¤–èµ‹å€¼
  }
}

// ä¸¤è€…æ•ˆæœç›¸åŒ
const p1 = new Person1('å¼ ä¸‰', 25)
const p2 = new Person2('å¼ ä¸‰', 25)
```

## æ–¹æ³•

### å®ä¾‹æ–¹æ³•

```typescript
class Calculator {
  private value: number = 0

  add(n: number): this {
    this.value += n
    return this // è¿”å› this æ”¯æŒé“¾å¼è°ƒç”¨
  }

  subtract(n: number): this {
    this.value -= n
    return this
  }

  multiply(n: number): this {
    this.value *= n
    return this
  }

  getResult(): number {
    return this.value
  }
}

const result = new Calculator().add(10).subtract(3).multiply(2).getResult()
console.log(result) // 14
```

### é™æ€æ–¹æ³•

```typescript
class MathUtils {
  static PI = 3.14159

  static square(n: number): number {
    return n * n
  }

  static cube(n: number): number {
    return n * n * n
  }

  static circleArea(radius: number): number {
    return MathUtils.PI * MathUtils.square(radius)
  }
}

// é€šè¿‡ç±»åè°ƒç”¨
console.log(MathUtils.PI) // 3.14159
console.log(MathUtils.square(4)) // 16
console.log(MathUtils.circleArea(5)) // 78.53975
```

### Getter å’Œ Setter

```typescript
class Temperature {
  private _celsius: number = 0

  // Getter
  get celsius(): number {
    return this._celsius
  }

  // Setter
  set celsius(value: number) {
    if (value < -273.15) {
      throw new Error('æ¸©åº¦ä¸èƒ½ä½äºç»å¯¹é›¶åº¦')
    }
    this._celsius = value
  }

  // è®¡ç®—å±æ€§
  get fahrenheit(): number {
    return this._celsius * 1.8 + 32
  }

  set fahrenheit(value: number) {
    this._celsius = (value - 32) / 1.8
  }
}

const temp = new Temperature()
temp.celsius = 25
console.log(temp.fahrenheit) // 77

temp.fahrenheit = 68
console.log(temp.celsius) // 20
```

## æ„é€ å‡½æ•°

### åŸºæœ¬æ„é€ å‡½æ•°

```typescript
class User {
  name: string
  email: string
  createdAt: Date

  constructor(name: string, email: string) {
    this.name = name
    this.email = email
    this.createdAt = new Date()
  }
}
```

### å¯é€‰å‚æ•°å’Œé»˜è®¤å€¼

```typescript
class HttpClient {
  baseUrl: string
  timeout: number
  headers: Record<string, string>

  constructor(
    baseUrl: string,
    timeout: number = 5000,
    headers: Record<string, string> = {}
  ) {
    this.baseUrl = baseUrl
    this.timeout = timeout
    this.headers = headers
  }
}

const client1 = new HttpClient('https://api.example.com')
const client2 = new HttpClient('https://api.example.com', 10000)
const client3 = new HttpClient('https://api.example.com', 10000, {
  Authorization: 'Bearer token',
})
```

### æ„é€ å‡½æ•°é‡è½½

```typescript
class Point {
  x: number
  y: number

  // é‡è½½ç­¾å
  constructor(x: number, y: number)
  constructor(coords: { x: number; y: number })
  constructor(coords: [number, number])

  // å®ç°ç­¾å
  constructor(
    xOrCoords: number | { x: number; y: number } | [number, number],
    y?: number
  ) {
    if (typeof xOrCoords === 'number') {
      this.x = xOrCoords
      this.y = y!
    } else if (Array.isArray(xOrCoords)) {
      this.x = xOrCoords[0]
      this.y = xOrCoords[1]
    } else {
      this.x = xOrCoords.x
      this.y = xOrCoords.y
    }
  }
}

const p1 = new Point(1, 2)
const p2 = new Point({ x: 1, y: 2 })
const p3 = new Point([1, 2])
```

## this ç±»å‹

### this ä½œä¸ºè¿”å›ç±»å‹

```typescript
class Builder {
  private data: Record<string, unknown> = {}

  set(key: string, value: unknown): this {
    this.data[key] = value
    return this
  }

  build(): Record<string, unknown> {
    return { ...this.data }
  }
}

// ç»§æ‰¿æ—¶ this æŒ‡å‘å­ç±»
class AdvancedBuilder extends Builder {
  setMultiple(entries: [string, unknown][]): this {
    entries.forEach(([key, value]) => this.set(key, value))
    return this
  }
}

const result = new AdvancedBuilder()
  .set('name', 'å¼ ä¸‰')
  .set('age', 25)
  .setMultiple([
    ['city', 'åŒ—äº¬'],
    ['job', 'å·¥ç¨‹å¸ˆ'],
  ])
  .build()
```

### this å‚æ•°

```typescript
class Handler {
  private name = 'Handler'

  // æ˜¾å¼å£°æ˜ this ç±»å‹
  handle(this: Handler, event: string): void {
    console.log(`${this.name} handling ${event}`)
  }
}

const handler = new Handler()
handler.handle('click') // âœ… æ­£ç¡®

// const fn = handler.handle;
// fn('click');  // âŒ é”™è¯¯ï¼šthis ä¸Šä¸‹æ–‡ä¸æ­£ç¡®
```

### this ç±»å‹ä¿æŠ¤

```typescript
class FileSystemObject {
  isFile(): this is FileRep {
    return this instanceof FileRep
  }

  isDirectory(): this is Directory {
    return this instanceof Directory
  }
}

class FileRep extends FileSystemObject {
  content: string = ''
}

class Directory extends FileSystemObject {
  children: FileSystemObject[] = []
}

function process(fso: FileSystemObject) {
  if (fso.isFile()) {
    // fso: FileRep
    console.log(fso.content)
  } else if (fso.isDirectory()) {
    // fso: Directory
    console.log(fso.children.length)
  }
}
```

## ç±»è¡¨è¾¾å¼

```typescript
// ç±»è¡¨è¾¾å¼
const Rectangle = class {
  constructor(
    public width: number,
    public height: number
  ) {}

  getArea(): number {
    return this.width * this.height
  }
}

const rect = new Rectangle(10, 20)
console.log(rect.getArea()) // 200

// å‘½åç±»è¡¨è¾¾å¼
const NamedClass = class MyClass {
  static className = 'MyClass'

  getClassName(): string {
    return MyClass.className
  }
}
```

## ç±»å‹æ¨æ–­

```typescript
// TypeScript ä¼šæ¨æ–­ç±»çš„ç±»å‹
class Auto {
  make = 'Toyota' // æ¨æ–­ä¸º string
  year = 2024 // æ¨æ–­ä¸º number
  features = ['GPS', 'Bluetooth'] // æ¨æ–­ä¸º string[]

  start() {
    return 'Engine started' // è¿”å›ç±»å‹æ¨æ–­ä¸º string
  }
}

// ç±»æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªç±»å‹
function createAuto(): Auto {
  return new Auto()
}

// typeof è·å–ç±»çš„æ„é€ å‡½æ•°ç±»å‹
type AutoConstructor = typeof Auto
// new () => Auto
```

## å¸¸è§é—®é¢˜

### ğŸ™‹ å±æ€§åˆå§‹åŒ–é¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ

```typescript
class Example {
  a = 1 // 1. å±æ€§åˆå§‹åŒ–å™¨
  b: number

  constructor() {
    // 2. æ„é€ å‡½æ•°ä½“
    console.log(this.a) // 1
    this.b = 2
  }
}

// åˆå§‹åŒ–å™¨åœ¨æ„é€ å‡½æ•°ä½“ä¹‹å‰æ‰§è¡Œ
```

### ğŸ™‹ å¦‚ä½•å£°æ˜ä½†ä¸åˆå§‹åŒ–å±æ€§ï¼Ÿ

ä½¿ç”¨ `!` æ–­è¨€ï¼š

```typescript
class Component {
  element!: HTMLElement // å‘Šè¯‰ TS ç¨åä¼šåˆå§‹åŒ–

  mount(container: HTMLElement) {
    this.element = document.createElement('div')
    container.appendChild(this.element)
  }
}
```

### ğŸ™‹ ç±»å±æ€§å¯ä»¥æ˜¯å‡½æ•°å—ï¼Ÿ

å¯ä»¥ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š

```typescript
class Handler {
  // æ–¹æ³•ï¼ˆåŸå‹ä¸Šï¼‰
  method1() {
    console.log('method1')
  }

  // å±æ€§ï¼ˆå®ä¾‹ä¸Šï¼Œæ¯ä¸ªå®ä¾‹ä¸€ä»½ï¼‰
  method2 = () => {
    console.log('method2')
  }

  // ç®­å¤´å‡½æ•°å±æ€§ä¼šè‡ªåŠ¨ç»‘å®š this
}

const h = new Handler()
const fn1 = h.method1 // this ä¼šä¸¢å¤±
const fn2 = h.method2 // this è¢«ç»‘å®š
```

## æ€»ç»“

| ç‰¹æ€§          | è¯­æ³•                              | ç”¨é€”           |
| ------------- | --------------------------------- | -------------- |
| å±æ€§å£°æ˜      | `prop: Type`                      | å£°æ˜å®ä¾‹å±æ€§   |
| å‚æ•°å±æ€§      | `constructor(public prop: Type)`  | ç®€åŒ–å±æ€§å£°æ˜   |
| åªè¯»å±æ€§      | `readonly prop: Type`             | ä¸å¯ä¿®æ”¹çš„å±æ€§ |
| é™æ€æˆå‘˜      | `static prop` / `static method()` | ç±»çº§åˆ«çš„æˆå‘˜   |
| Getter/Setter | `get prop()` / `set prop()`       | è®¡ç®—å±æ€§       |
| this ç±»å‹     | `: this`                          | é“¾å¼è°ƒç”¨æ”¯æŒ   |

ä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†å­¦ä¹ ç±»çš„è®¿é—®ä¿®é¥°ç¬¦ï¼špublicã€privateã€protectedã€readonly å’Œ staticã€‚
