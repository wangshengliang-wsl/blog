---
title: 'è”åˆç±»å‹ä¸äº¤å‰ç±»å‹'
description: 'TypeScript è”åˆç±»å‹ä¸äº¤å‰ç±»å‹è¯¦è§£ï¼šç±»å‹ç»„åˆã€ç±»å‹æ”¶çª„ã€å¯è¾¨è¯†è”åˆä¸å®é™…åº”ç”¨åœºæ™¯'
pubDate: 2024-01-21
toc: true
ogImage: true
category: 'TypeScript'
tags: ['TypeScript', 'è”åˆç±»å‹', 'äº¤å‰ç±»å‹', 'ç±»å‹æ”¶çª„', 'å¯è¾¨è¯†è”åˆ']
---

è”åˆç±»å‹å’Œäº¤å‰ç±»å‹æ˜¯ TypeScript ä¸­ç»„åˆç±»å‹çš„ä¸¤ç§åŸºæœ¬æ–¹å¼ã€‚è”åˆç±»å‹è¡¨ç¤º"æˆ–"çš„å…³ç³»ï¼Œäº¤å‰ç±»å‹è¡¨ç¤º"ä¸”"çš„å…³ç³»ã€‚æŒæ¡è¿™ä¸¤ç§ç±»å‹æ˜¯ç†è§£ TypeScript ç±»å‹ç³»ç»Ÿçš„å…³é”®ã€‚

## è”åˆç±»å‹

è”åˆç±»å‹ä½¿ç”¨ `|` è¡¨ç¤ºä¸€ä¸ªå€¼å¯ä»¥æ˜¯å¤šç§ç±»å‹ä¹‹ä¸€ï¼š

```typescript
// TypeScript 5.x

// åŸºç¡€è”åˆç±»å‹
let value: string | number

value = 'hello' // âœ…
value = 42 // âœ…
// value = true;  // âŒ boolean ä¸åœ¨è”åˆç±»å‹ä¸­

// å‡½æ•°å‚æ•°ä½¿ç”¨è”åˆç±»å‹
function formatId(id: string | number): string {
  return `ID: ${id}`
}

formatId(123) // "ID: 123"
formatId('abc') // "ID: abc"
```

### è”åˆç±»å‹çš„è®¿é—®é™åˆ¶

è”åˆç±»å‹åªèƒ½è®¿é—®æ‰€æœ‰ç±»å‹å…±æœ‰çš„æˆå‘˜ï¼š

```typescript
function getLength(value: string | number) {
  // âŒ é”™è¯¯ï¼šnumber æ²¡æœ‰ length å±æ€§
  // return value.length;

  // âœ… toString() æ˜¯å…±æœ‰æ–¹æ³•
  return value.toString().length
}

// éœ€è¦ç±»å‹æ”¶çª„æ‰èƒ½è®¿é—®ç‰¹å®šç±»å‹çš„æˆå‘˜
function getLength2(value: string | number): number {
  if (typeof value === 'string') {
    return value.length // âœ… è¿™é‡Œ value æ˜¯ string
  }
  return value.toString().length // è¿™é‡Œ value æ˜¯ number
}
```

## ç±»å‹æ”¶çª„

TypeScript é€šè¿‡æ§åˆ¶æµåˆ†æè‡ªåŠ¨æ”¶çª„è”åˆç±»å‹ï¼š

### typeof æ”¶çª„

```typescript
function process(value: string | number | boolean) {
  if (typeof value === 'string') {
    // value: string
    console.log(value.toUpperCase())
  } else if (typeof value === 'number') {
    // value: number
    console.log(value.toFixed(2))
  } else {
    // value: boolean
    console.log(value ? 'yes' : 'no')
  }
}
```

### instanceof æ”¶çª„

```typescript
class Dog {
  bark() {
    console.log('Woof!')
  }
}

class Cat {
  meow() {
    console.log('Meow!')
  }
}

function speak(animal: Dog | Cat) {
  if (animal instanceof Dog) {
    animal.bark() // animal: Dog
  } else {
    animal.meow() // animal: Cat
  }
}
```

### in æ“ä½œç¬¦æ”¶çª„

```typescript
interface Fish {
  swim(): void
}

interface Bird {
  fly(): void
}

function move(animal: Fish | Bird) {
  if ('swim' in animal) {
    animal.swim() // animal: Fish
  } else {
    animal.fly() // animal: Bird
  }
}
```

### çœŸå€¼æ”¶çª„

```typescript
function printMessage(message: string | null | undefined) {
  if (message) {
    // message: stringï¼ˆæ’é™¤äº† nullã€undefined å’Œç©ºå­—ç¬¦ä¸²ï¼‰
    console.log(message.toUpperCase())
  } else {
    console.log('No message')
  }
}
```

## å¯è¾¨è¯†è”åˆ

å¯è¾¨è¯†è”åˆæ˜¯è”åˆç±»å‹çš„å¼ºå¤§æ¨¡å¼ï¼Œé€šè¿‡å…±åŒçš„å­—é¢é‡å±æ€§æ¥åŒºåˆ†ç±»å‹ï¼š

```typescript
// å®šä¹‰å¸¦æœ‰ kind å±æ€§çš„ç±»å‹
interface Circle {
  kind: 'circle'
  radius: number
}

interface Rectangle {
  kind: 'rectangle'
  width: number
  height: number
}

interface Triangle {
  kind: 'triangle'
  base: number
  height: number
}

type Shape = Circle | Rectangle | Triangle

// æ ¹æ® kind å±æ€§æ”¶çª„ç±»å‹
function getArea(shape: Shape): number {
  switch (shape.kind) {
    case 'circle':
      return Math.PI * shape.radius ** 2
    case 'rectangle':
      return shape.width * shape.height
    case 'triangle':
      return (shape.base * shape.height) / 2
  }
}

// ä½¿ç”¨
const circle: Circle = { kind: 'circle', radius: 10 }
console.log(getArea(circle)) // 314.159...
```

### ç©·å°½æ£€æŸ¥

```typescript
type Shape = Circle | Rectangle | Triangle

function getArea(shape: Shape): number {
  switch (shape.kind) {
    case 'circle':
      return Math.PI * shape.radius ** 2
    case 'rectangle':
      return shape.width * shape.height
    case 'triangle':
      return (shape.base * shape.height) / 2
    default:
      // ç©·å°½æ£€æŸ¥ï¼šå¦‚æœæ‰€æœ‰æƒ…å†µéƒ½å¤„ç†äº†ï¼Œshape æ˜¯ never
      const _exhaustiveCheck: never = shape
      return _exhaustiveCheck
  }
}

// å¦‚æœæ–°å¢ç±»å‹ä½†å¿˜è®°å¤„ç†ï¼ŒTypeScript ä¼šæŠ¥é”™
interface Square {
  kind: 'square'
  size: number
}

type Shape2 = Circle | Rectangle | Triangle | Square

function getArea2(shape: Shape2): number {
  switch (shape.kind) {
    case 'circle':
      return Math.PI * shape.radius ** 2
    case 'rectangle':
      return shape.width * shape.height
    case 'triangle':
      return (shape.base * shape.height) / 2
    // ç¼ºå°‘ 'square' çš„å¤„ç†
    default:
      // âŒ é”™è¯¯ï¼šç±»å‹ Square ä¸èƒ½èµ‹å€¼ç»™ç±»å‹ never
      const _exhaustiveCheck: never = shape
      return _exhaustiveCheck
  }
}
```

## äº¤å‰ç±»å‹

äº¤å‰ç±»å‹ä½¿ç”¨ `&` è¡¨ç¤ºä¸€ä¸ªå€¼å¿…é¡»åŒæ—¶å…·æœ‰å¤šç§ç±»å‹çš„ç‰¹æ€§ï¼š

```typescript
interface Person {
  name: string
  age: number
}

interface Employee {
  employeeId: string
  department: string
}

// äº¤å‰ç±»å‹ï¼šåŒæ—¶å…·æœ‰ Person å’Œ Employee çš„æ‰€æœ‰å±æ€§
type Worker = Person & Employee

const worker: Worker = {
  name: 'å¼ ä¸‰',
  age: 30,
  employeeId: 'E001',
  department: 'æŠ€æœ¯éƒ¨',
}
```

### äº¤å‰ç±»å‹çš„åˆå¹¶

```typescript
// åŸºç¡€ç±»å‹äº¤å‰ï¼ˆé€šå¸¸å¾—åˆ° neverï¼‰
type T1 = string & number // neverï¼ˆä¸å­˜åœ¨æ—¢æ˜¯å­—ç¬¦ä¸²åˆæ˜¯æ•°å­—çš„å€¼ï¼‰

// å¯¹è±¡ç±»å‹äº¤å‰ï¼ˆåˆå¹¶å±æ€§ï¼‰
type A = { a: string }
type B = { b: number }
type AB = A & B // { a: string; b: number }

// ç›¸åŒå±æ€§åçš„äº¤å‰
type X = { prop: string }
type Y = { prop: number }
type XY = X & Y // { prop: never }ï¼ˆstring & number = neverï¼‰

// ç›¸åŒå±æ€§åä½†ç±»å‹å…¼å®¹æ—¶å¯ä»¥äº¤å‰
type P = { name: string }
type Q = { name: 'hello' } // å­—é¢é‡ç±»å‹
type PQ = P & Q // { name: "hello" }
```

### å®é™…åº”ç”¨ï¼šæ··å…¥æ¨¡å¼

```typescript
// æ—¶é—´æˆ³æ··å…¥
interface Timestamped {
  createdAt: Date
  updatedAt: Date
}

// ID æ··å…¥
interface Identifiable {
  id: string
}

// åŸºç¡€ç”¨æˆ·
interface BaseUser {
  name: string
  email: string
}

// å®Œæ•´ç”¨æˆ· = åŸºç¡€ç”¨æˆ· + æ··å…¥
type User = BaseUser & Identifiable & Timestamped

const user: User = {
  id: 'u123',
  name: 'å¼ ä¸‰',
  email: 'zhangsan@example.com',
  createdAt: new Date(),
  updatedAt: new Date(),
}
```

### å‡½æ•°äº¤å‰ç±»å‹

```typescript
type LogFn = (message: string) => void
type ErrorFn = (error: Error) => void

// å‡½æ•°äº¤å‰ = å‡½æ•°é‡è½½
type Logger = LogFn & ErrorFn

const logger: Logger = (input: string | Error) => {
  if (typeof input === 'string') {
    console.log(input)
  } else {
    console.error(input.message)
  }
}

logger('info message')
logger(new Error('error message'))
```

## è”åˆç±»å‹ vs äº¤å‰ç±»å‹

```typescript
// è”åˆç±»å‹ï¼šæˆ– (A | B)
// å€¼å¯ä»¥æ˜¯ A æˆ– B å…¶ä¸­ä¹‹ä¸€
type StringOrNumber = string | number
let a: StringOrNumber = 'hello' // âœ…
let b: StringOrNumber = 42 // âœ…

// äº¤å‰ç±»å‹ï¼šä¸” (A & B)
// å€¼å¿…é¡»åŒæ—¶æ»¡è¶³ A å’Œ B
type Named = { name: string }
type Aged = { age: number }
type Person = Named & Aged

const person: Person = {
  name: 'å¼ ä¸‰', // å¿…é¡»æœ‰
  age: 25, // å¿…é¡»æœ‰
}
```

ğŸ¤” ç›´è§‰ä¸Šçš„è¯¯è§£ï¼š

```typescript
// è”åˆç±»å‹æ¥å—çš„å€¼èŒƒå›´æ›´å¹¿ï¼ˆæˆ–ï¼‰
type T1 = { a: string } | { b: number }
const v1: T1 = { a: 'hello' } // âœ… åªéœ€æ»¡è¶³å…¶ä¸€
const v2: T1 = { b: 42 } // âœ…

// äº¤å‰ç±»å‹æ¥å—çš„å€¼èŒƒå›´æ›´çª„ï¼ˆä¸”ï¼‰
type T2 = { a: string } & { b: number }
const v3: T2 = { a: 'hello', b: 42 } // âœ… å¿…é¡»åŒæ—¶æ»¡è¶³
// const v4: T2 = { a: 'hello' };  // âŒ ç¼ºå°‘ b
```

## å®é™…åº”ç”¨åœºæ™¯

### API å“åº”å¤„ç†

```typescript
// API å“åº”å¯èƒ½æ˜¯æˆåŠŸæˆ–å¤±è´¥
interface SuccessResponse<T> {
  status: 'success'
  data: T
}

interface ErrorResponse {
  status: 'error'
  error: string
  code: number
}

type ApiResponse<T> = SuccessResponse<T> | ErrorResponse

function handleResponse<T>(response: ApiResponse<T>) {
  if (response.status === 'success') {
    // response: SuccessResponse<T>
    console.log('Data:', response.data)
  } else {
    // response: ErrorResponse
    console.error(`Error ${response.code}: ${response.error}`)
  }
}
```

### Redux Action æ¨¡å¼

```typescript
interface AddTodoAction {
  type: 'ADD_TODO'
  payload: { text: string }
}

interface RemoveTodoAction {
  type: 'REMOVE_TODO'
  payload: { id: number }
}

interface ToggleTodoAction {
  type: 'TOGGLE_TODO'
  payload: { id: number }
}

type TodoAction = AddTodoAction | RemoveTodoAction | ToggleTodoAction

function todoReducer(state: Todo[], action: TodoAction): Todo[] {
  switch (action.type) {
    case 'ADD_TODO':
      return [
        ...state,
        { id: Date.now(), text: action.payload.text, done: false },
      ]
    case 'REMOVE_TODO':
      return state.filter((todo) => todo.id !== action.payload.id)
    case 'TOGGLE_TODO':
      return state.map((todo) =>
        todo.id === action.payload.id ? { ...todo, done: !todo.done } : todo
      )
  }
}
```

### ç»„åˆé…ç½®

```typescript
// åŸºç¡€é…ç½®
interface BaseConfig {
  name: string
  version: string
}

// å¼€å‘é…ç½®
interface DevConfig {
  debug: true
  hotReload: boolean
}

// ç”Ÿäº§é…ç½®
interface ProdConfig {
  debug: false
  minify: boolean
  sourceMaps: boolean
}

// å®Œæ•´é…ç½® = åŸºç¡€ + (å¼€å‘ | ç”Ÿäº§)
type AppConfig = BaseConfig & (DevConfig | ProdConfig)

const devConfig: AppConfig = {
  name: 'MyApp',
  version: '1.0.0',
  debug: true,
  hotReload: true,
}

const prodConfig: AppConfig = {
  name: 'MyApp',
  version: '1.0.0',
  debug: false,
  minify: true,
  sourceMaps: false,
}
```

## å¸¸è§é—®é¢˜

### ğŸ™‹ è”åˆç±»å‹æ•°ç»„å’Œæ•°ç»„çš„è”åˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

```typescript
// (string | number)[] - æ•°ç»„ï¼Œå…ƒç´ å¯ä»¥æ˜¯ string æˆ– number
const arr1: (string | number)[] = [1, 'hello', 2, 'world']

// string[] | number[] - è¦ä¹ˆå…¨æ˜¯ stringï¼Œè¦ä¹ˆå…¨æ˜¯ number
const arr2: string[] | number[] = [1, 2, 3] // âœ…
const arr3: string[] | number[] = ['a', 'b', 'c'] // âœ…
// const arr4: string[] | number[] = [1, 'a'];  // âŒ æ··åˆä¸è¡Œ
```

### ğŸ™‹ å¦‚ä½•ä»è”åˆç±»å‹ä¸­æå–ç‰¹å®šç±»å‹ï¼Ÿ

```typescript
type Animal = { type: 'dog'; bark(): void } | { type: 'cat'; meow(): void }

// ä½¿ç”¨ Extract æå–
type Dog = Extract<Animal, { type: 'dog' }>
// { type: 'dog'; bark(): void }

// ä½¿ç”¨ Exclude æ’é™¤
type NotDog = Exclude<Animal, { type: 'dog' }>
// { type: 'cat'; meow(): void }
```

### ğŸ™‹ äº¤å‰ç±»å‹é‡åˆ°å†²çªæ€ä¹ˆåŠï¼Ÿ

```typescript
// å±æ€§ç±»å‹å†²çªä¼šå¾—åˆ° never
type A = { x: string }
type B = { x: number }
type C = A & B // { x: never }

// è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ Omit æ’é™¤å†²çªå±æ€§
type D = Omit<A, 'x'> & B // { x: number }
```

## æ€»ç»“

| ç±»å‹       | è¯­æ³•                   | å«ä¹‰                     | é€‚ç”¨åœºæ™¯               |
| ---------- | ---------------------- | ------------------------ | ---------------------- |
| è”åˆç±»å‹   | `A \| B`               | å€¼æ˜¯ A æˆ– B ä¹‹ä¸€         | å¤šç§å¯èƒ½çš„è¾“å…¥ã€çŠ¶æ€æœº |
| äº¤å‰ç±»å‹   | `A & B`                | å€¼åŒæ—¶å…·æœ‰ A å’Œ B çš„ç‰¹æ€§ | æ··å…¥ã€ç»„åˆå¯¹è±¡         |
| å¯è¾¨è¯†è”åˆ | å¸¦å…±åŒå­—é¢é‡å±æ€§çš„è”åˆ | å¯é çš„ç±»å‹æ”¶çª„           | Redux Actionã€API å“åº” |

ä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†å­¦ä¹ å­—é¢é‡ç±»å‹ä¸ç±»å‹åˆ«åï¼Œæ·±å…¥ç†è§£ TypeScript çš„ç±»å‹å®šä¹‰æ–¹å¼ã€‚
