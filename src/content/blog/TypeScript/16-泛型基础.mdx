---
title: 'æ³›å‹åŸºç¡€'
description: 'TypeScript æ³›å‹åŸºç¡€è¯¦è§£ï¼šæ³›å‹æ¦‚å¿µã€ç±»å‹å˜é‡ã€æ³›å‹å‡½æ•°çš„ä½¿ç”¨æ–¹æ³•ä¸æœ€ä½³å®è·µ'
pubDate: 2024-01-30
toc: true
ogImage: true
category: 'TypeScript'
tags: ['TypeScript', 'æ³›å‹', 'Generics', 'ç±»å‹å˜é‡', 'ç±»å‹å‚æ•°']
---

æ³›å‹æ˜¯ TypeScript ä¸­æœ€å¼ºå¤§çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œå®ƒå…è®¸æˆ‘ä»¬åˆ›å»ºå¯é‡ç”¨çš„ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶å¯ä»¥æ”¯æŒå¤šç§ç±»å‹è€Œä¸æ˜¯å•ä¸€ç±»å‹ã€‚

## ä¸ºä»€ä¹ˆéœ€è¦æ³›å‹

çœ‹ä¸€ä¸ªæ²¡æœ‰æ³›å‹çš„é—®é¢˜ï¼š

```typescript
// TypeScript 5.x

// é—®é¢˜ï¼šå¦‚ä½•å†™ä¸€ä¸ªé€šç”¨çš„ identity å‡½æ•°ï¼Ÿ

// æ–¹æ¡ˆ1ï¼šå…·ä½“ç±»å‹ - ä¸é€šç”¨
function identityNumber(arg: number): number {
  return arg
}

function identityString(arg: string): string {
  return arg
}

// æ–¹æ¡ˆ2ï¼šany - ä¸¢å¤±ç±»å‹ä¿¡æ¯
function identityAny(arg: any): any {
  return arg
}

const result = identityAny('hello')
// result æ˜¯ anyï¼Œä¸¢å¤±äº† string ç±»å‹

// æ–¹æ¡ˆ3ï¼šæ³›å‹ - å®Œç¾è§£å†³
function identity<T>(arg: T): T {
  return arg
}

const str = identity<string>('hello') // string
const num = identity<number>(42) // number
const auto = identity('hello') // è‡ªåŠ¨æ¨æ–­ä¸º string
```

## æ³›å‹å‡½æ•°

### åŸºæœ¬è¯­æ³•

```typescript
// å•ä¸ªç±»å‹å‚æ•°
function identity<T>(arg: T): T {
  return arg
}

// å¤šä¸ªç±»å‹å‚æ•°
function pair<T, U>(first: T, second: U): [T, U] {
  return [first, second]
}

const p = pair<string, number>('hello', 42) // [string, number]
const p2 = pair('hello', 42) // è‡ªåŠ¨æ¨æ–­

// ä½¿ç”¨ç±»å‹å‚æ•°çº¦æŸè¿”å›å€¼
function map<T, U>(arr: T[], fn: (item: T) => U): U[] {
  return arr.map(fn)
}

const numbers = [1, 2, 3]
const strings = map(numbers, (n) => n.toString()) // string[]
```

### ç®­å¤´å‡½æ•°æ³›å‹

```typescript
// æ™®é€šç®­å¤´å‡½æ•°
const identity1 = <T>(arg: T): T => arg

// åœ¨ .tsx æ–‡ä»¶ä¸­ï¼Œéœ€è¦åŠ é€—å·æˆ– extends é¿å…ä¸ JSX å†²çª
const identity2 = <T>(arg: T): T => arg
const identity3 = <T extends unknown>(arg: T): T => arg

// å¤šå‚æ•°
const swap = <T, U>(tuple: [T, U]): [U, T] => {
  return [tuple[1], tuple[0]]
}

const swapped = swap(['hello', 42]) // [number, string]
```

### ç±»å‹å‚æ•°é»˜è®¤å€¼

```typescript
// é»˜è®¤ç±»å‹å‚æ•°
function createArray<T = string>(length: number, value: T): T[] {
  return Array(length).fill(value)
}

const strings = createArray(3, 'hello') // string[]
const numbers = createArray<number>(3, 42) // number[]
const defaultStrings = createArray(3, 'hi') // string[]

// å¤šä¸ªé»˜è®¤å€¼
interface Options<T = string, U = number> {
  value: T
  count: U
}

const opt1: Options = { value: 'hello', count: 1 } // ä½¿ç”¨é»˜è®¤ç±»å‹
const opt2: Options<boolean> = { value: true, count: 1 } // T = boolean, U = number
const opt3: Options<boolean, string> = { value: true, count: 'one' }
```

## ç±»å‹å˜é‡å‘½åçº¦å®š

å¸¸è§çš„ç±»å‹å˜é‡åï¼š

```typescript
// T - Typeï¼Œæœ€å¸¸ç”¨
function identity<T>(arg: T): T

// K, V - Key, Valueï¼Œç”¨äºé”®å€¼å¯¹
function getProperty<K, V>(obj: Record<K, V>, key: K): V

// E - Elementï¼Œç”¨äºå…ƒç´ 
function first<E>(arr: E[]): E | undefined

// R - Returnï¼Œç”¨äºè¿”å›å€¼
function wrap<T, R>(fn: (arg: T) => R): (arg: T) => R

// P - Props/Parameters
type ComponentProps<P> = { props: P }

// æè¿°æ€§å‘½åï¼ˆå¤æ‚åœºæ™¯ï¼‰
function transform<TInput, TOutput>(
  input: TInput,
  fn: (value: TInput) => TOutput
): TOutput
```

## ä½¿ç”¨ç±»å‹å‚æ•°çš„æ•°ç»„

```typescript
function loggingIdentity<T>(arg: T[]): T[] {
  console.log(arg.length) // æ•°ç»„æœ‰ length å±æ€§
  return arg
}

// ç­‰ä»·å†™æ³•
function loggingIdentity2<T>(arg: Array<T>): Array<T> {
  console.log(arg.length)
  return arg
}

// å®é™…åº”ç”¨
function first<T>(arr: T[]): T | undefined {
  return arr[0]
}

function last<T>(arr: T[]): T | undefined {
  return arr[arr.length - 1]
}

function filter<T>(arr: T[], predicate: (item: T) => boolean): T[] {
  return arr.filter(predicate)
}

const nums = [1, 2, 3, 4, 5]
const evens = filter(nums, (n) => n % 2 === 0) // number[]
```

## æ³›å‹å‡½æ•°ç±»å‹

```typescript
// å‡½æ•°ç±»å‹è¡¨è¾¾å¼
type IdentityFn = <T>(arg: T) => T

const identity: IdentityFn = (arg) => arg

// å¸¦è°ƒç”¨ç­¾åçš„å¯¹è±¡ç±»å‹
type IdentityObj = {
  <T>(arg: T): T
}

// ç±»å‹å‚æ•°åœ¨å¤–å±‚
type GenericIdentityFn<T> = (arg: T) => T

const stringIdentity: GenericIdentityFn<string> = (arg) => arg
const numberIdentity: GenericIdentityFn<number> = (arg) => arg
```

## å¸¸è§æ³›å‹å‡½æ•°æ¨¡å¼

### è·å–å¯¹è±¡å±æ€§

```typescript
function getProperty<T, K extends keyof T>(obj: T, key: K): T[K] {
  return obj[key]
}

const user = {
  name: 'å¼ ä¸‰',
  age: 25,
  email: 'test@test.com',
}

const name = getProperty(user, 'name') // string
const age = getProperty(user, 'age') // number
// getProperty(user, 'invalid');  // âŒ é”™è¯¯
```

### åˆå¹¶å¯¹è±¡

```typescript
function merge<T, U>(obj1: T, obj2: U): T & U {
  return { ...obj1, ...obj2 }
}

const merged = merge({ name: 'å¼ ä¸‰' }, { age: 25 })
// { name: string; age: number }
console.log(merged.name, merged.age)
```

### åŒ…è£…å‡½æ•°

```typescript
function withLogging<T extends (...args: any[]) => any>(fn: T): T {
  return ((...args: Parameters<T>): ReturnType<T> => {
    console.log('Calling function with:', args)
    const result = fn(...args)
    console.log('Result:', result)
    return result
  }) as T
}

const add = (a: number, b: number) => a + b
const loggedAdd = withLogging(add)

loggedAdd(1, 2) // è¾“å‡ºæ—¥å¿—ï¼Œè¿”å› 3
```

### åˆ›å»ºå·¥å‚å‡½æ•°

```typescript
function createFactory<T>(type: new () => T): () => T {
  return () => new type()
}

class User {
  name = 'default'
}

const createUser = createFactory(User)
const user = createUser() // User
```

## ç±»å‹æ¨æ–­

TypeScript å¯ä»¥ä»å‚æ•°æ¨æ–­ç±»å‹å‚æ•°ï¼š

```typescript
function identity<T>(arg: T): T {
  return arg
}

// æ˜¾å¼æŒ‡å®š
const s1 = identity<string>('hello')

// è‡ªåŠ¨æ¨æ–­
const s2 = identity('hello') // T æ¨æ–­ä¸º string
const n1 = identity(42) // T æ¨æ–­ä¸º number

// å¤æ‚æ¨æ–­
function firstElement<T>(arr: T[]): T | undefined {
  return arr[0]
}

const first1 = firstElement(['a', 'b', 'c']) // string | undefined
const first2 = firstElement([1, 2, 3]) // number | undefined

// å­—é¢é‡æ¨æ–­
const first3 = firstElement(['a', 'b'] as const)
// "a" | "b" | undefined
```

## å¸¸è§é—®é¢˜

### ğŸ™‹ æ³›å‹å’Œ any æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

```typescript
// anyï¼šä¸¢å¤±ç±»å‹ä¿¡æ¯
function anyIdentity(arg: any): any {
  return arg
}
const a = anyIdentity('hello')
a.toUpperCase() // anyï¼Œæ— ç±»å‹æ£€æŸ¥

// æ³›å‹ï¼šä¿ç•™ç±»å‹ä¿¡æ¯
function genericIdentity<T>(arg: T): T {
  return arg
}
const g = genericIdentity('hello')
g.toUpperCase() // stringï¼Œæœ‰ç±»å‹æ£€æŸ¥
```

### ğŸ™‹ ä½•æ—¶ä½¿ç”¨æ³›å‹ï¼Ÿ

- å‡½æ•°å‚æ•°å’Œè¿”å›å€¼ç±»å‹æœ‰å…³è”
- éœ€è¦å¤„ç†å¤šç§ç±»å‹
- æƒ³ä¿æŒç±»å‹å®‰å…¨çš„åŒæ—¶å¤ç”¨ä»£ç 

```typescript
// âœ… é€‚åˆæ³›å‹ï¼šè¾“å…¥è¾“å‡ºç±»å‹å…³è”
function identity<T>(arg: T): T {
  return arg
}

// âŒ ä¸éœ€è¦æ³›å‹ï¼šæ²¡æœ‰ç±»å‹å…³è”
function greet(name: string): void {
  console.log(`Hello, ${name}`)
}
```

### ğŸ™‹ å¤šä¸ªç±»å‹å‚æ•°åº”è¯¥ä»€ä¹ˆé¡ºåºï¼Ÿ

æŒ‰ä½¿ç”¨é¢‘ç‡æ’åºï¼Œæœ€å¸¸éœ€è¦æŒ‡å®šçš„æ”¾å‰é¢ï¼š

```typescript
// å¥½ï¼šå¸¸ç”¨çš„ T åœ¨å‰
function create<T, Options = {}>(value: T, options?: Options): T

// ä½¿ç”¨æ—¶é€šå¸¸åªéœ€æŒ‡å®š T
create<string>('hello')
create<string, { debug: boolean }>('hello', { debug: true })
```

## æ€»ç»“

| ç‰¹æ€§       | è¯­æ³•               | ç”¨é€”           |
| ---------- | ------------------ | -------------- |
| ç±»å‹å‚æ•°   | `<T>`              | å®šä¹‰æ³›å‹å ä½ç¬¦ |
| å¤šç±»å‹å‚æ•° | `<T, U>`           | å¤šä¸ªç±»å‹å…³è”   |
| é»˜è®¤ç±»å‹   | `<T = string>`     | æä¾›é»˜è®¤å€¼     |
| ç±»å‹æ¨æ–­   | è‡ªåŠ¨               | å‡å°‘æ˜¾å¼æ ‡æ³¨   |
| å‡½æ•°ç±»å‹   | `<T>(arg: T) => T` | æ³›å‹å‡½æ•°ç­¾å   |

ä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†å­¦ä¹ æ³›å‹æ¥å£ä¸æ³›å‹ç±»ï¼Œäº†è§£å¦‚ä½•åœ¨æ›´å¤æ‚çš„åœºæ™¯ä¸­ä½¿ç”¨æ³›å‹ã€‚
