---
title: 'å£°æ˜æ–‡ä»¶åŸºç¡€'
description: 'TypeScript å£°æ˜æ–‡ä»¶åŸºç¡€ï¼š.d.ts æ–‡ä»¶ã€declare å…³é”®å­—ã€@types åŒ…çš„ä½¿ç”¨æ–¹æ³•'
pubDate: 2024-02-14
toc: true
ogImage: true
category: 'TypeScript'
tags: ['TypeScript', 'å£°æ˜æ–‡ä»¶', '.d.ts', 'declare', '@types']
---

å£°æ˜æ–‡ä»¶ï¼ˆDeclaration Filesï¼‰ä¸º JavaScript ä»£ç æä¾›ç±»å‹ä¿¡æ¯ï¼Œè®© TypeScript èƒ½å¤Ÿç†è§£ JS åº“çš„ APIã€‚

## ä»€ä¹ˆæ˜¯å£°æ˜æ–‡ä»¶

å£°æ˜æ–‡ä»¶ä»¥ `.d.ts` ä¸ºæ‰©å±•åï¼ŒåªåŒ…å«ç±»å‹å£°æ˜ï¼Œä¸åŒ…å«å®ç°ï¼š

```typescript
// TypeScript 5.x

// utils.d.ts - å£°æ˜æ–‡ä»¶
declare function greet(name: string): string
declare const VERSION: string
declare class Calculator {
  add(a: number, b: number): number
  subtract(a: number, b: number): number
}

// å¯¹åº”çš„ JavaScript å®ç° (utils.js)
function greet(name) {
  return `Hello, ${name}!`
}
const VERSION = '1.0.0'
class Calculator {
  add(a, b) {
    return a + b
  }
  subtract(a, b) {
    return a - b
  }
}
```

## declare å…³é”®å­—

`declare` å‘Šè¯‰ TypeScript æŸä¸ªå€¼å­˜åœ¨äºè¿è¡Œæ—¶ï¼š

```typescript
// å£°æ˜å˜é‡
declare const API_URL: string
declare let debug: boolean
declare var window: Window

// å£°æ˜å‡½æ•°
declare function fetch(url: string): Promise<Response>
declare function log(message: string): void

// å£°æ˜ç±»
declare class User {
  constructor(name: string)
  name: string
  greet(): string
}

// å£°æ˜æšä¸¾
declare enum Direction {
  Up,
  Down,
  Left,
  Right,
}

// å£°æ˜å‘½åç©ºé—´
declare namespace MyLib {
  function init(): void
  const version: string
}
```

## å¸¸è§å£°æ˜æ¨¡å¼

### å…¨å±€å˜é‡

```typescript
// global.d.ts

// ç®€å•ç±»å‹
declare const API_KEY: string
declare let isLoggedIn: boolean

// å¯¹è±¡ç±»å‹
declare const config: {
  apiUrl: string
  timeout: number
  debug: boolean
}

// å‡½æ•°ç±»å‹
declare function $(selector: string): HTMLElement | null
declare function ajax(url: string, options?: AjaxOptions): Promise<unknown>

interface AjaxOptions {
  method?: 'GET' | 'POST' | 'PUT' | 'DELETE'
  data?: unknown
  headers?: Record<string, string>
}
```

### å…¨å±€å‡½æ•°

```typescript
// å‡½æ•°å£°æ˜
declare function require(module: string): unknown
declare function define(deps: string[], factory: Function): void

// å‡½æ•°é‡è½½
declare function createElement(tag: 'div'): HTMLDivElement
declare function createElement(tag: 'span'): HTMLSpanElement
declare function createElement(tag: 'a'): HTMLAnchorElement
declare function createElement(tag: string): HTMLElement
```

### å…¨å±€ç±»

```typescript
// ç±»å£°æ˜
declare class Observable<T> {
  constructor(subscribe: (observer: Observer<T>) => void)
  subscribe(observer: Observer<T>): Subscription
  pipe<R>(...operators: OperatorFunction<T, R>[]): Observable<R>
}

interface Observer<T> {
  next(value: T): void
  error(err: unknown): void
  complete(): void
}

interface Subscription {
  unsubscribe(): void
}

type OperatorFunction<T, R> = (source: Observable<T>) => Observable<R>
```

### å…¨å±€æ¥å£æ‰©å±•

```typescript
// æ‰©å±• Window
interface Window {
  myApp: {
    version: string
    init(): void
  }
}

// æ‰©å±• Array
interface Array<T> {
  first(): T | undefined
  last(): T | undefined
}

// æ‰©å±• String
interface String {
  capitalize(): string
  truncate(length: number): string
}

// ä½¿ç”¨
window.myApp.init()
;[1, 2, 3].first()
'hello'.capitalize()
```

## æ¨¡å—å£°æ˜

### å£°æ˜å¤–éƒ¨æ¨¡å—

```typescript
// å£°æ˜æ¨¡å—
declare module 'my-library' {
  export function init(options: Options): void
  export function destroy(): void

  export interface Options {
    debug?: boolean
    logLevel?: 'info' | 'warn' | 'error'
  }

  export const version: string

  export default class MyLibrary {
    constructor(options?: Options)
    start(): void
    stop(): void
  }
}

// ä½¿ç”¨
import MyLibrary, { init, Options } from 'my-library'

const lib = new MyLibrary({ debug: true })
lib.start()
```

### å£°æ˜é JS æ¨¡å—

```typescript
// å£°æ˜ CSS æ¨¡å—
declare module '*.css' {
  const styles: { [className: string]: string }
  export default styles
}

// å£°æ˜ SCSS æ¨¡å—
declare module '*.scss' {
  const styles: { [className: string]: string }
  export default styles
}

// å£°æ˜å›¾ç‰‡æ¨¡å—
declare module '*.png' {
  const src: string
  export default src
}

declare module '*.jpg' {
  const src: string
  export default src
}

declare module '*.svg' {
  const content: string
  export default content
}

// å£°æ˜ JSON æ¨¡å—
declare module '*.json' {
  const value: unknown
  export default value
}

// ä½¿ç”¨
import styles from './app.css'
import logo from './logo.png'
import config from './config.json'
```

### æ¨¡å—æ‰©å±•

```typescript
// æ‰©å±•ç°æœ‰æ¨¡å—
// express-extension.d.ts
import 'express'

declare module 'express' {
  interface Request {
    user?: {
      id: string
      name: string
      role: 'admin' | 'user'
    }
    session?: {
      id: string
      data: Record<string, unknown>
    }
  }

  interface Response {
    success(data: unknown): void
    error(code: number, message: string): void
  }
}

// vue-extension.d.ts
import 'vue'

declare module 'vue' {
  interface ComponentCustomProperties {
    $http: typeof import('axios').default
    $store: import('vuex').Store<unknown>
  }
}
```

## @types åŒ…

### ä½¿ç”¨ DefinitelyTyped

```bash
# å®‰è£…ç±»å‹åŒ…
npm install --save-dev @types/node
npm install --save-dev @types/lodash
npm install --save-dev @types/express
npm install --save-dev @types/react
```

```typescript
// å®‰è£…åè‡ªåŠ¨ç”Ÿæ•ˆ
import express from 'express'
import _ from 'lodash'

const app = express() // ç±»å‹å®Œæ•´
_.map([1, 2, 3], (n) => n * 2) // ç±»å‹å®‰å…¨
```

### ç±»å‹åŒ…ç»“æ„

```
node_modules/@types/lodash/
â”œâ”€â”€ index.d.ts       # ä¸»å£°æ˜æ–‡ä»¶
â”œâ”€â”€ common/          # å…¬å…±å£°æ˜
â”œâ”€â”€ fp/              # fp ç‰ˆæœ¬å£°æ˜
â””â”€â”€ package.json     # åŒ…ä¿¡æ¯
```

### æŸ¥æ‰¾ç±»å‹å£°æ˜

TypeScript æŒ‰ä»¥ä¸‹é¡ºåºæŸ¥æ‰¾ç±»å‹ï¼š

1. æœ¬åœ° `.d.ts` æ–‡ä»¶
2. `package.json` çš„ `types` æˆ– `typings` å­—æ®µ
3. `node_modules/@types/`
4. `tsconfig.json` çš„ `typeRoots`

```typescript
// tsconfig.json
{
  "compilerOptions": {
    // è‡ªå®šä¹‰ç±»å‹æ ¹ç›®å½•
    "typeRoots": [
      "./types",
      "./node_modules/@types"
    ],
    // åªåŒ…å«ç‰¹å®šç±»å‹
    "types": ["node", "lodash", "express"]
  }
}
```

## ç¼–å†™å£°æ˜æ–‡ä»¶

### ä¸ºè‡ªå·±çš„åº“ç¼–å†™

```typescript
// my-utils/index.d.ts

/**
 * æ ¼å¼åŒ–æ—¥æœŸ
 * @param date æ—¥æœŸå¯¹è±¡æˆ–æ—¶é—´æˆ³
 * @param format æ ¼å¼å­—ç¬¦ä¸²
 */
export function formatDate(date: Date | number, format?: string): string

/**
 * æ·±æ‹·è´å¯¹è±¡
 * @param obj è¦æ‹·è´çš„å¯¹è±¡
 */
export function deepClone<T>(obj: T): T

/**
 * é˜²æŠ–å‡½æ•°
 * @param fn è¦é˜²æŠ–çš„å‡½æ•°
 * @param delay å»¶è¿Ÿæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
 */
export function debounce<T extends (...args: any[]) => any>(
  fn: T,
  delay: number
): T

/**
 * èŠ‚æµå‡½æ•°
 * @param fn è¦èŠ‚æµçš„å‡½æ•°
 * @param interval é—´éš”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
 */
export function throttle<T extends (...args: any[]) => any>(
  fn: T,
  interval: number
): T

export interface Config {
  baseUrl: string
  timeout: number
  headers?: Record<string, string>
}

export class HttpClient {
  constructor(config: Config)
  get<T>(url: string): Promise<T>
  post<T>(url: string, data: unknown): Promise<T>
}
```

### package.json é…ç½®

```json
{
  "name": "my-utils",
  "version": "1.0.0",
  "main": "dist/index.js",
  "types": "dist/index.d.ts",
  "files": ["dist"]
}
```

## æœ€ä½³å®è·µ

### ä½¿ç”¨ JSDoc æ³¨é‡Š

````typescript
/**
 * ç”¨æˆ·ä¿¡æ¯
 */
export interface User {
  /** ç”¨æˆ· ID */
  id: number
  /** ç”¨æˆ·å */
  name: string
  /** é‚®ç®±åœ°å€ */
  email: string
  /**
   * ç”¨æˆ·è§’è‰²
   * @default 'user'
   */
  role?: 'admin' | 'user'
}

/**
 * åˆ›å»ºæ–°ç”¨æˆ·
 * @param data - ç”¨æˆ·æ•°æ®
 * @returns åˆ›å»ºçš„ç”¨æˆ·å¯¹è±¡
 * @throws {Error} å¦‚æœæ•°æ®æ— æ•ˆ
 * @example
 * ```ts
 * const user = createUser({ name: 'å¼ ä¸‰', email: 'test@test.com' })
 * ```
 */
export function createUser(data: Omit<User, 'id'>): User
````

### å¯¼å‡ºç±»å‹

```typescript
// å¯¼å‡ºæ‰€æœ‰ç±»å‹ä¾›ä½¿ç”¨è€…ä½¿ç”¨
export type { User, CreateUserData, UpdateUserData }
export type { Config, Options }

// å¯¼å‡ºç±»å‹å’Œå€¼
export { UserService }
export type { UserServiceOptions }
```

## å¸¸è§é—®é¢˜

### ğŸ™‹ æ‰¾ä¸åˆ°æ¨¡å—çš„ç±»å‹å£°æ˜ï¼Ÿ

```typescript
// æ–¹æ³• 1ï¼šå®‰è£… @types åŒ…
npm install --save-dev @types/library-name

// æ–¹æ³• 2ï¼šåˆ›å»ºæœ¬åœ°å£°æ˜
// types/library-name.d.ts
declare module 'library-name' {
  export function doSomething(): void
}

// æ–¹æ³• 3ï¼šä½¿ç”¨ anyï¼ˆä¸æ¨èï¼‰
// types/library-name.d.ts
declare module 'library-name'
```

### ğŸ™‹ å¦‚ä½•å£°æ˜å…¨å±€å˜é‡ï¼Ÿ

```typescript
// global.d.ts

// æ–¹æ³• 1ï¼šç›´æ¥å£°æ˜
declare const MY_GLOBAL: string

// æ–¹æ³• 2ï¼šæ‰©å±• Window
interface Window {
  MY_GLOBAL: string
}

// æ–¹æ³• 3ï¼šåœ¨æ¨¡å—ä¸­å£°æ˜å…¨å±€
declare global {
  const MY_GLOBAL: string
}

export {} // ä½¿æ–‡ä»¶æˆä¸ºæ¨¡å—
```

### ğŸ™‹ å£°æ˜æ–‡ä»¶ä¸ç”Ÿæ•ˆï¼Ÿ

```typescript
// æ£€æŸ¥ tsconfig.json
{
  "compilerOptions": {
    "declaration": true,  // ç”Ÿæˆå£°æ˜æ–‡ä»¶
    "declarationDir": "./dist",  // å£°æ˜æ–‡ä»¶è¾“å‡ºç›®å½•
  },
  "include": [
    "src/**/*",
    "types/**/*"  // åŒ…å«ç±»å‹ç›®å½•
  ]
}
```

## æ€»ç»“

| ç‰¹æ€§     | è¯­æ³•              | ç”¨é€”                 |
| -------- | ----------------- | -------------------- |
| declare  | `declare const x` | å£°æ˜è¿è¡Œæ—¶å­˜åœ¨çš„å€¼   |
| æ¨¡å—å£°æ˜ | `declare module`  | å£°æ˜å¤–éƒ¨æ¨¡å—ç±»å‹     |
| å…¨å±€å£°æ˜ | `declare global`  | åœ¨æ¨¡å—ä¸­æ·»åŠ å…¨å±€ç±»å‹ |
| @types   | `@types/xxx`      | ç¤¾åŒºç±»å‹å®šä¹‰åŒ…       |
| JSDoc    | `/** */`          | æ·»åŠ æ–‡æ¡£æ³¨é‡Š         |

ä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†æ·±å…¥å­¦ä¹ å£°æ˜æ–‡ä»¶è¿›é˜¶ï¼Œäº†è§£æ›´å¤æ‚çš„å£°æ˜åœºæ™¯ã€‚
