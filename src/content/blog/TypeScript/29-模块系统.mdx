---
title: 'æ¨¡å—ç³»ç»Ÿ'
description: 'TypeScript æ¨¡å—ç³»ç»Ÿè¯¦è§£ï¼šES æ¨¡å—ã€CommonJSã€æ¨¡å—è§£æç­–ç•¥ã€ç±»å‹å¯¼å…¥å¯¼å‡º'
pubDate: 2024-02-12
toc: true
ogImage: true
category: 'TypeScript'
tags: ['TypeScript', 'æ¨¡å—ç³»ç»Ÿ', 'ES Modules', 'CommonJS', 'æ¨¡å—è§£æ']
---

TypeScript æ”¯æŒå¤šç§æ¨¡å—ç³»ç»Ÿï¼Œç†è§£æ¨¡å—çš„å·¥ä½œæ–¹å¼å¯¹äºæ„å»ºå¤§å‹åº”ç”¨è‡³å…³é‡è¦ã€‚

## ES æ¨¡å—

ES æ¨¡å—æ˜¯ç°ä»£ JavaScript çš„æ ‡å‡†æ¨¡å—ç³»ç»Ÿï¼š

```typescript
// TypeScript 5.x

// === utils.ts ===
// å‘½åå¯¼å‡º
export const PI = 3.14159

export function add(a: number, b: number): number {
  return a + b
}

export interface User {
  id: number
  name: string
}

export class Calculator {
  add(a: number, b: number) {
    return a + b
  }
}

// é»˜è®¤å¯¼å‡º
export default function greet(name: string) {
  console.log(`Hello, ${name}!`)
}

// === main.ts ===
// å‘½åå¯¼å…¥
import { PI, add, User, Calculator } from './utils'

// é»˜è®¤å¯¼å…¥
import greet from './utils'

// æ··åˆå¯¼å…¥
import greet2, { PI as pi, add } from './utils'

// å¯¼å…¥æ‰€æœ‰
import * as utils from './utils'
console.log(utils.PI)
utils.add(1, 2)

// ä»…å¯¼å…¥ç±»å‹
import type { User } from './utils'

// ç±»å‹å’Œå€¼æ··åˆå¯¼å…¥
import { Calculator, type User } from './utils'
```

## å¯¼å‡ºæ–¹å¼

```typescript
// å¯¼å‡ºå£°æ˜
export const name = 'å¼ ä¸‰'
export function hello() {}
export class Person {}
export interface Animal {}
export type ID = string | number

// å¯¼å‡ºåˆ—è¡¨
const a = 1
const b = 2
function fn() {}

export { a, b, fn }

// é‡å‘½åå¯¼å‡º
export { a as alpha, b as beta }

// é‡æ–°å¯¼å‡º
export { add, subtract } from './math'
export * from './utils'
export * as utils from './utils'
export { default } from './greeting'
export { default as greet } from './greeting'

// ç±»å‹å¯¼å‡º
export type { User, Admin } from './types'
export type * from './types'
```

## å¯¼å…¥æ–¹å¼

```typescript
// å‘½åå¯¼å…¥
import { add, subtract } from './math'

// é‡å‘½åå¯¼å…¥
import { add as sum } from './math'

// é»˜è®¤å¯¼å…¥
import Calculator from './calculator'

// å‘½åç©ºé—´å¯¼å…¥
import * as math from './math'

// å‰¯ä½œç”¨å¯¼å…¥ï¼ˆåªæ‰§è¡Œï¼Œä¸å¯¼å…¥ï¼‰
import './polyfills'
import './styles.css'

// ç±»å‹å¯¼å…¥
import type { User } from './types'
import { type User, type Admin } from './types'

// åŠ¨æ€å¯¼å…¥
async function loadModule() {
  const { add } = await import('./math')
  return add(1, 2)
}
```

## CommonJS å…¼å®¹

TypeScript å¯ä»¥ä¸ CommonJS æ¨¡å—äº’æ“ä½œï¼š

```typescript
// CommonJS é£æ ¼å¯¼å…¥
import fs = require('fs')
import path = require('path')

// ç­‰æ•ˆäº
const fs = require('fs')

// å¯¼å‡º CommonJS æ¨¡å—
export = {
  name: 'module',
  version: '1.0.0',
}

// esModuleInterop å¼€å¯å
// å¯ä»¥ç”¨ ES æ¨¡å—è¯­æ³•å¯¼å…¥ CommonJS
import fs from 'fs'
import express from 'express'

// ç±»å‹å£°æ˜ä¸­çš„ CommonJS
declare module 'my-library' {
  interface Options {
    debug: boolean
  }

  function init(options: Options): void

  export = init
}
```

## æ¨¡å—è§£æç­–ç•¥

TypeScript æä¾›ä¸¤ç§æ¨¡å—è§£æç­–ç•¥ï¼š

### Classic ç­–ç•¥

```typescript
// tsconfig.json
{
  "compilerOptions": {
    "moduleResolution": "classic"
  }
}

// ç›¸å¯¹è·¯å¾„å¯¼å…¥ï¼š./moduleB
// åœ¨ /root/src/folder/A.ts ä¸­
// æŸ¥æ‰¾é¡ºåºï¼š
// 1. /root/src/folder/moduleB.ts
// 2. /root/src/folder/moduleB.d.ts

// éç›¸å¯¹è·¯å¾„å¯¼å…¥ï¼šmoduleB
// åœ¨ /root/src/folder/A.ts ä¸­
// æŸ¥æ‰¾é¡ºåºï¼š
// 1. /root/src/folder/moduleB.ts
// 2. /root/src/folder/moduleB.d.ts
// 3. /root/src/moduleB.ts
// 4. /root/src/moduleB.d.ts
// 5. /root/moduleB.ts
// ... å‘ä¸ŠæŸ¥æ‰¾
```

### Node ç­–ç•¥

```typescript
// tsconfig.json
{
  "compilerOptions": {
    "moduleResolution": "node"
  }
}

// ç›¸å¯¹è·¯å¾„å¯¼å…¥ï¼š./moduleB
// åœ¨ /root/src/moduleA.ts ä¸­
// æŸ¥æ‰¾é¡ºåºï¼š
// 1. /root/src/moduleB.ts
// 2. /root/src/moduleB.tsx
// 3. /root/src/moduleB.d.ts
// 4. /root/src/moduleB/package.json (types å­—æ®µ)
// 5. /root/src/moduleB/index.ts
// 6. /root/src/moduleB/index.tsx
// 7. /root/src/moduleB/index.d.ts

// éç›¸å¯¹è·¯å¾„å¯¼å…¥ï¼šmoduleB
// åœ¨ /root/src/moduleA.ts ä¸­
// æŸ¥æ‰¾ node_modulesï¼š
// 1. /root/src/node_modules/moduleB.ts
// 2. /root/src/node_modules/moduleB.tsx
// 3. /root/src/node_modules/moduleB.d.ts
// 4. /root/src/node_modules/moduleB/package.json
// 5. /root/src/node_modules/@types/moduleB.d.ts
// 6. /root/node_modules/... (å‘ä¸ŠæŸ¥æ‰¾)
```

### Node16/NodeNext ç­–ç•¥

```typescript
// tsconfig.json
{
  "compilerOptions": {
    "module": "node16",
    "moduleResolution": "node16"
  }
}

// æ”¯æŒ package.json çš„ exports å­—æ®µ
// package.json
{
  "exports": {
    ".": {
      "import": "./dist/index.mjs",
      "require": "./dist/index.cjs",
      "types": "./dist/index.d.ts"
    },
    "./utils": {
      "import": "./dist/utils.mjs",
      "types": "./dist/utils.d.ts"
    }
  }
}

// ä½¿ç”¨
import { something } from 'package'
import { util } from 'package/utils'
```

## è·¯å¾„æ˜ å°„

ä½¿ç”¨ `paths` é…ç½®è·¯å¾„åˆ«åï¼š

```typescript
// tsconfig.json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"],
      "@components/*": ["src/components/*"],
      "@utils/*": ["src/utils/*"],
      "@types": ["src/types/index"]
    }
  }
}

// ä½¿ç”¨
import { Button } from '@components/Button'
import { formatDate } from '@utils/date'
import type { User } from '@types'

// ç­‰æ•ˆäº
import { Button } from './src/components/Button'
import { formatDate } from './src/utils/date'
import type { User } from './src/types/index'
```

## æ¨¡å—è¾“å‡ºæ ¼å¼

```typescript
// tsconfig.json
{
  "compilerOptions": {
    // ES æ¨¡å—
    "module": "ESNext",        // æœ€æ–° ES æ¨¡å—
    "module": "ES2022",        // ES2022 æ¨¡å—
    "module": "ES2020",        // ES2020 æ¨¡å—

    // CommonJS
    "module": "CommonJS",

    // Node.js
    "module": "Node16",        // Node.js 16+
    "module": "NodeNext",      // æœ€æ–° Node.js

    // å…¶ä»–
    "module": "AMD",           // AMD æ¨¡å—
    "module": "UMD",           // UMD æ¨¡å—
    "module": "System"         // SystemJS
  }
}

// è¾“å‡ºç¤ºä¾‹

// ESNext è¾“å‡º
export function add(a, b) {
    return a + b;
}

// CommonJS è¾“å‡º
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.add = add;
function add(a, b) {
    return a + b;
}
```

## æ¨¡å—éš”ç¦»

æ¯ä¸ªæ–‡ä»¶éƒ½æ˜¯ç‹¬ç«‹çš„æ¨¡å—ä½œç”¨åŸŸï¼š

```typescript
// æ–‡ä»¶æ˜¯æ¨¡å—çš„æ¡ä»¶ï¼šæœ‰ import æˆ– export

// a.ts - è¿™æ˜¯ä¸€ä¸ªæ¨¡å—
export const x = 1

// b.ts - è¿™ä¹Ÿæ˜¯ä¸€ä¸ªæ¨¡å—
import { x } from './a'

// c.ts - è¿™ä¸æ˜¯æ¨¡å—ï¼ˆå…¨å±€è„šæœ¬ï¼‰
const y = 2

// å¼ºåˆ¶å°†æ–‡ä»¶è§†ä¸ºæ¨¡å—
// d.ts
export {} // ç©ºå¯¼å‡ºä½¿å…¶æˆä¸ºæ¨¡å—

const privateVar = 'only in this file'
```

## å®é™…åº”ç”¨

### é¡¹ç›®ç»“æ„

```typescript
// src/
//   index.ts          # å…¥å£
//   types/            # ç±»å‹å®šä¹‰
//     index.ts
//     user.ts
//   utils/            # å·¥å…·å‡½æ•°
//     index.ts
//     date.ts
//     string.ts
//   services/         # æœåŠ¡å±‚
//     index.ts
//     api.ts
//     auth.ts
//   components/       # ç»„ä»¶
//     index.ts
//     Button.ts

// src/types/index.ts - ç±»å‹æ¡¶æ–‡ä»¶
export * from './user'
export * from './product'
export * from './order'

// src/utils/index.ts - å·¥å…·æ¡¶æ–‡ä»¶
export * from './date'
export * from './string'
export * from './number'

// src/index.ts - ä¸»å…¥å£
export * from './types'
export * from './utils'
export * from './services'
export * from './components'
```

### æ¡ä»¶å¯¼å‡º

```typescript
// æ ¹æ®ç¯å¢ƒå¯¼å‡ºä¸åŒå®ç°
// config/index.ts

let config: Config

if (process.env.NODE_ENV === 'production') {
  config = await import('./production').then((m) => m.default)
} else {
  config = await import('./development').then((m) => m.default)
}

export default config

// æˆ–ä½¿ç”¨æ¡ä»¶ç±»å‹
type Environment = 'development' | 'production'

const configs = {
  development: () => import('./development'),
  production: () => import('./production'),
}

export async function getConfig(env: Environment) {
  return configs[env]()
}
```

### å»¶è¿ŸåŠ è½½

```typescript
// è·¯ç”±çº§ä»£ç åˆ†å‰²
const routes = {
  home: () => import('./pages/Home'),
  about: () => import('./pages/About'),
  dashboard: () => import('./pages/Dashboard'),
}

async function loadPage(route: keyof typeof routes) {
  const module = await routes[route]()
  return module.default
}

// ç»„ä»¶å»¶è¿ŸåŠ è½½
class App {
  private chartModule: typeof import('chart.js') | null = null

  async showChart(data: number[]) {
    if (!this.chartModule) {
      this.chartModule = await import('chart.js')
    }
    // ä½¿ç”¨ chartModule
  }
}
```

## å¸¸è§é—®é¢˜

### ğŸ™‹ import å’Œ require æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

```typescript
// import æ˜¯é™æ€çš„ï¼Œåœ¨ç¼–è¯‘æ—¶åˆ†æ
import { add } from './math' // å¿…é¡»åœ¨é¡¶å±‚

// require æ˜¯åŠ¨æ€çš„ï¼Œåœ¨è¿è¡Œæ—¶æ‰§è¡Œ
const add = require('./math').add // å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹

// TypeScript æ¨èä½¿ç”¨ import
// ä½¿ç”¨ esModuleInterop æé«˜å…¼å®¹æ€§
```

### ğŸ™‹ ä½•æ—¶ä½¿ç”¨ type-only å¯¼å…¥ï¼Ÿ

```typescript
// ä»…ç±»å‹å¯¼å…¥ä¸ä¼šåœ¨ç¼–è¯‘åä¿ç•™
import type { User } from './types'

// å½“ä½ åªéœ€è¦ç±»å‹ï¼Œä¸éœ€è¦å€¼æ—¶ä½¿ç”¨
// è¿™å¯ä»¥é¿å…å¾ªç¯ä¾èµ–é—®é¢˜
// ä¹Ÿå¯ä»¥å‡å°‘æ‰“åŒ…ä½“ç§¯

// æ··åˆå¯¼å…¥
import { UserService, type User } from './user'
```

### ğŸ™‹ å¦‚ä½•å¤„ç†å¾ªç¯ä¾èµ–ï¼Ÿ

```typescript
// å¾ªç¯ä¾èµ–ç¤ºä¾‹
// a.ts
import { b } from './b'
export const a = 1

// b.ts
import { a } from './a'
export const b = a + 1

// è§£å†³æ–¹æ¡ˆ 1ï¼šé‡æ„ä»£ç ç»“æ„
// è§£å†³æ–¹æ¡ˆ 2ï¼šä½¿ç”¨ type-only å¯¼å…¥
// è§£å†³æ–¹æ¡ˆ 3ï¼šå»¶è¿Ÿå¯¼å…¥
export function getA() {
  const { a } = require('./a')
  return a
}
```

## æ€»ç»“

| ç‰¹æ€§         | è¯­æ³•              | ç”¨é€”       |
| ------------ | ----------------- | ---------- |
| å‘½åå¯¼å‡º     | `export { name }` | å¯¼å‡ºå¤šä¸ªå€¼ |
| é»˜è®¤å¯¼å‡º     | `export default`  | å¯¼å‡ºä¸»è¦å€¼ |
| å‘½åå¯¼å…¥     | `import { name }` | å¯¼å…¥ç‰¹å®šå€¼ |
| å‘½åç©ºé—´å¯¼å…¥ | `import * as ns`  | å¯¼å…¥æ‰€æœ‰å€¼ |
| ç±»å‹å¯¼å…¥     | `import type`     | ä»…å¯¼å…¥ç±»å‹ |
| åŠ¨æ€å¯¼å…¥     | `import()`        | è¿è¡Œæ—¶åŠ è½½ |

ä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†å­¦ä¹ å‘½åç©ºé—´ï¼Œäº†è§£ TypeScript çš„å¦ä¸€ç§ä»£ç ç»„ç»‡æ–¹å¼ã€‚
