---
title: 'ç±»çš„è®¿é—®ä¿®é¥°ç¬¦'
description: 'TypeScript ç±»ä¿®é¥°ç¬¦è¯¦è§£ï¼špublicã€privateã€protectedã€readonlyã€static çš„ä½¿ç”¨æ–¹æ³•ä¸åŒºåˆ«'
pubDate: 2024-01-27
toc: true
ogImage: true
category: 'TypeScript'
tags: ['TypeScript', 'è®¿é—®ä¿®é¥°ç¬¦', 'public', 'private', 'protected']
---

TypeScript æä¾›äº†å¤šç§è®¿é—®ä¿®é¥°ç¬¦æ¥æ§åˆ¶ç±»æˆå‘˜çš„å¯è§æ€§å’Œå¯ä¿®æ”¹æ€§ã€‚åˆç†ä½¿ç”¨è¿™äº›ä¿®é¥°ç¬¦å¯ä»¥å®ç°è‰¯å¥½çš„å°è£…ï¼Œæé«˜ä»£ç çš„å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

## public ä¿®é¥°ç¬¦

`public` æ˜¯é»˜è®¤çš„è®¿é—®ä¿®é¥°ç¬¦ï¼Œæˆå‘˜å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è®¿é—®ï¼š

```typescript
// TypeScript 5.x

class User {
  public name: string // æ˜¾å¼å£°æ˜ public
  age: number // é»˜è®¤å°±æ˜¯ public

  public constructor(name: string, age: number) {
    this.name = name
    this.age = age
  }

  public greet(): string {
    return `Hello, ${this.name}`
  }
}

const user = new User('å¼ ä¸‰', 25)
console.log(user.name) // âœ… å¯ä»¥è®¿é—®
console.log(user.age) // âœ… å¯ä»¥è®¿é—®
user.name = 'æå››' // âœ… å¯ä»¥ä¿®æ”¹
```

## private ä¿®é¥°ç¬¦

`private` æˆå‘˜åªèƒ½åœ¨ç±»å†…éƒ¨è®¿é—®ï¼š

```typescript
class BankAccount {
  private balance: number

  constructor(initialBalance: number) {
    this.balance = initialBalance
  }

  public deposit(amount: number): void {
    if (amount > 0) {
      this.balance += amount
      this.logTransaction('deposit', amount)
    }
  }

  public withdraw(amount: number): boolean {
    if (amount > 0 && amount <= this.balance) {
      this.balance -= amount
      this.logTransaction('withdraw', amount)
      return true
    }
    return false
  }

  public getBalance(): number {
    return this.balance
  }

  private logTransaction(type: string, amount: number): void {
    console.log(`${type}: ${amount}, Balance: ${this.balance}`)
  }
}

const account = new BankAccount(1000)
account.deposit(500)
// account.balance;  // âŒ é”™è¯¯ï¼šç§æœ‰å±æ€§
// account.logTransaction('test', 100);  // âŒ é”™è¯¯ï¼šç§æœ‰æ–¹æ³•
console.log(account.getBalance()) // âœ… 1500
```

### TypeScript private vs ES2022 #private

```typescript
// TypeScript privateï¼ˆç¼–è¯‘æ—¶æ£€æŸ¥ï¼‰
class A {
  private x: number = 1
}

// ES2022 åŸç”Ÿç§æœ‰å­—æ®µï¼ˆè¿è¡Œæ—¶å¼ºåˆ¶ï¼‰
class B {
  #x: number = 1

  getX() {
    return this.#x
  }
}

// åŒºåˆ«ï¼š
// 1. TypeScript private ç¼–è¯‘åå˜æˆæ™®é€šå±æ€§ï¼Œå¯è¢«ç»•è¿‡
// 2. # è¯­æ³•æ˜¯çœŸæ­£çš„ç§æœ‰ï¼Œè¿è¡Œæ—¶ä¹Ÿæ— æ³•è®¿é—®
// 3. # è¯­æ³•ä¸èƒ½ä¸ private ä¿®é¥°ç¬¦ä¸€èµ·ä½¿ç”¨
```

## protected ä¿®é¥°ç¬¦

`protected` æˆå‘˜å¯ä»¥åœ¨ç±»å†…éƒ¨å’Œå­ç±»ä¸­è®¿é—®ï¼š

```typescript
class Animal {
  protected name: string
  protected age: number

  constructor(name: string, age: number) {
    this.name = name
    this.age = age
  }

  protected makeSound(): void {
    console.log('Some sound')
  }
}

class Dog extends Animal {
  private breed: string

  constructor(name: string, age: number, breed: string) {
    super(name, age)
    this.breed = breed
  }

  public introduce(): string {
    // âœ… å¯ä»¥è®¿é—® protected æˆå‘˜
    return `æˆ‘æ˜¯ ${this.name}ï¼Œ${this.age} å²ï¼Œå“ç§æ˜¯ ${this.breed}`
  }

  public bark(): void {
    this.makeSound() // âœ… å¯ä»¥è°ƒç”¨ protected æ–¹æ³•
    console.log('æ±ªæ±ªï¼')
  }
}

const dog = new Dog('æ—ºè´¢', 3, 'æŸ´çŠ¬')
console.log(dog.introduce())
// dog.name;  // âŒ é”™è¯¯ï¼šprotected æˆå‘˜ä¸èƒ½åœ¨å¤–éƒ¨è®¿é—®
// dog.makeSound();  // âŒ é”™è¯¯
```

### protected constructor

```typescript
// å—ä¿æŠ¤çš„æ„é€ å‡½æ•°ï¼Œä¸èƒ½ç›´æ¥å®ä¾‹åŒ–
class Base {
  protected constructor(public id: string) {}
}

// const base = new Base('1');  // âŒ é”™è¯¯ï¼šæ„é€ å‡½æ•°å—ä¿æŠ¤

class Derived extends Base {
  constructor(
    id: string,
    public name: string
  ) {
    super(id) // âœ… å­ç±»å¯ä»¥è°ƒç”¨
  }

  static create(id: string, name: string): Derived {
    return new Derived(id, name)
  }
}

const derived = new Derived('1', 'æµ‹è¯•')
// æˆ–ä½¿ç”¨å·¥å‚æ–¹æ³•
const derived2 = Derived.create('2', 'æµ‹è¯•2')
```

## readonly ä¿®é¥°ç¬¦

`readonly` å±æ€§åªèƒ½åœ¨å£°æ˜æ—¶æˆ–æ„é€ å‡½æ•°ä¸­èµ‹å€¼ï¼š

```typescript
class Config {
  readonly apiUrl: string
  readonly timeout: number
  readonly version = '1.0.0' // å£°æ˜æ—¶èµ‹å€¼

  constructor(apiUrl: string, timeout: number) {
    this.apiUrl = apiUrl // æ„é€ å‡½æ•°ä¸­èµ‹å€¼
    this.timeout = timeout
  }

  // âŒ ä¸èƒ½åœ¨å…¶ä»–æ–¹æ³•ä¸­èµ‹å€¼
  // updateUrl(url: string) {
  //   this.apiUrl = url;  // é”™è¯¯
  // }
}

const config = new Config('https://api.example.com', 5000)
// config.apiUrl = 'xxx';  // âŒ é”™è¯¯ï¼šåªè¯»å±æ€§
```

### readonly ä¸ const çš„åŒºåˆ«

```typescript
class Example {
  readonly prop = 1 // åªè¯»å±æ€§

  method() {
    const local = 2 // å¸¸é‡å˜é‡
    // local = 3;  // âŒ é”™è¯¯
    // this.prop = 3;  // âŒ é”™è¯¯
  }
}

// readonly ç”¨äºå±æ€§ï¼Œconst ç”¨äºå˜é‡
// ä¸¤è€…éƒ½è¡¨ç¤ºä¸å¯é‡æ–°èµ‹å€¼
```

## static ä¿®é¥°ç¬¦

`static` æˆå‘˜å±äºç±»æœ¬èº«ï¼Œè€Œä¸æ˜¯å®ä¾‹ï¼š

```typescript
class Counter {
  static count: number = 0
  static readonly MAX_COUNT = 100

  id: number

  constructor() {
    Counter.count++
    this.id = Counter.count
  }

  static getCount(): number {
    return Counter.count
  }

  static reset(): void {
    Counter.count = 0
  }
}

const c1 = new Counter()
const c2 = new Counter()
const c3 = new Counter()

console.log(Counter.count) // 3
console.log(Counter.getCount()) // 3
console.log(c1.id, c2.id, c3.id) // 1, 2, 3

Counter.reset()
console.log(Counter.count) // 0
```

### é™æ€å—ï¼ˆES2022ï¼‰

```typescript
class Database {
  static connection: Connection
  static isInitialized = false

  // é™æ€åˆå§‹åŒ–å—
  static {
    try {
      Database.connection = createConnection()
      Database.isInitialized = true
      console.log('Database initialized')
    } catch (error) {
      console.error('Failed to initialize database')
    }
  }
}
```

## ä¿®é¥°ç¬¦ç»„åˆ

ä¿®é¥°ç¬¦å¯ä»¥ç»„åˆä½¿ç”¨ï¼š

```typescript
class Example {
  public readonly id: string
  private readonly secret: string
  protected static count: number = 0

  constructor(id: string, secret: string) {
    this.id = id
    this.secret = secret
    Example.count++
  }

  // é™æ€ç§æœ‰æ–¹æ³•
  private static log(message: string): void {
    console.log(`[Example] ${message}`)
  }

  // å—ä¿æŠ¤çš„é™æ€å±æ€§
  protected static getCount(): number {
    return Example.count
  }
}
```

### å‚æ•°å±æ€§ä¸ä¿®é¥°ç¬¦

```typescript
class User {
  constructor(
    public readonly id: string,
    public name: string,
    private password: string,
    protected role: string = 'user'
  ) {}

  checkPassword(input: string): boolean {
    return this.password === input
  }
}

const user = new User('1', 'å¼ ä¸‰', 'secret123')
console.log(user.id) // âœ…
console.log(user.name) // âœ…
// user.id = '2';  // âŒ readonly
// user.password;  // âŒ private
```

## è®¿é—®æ€§å¯¹æ¯”

| ä¿®é¥°ç¬¦    | ç±»å†…éƒ¨ | å­ç±» | å®ä¾‹ |
| --------- | ------ | ---- | ---- |
| public    | âœ…     | âœ…   | âœ…   |
| protected | âœ…     | âœ…   | âŒ   |
| private   | âœ…     | âŒ   | âŒ   |

## å®é™…åº”ç”¨æ¨¡å¼

### å•ä¾‹æ¨¡å¼

```typescript
class Singleton {
  private static instance: Singleton
  private constructor(public value: string) {}

  static getInstance(): Singleton {
    if (!Singleton.instance) {
      Singleton.instance = new Singleton('singleton value')
    }
    return Singleton.instance
  }
}

const s1 = Singleton.getInstance()
const s2 = Singleton.getInstance()
console.log(s1 === s2) // true
```

### å·¥å‚æ¨¡å¼

```typescript
class Product {
  private constructor(
    public readonly id: string,
    public readonly name: string,
    public readonly price: number
  ) {}

  static create(name: string, price: number): Product {
    const id = Math.random().toString(36).substr(2, 9)
    return new Product(id, name, price)
  }

  static createFromJson(json: string): Product {
    const data = JSON.parse(json)
    return new Product(data.id, data.name, data.price)
  }
}

const product = Product.create('æ‰‹æœº', 5999)
console.log(product.id, product.name, product.price)
```

### å°è£…çŠ¶æ€

```typescript
class StateMachine {
  private currentState: string
  private readonly transitions: Map<string, string[]>

  constructor(initialState: string) {
    this.currentState = initialState
    this.transitions = new Map()
  }

  addTransition(from: string, to: string): this {
    const existing = this.transitions.get(from) || []
    existing.push(to)
    this.transitions.set(from, existing)
    return this
  }

  transition(to: string): boolean {
    const allowed = this.transitions.get(this.currentState) || []
    if (allowed.includes(to)) {
      this.currentState = to
      return true
    }
    return false
  }

  get state(): string {
    return this.currentState
  }
}

const machine = new StateMachine('idle')
  .addTransition('idle', 'running')
  .addTransition('running', 'paused')
  .addTransition('running', 'stopped')
  .addTransition('paused', 'running')

machine.transition('running') // true
console.log(machine.state) // "running"
```

## å¸¸è§é—®é¢˜

### ğŸ™‹ private æˆå‘˜ä¼šè¢«ç»§æ‰¿å—ï¼Ÿ

ä¼šè¢«ç»§æ‰¿ï¼Œä½†ä¸èƒ½è®¿é—®ï¼š

```typescript
class Parent {
  private secret = 'secret'
}

class Child extends Parent {
  reveal() {
    // return this.secret;  // âŒ é”™è¯¯ï¼šä¸èƒ½è®¿é—®
    return 'Cannot access parent private'
  }
}
```

### ğŸ™‹ é™æ€æˆå‘˜å¯ä»¥è®¿é—®å®ä¾‹æˆå‘˜å—ï¼Ÿ

ä¸èƒ½ç›´æ¥è®¿é—®ï¼š

```typescript
class Example {
  instanceProp = 'instance'

  static staticMethod() {
    // console.log(this.instanceProp);  // âŒ é”™è¯¯
  }

  static staticMethodWithInstance(instance: Example) {
    console.log(instance.instanceProp) // âœ… é€šè¿‡å‚æ•°è®¿é—®
  }
}
```

### ğŸ™‹ å¦‚ä½•è®©å±æ€§åªåœ¨ç±»å†…éƒ¨å¯å†™ï¼Ÿ

ç»“åˆ private å’Œ public getterï¼š

```typescript
class Counter {
  private _count = 0

  get count(): number {
    return this._count
  }

  increment(): void {
    this._count++
  }
}

const counter = new Counter()
console.log(counter.count) // âœ… å¯è¯»
// counter.count = 10;  // âŒ æ²¡æœ‰ setterï¼Œä¸å¯å†™
counter.increment() // âœ… é€šè¿‡æ–¹æ³•ä¿®æ”¹
```

## æ€»ç»“

| ä¿®é¥°ç¬¦    | ä½œç”¨     | é€‚ç”¨åœºæ™¯             |
| --------- | -------- | -------------------- |
| public    | å…¬å¼€è®¿é—® | å…¬å…± API             |
| private   | ä»…ç±»å†…éƒ¨ | å†…éƒ¨å®ç°ç»†èŠ‚         |
| protected | ç±»å’Œå­ç±» | å¯ç»§æ‰¿çš„å†…éƒ¨æˆå‘˜     |
| readonly  | åªè¯»     | ä¸å˜çš„é…ç½®ã€å¸¸é‡     |
| static    | ç±»çº§åˆ«   | å·¥å…·æ–¹æ³•ã€å•ä¾‹ã€å¸¸é‡ |

ä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†å­¦ä¹ ç±»çš„ç»§æ‰¿ï¼ŒåŒ…æ‹¬ extendsã€super å’Œæ–¹æ³•é‡å†™ã€‚
