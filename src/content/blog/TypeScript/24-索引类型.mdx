---
title: 'ç´¢å¼•ç±»å‹ä¸ç´¢å¼•ç­¾å'
description: 'TypeScript ç´¢å¼•ç±»å‹è¯¦è§£ï¼škeyof æ“ä½œç¬¦ã€ç´¢å¼•è®¿é—®ç±»å‹ã€ç´¢å¼•ç­¾åçš„ä½¿ç”¨æ–¹æ³•ä¸æœ€ä½³å®è·µ'
pubDate: 2024-02-07
toc: true
ogImage: true
category: 'TypeScript'
tags: ['TypeScript', 'ç´¢å¼•ç±»å‹', 'keyof', 'ç´¢å¼•ç­¾å', 'ç±»å‹æ“ä½œ']
---

ç´¢å¼•ç±»å‹è®©æˆ‘ä»¬èƒ½å¤ŸæŸ¥è¯¢å’Œæ“ä½œå¯¹è±¡ç±»å‹çš„é”®å’Œå€¼ç±»å‹ï¼Œæ˜¯ TypeScript ç±»å‹ç³»ç»Ÿä¸­éå¸¸å¼ºå¤§çš„ç‰¹æ€§ã€‚

## keyof æ“ä½œç¬¦

`keyof` è·å–ç±»å‹çš„æ‰€æœ‰é”®ç»„æˆçš„è”åˆç±»å‹ï¼š

```typescript
// TypeScript 5.x

interface User {
  id: number
  name: string
  email: string
  age: number
}

// è·å–æ‰€æœ‰é”®
type UserKeys = keyof User
// 'id' | 'name' | 'email' | 'age'

// ä½¿ç”¨ keyof çº¦æŸå‚æ•°
function getProperty<T, K extends keyof T>(obj: T, key: K): T[K] {
  return obj[key]
}

const user: User = {
  id: 1,
  name: 'å¼ ä¸‰',
  email: 'test@test.com',
  age: 25,
}

const name = getProperty(user, 'name') // string
const age = getProperty(user, 'age') // number
// getProperty(user, 'invalid');  // âŒ é”™è¯¯

// keyof ä¸æ•°ç»„
type ArrayKeys = keyof string[]
// number | 'length' | 'push' | 'pop' | ...

type TupleKeys = keyof [string, number]
// '0' | '1' | 'length' | ...
```

## ç´¢å¼•è®¿é—®ç±»å‹

ä½¿ç”¨ `T[K]` è®¿é—®ç±»å‹çš„å±æ€§ç±»å‹ï¼š

```typescript
interface User {
  id: number
  name: string
  email: string
  address: {
    city: string
    street: string
  }
}

// è®¿é—®å•ä¸ªå±æ€§ç±»å‹
type UserId = User['id'] // number
type UserName = User['name'] // string
type UserAddress = User['address'] // { city: string; street: string }

// è®¿é—®åµŒå¥—å±æ€§
type City = User['address']['city'] // string

// ä½¿ç”¨è”åˆç±»å‹è®¿é—®å¤šä¸ªå±æ€§
type UserIdOrName = User['id' | 'name'] // number | string

// ç»“åˆ keyof
type UserValues = User[keyof User]
// number | string | { city: string; street: string }

// æ•°ç»„å…ƒç´ ç±»å‹
type StringArrayElement = string[][number] // string

const colors = ['red', 'green', 'blue'] as const
type Color = (typeof colors)[number] // 'red' | 'green' | 'blue'
```

## ç´¢å¼•ç­¾å

å®šä¹‰åŠ¨æ€é”®çš„å¯¹è±¡ç±»å‹ï¼š

```typescript
// å­—ç¬¦ä¸²ç´¢å¼•ç­¾å
interface StringDictionary {
  [key: string]: string
}

const dict: StringDictionary = {
  name: 'å¼ ä¸‰',
  city: 'åŒ—äº¬',
  // age: 25  // âŒ é”™è¯¯ï¼šnumber ä¸èƒ½èµ‹å€¼ç»™ string
}

// æ•°å­—ç´¢å¼•ç­¾å
interface NumberArray {
  [index: number]: string
}

const arr: NumberArray = ['a', 'b', 'c']
console.log(arr[0]) // 'a'

// æ··åˆç­¾å
interface MixedDictionary {
  [key: string]: string | number
  length: number // å¿…é¡»å…¼å®¹ç´¢å¼•ç­¾åç±»å‹
  name: string
}

// åªè¯»ç´¢å¼•ç­¾å
interface ReadonlyDictionary {
  readonly [key: string]: string
}

const readonlyDict: ReadonlyDictionary = {
  name: 'å¼ ä¸‰',
}
// readonlyDict.name = 'æå››';  // âŒ é”™è¯¯ï¼šåªè¯»
```

## æ¨¡æ¿å­—é¢é‡ç´¢å¼•

```typescript
// æ¨¡æ¿å­—é¢é‡ä½œä¸ºç´¢å¼•
type EventHandlers = {
  [K in `on${string}`]: (event: Event) => void
}

const handlers: EventHandlers = {
  onClick: (e) => console.log('clicked'),
  onHover: (e) => console.log('hovered'),
  // invalid: () => {}  // âŒ ä¸åŒ¹é…æ¨¡å¼
}

// æ›´ç²¾ç¡®çš„æ¨¡å¼
type MouseEvents = 'click' | 'mousedown' | 'mouseup'

type MouseHandlers = {
  [K in `on${Capitalize<MouseEvents>}`]: (event: MouseEvent) => void
}

const mouseHandlers: MouseHandlers = {
  onClick: (e) => console.log(e.clientX),
  onMousedown: (e) => console.log(e.button),
  onMouseup: (e) => console.log('released'),
}
```

## ç´¢å¼•ç±»å‹å®æˆ˜

### ç±»å‹å®‰å…¨çš„å±æ€§è®¿é—®

```typescript
// å®‰å…¨çš„ pick å‡½æ•°
function pick<T, K extends keyof T>(obj: T, keys: K[]): Pick<T, K> {
  const result = {} as Pick<T, K>
  keys.forEach((key) => {
    result[key] = obj[key]
  })
  return result
}

interface User {
  id: number
  name: string
  email: string
  password: string
}

const user: User = {
  id: 1,
  name: 'å¼ ä¸‰',
  email: 'test@test.com',
  password: 'secret',
}

const publicUser = pick(user, ['id', 'name', 'email'])
// { id: number; name: string; email: string }

// å®‰å…¨çš„ omit å‡½æ•°
function omit<T, K extends keyof T>(obj: T, keys: K[]): Omit<T, K> {
  const result = { ...obj }
  keys.forEach((key) => {
    delete result[key]
  })
  return result as Omit<T, K>
}

const safeUser = omit(user, ['password'])
// { id: number; name: string; email: string }
```

### åŠ¨æ€å±æ€§æ›´æ–°

```typescript
function updateProperty<T, K extends keyof T>(obj: T, key: K, value: T[K]): T {
  return { ...obj, [key]: value }
}

interface Settings {
  theme: 'light' | 'dark'
  fontSize: number
  notifications: boolean
}

const settings: Settings = {
  theme: 'light',
  fontSize: 14,
  notifications: true,
}

const updated = updateProperty(settings, 'theme', 'dark')
// updateProperty(settings, 'theme', 'blue');  // âŒ é”™è¯¯

// æ‰¹é‡æ›´æ–°
function updateProperties<T>(obj: T, updates: Partial<T>): T {
  return { ...obj, ...updates }
}

const newSettings = updateProperties(settings, {
  theme: 'dark',
  fontSize: 16,
})
```

### è·¯å¾„è®¿é—®ç±»å‹

```typescript
// è·å–åµŒå¥—å¯¹è±¡çš„ç±»å‹
type DeepValue<T, P extends string> = P extends `${infer K}.${infer Rest}`
  ? K extends keyof T
    ? DeepValue<T[K], Rest>
    : never
  : P extends keyof T
    ? T[P]
    : never

interface Config {
  database: {
    host: string
    port: number
    credentials: {
      username: string
      password: string
    }
  }
  server: {
    port: number
  }
}

type DbHost = DeepValue<Config, 'database.host'> // string
type DbPort = DeepValue<Config, 'database.port'> // number
type Username = DeepValue<Config, 'database.credentials.username'> // string

// è·å–åµŒå¥—å¯¹è±¡å€¼çš„å‡½æ•°
function getDeepValue<T, P extends string>(obj: T, path: P): DeepValue<T, P> {
  const keys = path.split('.')
  let result: any = obj
  for (const key of keys) {
    result = result[key]
  }
  return result
}
```

### è®°å½•ç±»å‹

```typescript
// åˆ›å»ºç‰¹å®šé”®å€¼å¯¹ç±»å‹
type UserRole = 'admin' | 'user' | 'guest'

type RolePermissions = Record<UserRole, string[]>

const permissions: RolePermissions = {
  admin: ['read', 'write', 'delete', 'manage'],
  user: ['read', 'write'],
  guest: ['read'],
}

// ç»“åˆ keyof ä½¿ç”¨
function hasPermission(role: UserRole, permission: string): boolean {
  return permissions[role].includes(permission)
}

// åŠ¨æ€é”®ç±»å‹
type ApiEndpoints = {
  [K in 'users' | 'posts' | 'comments']: `/${K}` | `/${K}/:id`
}

const endpoints: ApiEndpoints = {
  users: '/users',
  posts: '/posts/:id',
  comments: '/comments',
}
```

### è¡¨å•å­—æ®µç±»å‹

```typescript
interface FormSchema {
  username: { type: 'text'; required: true }
  email: { type: 'email'; required: true }
  age: { type: 'number'; required: false }
  bio: { type: 'textarea'; required: false }
}

// ä» schema æ¨æ–­è¡¨å•å€¼ç±»å‹
type FieldTypeMap = {
  text: string
  email: string
  number: number
  textarea: string
}

type FormValues<
  T extends Record<string, { type: keyof FieldTypeMap; required: boolean }>,
> = {
  [K in keyof T]: T[K]['required'] extends true
    ? FieldTypeMap[T[K]['type']]
    : FieldTypeMap[T[K]['type']] | undefined
}

type MyFormValues = FormValues<FormSchema>
// {
//   username: string
//   email: string
//   age: number | undefined
//   bio: string | undefined
// }
```

## ç´¢å¼•ç­¾åä¸å…¶ä»–å±æ€§

```typescript
// ç´¢å¼•ç­¾åä¸å…·ä½“å±æ€§å…±å­˜
interface Config {
  name: string // å¿…é¡»å…¼å®¹ç´¢å¼•ç­¾å
  version: number // âŒ å¦‚æœç´¢å¼•ç­¾åæ˜¯ stringï¼Œè¿™ä¼šæŠ¥é”™
  [key: string]: string | number // éœ€è¦åŒ…å«å…·ä½“å±æ€§çš„ç±»å‹
}

// æ›´å¥½çš„åšæ³•ï¼šä½¿ç”¨äº¤å‰ç±»å‹
interface SpecificConfig {
  name: string
  version: number
}

type FlexibleConfig = SpecificConfig & {
  [key: string]: unknown
}

const config: FlexibleConfig = {
  name: 'my-app',
  version: 1,
  customField: 'value',
  anotherField: 123,
}

// ä½¿ç”¨ Record è¾…åŠ©
type ConfigWithExtras = {
  name: string
  version: number
} & Record<string, unknown>
```

## å¸¸è§é—®é¢˜

### ğŸ™‹ keyof å’Œ Object.keys æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

```typescript
interface User {
  id: number
  name: string
}

// keyof åœ¨ç¼–è¯‘æ—¶è·å–ç±»å‹
type Keys = keyof User // 'id' | 'name'

// Object.keys åœ¨è¿è¡Œæ—¶è·å–å€¼
const user: User = { id: 1, name: 'å¼ ä¸‰' }
const keys = Object.keys(user) // string[]

// ç±»å‹å®‰å…¨çš„ Object.keys
function typedKeys<T extends object>(obj: T): (keyof T)[] {
  return Object.keys(obj) as (keyof T)[]
}

const userKeys = typedKeys(user) // ('id' | 'name')[]
```

### ğŸ™‹ å¦‚ä½•é™åˆ¶ç´¢å¼•ç­¾åçš„é”®ï¼Ÿ

```typescript
// ä½¿ç”¨æ¨¡æ¿å­—é¢é‡é™åˆ¶
type DataPrefix = {
  [K in `data-${string}`]: string
}

const attrs: DataPrefix = {
  'data-id': '123',
  'data-name': 'test',
  // 'invalid': 'value'  // âŒ é”™è¯¯
}

// ä½¿ç”¨ symbol ä½œä¸ºç§æœ‰é”®
const privateKey = Symbol('private')

interface WithPrivate {
  [privateKey]: string
  public: string
}
```

### ğŸ™‹ ç´¢å¼•ç­¾åä¼šå½±å“ç±»å‹æ£€æŸ¥å—ï¼Ÿ

```typescript
interface Loose {
  [key: string]: any
  name: string
}

const obj: Loose = {
  name: 'å¼ ä¸‰',
  anything: 123, // any ç±»å‹ï¼Œå¤±å»ç±»å‹æ£€æŸ¥
}

// æ›´å®‰å…¨çš„åšæ³•
interface Strict {
  name: string
  metadata?: Record<string, unknown>
}

const safeObj: Strict = {
  name: 'å¼ ä¸‰',
  metadata: {
    anything: 123,
  },
}
```

## æ€»ç»“

| ç‰¹æ€§     | è¯­æ³•                         | ç”¨é€”             |
| -------- | ---------------------------- | ---------------- |
| keyof    | `keyof T`                    | è·å–ç±»å‹çš„æ‰€æœ‰é”® |
| ç´¢å¼•è®¿é—® | `T[K]`                       | è·å–å±æ€§çš„ç±»å‹   |
| ç´¢å¼•ç­¾å | `[key: string]: T`           | å®šä¹‰åŠ¨æ€é”®ç±»å‹   |
| æ¨¡æ¿ç´¢å¼• | `[K in \`prefix${string}\`]` | é™åˆ¶é”®çš„æ¨¡å¼     |

ä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†å­¦ä¹ æ˜ å°„ç±»å‹ï¼Œäº†è§£å¦‚ä½•åŸºäºç°æœ‰ç±»å‹åˆ›å»ºæ–°ç±»å‹ã€‚
