---
title: 'ç±»ä¸æ¥å£å¯¹æ¯”'
description: 'TypeScript ç±»ä¸æ¥å£çš„ç»“åˆä½¿ç”¨ï¼šimplements å®ç°æ¥å£ã€ç±»è¡¨è¾¾å¼ã€ç±»ä½œä¸ºç±»å‹ã€è®¾è®¡æ¨¡å¼åº”ç”¨'
pubDate: 2024-01-29
toc: true
ogImage: true
category: 'TypeScript'
tags: ['TypeScript', 'ç±»', 'æ¥å£', 'implements', 'è®¾è®¡æ¨¡å¼']
---

ç±»å’Œæ¥å£æ˜¯ TypeScript ä¸­ä¸¤ç§é‡è¦çš„ç±»å‹å®šä¹‰æ–¹å¼ã€‚ç†è§£å®ƒä»¬çš„åŒºåˆ«å’Œé…åˆä½¿ç”¨æ–¹å¼ï¼Œå¯¹äºç¼–å†™å¥å£®çš„ TypeScript ä»£ç è‡³å…³é‡è¦ã€‚

## implements å›é¡¾

ç±»ä½¿ç”¨ `implements` å®ç°æ¥å£çš„å¥‘çº¦ï¼š

```typescript
// TypeScript 5.x

interface Printable {
  print(): void
}

interface Loggable {
  log(message: string): void
}

// å®ç°å¤šä¸ªæ¥å£
class Document implements Printable, Loggable {
  constructor(private content: string) {}

  print(): void {
    console.log(this.content)
  }

  log(message: string): void {
    console.log(`[Document] ${message}`)
  }
}

const doc = new Document('Hello, World!')
doc.print()
doc.log('Created')
```

## ç±»ä½œä¸ºç±»å‹

ç±»å£°æ˜ä¼šåˆ›å»ºä¸¤ä¸ªä¸œè¥¿ï¼š

1. **æ„é€ å‡½æ•°**ï¼šç”¨äºåˆ›å»ºå®ä¾‹
2. **ç±»å‹**ï¼šæè¿°å®ä¾‹çš„ç»“æ„

```typescript
class Point {
  constructor(
    public x: number,
    public y: number
  ) {}

  distanceTo(other: Point): number {
    return Math.sqrt((this.x - other.x) ** 2 + (this.y - other.y) ** 2)
  }
}

// Point ä½œä¸ºç±»å‹ä½¿ç”¨
function printPoint(p: Point): void {
  console.log(`(${p.x}, ${p.y})`)
}

// ä»»ä½•æ»¡è¶³ Point ç»“æ„çš„å¯¹è±¡éƒ½å¯ä»¥
const point: Point = new Point(1, 2)
const fakePoint = { x: 3, y: 4, distanceTo: (other: Point) => 0 }

printPoint(point) // âœ…
printPoint(fakePoint) // âœ… ç»“æ„å…¼å®¹
```

## ç±»å‹ vs å€¼

```typescript
class User {
  constructor(
    public name: string,
    public age: number
  ) {}
}

// ä½œä¸ºç±»å‹ï¼šæè¿°å®ä¾‹å½¢çŠ¶
const user: User = new User('å¼ ä¸‰', 25)

// ä½œä¸ºå€¼ï¼šæ„é€ å‡½æ•°æœ¬èº«
const UserClass = User
const user2 = new UserClass('æå››', 30)

// typeof è·å–æ„é€ å‡½æ•°ç±»å‹
type UserConstructor = typeof User
// new (name: string, age: number) => User

function createUser(ctor: UserConstructor, name: string, age: number): User {
  return new ctor(name, age)
}

const user3 = createUser(User, 'ç‹äº”', 35)
```

## æ¥å£æè¿°ç±»çš„å½¢çŠ¶

æ¥å£å¯ä»¥æè¿°ç±»å®ä¾‹çš„å½¢çŠ¶ï¼š

```typescript
interface ClockInterface {
  currentTime: Date
  setTime(d: Date): void
}

class Clock implements ClockInterface {
  currentTime: Date = new Date()

  setTime(d: Date): void {
    this.currentTime = d
  }
}
```

### æ¥å£æè¿°æ„é€ å‡½æ•°

```typescript
// æè¿°å®ä¾‹
interface ClockInterface {
  tick(): void
}

// æè¿°æ„é€ å‡½æ•°
interface ClockConstructor {
  new (hour: number, minute: number): ClockInterface
}

// å·¥å‚å‡½æ•°ä½¿ç”¨æ„é€ å‡½æ•°æ¥å£
function createClock(
  Ctor: ClockConstructor,
  hour: number,
  minute: number
): ClockInterface {
  return new Ctor(hour, minute)
}

class DigitalClock implements ClockInterface {
  constructor(h: number, m: number) {
    // åˆå§‹åŒ–
  }

  tick(): void {
    console.log('beep beep')
  }
}

class AnalogClock implements ClockInterface {
  constructor(h: number, m: number) {
    // åˆå§‹åŒ–
  }

  tick(): void {
    console.log('tick tock')
  }
}

const digital = createClock(DigitalClock, 12, 30)
const analog = createClock(AnalogClock, 7, 45)
```

## ç±»è¡¨è¾¾å¼

```typescript
// å‘½åç±»è¡¨è¾¾å¼
const Rectangle = class RectangleClass {
  constructor(
    public width: number,
    public height: number
  ) {}

  getArea(): number {
    return this.width * this.height
  }
}

// åŒ¿åç±»è¡¨è¾¾å¼
const Square = class {
  constructor(public size: number) {}

  getArea(): number {
    return this.size * this.size
  }
}

// å®ç°æ¥å£çš„ç±»è¡¨è¾¾å¼
interface Shape {
  getArea(): number
}

const Circle: new (radius: number) => Shape = class {
  constructor(public radius: number) {}

  getArea(): number {
    return Math.PI * this.radius ** 2
  }
}
```

## æ¥å£ vs æŠ½è±¡ç±»

| ç‰¹æ€§       | æ¥å£         | æŠ½è±¡ç±»         |
| ---------- | ------------ | -------------- |
| å®ç°       | æ— ï¼ˆçº¯ç±»å‹ï¼‰ | å¯ä»¥æœ‰éƒ¨åˆ†å®ç° |
| å¤šç»§æ‰¿     | æ”¯æŒå¤šå®ç°   | åªèƒ½å•ç»§æ‰¿     |
| å­—æ®µ       | æ— åˆå§‹å€¼     | å¯ä»¥æœ‰åˆå§‹å€¼   |
| æ„é€ å‡½æ•°   | æ—            | å¯ä»¥æœ‰         |
| è®¿é—®ä¿®é¥°ç¬¦ | æ—            | æ”¯æŒ           |

```typescript
// æ¥å£ï¼šçº¯å¥‘çº¦
interface Flyable {
  fly(): void
  altitude: number
}

// æŠ½è±¡ç±»ï¼šå¯ä»¥æœ‰å®ç°
abstract class Aircraft {
  abstract fly(): void

  protected speed: number = 0

  accelerate(amount: number): void {
    this.speed += amount
    console.log(`Speed: ${this.speed}`)
  }
}

// ç»“åˆä½¿ç”¨
class Airplane extends Aircraft implements Flyable {
  altitude: number = 0

  fly(): void {
    console.log('Airplane flying')
  }
}
```

## æ··å…¥æ¨¡å¼ï¼ˆMixinsï¼‰

TypeScript å¯ä»¥é€šè¿‡æ··å…¥å®ç°ç±»ä¼¼å¤šç»§æ‰¿çš„æ•ˆæœï¼š

```typescript
// æ··å…¥ç±»å‹
type Constructor<T = {}> = new (...args: any[]) => T

// æ—¶é—´æˆ³æ··å…¥
function Timestamped<TBase extends Constructor>(Base: TBase) {
  return class extends Base {
    createdAt = new Date()
    updatedAt = new Date()

    touch() {
      this.updatedAt = new Date()
    }
  }
}

// æ ‡ç­¾æ··å…¥
function Tagged<TBase extends Constructor>(Base: TBase) {
  return class extends Base {
    tags: string[] = []

    addTag(tag: string) {
      this.tags.push(tag)
    }
  }
}

// åŸºç±»
class User {
  constructor(public name: string) {}
}

// åº”ç”¨æ··å…¥
const TaggedTimestampedUser = Tagged(Timestamped(User))

const user = new TaggedTimestampedUser('å¼ ä¸‰')
user.addTag('admin')
user.touch()

console.log(user.name) // å¼ ä¸‰
console.log(user.tags) // ['admin']
console.log(user.createdAt) // Date
```

## ä¾èµ–æ³¨å…¥æ¨¡å¼

```typescript
// æœåŠ¡æ¥å£
interface Logger {
  log(message: string): void
}

interface Database {
  query(sql: string): Promise<any[]>
}

// å®ç°
class ConsoleLogger implements Logger {
  log(message: string): void {
    console.log(message)
  }
}

class MySQLDatabase implements Database {
  async query(sql: string): Promise<any[]> {
    console.log(`Executing: ${sql}`)
    return []
  }
}

// ä½¿ç”¨ä¾èµ–æ³¨å…¥
class UserService {
  constructor(
    private logger: Logger,
    private database: Database
  ) {}

  async getUsers(): Promise<any[]> {
    this.logger.log('Fetching users...')
    return this.database.query('SELECT * FROM users')
  }
}

// ç»„è£…
const logger = new ConsoleLogger()
const database = new MySQLDatabase()
const userService = new UserService(logger, database)
```

## å·¥å‚æ¨¡å¼

```typescript
interface Product {
  name: string
  price: number
  describe(): string
}

interface ProductFactory {
  create(name: string, price: number): Product
}

class Book implements Product {
  constructor(
    public name: string,
    public price: number,
    public author: string
  ) {}

  describe(): string {
    return `ã€Š${this.name}ã€‹ by ${this.author} - Â¥${this.price}`
  }
}

class Electronics implements Product {
  constructor(
    public name: string,
    public price: number,
    public warranty: number
  ) {}

  describe(): string {
    return `${this.name} - Â¥${this.price} (${this.warranty}å¹´ä¿ä¿®)`
  }
}

class BookFactory implements ProductFactory {
  constructor(private defaultAuthor: string) {}

  create(name: string, price: number): Book {
    return new Book(name, price, this.defaultAuthor)
  }
}

class ElectronicsFactory implements ProductFactory {
  constructor(private defaultWarranty: number) {}

  create(name: string, price: number): Electronics {
    return new Electronics(name, price, this.defaultWarranty)
  }
}

// ä½¿ç”¨
const bookFactory = new BookFactory('æœªçŸ¥ä½œè€…')
const electronicsFactory = new ElectronicsFactory(1)

const book = bookFactory.create('TypeScript æŒ‡å—', 99)
const phone = electronicsFactory.create('æ™ºèƒ½æ‰‹æœº', 4999)

console.log(book.describe())
console.log(phone.describe())
```

## å®é™…åº”ç”¨ï¼šæœåŠ¡å±‚è®¾è®¡

```typescript
// ä»“å‚¨æ¥å£
interface Repository<T> {
  findById(id: string): Promise<T | null>
  findAll(): Promise<T[]>
  save(entity: T): Promise<T>
  delete(id: string): Promise<void>
}

// å®ä½“
interface User {
  id: string
  name: string
  email: string
}

// æœåŠ¡æ¥å£
interface UserService {
  getUser(id: string): Promise<User | null>
  getAllUsers(): Promise<User[]>
  createUser(data: Omit<User, 'id'>): Promise<User>
  deleteUser(id: string): Promise<void>
}

// ä»“å‚¨å®ç°
class InMemoryUserRepository implements Repository<User> {
  private users: Map<string, User> = new Map()

  async findById(id: string): Promise<User | null> {
    return this.users.get(id) || null
  }

  async findAll(): Promise<User[]> {
    return Array.from(this.users.values())
  }

  async save(user: User): Promise<User> {
    this.users.set(user.id, user)
    return user
  }

  async delete(id: string): Promise<void> {
    this.users.delete(id)
  }
}

// æœåŠ¡å®ç°
class UserServiceImpl implements UserService {
  constructor(private repository: Repository<User>) {}

  async getUser(id: string): Promise<User | null> {
    return this.repository.findById(id)
  }

  async getAllUsers(): Promise<User[]> {
    return this.repository.findAll()
  }

  async createUser(data: Omit<User, 'id'>): Promise<User> {
    const user: User = {
      id: Math.random().toString(36).slice(2),
      ...data,
    }
    return this.repository.save(user)
  }

  async deleteUser(id: string): Promise<void> {
    return this.repository.delete(id)
  }
}

// ä½¿ç”¨
const repository = new InMemoryUserRepository()
const service = new UserServiceImpl(repository)

async function main() {
  const user = await service.createUser({
    name: 'å¼ ä¸‰',
    email: 'zhangsan@example.com',
  })
  console.log('Created:', user)

  const users = await service.getAllUsers()
  console.log('All users:', users)
}
```

## å¸¸è§é—®é¢˜

### ğŸ™‹ ä½•æ—¶ç”¨æ¥å£ï¼Œä½•æ—¶ç”¨ç±»ï¼Ÿ

- **æ¥å£**ï¼šå®šä¹‰å¥‘çº¦ã€æè¿°æ•°æ®ç»“æ„
- **ç±»**ï¼šéœ€è¦å®ä¾‹åŒ–ã€æœ‰çŠ¶æ€å’Œè¡Œä¸º
- **æŠ½è±¡ç±»**ï¼šéœ€è¦éƒ¨åˆ†å®ç°ã€å¼ºåˆ¶ç»§æ‰¿å…³ç³»

### ğŸ™‹ ç±»å®ç°æ¥å£æ—¶ï¼Œæ¥å£çš„å±æ€§ä¼šæˆä¸ºç±»çš„å±æ€§å—ï¼Ÿ

ä¸ä¼šè‡ªåŠ¨æˆä¸ºï¼Œéœ€è¦æ‰‹åŠ¨å£°æ˜ï¼š

```typescript
interface Named {
  name: string
}

// âŒ é”™è¯¯ï¼šç¼ºå°‘ name å±æ€§
// class Person implements Named { }

// âœ… å¿…é¡»æ‰‹åŠ¨å£°æ˜
class Person implements Named {
  name: string = ''
}
```

### ğŸ™‹ å¦‚ä½•æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å®ç°äº†æŸä¸ªæ¥å£ï¼Ÿ

TypeScript çš„æ¥å£æ˜¯ç¼–è¯‘æ—¶æ¦‚å¿µï¼Œè¿è¡Œæ—¶ä¸å­˜åœ¨ã€‚éœ€è¦ç”¨ç±»å‹å®ˆå«ï¼š

```typescript
interface Flyable {
  fly(): void
}

function isFlyable(obj: unknown): obj is Flyable {
  return typeof obj === 'object' && obj !== null && 'fly' in obj
}

if (isFlyable(someObject)) {
  someObject.fly()
}
```

## æ€»ç»“

| ä½¿ç”¨åœºæ™¯     | é€‰æ‹©      |
| ------------ | --------- |
| æè¿°æ•°æ®ç»“æ„ | æ¥å£      |
| å®šä¹‰æœåŠ¡å¥‘çº¦ | æ¥å£      |
| éœ€è¦å®ä¾‹åŒ–   | ç±»        |
| éœ€è¦éƒ¨åˆ†å®ç° | æŠ½è±¡ç±»    |
| ä¾èµ–æ³¨å…¥     | æ¥å£ + ç±» |
| å·¥å‚æ¨¡å¼     | æ¥å£ + ç±» |

ä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†è¿›å…¥æ³›å‹çš„å­¦ä¹ ï¼ŒæŒæ¡ TypeScript ä¸­æœ€å¼ºå¤§çš„ç±»å‹å·¥å…·ä¹‹ä¸€ã€‚
