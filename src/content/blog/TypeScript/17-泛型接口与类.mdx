---
title: 'æ³›å‹æ¥å£ä¸æ³›å‹ç±»'
description: 'TypeScript æ³›å‹æ¥å£ä¸æ³›å‹ç±»è¯¦è§£ï¼šæ³›å‹æ¥å£å®šä¹‰ã€æ³›å‹ç±»å®ç°ã€é»˜è®¤ç±»å‹å‚æ•°çš„ä½¿ç”¨æ–¹æ³•'
pubDate: 2024-01-31
toc: true
ogImage: true
category: 'TypeScript'
tags: ['TypeScript', 'æ³›å‹æ¥å£', 'æ³›å‹ç±»', 'Generics']
---

æ³›å‹ä¸ä»…å¯ä»¥ç”¨äºå‡½æ•°ï¼Œè¿˜å¯ä»¥ç”¨äºæ¥å£å’Œç±»ã€‚è¿™è®©æˆ‘ä»¬èƒ½å¤Ÿåˆ›å»ºæ›´åŠ çµæ´»å’Œå¯å¤ç”¨çš„æ•°æ®ç»“æ„ã€‚

## æ³›å‹æ¥å£

### åŸºæœ¬å®šä¹‰

```typescript
// TypeScript 5.x

// æ³›å‹æ¥å£
interface Container<T> {
  value: T
  getValue(): T
  setValue(value: T): void
}

// å®ç°æ³›å‹æ¥å£
const stringContainer: Container<string> = {
  value: 'hello',
  getValue() {
    return this.value
  },
  setValue(value) {
    this.value = value
  },
}

const numberContainer: Container<number> = {
  value: 42,
  getValue() {
    return this.value
  },
  setValue(value) {
    this.value = value
  },
}
```

### å¤šç±»å‹å‚æ•°

```typescript
// é”®å€¼å¯¹æ¥å£
interface KeyValuePair<K, V> {
  key: K
  value: V
}

const pair1: KeyValuePair<string, number> = {
  key: 'age',
  value: 25,
}

const pair2: KeyValuePair<number, string> = {
  key: 1,
  value: 'first',
}

// å­—å…¸æ¥å£
interface Dictionary<K extends string | number, V> {
  get(key: K): V | undefined
  set(key: K, value: V): void
  has(key: K): boolean
}
```

### å‡½æ•°ç±»å‹æ¥å£

```typescript
// å‡½æ•°ç±»å‹çš„æ³›å‹æ¥å£
interface Transformer<T, U> {
  (input: T): U
}

const stringToNumber: Transformer<string, number> = (s) => parseInt(s)
const numberToString: Transformer<number, string> = (n) => n.toString()

// å¸¦æ–¹æ³•çš„å‡½æ•°æ¥å£
interface Parser<T> {
  (input: string): T
  validate(input: string): boolean
}

const jsonParser: Parser<object> = Object.assign(
  (input: string) => JSON.parse(input),
  {
    validate: (input: string) => {
      try {
        JSON.parse(input)
        return true
      } catch {
        return false
      }
    },
  }
)
```

### ç»§æ‰¿æ³›å‹æ¥å£

```typescript
// åŸºç¡€ä»“å‚¨æ¥å£
interface Repository<T> {
  findById(id: string): Promise<T | null>
  findAll(): Promise<T[]>
  save(entity: T): Promise<T>
  delete(id: string): Promise<void>
}

// æ‰©å±•æ¥å£
interface SortableRepository<T> extends Repository<T> {
  findAllSorted(field: keyof T, order: 'asc' | 'desc'): Promise<T[]>
}

// å¸¦åˆ†é¡µçš„æ¥å£
interface PaginatedRepository<T> extends Repository<T> {
  findPaginated(
    page: number,
    size: number
  ): Promise<{
    items: T[]
    total: number
    page: number
    pageSize: number
  }>
}

// ç»„åˆæ¥å£
interface AdvancedRepository<T>
  extends SortableRepository<T>,
    PaginatedRepository<T> {
  search(query: Partial<T>): Promise<T[]>
}
```

## æ³›å‹ç±»

### åŸºæœ¬å®šä¹‰

```typescript
class Box<T> {
  private content: T

  constructor(initial: T) {
    this.content = initial
  }

  get(): T {
    return this.content
  }

  set(value: T): void {
    this.content = value
  }
}

const stringBox = new Box<string>('hello')
console.log(stringBox.get()) // "hello"
stringBox.set('world')

const numberBox = new Box(42) // ç±»å‹æ¨æ–­ä¸º Box<number>
console.log(numberBox.get()) // 42
```

### å¤šç±»å‹å‚æ•°

```typescript
class Pair<T, U> {
  constructor(
    public first: T,
    public second: U
  ) {}

  swap(): Pair<U, T> {
    return new Pair(this.second, this.first)
  }

  map<V, W>(fn1: (value: T) => V, fn2: (value: U) => W): Pair<V, W> {
    return new Pair(fn1(this.first), fn2(this.second))
  }
}

const pair = new Pair('hello', 42)
const swapped = pair.swap() // Pair<number, string>
const mapped = pair.map(
  (s) => s.length,
  (n) => n.toString()
)
// Pair<number, string>
```

### æ³›å‹ç±»å®ç°æ³›å‹æ¥å£

```typescript
interface Stack<T> {
  push(item: T): void
  pop(): T | undefined
  peek(): T | undefined
  isEmpty(): boolean
  size(): number
}

class ArrayStack<T> implements Stack<T> {
  private items: T[] = []

  push(item: T): void {
    this.items.push(item)
  }

  pop(): T | undefined {
    return this.items.pop()
  }

  peek(): T | undefined {
    return this.items[this.items.length - 1]
  }

  isEmpty(): boolean {
    return this.items.length === 0
  }

  size(): number {
    return this.items.length
  }
}

const numberStack = new ArrayStack<number>()
numberStack.push(1)
numberStack.push(2)
console.log(numberStack.pop()) // 2
```

### é™æ€æˆå‘˜ä¸æ³›å‹

é™æ€æˆå‘˜ä¸èƒ½ä½¿ç”¨ç±»çš„ç±»å‹å‚æ•°ï¼š

```typescript
class Container<T> {
  // âŒ é™æ€æˆå‘˜ä¸èƒ½å¼•ç”¨ç±»å‹å‚æ•°
  // static defaultValue: T;

  // âœ… å¯ä»¥æœ‰è‡ªå·±çš„æ³›å‹
  static create<U>(value: U): Container<U> {
    return new Container(value)
  }

  constructor(public value: T) {}
}

const container = Container.create('hello') // Container<string>
```

### æ³›å‹ç±»ç»§æ‰¿

```typescript
// åŸºç±»
class Collection<T> {
  protected items: T[] = []

  add(item: T): void {
    this.items.push(item)
  }

  remove(item: T): boolean {
    const index = this.items.indexOf(item)
    if (index > -1) {
      this.items.splice(index, 1)
      return true
    }
    return false
  }

  toArray(): T[] {
    return [...this.items]
  }
}

// ä¿æŒæ³›å‹ç»§æ‰¿
class SortableCollection<T> extends Collection<T> {
  sort(compareFn: (a: T, b: T) => number): void {
    this.items.sort(compareFn)
  }
}

// å›ºå®šç±»å‹ç»§æ‰¿
class StringCollection extends Collection<string> {
  join(separator: string): string {
    return this.items.join(separator)
  }
}

// æ·»åŠ æ–°ç±»å‹å‚æ•°
class MappedCollection<T, K> extends Collection<T> {
  private keyFn: (item: T) => K

  constructor(keyFn: (item: T) => K) {
    super()
    this.keyFn = keyFn
  }

  findByKey(key: K): T | undefined {
    return this.items.find((item) => this.keyFn(item) === key)
  }
}
```

## é»˜è®¤ç±»å‹å‚æ•°

```typescript
// æ¥å£é»˜è®¤ç±»å‹
interface Response<T = any> {
  data: T
  status: number
  message: string
}

const res1: Response = { data: 'anything', status: 200, message: 'OK' }
const res2: Response<string[]> = {
  data: ['a', 'b'],
  status: 200,
  message: 'OK',
}

// ç±»é»˜è®¤ç±»å‹
class EventEmitter<T = Record<string, unknown>> {
  private handlers = new Map<keyof T, Function[]>()

  on<K extends keyof T>(event: K, handler: (payload: T[K]) => void): void {
    const list = this.handlers.get(event) || []
    list.push(handler)
    this.handlers.set(event, list)
  }

  emit<K extends keyof T>(event: K, payload: T[K]): void {
    const handlers = this.handlers.get(event) || []
    handlers.forEach((h) => h(payload))
  }
}

// ä½¿ç”¨é»˜è®¤ç±»å‹
const emitter1 = new EventEmitter()
emitter1.on('anyEvent', (data) => console.log(data))

// æŒ‡å®šäº‹ä»¶ç±»å‹
interface AppEvents {
  login: { userId: string }
  logout: undefined
  error: Error
}

const emitter2 = new EventEmitter<AppEvents>()
emitter2.on('login', (payload) => console.log(payload.userId))
emitter2.emit('login', { userId: '123' })
```

## å®é™…åº”ç”¨

### é€šç”¨æ•°æ®ç»“æ„

```typescript
// é“¾è¡¨èŠ‚ç‚¹
class ListNode<T> {
  constructor(
    public value: T,
    public next: ListNode<T> | null = null
  ) {}
}

// é“¾è¡¨
class LinkedList<T> {
  private head: ListNode<T> | null = null
  private tail: ListNode<T> | null = null
  private _size = 0

  get size(): number {
    return this._size
  }

  append(value: T): void {
    const node = new ListNode(value)
    if (!this.tail) {
      this.head = this.tail = node
    } else {
      this.tail.next = node
      this.tail = node
    }
    this._size++
  }

  prepend(value: T): void {
    const node = new ListNode(value, this.head)
    this.head = node
    if (!this.tail) {
      this.tail = node
    }
    this._size++
  }

  *[Symbol.iterator](): Iterator<T> {
    let current = this.head
    while (current) {
      yield current.value
      current = current.next
    }
  }

  toArray(): T[] {
    return [...this]
  }
}

const list = new LinkedList<number>()
list.append(1)
list.append(2)
list.prepend(0)
console.log(list.toArray()) // [0, 1, 2]
```

### çŠ¶æ€ç®¡ç†

```typescript
interface State {
  [key: string]: unknown
}

class Store<S extends State> {
  private state: S
  private listeners: ((state: S) => void)[] = []

  constructor(initialState: S) {
    this.state = initialState
  }

  getState(): S {
    return this.state
  }

  setState(partial: Partial<S>): void {
    this.state = { ...this.state, ...partial }
    this.notify()
  }

  subscribe(listener: (state: S) => void): () => void {
    this.listeners.push(listener)
    return () => {
      this.listeners = this.listeners.filter((l) => l !== listener)
    }
  }

  private notify(): void {
    this.listeners.forEach((l) => l(this.state))
  }
}

interface AppState {
  user: { name: string } | null
  count: number
  loading: boolean
}

const store = new Store<AppState>({
  user: null,
  count: 0,
  loading: false,
})

store.subscribe((state) => console.log('State changed:', state))
store.setState({ count: 1 })
store.setState({ user: { name: 'å¼ ä¸‰' } })
```

## å¸¸è§é—®é¢˜

### ğŸ™‹ æ³›å‹ç±»çš„ç±»å‹å‚æ•°å¯ä»¥ç”¨äºé™æ€æˆå‘˜å—ï¼Ÿ

ä¸èƒ½ã€‚é™æ€æˆå‘˜å±äºç±»æœ¬èº«ï¼Œè€Œç±»å‹å‚æ•°æ˜¯å®ä¾‹çº§åˆ«çš„ï¼š

```typescript
class Example<T> {
  // âŒ é”™è¯¯
  // static value: T;

  // âœ… é™æ€æ–¹æ³•å¯ä»¥æœ‰è‡ªå·±çš„ç±»å‹å‚æ•°
  static of<U>(value: U): Example<U> {
    return new Example()
  }
}
```

### ğŸ™‹ æ³›å‹æ¥å£å’Œæ³›å‹ç±»å‹åˆ«åæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

ä¸»è¦åŒºåˆ«åœ¨äºæ¥å£å¯ä»¥åˆå¹¶å£°æ˜ï¼š

```typescript
// æ¥å£å¯ä»¥åˆå¹¶
interface Box<T> {
  value: T
}
interface Box<T> {
  isEmpty(): boolean
}

// type ä¸èƒ½åˆå¹¶
type BoxType<T> = {
  value: T
}
// type BoxType<T> = { isEmpty(): boolean }  // âŒ é”™è¯¯
```

### ğŸ™‹ å¦‚ä½•çº¦æŸæ³›å‹ç±»çš„ç±»å‹å‚æ•°ï¼Ÿ

ä½¿ç”¨ `extends` å…³é”®å­—ï¼š

```typescript
interface Identifiable {
  id: string
}

class Repository<T extends Identifiable> {
  private items = new Map<string, T>()

  save(item: T): void {
    this.items.set(item.id, item)
  }

  findById(id: string): T | undefined {
    return this.items.get(id)
  }
}
```

## æ€»ç»“

| ç‰¹æ€§     | è¯­æ³•                          | ç”¨é€”             |
| -------- | ----------------------------- | ---------------- |
| æ³›å‹æ¥å£ | `interface Box<T> { }`        | å®šä¹‰é€šç”¨å¥‘çº¦     |
| æ³›å‹ç±»   | `class Box<T> { }`            | åˆ›å»ºé€šç”¨æ•°æ®ç»“æ„ |
| é»˜è®¤ç±»å‹ | `<T = string>`                | æä¾›ç±»å‹é»˜è®¤å€¼   |
| æ¥å£ç»§æ‰¿ | `extends GenericInterface<T>` | æ‰©å±•æ³›å‹æ¥å£     |
| ç±»ç»§æ‰¿   | `extends GenericClass<T>`     | ç»§æ‰¿æ³›å‹ç±»       |

ä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†å­¦ä¹ æ³›å‹çº¦æŸï¼Œäº†è§£å¦‚ä½•é™åˆ¶ç±»å‹å‚æ•°çš„èŒƒå›´ã€‚
