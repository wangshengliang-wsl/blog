---
title: 'å£°æ˜æ–‡ä»¶è¿›é˜¶'
description: 'TypeScript å£°æ˜æ–‡ä»¶è¿›é˜¶ï¼šæ¨¡å—å£°æ˜ã€å…¨å±€å£°æ˜ã€ä¸‰æ–œçº¿æŒ‡ä»¤ã€å¤æ‚ç±»å‹å£°æ˜æŠ€å·§'
pubDate: 2024-02-15
toc: true
ogImage: true
category: 'TypeScript'
tags: ['TypeScript', 'å£°æ˜æ–‡ä»¶', 'æ¨¡å—å£°æ˜', 'å…¨å±€å£°æ˜', 'ä¸‰æ–œçº¿æŒ‡ä»¤']
---

æŒæ¡åŸºç¡€å£°æ˜æ–‡ä»¶åï¼Œæœ¬ï¿½ï¿½ä»‹ç»æ›´å¤æ‚çš„å£°æ˜åœºæ™¯å’Œé«˜çº§æŠ€å·§ã€‚

## ä¸‰æ–œçº¿æŒ‡ä»¤

ä¸‰æ–œçº¿æŒ‡ä»¤æ˜¯å£°æ˜æ–‡ä»¶ä¹‹é—´çš„å¼•ç”¨æ–¹å¼ï¼š

```typescript
// TypeScript 5.x

// å¼•ç”¨å…¶ä»–å£°æ˜æ–‡ä»¶
/// <reference path="./other.d.ts" />

// å¼•ç”¨ @types åŒ…
/// <reference types="node" />

// å¼•ç”¨ ES å†…ç½®åº“
/// <reference lib="es2015" />
/// <reference lib="dom" />
```

### reference path

å¼•ç”¨æœ¬åœ°å£°æ˜æ–‡ä»¶ï¿½ï¿½ï¿½

```typescript
// === types/base.d.ts ===
interface BaseEntity {
  id: string
  createdAt: Date
  updatedAt: Date
}

// === types/user.d.ts ===
/// <reference path="./base.d.ts" />

interface User extends BaseEntity {
  name: string
  email: string
}

// === types/index.d.ts ===
/// <reference path="./base.d.ts" />
/// <reference path="./user.d.ts" />
```

### reference types

å¼•ç”¨ npm åŒ…ä¸­çš„ç±»å‹ï¼š

```typescript
// === my-library.d.ts ===
/// <reference types="node" />

import { EventEmitter } from 'events'

export class MyEmitter extends EventEmitter {
  emit(event: 'data', data: Buffer): boolean
  emit(event: 'end'): boolean
  emit(event: string, ...args: unknown[]): boolean
}
```

### reference lib

å¼•ç”¨å†…ç½®åº“ï¼š

```typescript
// åªå¼•ç”¨éœ€è¦çš„åº“
/// <reference lib="es2015.promise" />
/// <reference lib="es2015.iterable" />
/// <reference lib="dom" />

// è€Œä¸æ˜¯åœ¨ tsconfig.json ä¸­é…ç½®
```

## å¤æ‚æ¨¡å—å£°æ˜

### UMD æ¨¡å—

åŒæ—¶æ”¯æŒå¤šç§æ¨¡å—ç³»ç»Ÿï¼š

```typescript
// my-library.d.ts
export as namespace MyLibrary

export function init(options: Options): void
export function destroy(): void

export interface Options {
  debug?: boolean
}

export default class MyLibrary {
  constructor(options?: Options)
  start(): void
  stop(): void
}

// ä½¿ç”¨æ–¹å¼

// ES æ¨¡å—
import MyLibrary from 'my-library'

// CommonJS
const MyLibrary = require('my-library')

// å…¨å±€å˜é‡ï¼ˆæµè§ˆå™¨ï¼‰
MyLibrary.init({ debug: true })
```

### å¯¼å‡ºå‡½æ•°å’Œå‘½åç©ºé—´

```typescript
// lodash.d.ts
export = _

declare function _(value: string): _.LoDashWrapper<string>
declare function _(value: number): _.LoDashWrapper<number>
declare function _<T>(value: T[]): _.LoDashArrayWrapper<T>
declare function _<T extends object>(value: T): _.LoDashObjectWrapper<T>

declare namespace _ {
  interface LoDashWrapper<T> {
    value(): T
  }

  interface LoDashArrayWrapper<T> {
    first(): T | undefined
    last(): T | undefined
    value(): T[]
  }

  interface LoDashObjectWrapper<T> {
    keys(): string[]
    values(): unknown[]
    value(): T
  }

  function map<T, R>(array: T[], fn: (item: T) => R): R[]
  function filter<T>(array: T[], fn: (item: T) => boolean): T[]
  function reduce<T, R>(array: T[], fn: (acc: R, item: T) => R, initial: R): R
}

// ä½¿ç”¨
import _ from 'lodash'

const result = _([1, 2, 3]).first()
const mapped = _.map([1, 2, 3], (n) => n * 2)
```

### å¯è°ƒç”¨å¯¹è±¡

```typescript
// æ—¢æ˜¯å‡½æ•°åˆæœ‰å±æ€§
interface JQuery {
  (selector: string): JQueryElement
  (element: HTMLElement): JQueryElement
  (callback: () => void): void

  ajax(options: AjaxOptions): Promise<unknown>
  get(url: string): Promise<unknown>
  post(url: string, data: unknown): Promise<unknown>

  fn: JQueryPrototype
  version: string
}

interface JQueryElement {
  html(): string
  html(content: string): this
  css(property: string): string
  css(property: string, value: string): this
  addClass(className: string): this
  removeClass(className: string): this
  on(event: string, handler: (e: Event) => void): this
}

interface AjaxOptions {
  url: string
  method?: string
  data?: unknown
}

interface JQueryPrototype {
  extend(plugin: Record<string, Function>): void
}

declare const $: JQuery
```

### ç±»çš„é™æ€å’Œå®ä¾‹

```typescript
// åˆ†ç¦»é™æ€å’Œå®ä¾‹ç±»å‹
interface UserConstructor {
  new (name: string, email: string): UserInstance
  fromJSON(json: string): UserInstance
  defaultRole: string
}

interface UserInstance {
  name: string
  email: string
  greet(): string
  toJSON(): string
}

declare const User: UserConstructor

// ä½¿ç”¨
const user = new User('å¼ ä¸‰', 'test@test.com')
user.greet()

const user2 = User.fromJSON('{}')
console.log(User.defaultRole)
```

## å…¨å±€å£°æ˜

### åœ¨æ¨¡å—ä¸­å£°æ˜å…¨å±€

```typescript
// globals.d.ts
export {}

declare global {
  // å…¨å±€å˜é‡
  const __DEV__: boolean
  const __VERSION__: string

  // å…¨å±€å‡½æ•°
  function __log__(message: string): void

  // æ‰©å±• Window
  interface Window {
    dataLayer: unknown[]
    gtag(...args: unknown[]): void
  }

  // æ‰©å±• NodeJS
  namespace NodeJS {
    interface ProcessEnv {
      NODE_ENV: 'development' | 'production' | 'test'
      DATABASE_URL: string
      API_KEY: string
    }
  }

  // æ‰©å±•å†…ç½®ç±»å‹
  interface Array<T> {
    unique(): T[]
    groupBy<K extends string | number>(fn: (item: T) => K): Record<K, T[]>
  }

  interface String {
    toTitleCase(): string
  }
}
```

### ç¯å¢ƒå£°æ˜

```typescript
// env.d.ts
/// <reference types="vite/client" />

interface ImportMetaEnv {
  readonly VITE_API_URL: string
  readonly VITE_APP_TITLE: string
  readonly VITE_DEBUG: string
}

interface ImportMeta {
  readonly env: ImportMetaEnv
}

// ä½¿ç”¨
console.log(import.meta.env.VITE_API_URL)
```

## å£°æ˜åˆå¹¶

### æ¥å£åˆå¹¶

```typescript
// æ‰©å±•ç¬¬ä¸‰æ–¹åº“çš„æ¥å£
import 'express-serve-static-core'

declare module 'express-serve-static-core' {
  interface Request {
    user?: {
      id: string
      role: string
    }
    startTime?: number
  }

  interface Response {
    success<T>(data: T): void
    fail(error: Error): void
  }
}

// ä½¿ç”¨
import express from 'express'

const app = express()

app.use((req, res, next) => {
  req.startTime = Date.now()
  next()
})

app.get('/', (req, res) => {
  res.success({ message: 'ok' })
})
```

### å‘½åç©ºé—´åˆå¹¶

```typescript
// æ‰©å±•æšä¸¾
enum Color {
  Red,
  Green,
  Blue,
}

namespace Color {
  export function fromString(str: string): Color | undefined {
    switch (str.toLowerCase()) {
      case 'red':
        return Color.Red
      case 'green':
        return Color.Green
      case 'blue':
        return Color.Blue
      default:
        return undefined
    }
  }

  export function toString(color: Color): string {
    return Color[color].toLowerCase()
  }
}

// ä½¿ç”¨
const color = Color.fromString('red')
const str = Color.toString(Color.Blue)
```

## æ¡ä»¶ç±»å‹åœ¨å£°æ˜ä¸­çš„åº”ç”¨

```typescript
// æ ¹æ®å‚æ•°ç±»å‹è¿”å›ä¸åŒç±»å‹
declare function createElement<T extends keyof HTMLElementTagNameMap>(
  tag: T
): HTMLElementTagNameMap[T]

declare function createElement(tag: string): HTMLElement

// ä½¿ç”¨
const div = createElement('div') // HTMLDivElement
const span = createElement('span') // HTMLSpanElement
const custom = createElement('my-element') // HTMLElement

// äº‹ä»¶å¤„ç†å™¨å£°æ˜
interface EventMap {
  click: MouseEvent
  keydown: KeyboardEvent
  focus: FocusEvent
  custom: CustomEvent
}

declare function addEventListener<K extends keyof EventMap>(
  type: K,
  listener: (event: EventMap[K]) => void
): void

declare function addEventListener(
  type: string,
  listener: (event: Event) => void
): void

// ä½¿ç”¨
addEventListener('click', (e) => {
  console.log(e.clientX) // MouseEvent
})

addEventListener('keydown', (e) => {
  console.log(e.key) // KeyboardEvent
})
```

## æ³›å‹å£°æ˜

```typescript
// å¤æ‚æ³›å‹å‡½æ•°
declare function pick<T, K extends keyof T>(obj: T, keys: K[]): Pick<T, K>

declare function omit<T, K extends keyof T>(obj: T, keys: K[]): Omit<T, K>

declare function merge<T, U>(target: T, source: U): T & U

// Promise å·¥å…·
declare function promiseAll<T extends readonly unknown[]>(
  promises: T
): Promise<{ [K in keyof T]: Awaited<T[K]> }>

declare function promiseRace<T>(promises: Promise<T>[]): Promise<T>

// ç±»å‹æ¨æ–­
declare function identity<T>(value: T): T

declare function pair<T, U>(first: T, second: U): [T, U]

// æ¡ä»¶æ³›å‹
declare function isDefined<T>(value: T | undefined | null): value is T

declare function assertDefined<T>(
  value: T | undefined | null
): asserts value is T
```

## å®é™…æ¡ˆä¾‹

### React ç»„ä»¶å£°æ˜

```typescript
// react-components.d.ts
import * as React from 'react'

declare module 'my-ui-library' {
  export interface ButtonProps {
    variant?: 'primary' | 'secondary' | 'danger'
    size?: 'small' | 'medium' | 'large'
    disabled?: boolean
    loading?: boolean
    onClick?: (event: React.MouseEvent<HTMLButtonElement>) => void
    children: React.ReactNode
  }

  export const Button: React.FC<ButtonProps>

  export interface InputProps {
    value?: string
    defaultValue?: string
    placeholder?: string
    onChange?: (value: string) => void
    onBlur?: () => void
  }

  export const Input: React.ForwardRefExoticComponent<
    InputProps & React.RefAttributes<HTMLInputElement>
  >

  export interface ModalProps {
    open: boolean
    onClose: () => void
    title?: string
    children: React.ReactNode
  }

  export const Modal: React.FC<ModalProps>
}
```

### æ•°æ®åº“å®¢æˆ·ç«¯å£°æ˜

```typescript
// database.d.ts
declare module 'my-database' {
  export interface QueryResult<T> {
    rows: T[]
    rowCount: number
    command: string
  }

  export interface ConnectionConfig {
    host: string
    port: number
    database: string
    user: string
    password: string
  }

  export class Client {
    constructor(config: ConnectionConfig)
    connect(): Promise<void>
    disconnect(): Promise<void>
    query<T = unknown>(sql: string, params?: unknown[]): Promise<QueryResult<T>>
    transaction<T>(fn: (client: Client) => Promise<T>): Promise<T>
  }

  export class Pool {
    constructor(config: ConnectionConfig & { max?: number })
    query<T = unknown>(sql: string, params?: unknown[]): Promise<QueryResult<T>>
    getClient(): Promise<Client>
    end(): Promise<void>
  }
}
```

### API å®¢æˆ·ç«¯å£°æ˜

```typescript
// api-client.d.ts
declare module 'api-client' {
  export interface RequestConfig {
    baseURL?: string
    timeout?: number
    headers?: Record<string, string>
  }

  export interface Response<T> {
    data: T
    status: number
    headers: Record<string, string>
  }

  export interface ApiClient {
    get<T>(url: string, config?: RequestConfig): Promise<Response<T>>
    post<T>(
      url: string,
      data?: unknown,
      config?: RequestConfig
    ): Promise<Response<T>>
    put<T>(
      url: string,
      data?: unknown,
      config?: RequestConfig
    ): Promise<Response<T>>
    delete<T>(url: string, config?: RequestConfig): Promise<Response<T>>

    interceptors: {
      request: InterceptorManager<RequestConfig>
      response: InterceptorManager<Response<unknown>>
    }
  }

  export interface InterceptorManager<T> {
    use(
      onFulfilled?: (value: T) => T | Promise<T>,
      onRejected?: (error: unknown) => unknown
    ): number
    eject(id: number): void
  }

  export function create(config?: RequestConfig): ApiClient

  const defaultClient: ApiClient
  export default defaultClient
}
```

## å¸¸è§é—®é¢˜

### ğŸ™‹ å¦‚ä½•å¤„ç† this ç±»å‹ï¼Ÿ

```typescript
// é“¾å¼è°ƒç”¨å£°æ˜
declare class Builder<T> {
  set<K extends string, V>(key: K, value: V): Builder<T & { [P in K]: V }>
  build(): T
}

// ä½¿ç”¨
const obj = new Builder().set('name', 'å¼ ä¸‰').set('age', 25).build()
// { name: string; age: number }
```

### ğŸ™‹ å¦‚ä½•å£°æ˜å›è°ƒå‡½æ•°ï¼Ÿ

```typescript
// å›è°ƒå‡½æ•°ç±»å‹
type Callback<T> = (error: Error | null, result?: T) => void

declare function readFile(path: string, callback: Callback<string>): void

declare function readFileAsync(path: string): Promise<string>

// äº‹ä»¶å›è°ƒ
type EventCallback<T> = (event: T) => void

declare function on<K extends keyof EventMap>(
  event: K,
  callback: EventCallback<EventMap[K]>
): void
```

### ğŸ™‹ å¦‚ä½•æµ‹è¯•å£°æ˜æ–‡ä»¶ï¼Ÿ

```typescript
// åˆ›å»ºæµ‹è¯•æ–‡ä»¶ test.ts
import MyLib from 'my-lib'

// æµ‹è¯•ç±»å‹æ˜¯å¦æ­£ç¡®
const lib = new MyLib() // $ExpectType MyLib
lib.method() // $ExpectType string

// æµ‹è¯•ç±»å‹é”™è¯¯
// @ts-expect-error
lib.method(123) // åº”è¯¥æŠ¥é”™

// è¿è¡Œ tsc --noEmit æ£€æŸ¥
```

## æ€»ç»“

| ç‰¹æ€§            | è¯­æ³•                         | ç”¨é€”           |
| --------------- | ---------------------------- | -------------- |
| reference path  | `/// <reference path="" />`  | å¼•ç”¨æœ¬åœ°å£°æ˜   |
| reference types | `/// <reference types="" />` | å¼•ç”¨ç±»å‹åŒ…     |
| reference lib   | `/// <reference lib="" />`   | å¼•ç”¨å†…ç½®åº“     |
| UMD             | `export as namespace`        | æ”¯æŒå…¨å±€å’Œæ¨¡å— |
| å…¨å±€å£°æ˜        | `declare global`             | æ¨¡å—ä¸­æ·»åŠ å…¨å±€ |
| å£°æ˜åˆå¹¶        | åŒåå£°æ˜                     | æ‰©å±•ç°æœ‰ç±»å‹   |

ä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†å­¦ä¹  tsconfig é…ç½®ï¼Œäº†è§£ TypeScript é¡¹ç›®çš„é…ç½®é€‰é¡¹ã€‚
