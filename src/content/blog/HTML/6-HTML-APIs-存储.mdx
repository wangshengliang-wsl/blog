---
title: 'HTML APIsï¼ˆä¸Šï¼‰ï¼šå®¢æˆ·ç«¯å­˜å‚¨å®Œå…¨æŒ‡å—'
description: 'æ·±å…¥æŒæ¡ Web Storageã€IndexedDB å’Œ Cache APIï¼Œå®ç°é«˜æ•ˆçš„å®¢æˆ·ç«¯æ•°æ®å­˜å‚¨ä¸ç¦»çº¿ç¼“å­˜'
pubDate: 2025-12-03
toc: true
ogImage: true
category: 'HTML'
tags: ['HTML', 'JavaScript', 'Web Storage', 'IndexedDB', 'ç¦»çº¿å­˜å‚¨']
---

ç°ä»£ Web åº”ç”¨éœ€è¦åœ¨å®¢æˆ·ç«¯å­˜å‚¨æ•°æ®â€”â€”ç”¨æˆ·åå¥½ã€ç¼“å­˜å†…å®¹ã€ç¦»çº¿æ•°æ®ç­‰ã€‚æµè§ˆå™¨æä¾›äº†å¤šç§å­˜å‚¨ APIï¼Œå„æœ‰ç‰¹ç‚¹å’Œé€‚ç”¨åœºæ™¯ã€‚

## ğŸ¯ å­˜å‚¨æ–¹æ¡ˆæ¦‚è§ˆ

| æ–¹æ¡ˆ           | å®¹é‡     | ç±»å‹      | ç”Ÿå‘½å‘¨æœŸ   | åŒæ­¥/å¼‚æ­¥ |
| -------------- | -------- | --------- | ---------- | --------- |
| Cookie         | ~4KB     | å­—ç¬¦ä¸²    | å¯è®¾ç½®è¿‡æœŸ | åŒæ­¥      |
| localStorage   | ~5-10MB  | å­—ç¬¦ä¸²    | æ°¸ä¹…       | åŒæ­¥      |
| sessionStorage | ~5-10MB  | å­—ç¬¦ä¸²    | ä¼šè¯       | åŒæ­¥      |
| IndexedDB      | æ— é™åˆ¶\* | ç»“æ„åŒ–    | æ°¸ä¹…       | å¼‚æ­¥      |
| Cache API      | æ— é™åˆ¶\* | è¯·æ±‚/å“åº” | æ°¸ä¹…       | å¼‚æ­¥      |

\*å®é™…å—ç£ç›˜ç©ºé—´å’Œæµè§ˆå™¨é…é¢é™åˆ¶

## Web Storage

Web Storage æä¾›ç®€å•çš„é”®å€¼å¯¹å­˜å‚¨ï¼ŒåŒ…æ‹¬ `localStorage` å’Œ `sessionStorage`ã€‚

### localStorage

æ•°æ®æ°¸ä¹…ä¿å­˜ï¼Œé™¤éä¸»åŠ¨æ¸…é™¤ï¼š

```javascript
// å­˜å‚¨æ•°æ®
localStorage.setItem('username', 'å¼ ä¸‰')
localStorage.setItem('settings', JSON.stringify({ theme: 'dark', lang: 'zh' }))

// è¯»å–æ•°æ®
const username = localStorage.getItem('username') // "å¼ ä¸‰"
const settings = JSON.parse(localStorage.getItem('settings'))

// åˆ é™¤æ•°æ®
localStorage.removeItem('username')

// æ¸…ç©ºæ‰€æœ‰æ•°æ®
localStorage.clear()

// è·å–æ•°æ®æ¡æ•°
console.log(localStorage.length)

// è·å–ç¬¬ n ä¸ªé”®å
console.log(localStorage.key(0))
```

### sessionStorage

æ•°æ®ä»…åœ¨å½“å‰ä¼šè¯ï¼ˆæ ‡ç­¾é¡µï¼‰æœ‰æ•ˆï¼Œå…³é—­æ ‡ç­¾é¡µåæ¸…é™¤ï¼š

```javascript
// API ä¸ localStorage å®Œå…¨ç›¸åŒ
sessionStorage.setItem('tempData', 'value')
sessionStorage.getItem('tempData')
sessionStorage.removeItem('tempData')
sessionStorage.clear()
```

### ä½¿ç”¨åœºæ™¯å¯¹æ¯”

| åœºæ™¯           | æ¨èæ–¹æ¡ˆ       | åŸå›                |
| -------------- | -------------- | ------------------ |
| ç”¨æˆ·åå¥½è®¾ç½®   | localStorage   | éœ€è¦æŒä¹…åŒ–         |
| ç™»å½•çŠ¶æ€ Token | localStorage   | éœ€è¦è·¨ä¼šè¯ä¿æŒ     |
| è¡¨å•è‰ç¨¿       | sessionStorage | å…³é—­é¡µé¢åæ— éœ€ä¿ç•™ |
| ä¸€æ¬¡æ€§æ“ä½œçŠ¶æ€ | sessionStorage | ä»…å½“å‰ä¼šè¯æœ‰æ•ˆ     |
| è´­ç‰©è½¦æ•°æ®     | localStorage   | éœ€è¦æŒä¹…åŒ–         |

### å­˜å‚¨äº‹ä»¶

å½“ **å…¶ä»–æ ‡ç­¾é¡µ** ä¿®æ”¹ localStorage æ—¶ï¼Œå¯ä»¥ç›‘å¬åˆ°ï¼š

```javascript
window.addEventListener('storage', (event) => {
  console.log('Key:', event.key)
  console.log('æ—§å€¼:', event.oldValue)
  console.log('æ–°å€¼:', event.newValue)
  console.log('æ¥æº:', event.url)
})
```

ğŸ”¶ **æ³¨æ„**ï¼šstorage äº‹ä»¶ä¸ä¼šåœ¨å½“å‰é¡µé¢è§¦å‘ï¼Œåªåœ¨åŒæºçš„å…¶ä»–æ ‡ç­¾é¡µè§¦å‘ã€‚

### å°è£…å·¥å…·å‡½æ•°

```javascript
const storage = {
  set(key, value, expires) {
    const data = {
      value,
      expires: expires ? Date.now() + expires : null,
    }
    localStorage.setItem(key, JSON.stringify(data))
  },

  get(key) {
    const item = localStorage.getItem(key)
    if (!item) return null

    const data = JSON.parse(item)

    // æ£€æŸ¥è¿‡æœŸ
    if (data.expires && Date.now() > data.expires) {
      localStorage.removeItem(key)
      return null
    }

    return data.value
  },

  remove(key) {
    localStorage.removeItem(key)
  },

  clear() {
    localStorage.clear()
  },
}

// ä½¿ç”¨
storage.set('token', 'abc123', 7 * 24 * 60 * 60 * 1000) // 7å¤©è¿‡æœŸ
storage.get('token')
```

## IndexedDB

IndexedDB æ˜¯æµè§ˆå™¨å†…ç½®çš„**å®Œæ•´æ•°æ®åº“**ï¼Œæ”¯æŒäº‹åŠ¡ã€ç´¢å¼•ã€å¤§å®¹é‡å­˜å‚¨ã€‚

### æ ¸å¿ƒæ¦‚å¿µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              IndexedDB                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚           Database                  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚ Object Store â”‚ Object Store  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚   (users)    â”‚   (posts)     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ Record â”‚  â”‚  â”‚ Record  â”‚  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ Record â”‚  â”‚  â”‚ Record  â”‚  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ Record â”‚  â”‚  â”‚ Record  â”‚  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **Database**ï¼šæ•°æ®åº“ï¼Œå¯åˆ›å»ºå¤šä¸ª
- **Object Store**ï¼šç±»ä¼¼è¡¨ï¼Œå­˜å‚¨åŒç±»æ•°æ®
- **Record**ï¼šä¸€æ¡è®°å½•ï¼ˆJavaScript å¯¹è±¡ï¼‰
- **Index**ï¼šç´¢å¼•ï¼ŒåŠ é€ŸæŸ¥è¯¢
- **Transaction**ï¼šäº‹åŠ¡ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§

### æ‰“å¼€æ•°æ®åº“

```javascript
const request = indexedDB.open('MyDatabase', 1)

request.onerror = (event) => {
  console.error('æ•°æ®åº“æ‰“å¼€å¤±è´¥:', event.target.error)
}

request.onsuccess = (event) => {
  const db = event.target.result
  console.log('æ•°æ®åº“æ‰“å¼€æˆåŠŸ')
}

// é¦–æ¬¡åˆ›å»ºæˆ–ç‰ˆæœ¬å‡çº§æ—¶è§¦å‘
request.onupgradeneeded = (event) => {
  const db = event.target.result

  // åˆ›å»º Object Store
  if (!db.objectStoreNames.contains('users')) {
    const store = db.createObjectStore('users', {
      keyPath: 'id',
      autoIncrement: true,
    })

    // åˆ›å»ºç´¢å¼•
    store.createIndex('email', 'email', { unique: true })
    store.createIndex('name', 'name', { unique: false })
  }
}
```

### å¢åˆ æ”¹æŸ¥ï¼ˆCRUDï¼‰

```javascript
// å‡è®¾ db æ˜¯å·²æ‰“å¼€çš„æ•°æ®åº“å®ä¾‹

// ===== æ·»åŠ æ•°æ® =====
function addUser(user) {
  const transaction = db.transaction(['users'], 'readwrite')
  const store = transaction.objectStore('users')

  const request = store.add(user)

  request.onsuccess = () => {
    console.log('æ·»åŠ æˆåŠŸï¼ŒID:', request.result)
  }

  request.onerror = () => {
    console.error('æ·»åŠ å¤±è´¥:', request.error)
  }
}

addUser({ name: 'å¼ ä¸‰', email: 'zhang@example.com', age: 25 })

// ===== è¯»å–æ•°æ® =====
function getUser(id) {
  const transaction = db.transaction(['users'], 'readonly')
  const store = transaction.objectStore('users')

  const request = store.get(id)

  request.onsuccess = () => {
    console.log('ç”¨æˆ·:', request.result)
  }
}

// ===== æ›´æ–°æ•°æ® =====
function updateUser(user) {
  const transaction = db.transaction(['users'], 'readwrite')
  const store = transaction.objectStore('users')

  const request = store.put(user) // put ä¼šæ›´æ–°æˆ–æ’å…¥

  request.onsuccess = () => {
    console.log('æ›´æ–°æˆåŠŸ')
  }
}

updateUser({ id: 1, name: 'å¼ ä¸‰', email: 'zhangsan@example.com', age: 26 })

// ===== åˆ é™¤æ•°æ® =====
function deleteUser(id) {
  const transaction = db.transaction(['users'], 'readwrite')
  const store = transaction.objectStore('users')

  const request = store.delete(id)

  request.onsuccess = () => {
    console.log('åˆ é™¤æˆåŠŸ')
  }
}
```

### æŸ¥è¯¢æ‰€æœ‰æ•°æ®

```javascript
function getAllUsers() {
  const transaction = db.transaction(['users'], 'readonly')
  const store = transaction.objectStore('users')

  const request = store.getAll()

  request.onsuccess = () => {
    console.log('æ‰€æœ‰ç”¨æˆ·:', request.result)
  }
}
```

### ä½¿ç”¨æ¸¸æ ‡éå†

```javascript
function iterateUsers() {
  const transaction = db.transaction(['users'], 'readonly')
  const store = transaction.objectStore('users')

  const request = store.openCursor()

  request.onsuccess = (event) => {
    const cursor = event.target.result
    if (cursor) {
      console.log('ç”¨æˆ·:', cursor.value)
      cursor.continue() // ç§»åŠ¨åˆ°ä¸‹ä¸€æ¡
    } else {
      console.log('éå†å®Œæˆ')
    }
  }
}
```

### ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢

```javascript
function getUserByEmail(email) {
  const transaction = db.transaction(['users'], 'readonly')
  const store = transaction.objectStore('users')
  const index = store.index('email')

  const request = index.get(email)

  request.onsuccess = () => {
    console.log('æŸ¥è¯¢ç»“æœ:', request.result)
  }
}

getUserByEmail('zhang@example.com')
```

### Promise å°è£…

åŸç”Ÿ API åŸºäºå›è°ƒï¼Œå°è£…æˆ Promise æ›´æ˜“ç”¨ï¼š

```javascript
class IDBHelper {
  constructor(dbName, version) {
    this.dbName = dbName
    this.version = version
    this.db = null
  }

  async open(upgradeCallback) {
    return new Promise((resolve, reject) => {
      const request = indexedDB.open(this.dbName, this.version)

      request.onerror = () => reject(request.error)
      request.onsuccess = () => {
        this.db = request.result
        resolve(this.db)
      }

      request.onupgradeneeded = (event) => {
        upgradeCallback(event.target.result)
      }
    })
  }

  async add(storeName, data) {
    return new Promise((resolve, reject) => {
      const transaction = this.db.transaction([storeName], 'readwrite')
      const store = transaction.objectStore(storeName)
      const request = store.add(data)

      request.onsuccess = () => resolve(request.result)
      request.onerror = () => reject(request.error)
    })
  }

  async get(storeName, key) {
    return new Promise((resolve, reject) => {
      const transaction = this.db.transaction([storeName], 'readonly')
      const store = transaction.objectStore(storeName)
      const request = store.get(key)

      request.onsuccess = () => resolve(request.result)
      request.onerror = () => reject(request.error)
    })
  }

  async getAll(storeName) {
    return new Promise((resolve, reject) => {
      const transaction = this.db.transaction([storeName], 'readonly')
      const store = transaction.objectStore(storeName)
      const request = store.getAll()

      request.onsuccess = () => resolve(request.result)
      request.onerror = () => reject(request.error)
    })
  }

  async put(storeName, data) {
    return new Promise((resolve, reject) => {
      const transaction = this.db.transaction([storeName], 'readwrite')
      const store = transaction.objectStore(storeName)
      const request = store.put(data)

      request.onsuccess = () => resolve(request.result)
      request.onerror = () => reject(request.error)
    })
  }

  async delete(storeName, key) {
    return new Promise((resolve, reject) => {
      const transaction = this.db.transaction([storeName], 'readwrite')
      const store = transaction.objectStore(storeName)
      const request = store.delete(key)

      request.onsuccess = () => resolve()
      request.onerror = () => reject(request.error)
    })
  }
}

// ä½¿ç”¨
const db = new IDBHelper('MyApp', 1)

await db.open((database) => {
  database.createObjectStore('todos', { keyPath: 'id', autoIncrement: true })
})

await db.add('todos', { title: 'å­¦ä¹  IndexedDB', completed: false })
const todos = await db.getAll('todos')
console.log(todos)
```

## Cache API

Cache API ä¸»è¦ç”¨äºç¼“å­˜ç½‘ç»œè¯·æ±‚ï¼Œæ˜¯ Service Worker çš„æ ¸å¿ƒèƒ½åŠ›ã€‚

### åŸºç¡€ç”¨æ³•

```javascript
// æ‰“å¼€ç¼“å­˜
const cache = await caches.open('my-cache-v1')

// ç¼“å­˜è¯·æ±‚
await cache.add('/api/data') // å‘èµ·è¯·æ±‚å¹¶ç¼“å­˜
await cache.addAll(['/style.css', '/app.js', '/logo.png'])

// æ‰‹åŠ¨å­˜å…¥
await cache.put('/api/user', new Response(JSON.stringify({ name: 'å¼ ä¸‰' })))

// è¯»å–ç¼“å­˜
const response = await cache.match('/api/data')
if (response) {
  const data = await response.json()
  console.log(data)
}

// åˆ é™¤ç¼“å­˜
await cache.delete('/api/data')

// åˆ—å‡ºæ‰€æœ‰ç¼“å­˜çš„è¯·æ±‚
const keys = await cache.keys()
console.log(keys)
```

### ç¼“å­˜ç­–ç•¥

```javascript
// ç¼“å­˜ä¼˜å…ˆï¼ˆé€‚åˆé™æ€èµ„æºï¼‰
async function cacheFirst(request) {
  const cached = await caches.match(request)
  if (cached) return cached

  const response = await fetch(request)
  const cache = await caches.open('static-v1')
  cache.put(request, response.clone())
  return response
}

// ç½‘ç»œä¼˜å…ˆï¼ˆé€‚åˆ API æ•°æ®ï¼‰
async function networkFirst(request) {
  try {
    const response = await fetch(request)
    const cache = await caches.open('api-v1')
    cache.put(request, response.clone())
    return response
  } catch (error) {
    return caches.match(request)
  }
}

// ä»…ç¼“å­˜
async function cacheOnly(request) {
  return caches.match(request)
}

// ä»…ç½‘ç»œ
async function networkOnly(request) {
  return fetch(request)
}
```

### ç®¡ç†ç¼“å­˜ç‰ˆæœ¬

```javascript
const CACHE_NAME = 'my-cache-v2'

// åˆ é™¤æ—§ç‰ˆæœ¬ç¼“å­˜
async function cleanOldCaches() {
  const keys = await caches.keys()
  const oldCaches = keys.filter((key) => key !== CACHE_NAME)

  await Promise.all(oldCaches.map((key) => caches.delete(key)))
}
```

## ğŸ¯ å®æˆ˜ï¼šç¦»çº¿ Todo åº”ç”¨

ç»¼åˆè¿ç”¨ IndexedDB å®ç°ä¸€ä¸ªå¯ç¦»çº¿ä½¿ç”¨çš„ Todo åº”ç”¨ï¼š

```html
<!doctype html>
<html lang="zh-Hans">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç¦»çº¿ Todo</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: system-ui, sans-serif;
        padding: 2rem;
        max-width: 500px;
        margin: 0 auto;
      }
      h1 {
        margin-bottom: 1.5rem;
      }
      .input-group {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
      }
      input[type='text'] {
        flex: 1;
        padding: 0.75rem;
        border: 2px solid #e2e8f0;
        border-radius: 0.5rem;
      }
      button {
        padding: 0.75rem 1.5rem;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 0.5rem;
        cursor: pointer;
      }
      button:hover {
        background: #2563eb;
      }
      .todo-list {
        list-style: none;
      }
      .todo-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        border-bottom: 1px solid #e2e8f0;
      }
      .todo-item.completed span {
        text-decoration: line-through;
        color: #94a3b8;
      }
      .todo-item span {
        flex: 1;
      }
      .todo-item input[type='checkbox'] {
        width: 1.25rem;
        height: 1.25rem;
      }
      .delete-btn {
        background: #ef4444;
        padding: 0.5rem 1rem;
      }
      .status {
        margin-top: 1rem;
        padding: 0.75rem;
        border-radius: 0.5rem;
        font-size: 0.875rem;
      }
      .online {
        background: #dcfce7;
        color: #166534;
      }
      .offline {
        background: #fef3c7;
        color: #92400e;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ“ ç¦»çº¿ Todo</h1>

    <div class="input-group">
      <input type="text" id="todoInput" placeholder="æ·»åŠ æ–°ä»»åŠ¡..." />
      <button onclick="addTodo()">æ·»åŠ </button>
    </div>

    <ul class="todo-list" id="todoList"></ul>

    <div class="status" id="status"></div>

    <script>
      let db

      // åˆå§‹åŒ–æ•°æ®åº“
      async function initDB() {
        return new Promise((resolve, reject) => {
          const request = indexedDB.open('TodoApp', 1)

          request.onerror = () => reject(request.error)

          request.onsuccess = () => {
            db = request.result
            resolve(db)
          }

          request.onupgradeneeded = (event) => {
            const database = event.target.result
            if (!database.objectStoreNames.contains('todos')) {
              const store = database.createObjectStore('todos', {
                keyPath: 'id',
                autoIncrement: true,
              })
              store.createIndex('createdAt', 'createdAt')
            }
          }
        })
      }

      // æ·»åŠ  Todo
      async function addTodo() {
        const input = document.getElementById('todoInput')
        const text = input.value.trim()
        if (!text) return

        const todo = {
          text,
          completed: false,
          createdAt: Date.now(),
        }

        await new Promise((resolve, reject) => {
          const transaction = db.transaction(['todos'], 'readwrite')
          const store = transaction.objectStore('todos')
          const request = store.add(todo)
          request.onsuccess = () => resolve(request.result)
          request.onerror = () => reject(request.error)
        })

        input.value = ''
        renderTodos()
      }

      // åˆ‡æ¢å®ŒæˆçŠ¶æ€
      async function toggleTodo(id) {
        const transaction = db.transaction(['todos'], 'readwrite')
        const store = transaction.objectStore('todos')

        const todo = await new Promise((resolve) => {
          store.get(id).onsuccess = (e) => resolve(e.target.result)
        })

        todo.completed = !todo.completed

        await new Promise((resolve) => {
          store.put(todo).onsuccess = () => resolve()
        })

        renderTodos()
      }

      // åˆ é™¤ Todo
      async function deleteTodo(id) {
        await new Promise((resolve, reject) => {
          const transaction = db.transaction(['todos'], 'readwrite')
          const store = transaction.objectStore('todos')
          const request = store.delete(id)
          request.onsuccess = () => resolve()
          request.onerror = () => reject(request.error)
        })

        renderTodos()
      }

      // è·å–æ‰€æœ‰ Todo
      async function getAllTodos() {
        return new Promise((resolve, reject) => {
          const transaction = db.transaction(['todos'], 'readonly')
          const store = transaction.objectStore('todos')
          const request = store.getAll()
          request.onsuccess = () => resolve(request.result)
          request.onerror = () => reject(request.error)
        })
      }

      // æ¸²æŸ“åˆ—è¡¨
      async function renderTodos() {
        const todos = await getAllTodos()
        const list = document.getElementById('todoList')

        // æŒ‰åˆ›å»ºæ—¶é—´å€’åº
        todos.sort((a, b) => b.createdAt - a.createdAt)

        list.innerHTML = todos
          .map(
            (todo) => `
        <li class="todo-item ${todo.completed ? 'completed' : ''}">
          <input
            type="checkbox"
            ${todo.completed ? 'checked' : ''}
            onchange="toggleTodo(${todo.id})"
          />
          <span>${escapeHtml(todo.text)}</span>
          <button class="delete-btn" onclick="deleteTodo(${todo.id})">åˆ é™¤</button>
        </li>
      `
          )
          .join('')
      }

      // è½¬ä¹‰ HTML
      function escapeHtml(text) {
        const div = document.createElement('div')
        div.textContent = text
        return div.innerHTML
      }

      // æ›´æ–°ç½‘ç»œçŠ¶æ€
      function updateNetworkStatus() {
        const status = document.getElementById('status')
        if (navigator.onLine) {
          status.textContent = 'ğŸŸ¢ åœ¨çº¿ - æ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°'
          status.className = 'status online'
        } else {
          status.textContent = 'ğŸŸ¡ ç¦»çº¿ - æ•°æ®ä»…ä¿å­˜åœ¨æœ¬åœ°'
          status.className = 'status offline'
        }
      }

      // ç›‘å¬é”®ç›˜äº‹ä»¶
      document.getElementById('todoInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') addTodo()
      })

      // ç›‘å¬ç½‘ç»œçŠ¶æ€
      window.addEventListener('online', updateNetworkStatus)
      window.addEventListener('offline', updateNetworkStatus)

      // åˆå§‹åŒ–
      initDB().then(() => {
        renderTodos()
        updateNetworkStatus()
      })
    </script>
  </body>
</html>
```

## å­˜å‚¨æ–¹æ¡ˆé€‰å‹

ğŸ™‹ å¦‚ä½•é€‰æ‹©å­˜å‚¨æ–¹æ¡ˆï¼Ÿ

```
éœ€è¦å­˜å‚¨ä»€ä¹ˆï¼Ÿ
â”‚
â”œâ”€ å°‘é‡ç®€å•æ•°æ®ï¼ˆ<1MBï¼‰
â”‚  â”œâ”€ éœ€è¦æŒä¹…åŒ– â†’ localStorage
â”‚  â””â”€ ä»…å½“å‰ä¼šè¯ â†’ sessionStorage
â”‚
â”œâ”€ å¤§é‡ç»“æ„åŒ–æ•°æ®
â”‚  â””â”€ IndexedDB
â”‚
â”œâ”€ ç½‘ç»œè¯·æ±‚ç¼“å­˜
â”‚  â””â”€ Cache API
â”‚
â””â”€ éœ€è¦æœåŠ¡ç«¯è¯»å–
   â””â”€ Cookieï¼ˆä½†è€ƒè™‘ HttpOnlyï¼‰
```

## å¸¸è§é—®é¢˜

### ğŸ¤” localStorage è¢«ç¦ç”¨æ€ä¹ˆåŠï¼Ÿ

æŸäº›éšç§æ¨¡å¼æˆ–è®¾ç½®ä¼šç¦ç”¨ localStorageï¼š

```javascript
function isStorageAvailable() {
  try {
    const test = '__storage_test__'
    localStorage.setItem(test, test)
    localStorage.removeItem(test)
    return true
  } catch (e) {
    return false
  }
}

if (!isStorageAvailable()) {
  // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨å†…å­˜å­˜å‚¨
  const memoryStorage = new Map()
}
```

### ğŸ¤” å­˜å‚¨é…é¢æ˜¯å¤šå°‘ï¼Ÿ

å„æµè§ˆå™¨ä¸åŒï¼Œä¸€èˆ¬è§„åˆ™ï¼š

- localStorage/sessionStorageï¼š5-10MB
- IndexedDBï¼šé€šå¸¸æ˜¯å¯ç”¨ç£ç›˜ç©ºé—´çš„ 50%
- å¯é€šè¿‡ Storage API æŸ¥è¯¢ï¼š

```javascript
if (navigator.storage && navigator.storage.estimate) {
  const { usage, quota } = await navigator.storage.estimate()
  console.log(`å·²ä½¿ç”¨: ${(usage / 1024 / 1024).toFixed(2)} MB`)
  console.log(`æ€»é…é¢: ${(quota / 1024 / 1024).toFixed(2)} MB`)
}
```

### ğŸ¤” æ•°æ®ä¼šè¢«æ¸…é™¤å—ï¼Ÿ

æµè§ˆå™¨åœ¨å­˜å‚¨å‹åŠ›å¤§æ—¶å¯èƒ½æ¸…é™¤æ•°æ®ã€‚è¯·æ±‚æŒä¹…åŒ–å­˜å‚¨ï¼š

```javascript
if (navigator.storage && navigator.storage.persist) {
  const persistent = await navigator.storage.persist()
  console.log(persistent ? 'æŒä¹…åŒ–å­˜å‚¨å·²æˆæƒ' : 'å¯èƒ½è¢«æ¸…é™¤')
}
```

## å‚è€ƒèµ„æ–™

- [MDN: Web Storage API](https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Storage_API)
- [MDN: IndexedDB](https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API)
- [MDN: Cache API](https://developer.mozilla.org/zh-CN/docs/Web/API/Cache)
- [web.dev: å­˜å‚¨æ¦‚è¿°](https://web.dev/storage-for-the-web/)
