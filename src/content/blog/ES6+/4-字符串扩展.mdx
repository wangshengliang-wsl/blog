---
title: 'å­—ç¬¦ä¸²çš„æ‰©å±•'
description: 'å…¨é¢ä»‹ç» ES6 æ¨¡æ¿å­—ç¬¦ä¸²ã€æ ‡ç­¾æ¨¡æ¿ã€Unicode æ”¯æŒç­‰å­—ç¬¦ä¸²æ–°ç‰¹æ€§'
pubDate: 2024-01-04
toc: true
ogImage: true
category: 'ES6+'
tags: ['ES6', 'å­—ç¬¦ä¸²', 'æ¨¡æ¿å­—ç¬¦ä¸²', 'Unicode']
---

ES6 å¯¹å­—ç¬¦ä¸²åšäº†å¤§é‡å¢å¼ºï¼Œå…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯æ¨¡æ¿å­—ç¬¦ä¸²ã€‚

## æ¨¡æ¿å­—ç¬¦ä¸²

### åŸºæœ¬è¯­æ³•

ç”¨åå¼•å· `` ` `` åŒ…è£¹ï¼š

```javascript
const name = 'å¼ ä¸‰'
const greeting = `ä½ å¥½ï¼Œ${name}ï¼`
console.log(greeting) // ä½ å¥½ï¼Œå¼ ä¸‰ï¼
```

### å¤šè¡Œå­—ç¬¦ä¸²

```javascript
// ES5 å¤šè¡Œå­—ç¬¦ä¸²
var html = '<div>\n' + '  <h1>æ ‡é¢˜</h1>\n' + '</div>'

// ES6
const html = `<div>
  <h1>æ ‡é¢˜</h1>
</div>`
```

æ‰€æœ‰ç©ºæ ¼å’Œæ¢è¡Œéƒ½ä¼šä¿ç•™ï¼š

```javascript
const text = `ç¬¬ä¸€è¡Œ
  ç¬¬äºŒè¡Œï¼ˆå‰é¢æœ‰ä¸¤ä¸ªç©ºæ ¼ï¼‰
ç¬¬ä¸‰è¡Œ`
console.log(text)
// ç¬¬ä¸€è¡Œ
//   ç¬¬äºŒè¡Œï¼ˆå‰é¢æœ‰ä¸¤ä¸ªç©ºæ ¼ï¼‰
// ç¬¬ä¸‰è¡Œ
```

### è¡¨è¾¾å¼åµŒå…¥

`${}` ä¸­å¯ä»¥æ˜¯ä»»æ„ JavaScript è¡¨è¾¾å¼ï¼š

```javascript
const a = 10
const b = 20

console.log(`${a} + ${b} = ${a + b}`) // 10 + 20 = 30

// è°ƒç”¨å‡½æ•°
function getName() {
  return 'å¼ ä¸‰'
}
console.log(`ç”¨æˆ·ï¼š${getName()}`) // ç”¨æˆ·ï¼šå¼ ä¸‰

// ä¸‰å…ƒè¡¨è¾¾å¼
const score = 85
console.log(`æˆç»©ï¼š${score >= 60 ? 'åŠæ ¼' : 'ä¸åŠæ ¼'}`) // æˆç»©ï¼šåŠæ ¼

// è®¿é—®å¯¹è±¡å±æ€§
const user = { name: 'å¼ ä¸‰', age: 25 }
console.log(`${user.name}ï¼Œ${user.age}å²`) // å¼ ä¸‰ï¼Œ25å²
```

### åµŒå¥—æ¨¡æ¿

```javascript
const items = ['è‹¹æœ', 'é¦™è•‰', 'æ©™å­']

const list = `
<ul>
  ${items.map((item) => `<li>${item}</li>`).join('\n  ')}
</ul>
`

console.log(list)
// <ul>
//   <li>è‹¹æœ</li>
//   <li>é¦™è•‰</li>
//   <li>æ©™å­</li>
// </ul>
```

### è½¬ä¹‰

åœ¨æ¨¡æ¿å­—ç¬¦ä¸²ä¸­ä½¿ç”¨åå¼•å·æˆ– `${`ï¼š

```javascript
const code = `ä½¿ç”¨ \`åå¼•å·\` å’Œ \${è¡¨è¾¾å¼}`
console.log(code) // ä½¿ç”¨ `åå¼•å·` å’Œ ${è¡¨è¾¾å¼}
```

## æ ‡ç­¾æ¨¡æ¿

æ ‡ç­¾æ¨¡æ¿ï¼ˆTagged Templateï¼‰æ˜¯æ¨¡æ¿å­—ç¬¦ä¸²çš„é«˜çº§ç”¨æ³•ï¼Œå‡½æ•°ååé¢ç›´æ¥è·Ÿæ¨¡æ¿å­—ç¬¦ä¸²ï¼š

```javascript
function tag(strings, ...values) {
  console.log(strings) // ['Hello ', '!']
  console.log(values) // ['World']
}

tag`Hello ${'World'}!`
```

### å‚æ•°è¯´æ˜

- `strings`ï¼šæ¨¡æ¿å­—ç¬¦ä¸²è¢« `${}` åˆ†å‰²åçš„å­—ç¬¦ä¸²æ•°ç»„
- `values`ï¼šæ‰€æœ‰ `${}` ä¸­è¡¨è¾¾å¼çš„å€¼

```javascript
const name = 'å¼ ä¸‰'
const age = 25

function myTag(strings, ...values) {
  console.log(strings) // ['ç”¨æˆ·', 'ï¼Œå¹´é¾„', '']
  console.log(values) // ['å¼ ä¸‰', 25]
  console.log(strings.raw) // åŸå§‹å­—ç¬¦ä¸²æ•°ç»„
}

myTag`ç”¨æˆ·${name}ï¼Œå¹´é¾„${age}`
```

### å®ç”¨åœºæ™¯ï¼šHTML è½¬ä¹‰

```javascript
function safeHTML(strings, ...values) {
  const escape = (str) =>
    String(str)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')

  return strings.reduce((result, str, i) => {
    const value = values[i - 1]
    return result + escape(value) + str
  })
}

const userInput = '<script>alert("xss")</script>'
const html = safeHTML`<div>${userInput}</div>`
console.log(html)
// <div>&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;</div>
```

### å®ç”¨åœºæ™¯ï¼šå›½é™…åŒ–

```javascript
const i18n = {
  'zh-CN': {
    greeting: (name) => `ä½ å¥½ï¼Œ${name}ï¼`,
  },
  'en-US': {
    greeting: (name) => `Hello, ${name}!`,
  },
}

function t(strings, ...values) {
  const locale = 'zh-CN' // å‡è®¾ä»æŸå¤„è·å–
  const key = strings.join('$')
  const template = i18n[locale][key]
  return template ? template(...values) : strings.join('')
}

// éœ€è¦æ›´å¤æ‚çš„å®ç°ï¼Œè¿™é‡Œåªæ˜¯ç¤ºä¾‹æ€è·¯
```

### å®ç”¨åœºæ™¯ï¼šæ ·å¼ç»„ä»¶

CSS-in-JS åº“å¦‚ styled-components å°±æ˜¯ç”¨æ ‡ç­¾æ¨¡æ¿å®ç°çš„ï¼š

```javascript
// ç®€åŒ–ç‰ˆå®ç°
function styled(strings, ...values) {
  const css = strings.reduce((result, str, i) => {
    return result + str + (values[i] || '')
  }, '')

  return function (props) {
    return {
      style: css,
      props,
    }
  }
}

const Button = styled`
  background: blue;
  color: white;
  padding: 10px 20px;
`
```

### å®ç”¨åœºæ™¯ï¼šSQL é˜²æ³¨å…¥

```javascript
function sql(strings, ...values) {
  const escaped = values.map((v) => {
    if (typeof v === 'string') {
      return `'${v.replace(/'/g, "''")}'`
    }
    return v
  })

  return strings.reduce((query, str, i) => {
    return query + str + (escaped[i - 1] ?? '')
  })
}

const name = "O'Brien"
const query = sql`SELECT * FROM users WHERE name = ${name}`
console.log(query)
// SELECT * FROM users WHERE name = 'O''Brien'
```

## Unicode æ”¯æŒ

### ç ç‚¹è¡¨ç¤ºæ³•

ES6 æ”¯æŒ `\u{ç ç‚¹}` è¯­æ³•ï¼š

```javascript
// ES5 åªèƒ½è¡¨ç¤º \u0000 åˆ° \uFFFF
console.log('\u0041') // A
console.log('\u20BB7') // ä¹±ç ï¼Œè¢«è§£æä¸º \u20BB + 7

// ES6 å¤§æ‹¬å·è¯­æ³•
console.log('\u{20BB7}') // ğ ®·
console.log('\u{1F600}') // ğŸ˜€
```

### å­—ç¬¦ä¸²éå†å™¨

`for...of` æ­£ç¡®è¯†åˆ« 32 ä½å­—ç¬¦ï¼š

```javascript
const text = 'ğ ®·a'

// for å¾ªç¯æ— æ³•æ­£ç¡®å¤„ç†
for (let i = 0; i < text.length; i++) {
  console.log(text[i]) // ä¹±ç , ä¹±ç , a
}

// for...of æ­£ç¡®å¤„ç†
for (const char of text) {
  console.log(char) // ğ ®·, a
}

// è·å–æ­£ç¡®é•¿åº¦
console.log([...text].length) // 2
console.log(text.length) // 3
```

### codePointAt å’Œ fromCodePoint

```javascript
const s = 'ğ ®·a'

// charCodeAt æ— æ³•æ­£ç¡®å¤„ç†
s.charCodeAt(0).toString(16) // d842

// codePointAt æ­£ç¡®è¿”å›ç ç‚¹
s.codePointAt(0).toString(16) // 20bb7

// ä»ç ç‚¹åˆ›å»ºå­—ç¬¦
String.fromCodePoint(0x20bb7) // ğ ®·
String.fromCodePoint(0x1f600) // ğŸ˜€

// fromCharCode æ— æ³•å¤„ç†å¤§äº 0xFFFF çš„ç ç‚¹
String.fromCharCode(0x20bb7) // ä¹±ç 
```

### normalize

å¤„ç† Unicode ç»„åˆå­—ç¬¦ï¼š

```javascript
// åŒä¸€ä¸ªå­—ç¬¦å¯èƒ½æœ‰ä¸åŒçš„è¡¨ç¤ºæ–¹å¼
const s1 = '\u01D1' // Çï¼ˆä¸€ä¸ªå­—ç¬¦ï¼‰
const s2 = '\u004F\u030C' // O + ÌŒï¼ˆä¸¤ä¸ªå­—ç¬¦ç»„åˆï¼‰

console.log(s1 === s2) // false
console.log(s1.length, s2.length) // 1, 2

// normalize ç»Ÿä¸€è¡¨ç¤º
console.log(s1.normalize() === s2.normalize()) // true
```

## String.raw

è·å–æ¨¡æ¿å­—ç¬¦ä¸²çš„åŸå§‹å†…å®¹ï¼š

```javascript
console.log(`line1\nline2`)
// line1
// line2

console.log(String.raw`line1\nline2`)
// line1\nline2

// å®é™…åº”ç”¨ï¼šWindows è·¯å¾„
const path = String.raw`C:\Users\name\file.txt`
console.log(path) // C:\Users\name\file.txt
```

ä¹Ÿå¯ä»¥ä½œä¸ºå‡½æ•°è°ƒç”¨ï¼š

```javascript
String.raw({ raw: ['a', 'b', 'c'] }, 1, 2)
// 'a1b2c'
```

## å®æˆ˜åº”ç”¨

### HTML æ¨¡æ¿

```javascript
function render(data) {
  return `
    <!DOCTYPE html>
    <html>
      <head>
        <title>${data.title}</title>
      </head>
      <body>
        <h1>${data.title}</h1>
        <ul>
          ${data.items.map((item) => `<li>${item}</li>`).join('')}
        </ul>
      </body>
    </html>
  `
}

const html = render({
  title: 'å•†å“åˆ—è¡¨',
  items: ['è‹¹æœ', 'é¦™è•‰', 'æ©™å­'],
})
```

### æ—¥å¿—æ ¼å¼åŒ–

```javascript
function log(level) {
  return function (strings, ...values) {
    const message = strings.reduce((acc, str, i) => {
      return acc + str + (values[i] ?? '')
    }, '')

    const timestamp = new Date().toISOString()
    console.log(`[${timestamp}] [${level}] ${message}`)
  }
}

const info = log('INFO')
const error = log('ERROR')

const user = 'å¼ ä¸‰'
info`ç”¨æˆ· ${user} ç™»å½•æˆåŠŸ`
// [2024-01-01T00:00:00.000Z] [INFO] ç”¨æˆ· å¼ ä¸‰ ç™»å½•æˆåŠŸ
```

### ç®€å•çš„æ¨¡æ¿å¼•æ“

```javascript
function template(str) {
  return function (data) {
    return str.replace(/\{\{(\w+)\}\}/g, (_, key) => {
      return data[key] ?? ''
    })
  }
}

const tpl = template('ä½ å¥½ï¼Œ{{name}}ï¼ä½ çš„ä½™é¢æ˜¯ {{balance}} å…ƒã€‚')
console.log(tpl({ name: 'å¼ ä¸‰', balance: 100 }))
// ä½ å¥½ï¼Œå¼ ä¸‰ï¼ä½ çš„ä½™é¢æ˜¯ 100 å…ƒã€‚
```

## å°ç»“

| ç‰¹æ€§         | è¯­æ³•                  | ç”¨é€”                 |
| ------------ | --------------------- | -------------------- |
| æ¨¡æ¿å­—ç¬¦ä¸²   | `` `${expr}` ``       | å­—ç¬¦ä¸²æ’å€¼ã€å¤šè¡Œæ–‡æœ¬ |
| æ ‡ç­¾æ¨¡æ¿     | `` fn`...` ``         | è‡ªå®šä¹‰å­—ç¬¦ä¸²å¤„ç†     |
| Unicode æ”¯æŒ | `\u{ç ç‚¹}`            | å®Œæ•´ Unicode è¡¨ç¤º    |
| String.raw   | `` String.raw`...` `` | è·å–åŸå§‹å­—ç¬¦ä¸²       |

æ¨¡æ¿å­—ç¬¦ä¸²è®©å­—ç¬¦ä¸²æ“ä½œå˜å¾—æ›´åŠ ç›´è§‚ï¼Œæ ‡ç­¾æ¨¡æ¿åˆ™ä¸º DSLï¼ˆé¢†åŸŸç‰¹å®šè¯­è¨€ï¼‰æä¾›äº†å¼ºå¤§çš„åŸºç¡€è®¾æ–½ã€‚
