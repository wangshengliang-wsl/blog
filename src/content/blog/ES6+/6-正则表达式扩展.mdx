---
title: 'æ­£åˆ™è¡¨è¾¾å¼æ‰©å±•'
description: 'æ·±å…¥ç†è§£ ES6+ æ­£åˆ™è¡¨è¾¾å¼æ–°ç‰¹æ€§ï¼šu/y/s ä¿®é¥°ç¬¦ã€å‘½åæ•è·ç»„ã€åè¡Œæ–­è¨€ç­‰'
pubDate: 2024-01-06
toc: true
ogImage: true
category: 'ES6+'
tags: ['ES6', 'æ­£åˆ™è¡¨è¾¾å¼', 'RegExp', 'Unicode']
---

ES6 åŠåç»­ç‰ˆæœ¬å¯¹æ­£åˆ™è¡¨è¾¾å¼åšäº†å¤§é‡å¢å¼ºï¼Œè®©æ¨¡å¼åŒ¹é…æ›´åŠ å¼ºå¤§ã€‚

## u ä¿®é¥°ç¬¦

### Unicode æ¨¡å¼

`u` ä¿®é¥°ç¬¦å¯ç”¨ Unicode æ¨¡å¼ï¼Œæ­£ç¡®å¤„ç† 32 ä½å­—ç¬¦ï¼š

```javascript
// ä¸å¸¦ uï¼Œæ— æ³•æ­£ç¡®åŒ¹é…
;/^.$/.test('ğ ®·') // falseï¼ˆè¢«å½“ä½œä¸¤ä¸ªå­—ç¬¦ï¼‰

// å¸¦ uï¼Œæ­£ç¡®åŒ¹é…
;/^.$/u.test('ğ ®·') // true
```

### Unicode å±æ€§è½¬ä¹‰

`\p{...}` åŒ¹é… Unicode å±æ€§ï¼ˆéœ€è¦ `u` æ ‡å¿—ï¼‰ï¼š

```javascript
// åŒ¹é…ä»»æ„å­—æ¯
;/\p{Letter}/u.test('ä¸­') // true
;/\p{Letter}/u.test('A') // true
;/\p{Letter}/u.test('1') // false

// åŒ¹é…ä¸­æ–‡å­—ç¬¦
;/\p{Script=Han}/u.test('ä¸­') // true
;/\p{Script=Han}/u.test('ã‚') // false

// åŒ¹é… Emoji
;/\p{Emoji}/u.test('ğŸ˜€') // true

// å¦å®šåŒ¹é…
;/\P{Letter}/u.test('1') // trueï¼ˆéå­—æ¯ï¼‰
```

å¸¸ç”¨ Unicode å±æ€§ï¼š

| å±æ€§                  | è¯´æ˜       |
| --------------------- | ---------- |
| `\p{Letter}`          | ä»»æ„å­—æ¯   |
| `\p{Number}`          | ä»»æ„æ•°å­—   |
| `\p{Punctuation}`     | æ ‡ç‚¹ç¬¦å·   |
| `\p{Script=Han}`      | ä¸­æ–‡å­—ç¬¦   |
| `\p{Script=Hiragana}` | å¹³å‡å     |
| `\p{Emoji}`           | Emoji è¡¨æƒ… |

### ç ç‚¹è½¬ä¹‰

`\u{...}` è¯­æ³•åœ¨æ­£åˆ™ä¸­ä¹Ÿé€‚ç”¨ï¼š

```javascript
// ES5 å†™æ³•ï¼ˆå—é™ï¼‰
;/\uD842\uDFB7/.test('ğ ®·') // trueï¼Œä½†å¾ˆéº»çƒ¦

// ES6 å†™æ³•
;/\u{20BB7}/u.test('ğ ®·') // true
```

## y ä¿®é¥°ç¬¦

### ç²˜è¿åŒ¹é…

`y` ä¿®é¥°ç¬¦ï¼ˆstickyï¼‰è¦æ±‚ä» `lastIndex` ä½ç½®å¼€å§‹åŒ¹é…ï¼š

```javascript
const str = 'aaa_aa_a'

// g ä¿®é¥°ç¬¦ï¼šå…¨å±€æœç´¢ï¼Œå¯ä»¥è·³è¿‡ä¸åŒ¹é…çš„å­—ç¬¦
const regG = /a+/g
regG.exec(str) // ['aaa']ï¼ŒlastIndex = 3
regG.exec(str) // ['aa']ï¼ŒlastIndex = 7
regG.exec(str) // ['a']ï¼ŒlastIndex = 9

// y ä¿®é¥°ç¬¦ï¼šå¿…é¡»ä»å½“å‰ä½ç½®å¼€å§‹åŒ¹é…
const regY = /a+/y
regY.exec(str) // ['aaa']ï¼ŒlastIndex = 3
regY.exec(str) // nullï¼ˆä½ç½®3æ˜¯'_'ï¼Œä¸åŒ¹é…ï¼‰
```

### å®é™…åº”ç”¨

è¯æ³•åˆ†æï¼ˆTokenizerï¼‰ï¼š

```javascript
const TOKEN_TYPES = [
  { type: 'NUMBER', pattern: /\d+/y },
  { type: 'PLUS', pattern: /\+/y },
  { type: 'MINUS', pattern: /-/y },
  { type: 'SPACE', pattern: /\s+/y },
]

function tokenize(input) {
  const tokens = []
  let pos = 0

  while (pos < input.length) {
    let matched = false

    for (const { type, pattern } of TOKEN_TYPES) {
      pattern.lastIndex = pos
      const match = pattern.exec(input)

      if (match) {
        if (type !== 'SPACE') {
          tokens.push({ type, value: match[0] })
        }
        pos = pattern.lastIndex
        matched = true
        break
      }
    }

    if (!matched) {
      throw new Error(`Unexpected character at position ${pos}`)
    }
  }

  return tokens
}

tokenize('12 + 34 - 5')
// [
//   { type: 'NUMBER', value: '12' },
//   { type: 'PLUS', value: '+' },
//   { type: 'NUMBER', value: '34' },
//   { type: 'MINUS', value: '-' },
//   { type: 'NUMBER', value: '5' }
// ]
```

## s ä¿®é¥°ç¬¦

### dotAll æ¨¡å¼

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`.` ä¸åŒ¹é…æ¢è¡Œç¬¦ã€‚`s` ä¿®é¥°ç¬¦è®© `.` åŒ¹é…åŒ…æ‹¬æ¢è¡Œåœ¨å†…çš„ä»»æ„å­—ç¬¦ï¼š

```javascript
const str = 'Hello\nWorld'

// ä¸å¸¦ s
;/Hello.World/.test(str) // false

// å¸¦ s
;/Hello.World/s.test(str) // true

// æ£€æŸ¥æ˜¯å¦å¯ç”¨ dotAll
;/./s.dotAll // true
```

å¤šè¡Œæ–‡æœ¬å¤„ç†ï¼š

```javascript
const html = `<div>
  <p>å†…å®¹</p>
</div>`

// åŒ¹é… div æ ‡ç­¾åŠå…¶å†…å®¹
;/<div>.*<\/div>/s.test(html) // true

// ä¸å¸¦ s æ— æ³•åŒ¹é…
;/<div>.*<\/div>/.test(html) // false
```

## å‘½åæ•è·ç»„

### åŸºæœ¬è¯­æ³•

ç”¨ `(?<name>...)` ç»™æ•è·ç»„å‘½åï¼š

```javascript
const dateReg = /(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/
const match = dateReg.exec('2024-01-15')

console.log(match.groups.year) // '2024'
console.log(match.groups.month) // '01'
console.log(match.groups.day) // '15'

// è§£æ„ä½¿ç”¨
const {
  groups: { year, month, day },
} = dateReg.exec('2024-01-15')
console.log(year, month, day) // 2024 01 15
```

### åå‘å¼•ç”¨

ç”¨ `\k<name>` å¼•ç”¨å·²å‘½åçš„æ•è·ç»„ï¼š

```javascript
// åŒ¹é…é‡å¤å•è¯
const reg = /\b(?<word>\w+)\s+\k<word>\b/
reg.test('hello hello') // true
reg.test('hello world') // false

// åŒ¹é…å¼•å·åŒ…è£¹çš„å†…å®¹ï¼ˆå¼•å·ç±»å‹å¿…é¡»ä¸€è‡´ï¼‰
const quoteReg = /(?<quote>['"]).*?\k<quote>/
quoteReg.test('"hello"') // true
quoteReg.test("'world'") // true
quoteReg.test('"mixed\'') // false
```

### replace ä¸­ä½¿ç”¨

```javascript
const dateStr = '2024-01-15'

// æ›¿æ¢æ—¶ä½¿ç”¨å‘½åç»„
const result = dateStr.replace(
  /(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/,
  '$<year>å¹´$<month>æœˆ$<day>æ—¥'
)
console.log(result) // '2024å¹´01æœˆ15æ—¥'

// å‡½æ•°å½¢å¼
dateStr.replace(/(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/, (...args) => {
  const groups = args.at(-1) // æœ€åä¸€ä¸ªå‚æ•°æ˜¯ groups
  return `${groups.year}/${groups.month}/${groups.day}`
})
// '2024/01/15'
```

## åè¡Œæ–­è¨€

ES2018 æ–°å¢åè¡Œæ–­è¨€ï¼ˆLookbehindï¼‰ï¼Œä¸å…ˆè¡Œæ–­è¨€å¯¹ç§°ï¼š

### è¯­æ³•å¯¹æ¯”

| ç±»å‹         | è¯­æ³•       | è¯´æ˜        |
| ------------ | ---------- | ----------- |
| å…ˆè¡Œè‚¯å®šæ–­è¨€ | `(?=...)`  | åé¢æ˜¯...   |
| å…ˆè¡Œå¦å®šæ–­è¨€ | `(?!...)`  | åé¢ä¸æ˜¯... |
| åè¡Œè‚¯å®šæ–­è¨€ | `(?<=...)` | å‰é¢æ˜¯...   |
| åè¡Œå¦å®šæ–­è¨€ | `(?<!...)` | å‰é¢ä¸æ˜¯... |

### ä½¿ç”¨ç¤ºä¾‹

```javascript
// å…ˆè¡Œæ–­è¨€ï¼šåŒ¹é…åé¢æ˜¯å…ƒçš„æ•°å­—
;/\d+(?=å…ƒ)/.exec('100å…ƒ') // ['100']

// å…ˆè¡Œå¦å®šæ–­è¨€ï¼šåŒ¹é…åé¢ä¸æ˜¯å…ƒçš„æ•°å­—
;/\d+(?!å…ƒ)/.exec('100ç¾å…ƒ') // ['100']

// åè¡Œè‚¯å®šæ–­è¨€ï¼šåŒ¹é…å‰é¢æ˜¯$çš„æ•°å­—
;/(?<=\$)\d+/.exec('$100') // ['100']

// åè¡Œå¦å®šæ–­è¨€ï¼šåŒ¹é…å‰é¢ä¸æ˜¯$çš„æ•°å­—
;/(?<!\$)\d+/.exec('â‚¬100') // ['100']
```

å®é™…åº”ç”¨ï¼š

```javascript
// æå–ä»·æ ¼ï¼ˆå‰é¢æ˜¯ï¿¥ï¼‰
const priceReg = /(?<=ï¿¥)\d+(\.\d{2})?/g
'å•†å“A ï¿¥99.00 å•†å“B ï¿¥199.50'.match(priceReg)
// ['99.00', '199.50']

// å¯†ç è„±æ•ï¼ˆä¿ç•™å‰3å4ï¼‰
function maskPassword(pwd) {
  return pwd.replace(/(?<=.{3}).(?=.{4})/g, '*')
}
maskPassword('12345678') // '123*5678'

// æå–æ ‡ç­¾å†…å®¹
const tagReg = /(?<=<title>).*?(?=<\/title>)/
tagReg.exec('<title>Hello World</title>')[0] // 'Hello World'
```

## d ä¿®é¥°ç¬¦

### åŒ¹é…ç´¢å¼•

ES2022 æ–°å¢ `d` ä¿®é¥°ç¬¦ï¼Œæä¾›åŒ¹é…çš„ç´¢å¼•ä¿¡æ¯ï¼š

```javascript
const reg = /(?<name>\w+)/d
const match = reg.exec('hello world')

console.log(match.indices[0]) // [0, 5]ï¼ˆæ•´ä½“åŒ¹é…çš„ä½ç½®ï¼‰
console.log(match.indices[1]) // [0, 5]ï¼ˆç¬¬ä¸€ä¸ªæ•è·ç»„çš„ä½ç½®ï¼‰
console.log(match.indices.groups.name) // [0, 5]ï¼ˆå‘½åç»„çš„ä½ç½®ï¼‰
```

å®é™…åº”ç”¨ï¼š

```javascript
// é«˜äº®æœç´¢ç»“æœ
function highlightMatches(text, pattern) {
  const reg = new RegExp(pattern, 'gd')
  const result = []
  let lastIndex = 0
  let match

  while ((match = reg.exec(text)) !== null) {
    const [start, end] = match.indices[0]
    result.push(text.slice(lastIndex, start))
    result.push(`<mark>${text.slice(start, end)}</mark>`)
    lastIndex = end
  }

  result.push(text.slice(lastIndex))
  return result.join('')
}

highlightMatches('hello world hello', 'hello')
// '<mark>hello</mark> world <mark>hello</mark>'
```

## String æ–¹æ³•å¢å¼º

### matchAll()

ES2020 æ–°å¢ï¼Œè¿”å›æ‰€æœ‰åŒ¹é…çš„è¿­ä»£å™¨ï¼š

```javascript
const str = 'test1test2test3'
const reg = /t(e)(st(\d))/g

// ä¼ ç»Ÿæ–¹å¼éœ€è¦å¾ªç¯è°ƒç”¨ exec
// ES2020 ç”¨ matchAll
for (const match of str.matchAll(reg)) {
  console.log(match[0]) // test1, test2, test3
  console.log(match[1]) // e, e, e
  console.log(match.index) // 0, 5, 10
}

// è½¬ä¸ºæ•°ç»„
const matches = [...str.matchAll(reg)]
```

## å®æˆ˜æŠ€å·§

### è§£æ URL å‚æ•°

```javascript
function parseQuery(url) {
  const reg = /[?&](?<key>[^=&]+)=(?<value>[^&]*)/g
  const result = {}

  for (const match of url.matchAll(reg)) {
    const { key, value } = match.groups
    result[key] = decodeURIComponent(value)
  }

  return result
}

parseQuery('https://example.com?name=å¼ ä¸‰&age=25')
// { name: 'å¼ ä¸‰', age: '25' }
```

### éªŒè¯ä¸­æ–‡å§“å

```javascript
const chineseNameReg = /^[\p{Script=Han}]{2,4}$/u

chineseNameReg.test('å¼ ä¸‰') // true
chineseNameReg.test('æ¬§é˜³å¨œå¨œ') // true
chineseNameReg.test('å¼ ') // falseï¼ˆå¤ªçŸ­ï¼‰
chineseNameReg.test('ABC') // false
```

### ç”µè¯å·ç æ ¼å¼åŒ–

```javascript
function formatPhone(phone) {
  return phone.replace(/(\d{3})(\d{4})(\d{4})/, '$1-$2-$3')
}

formatPhone('13812345678') // '138-1234-5678'

// ç”¨å‘½åç»„æ›´æ¸…æ™°
function formatPhoneNamed(phone) {
  return phone.replace(
    /(?<area>\d{3})(?<middle>\d{4})(?<last>\d{4})/,
    '$<area>-$<middle>-$<last>'
  )
}
```

## ä¿®é¥°ç¬¦æ±‡æ€»

| ä¿®é¥°ç¬¦ | åç§°       | è¯´æ˜            | ç‰ˆæœ¬   |
| ------ | ---------- | --------------- | ------ |
| `g`    | global     | å…¨å±€åŒ¹é…        | ES3    |
| `i`    | ignoreCase | å¿½ç•¥å¤§å°å†™      | ES3    |
| `m`    | multiline  | å¤šè¡Œæ¨¡å¼        | ES3    |
| `u`    | unicode    | Unicode æ¨¡å¼    | ES6    |
| `y`    | sticky     | ç²˜è¿åŒ¹é…        | ES6    |
| `s`    | dotAll     | è®© . åŒ¹é…æ¢è¡Œç¬¦ | ES2018 |
| `d`    | hasIndices | è¿”å›åŒ¹é…ç´¢å¼•    | ES2022 |

æ­£åˆ™è¡¨è¾¾å¼çš„è¿™äº›æ‰©å±•è®©æ–‡æœ¬å¤„ç†æ›´åŠ å¼ºå¤§å’Œä¾¿æ·ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å›½é™…åŒ–å†…å®¹å’Œå¤æ‚æ¨¡å¼åŒ¹é…æ—¶ã€‚
