---
title: 'Class ç»§æ‰¿'
description: 'æ·±å…¥ç†è§£ ES6 Class ç»§æ‰¿æœºåˆ¶ï¼šextendsã€super å…³é”®å­—ä¸åŸå‹é“¾å…³ç³»'
pubDate: 2024-02-06
toc: true
ogImage: true
category: 'ES6+'
tags: ['ES6', 'Class', 'ç»§æ‰¿', 'extends', 'super']
---

ES6 çš„ Class ç»§æ‰¿é€šè¿‡ `extends` å’Œ `super` å…³é”®å­—ï¼Œæä¾›äº†æ¯” ES5 æ›´æ¸…æ™°çš„ç»§æ‰¿è¯­æ³•ã€‚

## extends åŸºç¡€

### åŸºæœ¬ç»§æ‰¿

```javascript
class Animal {
  constructor(name) {
    this.name = name
  }

  speak() {
    console.log(`${this.name} å‘å‡ºå£°éŸ³`)
  }
}

class Dog extends Animal {
  constructor(name, breed) {
    super(name) // è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°
    this.breed = breed
  }

  speak() {
    console.log(`${this.name} æ±ªæ±ªå«`)
  }
}

const dog = new Dog('æ—ºè´¢', 'æŸ´çŠ¬')
dog.speak() // æ—ºè´¢ æ±ªæ±ªå«
```

### ç»§æ‰¿çš„æœ¬è´¨

```javascript
class Parent {}
class Child extends Parent {}

// åŸå‹é“¾å…³ç³»
Child.prototype.__proto__ === Parent.prototype // true
Child.__proto__ === Parent // true

// instanceof æ£€æŸ¥
const child = new Child()
child instanceof Child // true
child instanceof Parent // true
```

## super å…³é”®å­—

### ä½œä¸ºå‡½æ•°è°ƒç”¨

`super()` è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ï¼š

```javascript
class Animal {
  constructor(name) {
    this.name = name
  }
}

class Dog extends Animal {
  constructor(name, age) {
    // super() å¿…é¡»åœ¨ä½¿ç”¨ this ä¹‹å‰è°ƒç”¨
    super(name)
    this.age = age
  }
}
```

ğŸ”¶ åœ¨æ´¾ç”Ÿç±»çš„ constructor ä¸­ï¼Œå¿…é¡»å…ˆè°ƒç”¨ `super()`ï¼Œç„¶åæ‰èƒ½ä½¿ç”¨ `this`ã€‚

### ä½œä¸ºå¯¹è±¡è°ƒç”¨

`super` ä½œä¸ºå¯¹è±¡æ—¶æŒ‡å‘çˆ¶ç±»åŸå‹ï¼š

```javascript
class Animal {
  speak() {
    return 'åŠ¨ç‰©çš„å£°éŸ³'
  }
}

class Dog extends Animal {
  speak() {
    // super.speak() è°ƒç”¨çˆ¶ç±»æ–¹æ³•
    return super.speak() + 'ï¼Œæ±ªæ±ªæ±ª'
  }
}

new Dog().speak() // 'åŠ¨ç‰©çš„å£°éŸ³ï¼Œæ±ªæ±ªæ±ª'
```

### åœ¨é™æ€æ–¹æ³•ä¸­ä½¿ç”¨ super

```javascript
class Animal {
  static getType() {
    return 'åŠ¨ç‰©'
  }
}

class Dog extends Animal {
  static getType() {
    return super.getType() + ' - ç‹—'
  }
}

Dog.getType() // 'åŠ¨ç‰© - ç‹—'
```

## æ–¹æ³•é‡å†™

### å®Œå…¨é‡å†™

```javascript
class Shape {
  getArea() {
    return 0
  }
}

class Rectangle extends Shape {
  constructor(width, height) {
    super()
    this.width = width
    this.height = height
  }

  getArea() {
    return this.width * this.height
  }
}
```

### æ‰©å±•çˆ¶ç±»æ–¹æ³•

```javascript
class Logger {
  log(message) {
    console.log(`[LOG] ${message}`)
  }
}

class TimestampLogger extends Logger {
  log(message) {
    const timestamp = new Date().toISOString()
    super.log(`${timestamp} - ${message}`)
  }
}

new TimestampLogger().log('Hello')
// [LOG] 2024-01-01T00:00:00.000Z - Hello
```

### æ¡ä»¶è°ƒç”¨çˆ¶ç±»æ–¹æ³•

```javascript
class Cache {
  get(key) {
    return this.data[key]
  }
}

class ExpiringCache extends Cache {
  get(key) {
    const item = super.get(key)
    if (item && item.expiry < Date.now()) {
      delete this.data[key]
      return undefined
    }
    return item?.value
  }
}
```

## ç»§æ‰¿å†…ç½®ç±»

### ç»§æ‰¿ Array

```javascript
class MyArray extends Array {
  // è·å–ç¬¬ä¸€ä¸ªå…ƒç´ 
  first() {
    return this[0]
  }

  // è·å–æœ€åä¸€ä¸ªå…ƒç´ 
  last() {
    return this[this.length - 1]
  }

  // æ±‚å’Œ
  sum() {
    return this.reduce((a, b) => a + b, 0)
  }
}

const arr = new MyArray(1, 2, 3, 4, 5)
arr.first() // 1
arr.last() // 5
arr.sum() // 15

// ç»§æ‰¿çš„æ–¹æ³•è¿”å›çš„ä»æ˜¯ MyArray å®ä¾‹
arr.map((x) => x * 2) instanceof MyArray // true
```

### ç»§æ‰¿ Error

```javascript
class ValidationError extends Error {
  constructor(message, field) {
    super(message)
    this.name = 'ValidationError'
    this.field = field

    // ä¿®å¤åŸå‹é“¾ï¼ˆæŸäº›ç¯å¢ƒéœ€è¦ï¼‰
    Object.setPrototypeOf(this, ValidationError.prototype)
  }
}

class NetworkError extends Error {
  constructor(message, status) {
    super(message)
    this.name = 'NetworkError'
    this.status = status
    Object.setPrototypeOf(this, NetworkError.prototype)
  }
}

try {
  throw new ValidationError('é‚®ç®±æ ¼å¼é”™è¯¯', 'email')
} catch (error) {
  if (error instanceof ValidationError) {
    console.log(`å­—æ®µ ${error.field}: ${error.message}`)
  }
}
```

### ç»§æ‰¿ Map

```javascript
class ObservableMap extends Map {
  #listeners = new Set()

  set(key, value) {
    const oldValue = this.get(key)
    super.set(key, value)
    this.#notify('set', { key, value, oldValue })
    return this
  }

  delete(key) {
    const value = this.get(key)
    const result = super.delete(key)
    if (result) {
      this.#notify('delete', { key, value })
    }
    return result
  }

  subscribe(listener) {
    this.#listeners.add(listener)
    return () => this.#listeners.delete(listener)
  }

  #notify(type, data) {
    this.#listeners.forEach((listener) => listener(type, data))
  }
}

const map = new ObservableMap()
map.subscribe((type, data) => {
  console.log(`${type}:`, data)
})

map.set('name', 'å¼ ä¸‰') // set: { key: 'name', value: 'å¼ ä¸‰', oldValue: undefined }
```

## å¤šæ€

### åŸºç¡€å¤šæ€

```javascript
class Shape {
  getArea() {
    throw new Error('å­ç±»å¿…é¡»å®ç° getArea æ–¹æ³•')
  }

  getInfo() {
    return `é¢ç§¯: ${this.getArea()}`
  }
}

class Circle extends Shape {
  constructor(radius) {
    super()
    this.radius = radius
  }

  getArea() {
    return Math.PI * this.radius ** 2
  }
}

class Rectangle extends Shape {
  constructor(width, height) {
    super()
    this.width = width
    this.height = height
  }

  getArea() {
    return this.width * this.height
  }
}

// å¤šæ€ä½¿ç”¨
function printArea(shape) {
  console.log(shape.getInfo())
}

printArea(new Circle(5)) // é¢ç§¯: 78.54...
printArea(new Rectangle(4, 6)) // é¢ç§¯: 24
```

### æ¨¡æ¿æ–¹æ³•æ¨¡å¼

```javascript
class DataProcessor {
  // æ¨¡æ¿æ–¹æ³•
  process(data) {
    const validated = this.validate(data)
    const transformed = this.transform(validated)
    return this.output(transformed)
  }

  // å­ç±»å¯é‡å†™çš„é’©å­æ–¹æ³•
  validate(data) {
    return data
  }

  transform(data) {
    throw new Error('å­ç±»å¿…é¡»å®ç° transform æ–¹æ³•')
  }

  output(data) {
    return data
  }
}

class JSONProcessor extends DataProcessor {
  transform(data) {
    return JSON.parse(data)
  }

  output(data) {
    return { success: true, data }
  }
}

class CSVProcessor extends DataProcessor {
  transform(data) {
    return data.split('\n').map((line) => line.split(','))
  }
}
```

## æŠ½è±¡ç±»æ¨¡æ‹Ÿ

JavaScript æ²¡æœ‰åŸç”ŸæŠ½è±¡ç±»ï¼Œä½†å¯ä»¥æ¨¡æ‹Ÿï¼š

```javascript
class AbstractAnimal {
  constructor() {
    if (new.target === AbstractAnimal) {
      throw new Error('AbstractAnimal ä¸èƒ½è¢«ç›´æ¥å®ä¾‹åŒ–')
    }
  }

  // æŠ½è±¡æ–¹æ³•
  speak() {
    throw new Error('å­ç±»å¿…é¡»å®ç° speak æ–¹æ³•')
  }

  // å…·ä½“æ–¹æ³•
  sleep() {
    console.log('ç¡è§‰...')
  }
}

class Dog extends AbstractAnimal {
  speak() {
    console.log('æ±ªæ±ªæ±ª')
  }
}

// new AbstractAnimal(); // Error: AbstractAnimal ä¸èƒ½è¢«ç›´æ¥å®ä¾‹åŒ–
new Dog().speak() // æ±ªæ±ªæ±ª
```

## ç§æœ‰æˆå‘˜ç»§æ‰¿

### ç§æœ‰å­—æ®µä¸å¯ç»§æ‰¿

```javascript
class Parent {
  #secret = 'ç§å¯†ä¿¡æ¯'

  getSecret() {
    return this.#secret
  }
}

class Child extends Parent {
  revealSecret() {
    // return this.#secret; // SyntaxError: ç§æœ‰å­—æ®µåœ¨å­ç±»ä¸­ä¸å¯è®¿é—®
    return this.getSecret() // å¯ä»¥é€šè¿‡çˆ¶ç±»æ–¹æ³•è®¿é—®
  }
}

new Child().revealSecret() // 'ç§å¯†ä¿¡æ¯'
```

### ä½¿ç”¨ Symbol å®ç°å—ä¿æŠ¤æˆå‘˜

```javascript
const _protected = Symbol('protected')

class Parent {
  constructor() {
    this[_protected] = 'å—ä¿æŠ¤çš„å€¼'
  }

  getProtected() {
    return this[_protected]
  }
}

class Child extends Parent {
  useProtected() {
    // å­ç±»å¯ä»¥è®¿é—® Symbol å±æ€§
    return this[_protected]
  }
}

new Child().useProtected() // 'å—ä¿æŠ¤çš„å€¼'
```

## ç»„åˆä¼˜äºç»§æ‰¿

### ç»§æ‰¿çš„é—®é¢˜

```javascript
// ç»§æ‰¿å¯¼è‡´ç´§è€¦åˆ
class Bird {
  fly() {
    console.log('é£è¡Œä¸­')
  }
}

class Penguin extends Bird {
  // ä¼é¹…ä¸ä¼šé£ï¼Œä½†ç»§æ‰¿äº† fly æ–¹æ³•
  fly() {
    throw new Error('ä¼é¹…ä¸ä¼šé£')
  }
}
```

### ç»„åˆæ–¹å¼

```javascript
// ä½¿ç”¨ç»„åˆ
const canFly = {
  fly() {
    console.log(`${this.name} é£è¡Œä¸­`)
  },
}

const canSwim = {
  swim() {
    console.log(`${this.name} æ¸¸æ³³ä¸­`)
  },
}

const canWalk = {
  walk() {
    console.log(`${this.name} è¡Œèµ°ä¸­`)
  },
}

class Animal {
  constructor(name) {
    this.name = name
  }
}

// é¸Ÿç±»ï¼šä¼šé£ä¼šèµ°
class Bird extends Animal {}
Object.assign(Bird.prototype, canFly, canWalk)

// ä¼é¹…ï¼šä¼šæ¸¸æ³³ä¼šèµ°
class Penguin extends Animal {}
Object.assign(Penguin.prototype, canSwim, canWalk)

// é¸­å­ï¼šä¼šé£ä¼šæ¸¸æ³³ä¼šèµ°
class Duck extends Animal {}
Object.assign(Duck.prototype, canFly, canSwim, canWalk)
```

### ç­–ç•¥æ¨¡å¼æ›¿ä»£ç»§æ‰¿

```javascript
class PaymentProcessor {
  constructor(strategy) {
    this.strategy = strategy
  }

  process(amount) {
    return this.strategy.process(amount)
  }
}

const creditCardStrategy = {
  process(amount) {
    console.log(`ä¿¡ç”¨å¡æ”¯ä»˜ ${amount} å…ƒ`)
    return { success: true, method: 'creditCard' }
  },
}

const wechatStrategy = {
  process(amount) {
    console.log(`å¾®ä¿¡æ”¯ä»˜ ${amount} å…ƒ`)
    return { success: true, method: 'wechat' }
  },
}

const alipayStrategy = {
  process(amount) {
    console.log(`æ”¯ä»˜å®æ”¯ä»˜ ${amount} å…ƒ`)
    return { success: true, method: 'alipay' }
  },
}

// ä½¿ç”¨
const processor = new PaymentProcessor(wechatStrategy)
processor.process(100)
```

## Object.getPrototypeOf

```javascript
class Parent {}
class Child extends Parent {}

Object.getPrototypeOf(Child.prototype) === Parent.prototype // true
Object.getPrototypeOf(Child) === Parent // true
```

## å°ç»“

| ç‰¹æ€§           | è¯´æ˜                 |
| -------------- | -------------------- |
| extends        | å£°æ˜ç»§æ‰¿å…³ç³»         |
| super()        | è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°     |
| super.method() | è°ƒç”¨çˆ¶ç±»æ–¹æ³•         |
| æ–¹æ³•é‡å†™       | å­ç±»é‡æ–°å®šä¹‰çˆ¶ç±»æ–¹æ³• |
| ç§æœ‰å­—æ®µ       | ä¸å¯è¢«å­ç±»ç»§æ‰¿       |
| é™æ€æˆå‘˜       | å¯è¢«å­ç±»ç»§æ‰¿         |

Class ç»§æ‰¿æä¾›äº†æ¸…æ™°çš„è¯­æ³•ï¼Œä½†è¦æ³¨æ„é¿å…è¿‡æ·±çš„ç»§æ‰¿å±‚æ¬¡ï¼Œé€‚æ—¶è€ƒè™‘ç»„åˆæ¨¡å¼ã€‚
