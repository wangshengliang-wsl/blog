---
title: 'å‡½æ•°é»˜è®¤å‚æ•°'
description: 'æ·±å…¥ç†è§£ ES6 å‡½æ•°é»˜è®¤å‚æ•°çš„è¯­æ³•ã€ä½œç”¨åŸŸè§„åˆ™ä¸æœ€ä½³å®è·µ'
pubDate: 2024-01-09
toc: true
ogImage: true
category: 'ES6+'
tags: ['ES6', 'å‡½æ•°', 'é»˜è®¤å‚æ•°', 'å‚æ•°']
---

ES6 å…è®¸ä¸ºå‡½æ•°å‚æ•°è®¾ç½®é»˜è®¤å€¼ï¼Œå¤§å¤§ç®€åŒ–äº†å‚æ•°å¤„ç†é€»è¾‘ã€‚

## åŸºæœ¬è¯­æ³•

### ES5 çš„åšæ³•

```javascript
// ES5 å¤„ç†é»˜è®¤å€¼
function greet(name, greeting) {
  name = name || 'æœ‹å‹'
  greeting = greeting || 'ä½ å¥½'
  console.log(greeting + 'ï¼Œ' + name)
}

greet() // 'ä½ å¥½ï¼Œæœ‹å‹'
greet('å¼ ä¸‰') // 'ä½ å¥½ï¼Œå¼ ä¸‰'

// ğŸ”¶ é—®é¢˜ï¼šæ— æ³•åŒºåˆ† undefined å’Œ falsy å€¼
greet('å¼ ä¸‰', '') // 'ä½ å¥½ï¼Œå¼ ä¸‰'ï¼ˆç©ºå­—ç¬¦ä¸²è¢«å½“ä½œ falseï¼‰
```

### ES6 é»˜è®¤å‚æ•°

```javascript
function greet(name = 'æœ‹å‹', greeting = 'ä½ å¥½') {
  console.log(`${greeting}ï¼Œ${name}`)
}

greet() // 'ä½ å¥½ï¼Œæœ‹å‹'
greet('å¼ ä¸‰') // 'ä½ å¥½ï¼Œå¼ ä¸‰'
greet('å¼ ä¸‰', '') // 'ï¼Œå¼ ä¸‰'ï¼ˆç©ºå­—ç¬¦ä¸²æœ‰æ•ˆï¼‰
greet('å¼ ä¸‰', undefined) // 'ä½ å¥½ï¼Œå¼ ä¸‰'ï¼ˆundefined è§¦å‘é»˜è®¤å€¼ï¼‰
```

ğŸ¤” åªæœ‰ `undefined` ä¼šè§¦å‘é»˜è®¤å€¼ï¼Œ`null` å’Œå…¶ä»– falsy å€¼ä¸ä¼šï¼š

```javascript
function test(a = 1, b = 2) {
  console.log(a, b)
}

test(undefined, null) // 1 null
test(0, '') // 0 ''
test(false, NaN) // false NaN
```

## è¡¨è¾¾å¼ä½œä¸ºé»˜è®¤å€¼

é»˜è®¤å€¼å¯ä»¥æ˜¯ä»»æ„è¡¨è¾¾å¼ï¼Œæƒ°æ€§æ±‚å€¼ï¼š

```javascript
function getDefault() {
  console.log('è®¡ç®—é»˜è®¤å€¼')
  return 100
}

function test(value = getDefault()) {
  return value
}

test(1) // ä¸ä¼šæ‰“å°ï¼Œè¿”å› 1
test() // æ‰“å° 'è®¡ç®—é»˜è®¤å€¼'ï¼Œè¿”å› 100
```

å®é™…åº”ç”¨ï¼š

```javascript
// å¿…å¡«å‚æ•°æ£€æŸ¥
function required(name) {
  throw new Error(`å‚æ•° ${name} æ˜¯å¿…å¡«çš„`)
}

function createUser(name = required('name'), age = 18) {
  return { name, age }
}

createUser('å¼ ä¸‰') // { name: 'å¼ ä¸‰', age: 18 }
// createUser(); // Error: å‚æ•° name æ˜¯å¿…å¡«çš„

// ç”Ÿæˆå”¯ä¸€ ID
let id = 0
function createItem(name, itemId = ++id) {
  return { id: itemId, name }
}

createItem('A') // { id: 1, name: 'A' }
createItem('B') // { id: 2, name: 'B' }
createItem('C', 100) // { id: 100, name: 'C' }
```

## ä¸è§£æ„ç»“åˆ

### å‚æ•°è§£æ„çš„é»˜è®¤å€¼

```javascript
// è§£æ„å‚æ•° + é»˜è®¤å€¼
function createUser({ name = 'åŒ¿å', age = 18 } = {}) {
  return { name, age }
}

createUser() // { name: 'åŒ¿å', age: 18 }
createUser({}) // { name: 'åŒ¿å', age: 18 }
createUser({ name: 'å¼ ä¸‰' }) // { name: 'å¼ ä¸‰', age: 18 }
createUser({ name: 'å¼ ä¸‰', age: 25 }) // { name: 'å¼ ä¸‰', age: 25 }
```

ğŸ”¶ æ³¨æ„ä¸¤å±‚é»˜è®¤å€¼çš„åŒºåˆ«ï¼š

```javascript
// æ–¹å¼ 1ï¼šåªæœ‰è§£æ„é»˜è®¤å€¼
function foo({ a = 1, b = 2 }) {
  console.log(a, b)
}
// foo(); // TypeError: æ— æ³•è§£æ„ undefined

// æ–¹å¼ 2ï¼šæ•´ä½“é»˜è®¤å€¼
function bar({ a, b } = { a: 1, b: 2 }) {
  console.log(a, b)
}
bar() // 1 2
bar({}) // undefined undefinedï¼ˆæ•´ä½“å‚æ•°ä¸æ˜¯ undefinedï¼Œä¸è§¦å‘é»˜è®¤å€¼ï¼‰

// æ–¹å¼ 3ï¼šä¸¤å±‚é»˜è®¤å€¼ï¼ˆæ¨èï¼‰
function baz({ a = 1, b = 2 } = {}) {
  console.log(a, b)
}
baz() // 1 2
baz({}) // 1 2
baz({ a: 10 }) // 10 2
```

### æ•°ç»„è§£æ„é»˜è®¤å€¼

```javascript
function sum([a = 0, b = 0] = []) {
  return a + b
}

sum() // 0
sum([]) // 0
sum([1]) // 1
sum([1, 2]) // 3
```

## å‚æ•°ä½œç”¨åŸŸ

é»˜è®¤å‚æ•°å½¢æˆä¸€ä¸ªç‹¬ç«‹çš„ä½œç”¨åŸŸï¼š

```javascript
const x = 1

function foo(x, y = x) {
  console.log(y)
}

foo(2) // 2ï¼ˆy çš„é»˜è®¤å€¼æ˜¯å‚æ•° xï¼Œä¸æ˜¯å…¨å±€ xï¼‰
```

æ›´å¤æ‚çš„ä¾‹å­ï¼š

```javascript
let x = 1

function foo(
  x,
  y = function () {
    x = 2
  }
) {
  var x = 3
  y()
  console.log(x)
}

foo() // 3
console.log(x) // 1

// è§£é‡Šï¼š
// 1. å‚æ•° (x, y = ...) å½¢æˆç‹¬ç«‹ä½œç”¨åŸŸ
// 2. y å‡½æ•°ä¸­çš„ x æ˜¯å‚æ•°ä½œç”¨åŸŸçš„ x
// 3. å‡½æ•°ä½“å†… var x = 3 æ˜¯å¦ä¸€ä¸ª x
// 4. y() ä¿®æ”¹çš„æ˜¯å‚æ•°ä½œç”¨åŸŸçš„ x
// 5. console.log(x) æ‰“å°çš„æ˜¯å‡½æ•°ä½“çš„ x
```

## å‚æ•°ä½ç½®

### å¸¦é»˜è®¤å€¼çš„å‚æ•°åº”æ”¾åœ¨åé¢

```javascript
// ä¸æ¨èï¼šé»˜è®¤å‚æ•°åœ¨å‰
function greet(greeting = 'ä½ å¥½', name) {
  console.log(`${greeting}ï¼Œ${name}`)
}

greet('å¼ ä¸‰') // 'å¼ ä¸‰ï¼Œundefined'ï¼ˆæ²¡è¾¾åˆ°é¢„æœŸï¼‰
greet(undefined, 'å¼ ä¸‰') // 'ä½ å¥½ï¼Œå¼ ä¸‰'ï¼ˆå¿…é¡»æ˜¾å¼ä¼  undefinedï¼‰

// æ¨èï¼šé»˜è®¤å‚æ•°åœ¨å
function greet2(name, greeting = 'ä½ å¥½') {
  console.log(`${greeting}ï¼Œ${name}`)
}

greet2('å¼ ä¸‰') // 'ä½ å¥½ï¼Œå¼ ä¸‰'
```

### ä¸­é—´çš„é»˜è®¤å‚æ•°

```javascript
function range(start = 0, end, step = 1) {
  // å¤„ç†çœç•¥ä¸­é—´å‚æ•°çš„æƒ…å†µ
  if (end === undefined) {
    end = start
    start = 0
  }

  const result = []
  for (let i = start; i < end; i += step) {
    result.push(i)
  }
  return result
}

range(5) // [0, 1, 2, 3, 4]
range(1, 5) // [1, 2, 3, 4]
range(0, 10, 2) // [0, 2, 4, 6, 8]
```

## length å±æ€§

æœ‰é»˜è®¤å€¼çš„å‚æ•°ä¸è®¡å…¥ `length`ï¼š

```javascript
;(function (a) {}).length // 1
;(function (a = 1) {}).length // 0
;(function (a, b = 1) {}).length // 1
;(function (a, b, c = 1) {}).length // 2

// rest å‚æ•°ä¹Ÿä¸è®¡å…¥
;(function (a, ...rest) {}).length // 1
```

## å®æˆ˜åº”ç”¨

### é…ç½®å¯¹è±¡æ¨¡å¼

```javascript
function createServer({
  port = 3000,
  host = 'localhost',
  https = false,
  cors = true,
  timeout = 30000,
} = {}) {
  console.log(`Server: ${https ? 'https' : 'http'}://${host}:${port}`)
  console.log(`CORS: ${cors}, Timeout: ${timeout}ms`)
}

createServer() // ä½¿ç”¨å…¨éƒ¨é»˜è®¤å€¼
createServer({ port: 8080 }) // åªæ”¹ç«¯å£
createServer({ https: true, port: 443 }) // HTTPS
```

### å·¥å‚å‡½æ•°

```javascript
function createPerson(
  name,
  { age = 0, gender = 'æœªçŸ¥', email = '', address = {} } = {}
) {
  return {
    name,
    age,
    gender,
    email,
    address: {
      city: address.city || 'æœªçŸ¥',
      country: address.country || 'ä¸­å›½',
    },
  }
}

createPerson('å¼ ä¸‰')
// {
//   name: 'å¼ ä¸‰',
//   age: 0,
//   gender: 'æœªçŸ¥',
//   email: '',
//   address: { city: 'æœªçŸ¥', country: 'ä¸­å›½' }
// }
```

### å‡½æ•°é‡è½½æ¨¡æ‹Ÿ

```javascript
function createElement(tag, options = {}) {
  const { id, className, text, children = [], attrs = {} } = options

  const element = document.createElement(tag)

  if (id) element.id = id
  if (className) element.className = className
  if (text) element.textContent = text

  Object.entries(attrs).forEach(([key, value]) => {
    element.setAttribute(key, value)
  })

  children.forEach((child) => {
    if (typeof child === 'string') {
      element.appendChild(document.createTextNode(child))
    } else {
      element.appendChild(child)
    }
  })

  return element
}

// ç®€å•ç”¨æ³•
createElement('div')

// å®Œæ•´ç”¨æ³•
createElement('div', {
  id: 'container',
  className: 'wrapper',
  attrs: { 'data-id': '123' },
  children: [createElement('p', { text: 'Hello' })],
})
```

### æ—¥æœŸæ ¼å¼åŒ–

```javascript
function formatDate(
  date = new Date(),
  {
    year = true,
    month = true,
    day = true,
    hour = false,
    minute = false,
    second = false,
    separator = '-',
    timeSeparator = ':',
  } = {}
) {
  const parts = []

  if (year) parts.push(date.getFullYear())
  if (month) parts.push(String(date.getMonth() + 1).padStart(2, '0'))
  if (day) parts.push(String(date.getDate()).padStart(2, '0'))

  let result = parts.join(separator)

  const timeParts = []
  if (hour) timeParts.push(String(date.getHours()).padStart(2, '0'))
  if (minute) timeParts.push(String(date.getMinutes()).padStart(2, '0'))
  if (second) timeParts.push(String(date.getSeconds()).padStart(2, '0'))

  if (timeParts.length) {
    result += ' ' + timeParts.join(timeSeparator)
  }

  return result
}

formatDate() // '2024-01-09'
formatDate(new Date(), { hour: true, minute: true }) // '2024-01-09 10:30'
formatDate(new Date(), { separator: '/' }) // '2024/01/09'
```

## å°ç»“

| ç‰¹æ€§     | è¯´æ˜                         |
| -------- | ---------------------------- |
| è§¦å‘æ¡ä»¶ | åªæœ‰ `undefined` è§¦å‘é»˜è®¤å€¼  |
| è¡¨è¾¾å¼   | é»˜è®¤å€¼å¯ä»¥æ˜¯è¡¨è¾¾å¼ï¼Œæƒ°æ€§æ±‚å€¼ |
| ä½œç”¨åŸŸ   | å‚æ•°å½¢æˆç‹¬ç«‹ä½œç”¨åŸŸ           |
| ä½ç½®     | é»˜è®¤å‚æ•°åº”æ”¾åœ¨å‚æ•°åˆ—è¡¨æœ«å°¾   |
| length   | é»˜è®¤å‚æ•°ä¸è®¡å…¥å‡½æ•° length    |

é»˜è®¤å‚æ•°è®©å‡½æ•°ç­¾åæ›´æ¸…æ™°ï¼Œé…åˆè§£æ„ä½¿ç”¨å¯ä»¥å®ç°çµæ´»çš„é…ç½®å¯¹è±¡æ¨¡å¼ã€‚
