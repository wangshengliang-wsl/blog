---
title: 字符串的扩展与新增方法
description: 深入掌握 ES6+ 字符串新特性，包括模板字符串、标签模板、Unicode 支持，以及 includes、padStart、replaceAll 等实用方法
pubDate: 2025-11-27
toc: true
ogImage: true
category: ES6+
---

字符串是编程中使用最频繁的数据类型之一。ES6 之前，JavaScript 的字符串处理能力相当有限——拼接靠 `+`，多行字符串靠 `\n`，判断包含关系只能用 `indexOf`。ES6 及后续版本对字符串进行了大幅增强。

## 模板字符串（Template Literals）

模板字符串用反引号（`）包裹，解决了传统字符串拼接的痛点。

### 基本用法

```javascript
const name = '张三'
const age = 25

// ES5 拼接
var greeting = '你好，我是' + name + '，今年' + age + '岁。'

// ES6 模板字符串
const greeting = `你好，我是${name}，今年${age}岁。`
```

`${}` 中可以放入任意 JavaScript 表达式：

```javascript
const price = 99.5
const quantity = 3

const message = `总价：${price * quantity}元`
console.log(message) // '总价：298.5元'

const arr = [1, 2, 3]
console.log(`数组长度：${arr.length}`) // '数组长度：3'

console.log(`当前时间：${new Date().toLocaleString()}`)

// 可以调用函数
function format(n) {
  return n.toFixed(2)
}
console.log(`格式化：${format(3.14159)}`) // '格式化：3.14'
```

### 多行字符串

模板字符串天然支持多行，所有的空格和换行都会保留：

```javascript
const html = `
<div class="container">
  <h1>标题</h1>
  <p>内容</p>
</div>
`

// 注意：开头的换行也会保留
console.log(html)
```

如果需要去除开头的换行：

```javascript
const html = `<div class="container">
  <h1>标题</h1>
  <p>内容</p>
</div>`
```

### 嵌套模板

模板字符串可以嵌套：

```javascript
const items = ['苹果', '香蕉', '橙子']

const list = `
<ul>
  ${items.map((item) => `<li>${item}</li>`).join('\n  ')}
</ul>
`

console.log(list)
// <ul>
//   <li>苹果</li>
//   <li>香蕉</li>
//   <li>橙子</li>
// </ul>
```

### 转义

在模板字符串中，反引号、`$` 和 `{` 需要转义：

```javascript
console.log(`反引号：\``) // '反引号：`'
console.log(`美元符号：\${}`) // '美元符号：${}'
```

## 标签模板（Tagged Templates）

标签模板是一种更高级的模板字符串用法，可以用函数来处理模板字符串。

### 基本语法

```javascript
function tag(strings, ...values) {
  console.log(strings) // 字符串数组
  console.log(values) // 插值数组
}

const name = '张三'
const age = 25

tag`我是${name}，今年${age}岁`
// strings: ['我是', '，今年', '岁']
// values: ['张三', 25]
```

`strings` 是按插值位置分割的字符串数组，`values` 是所有插值。`strings.length` 总是等于 `values.length + 1`。

### 实现一个简单的模板函数

```javascript
function template(strings, ...values) {
  return strings.reduce((result, str, i) => {
    return result + str + (values[i] !== undefined ? values[i] : '')
  }, '')
}

const name = '张三'
const result = template`你好，${name}！`
console.log(result) // '你好，张三！'
```

### 实战：安全的 HTML 转义

```javascript
function safeHtml(strings, ...values) {
  const escape = (str) =>
    String(str)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#39;')

  return strings.reduce((result, str, i) => {
    const value = values[i] !== undefined ? escape(values[i]) : ''
    return result + str + value
  }, '')
}

const userInput = '<script>alert("xss")</script>'
const html = safeHtml`<div>${userInput}</div>`
console.log(html)
// '<div>&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;</div>'
```

### 实战：国际化（i18n）

```javascript
const messages = {
  'zh-CN': {
    greeting: '你好，{0}！',
    items: '你有 {0} 个未读消息',
  },
  'en-US': {
    greeting: 'Hello, {0}!',
    items: 'You have {0} unread messages',
  },
}

function createI18n(locale) {
  const dict = messages[locale]
  return function (strings, ...values) {
    const key = strings.join('{0}').trim()
    let template = dict[key] || key
    values.forEach((val, i) => {
      template = template.replace(`{${i}}`, val)
    })
    return template
  }
}

const i18n = createI18n('zh-CN')
const name = '张三'
console.log(i18n`greeting ${name}`) // '你好，张三！'

const count = 5
console.log(i18n`items ${count}`) // '你有 5 个未读消息'
```

### 实战：styled-components 风格的 CSS-in-JS

```javascript
function css(strings, ...values) {
  const style = strings.reduce((result, str, i) => {
    return result + str + (values[i] || '')
  }, '')

  // 返回一个可以应用样式的函数
  return (element) => {
    element.style.cssText = style
  }
}

const primaryColor = '#007bff'
const applyStyle = css`
  color: ${primaryColor};
  padding: 10px 20px;
  border-radius: 4px;
`

// applyStyle(document.querySelector('.btn'));
```

### String.raw

`String.raw` 是内置的标签函数，返回原始字符串，不处理转义：

```javascript
console.log(`Line1\nLine2`)
// Line1
// Line2

console.log(String.raw`Line1\nLine2`)
// Line1\nLine2

// 处理 Windows 路径很方便
const path = String.raw`C:\Users\Admin\Documents`
console.log(path) // 'C:\Users\Admin\Documents'
```

## Unicode 支持增强

### 码点表示法

ES6 支持用 `\u{码点}` 表示 Unicode 字符：

```javascript
// ES5 只支持 \uXXXX（4位十六进制）
console.log('\u0041') // 'A'
console.log('\u20BB7') // '₻7'，被解析为 \u20BB + '7'

// ES6 支持大括号表示法
console.log('\u{20BB7}') // '𠮷'，正确显示
console.log('\u{41}') // 'A'
```

### codePointAt 和 fromCodePoint

JavaScript 内部使用 UTF-16 编码，对于码点大于 `0xFFFF` 的字符（如 emoji、部分汉字），需要两个编码单元表示。ES5 的 `charCodeAt` 无法正确处理这种情况：

```javascript
const s = '𠮷'

// ES5：错误地返回第一个编码单元
console.log(s.charCodeAt(0).toString(16)) // 'd842'

// ES6：正确返回码点
console.log(s.codePointAt(0).toString(16)) // '20bb7'
console.log(s.codePointAt(0)) // 134071
```

`String.fromCodePoint` 是 `codePointAt` 的逆操作：

```javascript
// ES5：无法处理大于 0xFFFF 的码点
console.log(String.fromCharCode(0x20bb7)) // ''

// ES6：正确
console.log(String.fromCodePoint(0x20bb7)) // '𠮷'
console.log(String.fromCodePoint(65, 66, 67)) // 'ABC'
```

### 正确遍历字符串

```javascript
const s = '𠮷a'

// ES5：错误，按编码单元遍历
for (var i = 0; i < s.length; i++) {
  console.log(s[i]) // 输出 4 个字符（乱码）
}

// ES6：for...of 正确按码点遍历
for (const char of s) {
  console.log(char) // '𠮷', 'a'
}

// 获取正确的字符串长度
console.log([...s].length) // 2
console.log(Array.from(s).length) // 2
```

### normalize

用于 Unicode 正规化，处理合成字符：

```javascript
// 同一个字符可能有不同的表示方式
const s1 = '\u01D1' // 'Ǐ'（单个字符）
const s2 = '\u004F\u030C' // 'Ǐ'（O + 组合字符）

console.log(s1 === s2) // false
console.log(s1.length) // 1
console.log(s2.length) // 2

// normalize 后相等
console.log(s1.normalize() === s2.normalize()) // true
```

## 字符串新增方法

### includes、startsWith、endsWith

ES5 只能用 `indexOf` 判断字符串包含关系，返回值是位置，需要与 `-1` 比较。ES6 新增三个方法直接返回布尔值：

```javascript
const str = 'Hello, World!'

// includes：是否包含
console.log(str.includes('World')) // true
console.log(str.includes('world')) // false（区分大小写）

// startsWith：是否以指定字符串开头
console.log(str.startsWith('Hello')) // true
console.log(str.startsWith('World')) // false

// endsWith：是否以指定字符串结尾
console.log(str.endsWith('!')) // true
console.log(str.endsWith('World!')) // true
```

三个方法都支持第二个参数指定搜索起始位置：

```javascript
const str = 'Hello, World!'

console.log(str.includes('Hello', 1)) // false，从位置 1 开始搜索
console.log(str.startsWith('World', 7)) // true，从位置 7 开始
console.log(str.endsWith('Hello', 5)) // true，只在前 5 个字符中搜索
```

### repeat

将字符串重复指定次数：

```javascript
console.log('ab'.repeat(3)) // 'ababab'
console.log('x'.repeat(5)) // 'xxxxx'

// 小数会被取整
console.log('na'.repeat(2.9)) // 'nana'

// 0 返回空字符串
console.log('x'.repeat(0)) // ''

// 负数或 Infinity 报错
console.log('x'.repeat(-1)) // RangeError
console.log('x'.repeat(Infinity)) // RangeError

// NaN 等同于 0
console.log('x'.repeat(NaN)) // ''
```

### padStart、padEnd

字符串补全到指定长度：

```javascript
// padStart：在开头补全
console.log('5'.padStart(2, '0')) // '05'
console.log('123'.padStart(5, '0')) // '00123'

// padEnd：在结尾补全
console.log('x'.padEnd(5, 'ab')) // 'xabab'
console.log('x'.padEnd(4, 'ab')) // 'xaba'

// 原字符串长度大于等于指定长度，返回原字符串
console.log('hello'.padStart(3)) // 'hello'

// 省略第二个参数，用空格补全
console.log('x'.padStart(4)) // '   x'

// 补全字符串超出时会截断
console.log('abc'.padStart(10, '0123456789')) // '0123456abc'
```

实际应用：

```javascript
// 数字补零
const formatNumber = (n) => String(n).padStart(2, '0')
console.log(formatNumber(5)) // '05'

// 日期格式化
const date = new Date()
const year = date.getFullYear()
const month = String(date.getMonth() + 1).padStart(2, '0')
const day = String(date.getDate()).padStart(2, '0')
console.log(`${year}-${month}-${day}`)

// 对齐输出
const items = [
  { name: 'Apple', price: 5 },
  { name: 'Banana', price: 12 },
  { name: 'Orange', price: 8 },
]
items.forEach((item) => {
  console.log(`${item.name.padEnd(10)} $${String(item.price).padStart(4)}`)
})
// Apple      $   5
// Banana     $  12
// Orange     $   8
```

### trimStart、trimEnd

`trim()` 去除两端空白，ES2019 新增 `trimStart()` 和 `trimEnd()` 分别去除开头和结尾的空白：

```javascript
const str = '  Hello World  '

console.log(str.trim()) // 'Hello World'
console.log(str.trimStart()) // 'Hello World  '
console.log(str.trimEnd()) // '  Hello World'

// 别名
console.log(str.trimLeft()) // trimStart 的别名
console.log(str.trimRight()) // trimEnd 的别名
```

### replaceAll

ES2021 新增，替换所有匹配的子串：

```javascript
const str = 'aabbcc'

// replace 只替换第一个
console.log(str.replace('b', 'x')) // 'aaxbcc'

// ES5 需要正则的 g 标志
console.log(str.replace(/b/g, 'x')) // 'aaxxcc'

// ES2021 replaceAll
console.log(str.replaceAll('b', 'x')) // 'aaxxcc'
```

`replaceAll` 也支持正则表达式，但必须带 `g` 标志：

```javascript
console.log('aabbcc'.replaceAll(/b/g, 'x')) // 'aaxxcc'
console.log('aabbcc'.replaceAll(/b/, 'x')) // TypeError
```

### at

ES2022 新增，支持负索引的字符访问：

```javascript
const str = 'Hello'

console.log(str.at(0)) // 'H'
console.log(str.at(1)) // 'e'
console.log(str.at(-1)) // 'o'，倒数第一个
console.log(str.at(-2)) // 'l'，倒数第二个

// 相比 [] 的优势
console.log(str[-1]) // undefined，[] 不支持负索引
console.log(str.at(-1)) // 'o'
```

### 其他实用方法

```javascript
// split 的逆操作
console.log(['a', 'b', 'c'].join('-')) // 'a-b-c'

// 大小写转换
console.log('Hello'.toUpperCase()) // 'HELLO'
console.log('Hello'.toLowerCase()) // 'hello'

// 本地化大小写转换（处理特殊语言）
console.log('İ'.toLocaleLowerCase('tr')) // 'i'（土耳其语）

// slice vs substring vs substr
const s = 'Hello, World'
console.log(s.slice(7, 12)) // 'World'
console.log(s.substring(7, 12)) // 'World'
console.log(s.slice(-5)) // 'World'，支持负数
console.log(s.substring(-5)) // 'Hello, World'，负数当作 0
```

## 实战应用

### SQL 查询构建器

```javascript
function sql(strings, ...values) {
  // 参数化查询，防止 SQL 注入
  const query = strings.join('?')
  return {
    text: query,
    values: values,
  }
}

const userId = 123
const status = 'active'
const query = sql`SELECT * FROM users WHERE id = ${userId} AND status = ${status}`

console.log(query)
// { text: 'SELECT * FROM users WHERE id = ? AND status = ?', values: [123, 'active'] }
```

### GraphQL 查询

```javascript
function gql(strings, ...values) {
  return strings
    .reduce((result, str, i) => {
      return result + str + (values[i] || '')
    }, '')
    .trim()
}

const userFields = `
  id
  name
  email
`

const query = gql`
  query GetUser($id: ID!) {
    user(id: $id) {
      ${userFields}
      posts {
        title
      }
    }
  }
`
```

### 日志格式化

```javascript
function log(strings, ...values) {
  const timestamp = new Date().toISOString()
  const message = strings.reduce((result, str, i) => {
    const value =
      values[i] !== undefined
        ? typeof values[i] === 'object'
          ? JSON.stringify(values[i])
          : values[i]
        : ''
    return result + str + value
  }, '')
  console.log(`[${timestamp}] ${message}`)
}

const user = { id: 1, name: '张三' }
const action = 'login'
log`User ${user} performed ${action}`
// [2025-11-27T10:30:00.000Z] User {"id":1,"name":"张三"} performed login
```

### URL 构建

```javascript
function buildUrl(base, params = {}) {
  const query = Object.entries(params)
    .map(
      ([key, value]) =>
        `${encodeURIComponent(key)}=${encodeURIComponent(value)}`
    )
    .join('&')
  return query ? `${base}?${query}` : base
}

const searchUrl = buildUrl('https://api.example.com/search', {
  q: '中文搜索',
  page: 1,
  limit: 10,
})
console.log(searchUrl)
// https://api.example.com/search?q=%E4%B8%AD%E6%96%87%E6%90%9C%E7%B4%A2&page=1&limit=10
```

---

ES6+ 对字符串的增强让日常开发变得更加顺畅。模板字符串消除了繁琐的拼接，标签模板提供了 DSL 的可能性，新增的方法让字符串处理更加直观。在现代项目中，这些特性已经成为标配。
