---
title: 'å¯¹è±¡çš„æ‰©å±•'
description: 'è¯¦è§£ ES6 å¯¹è±¡å­—é¢é‡å¢å¼ºï¼šå±æ€§ç®€å†™ã€è®¡ç®—å±æ€§åã€æ–¹æ³•ç®€å†™ä¸ super å…³é”®å­—'
pubDate: 2024-01-16
toc: true
ogImage: true
category: 'ES6+'
tags: ['ES6', 'å¯¹è±¡', 'å±æ€§ç®€å†™', 'è®¡ç®—å±æ€§']
---

ES6 å¤§å¹…å¢å¼ºäº†å¯¹è±¡å­—é¢é‡çš„è¯­æ³•ï¼Œè®©å¯¹è±¡çš„åˆ›å»ºæ›´åŠ ç®€æ´ã€‚

## å±æ€§ç®€å†™

å½“å±æ€§åå’Œå˜é‡åç›¸åŒæ—¶ï¼Œå¯ä»¥ç®€å†™ï¼š

```javascript
const name = 'å¼ ä¸‰'
const age = 25

// ES5
const user1 = {
  name: name,
  age: age,
}

// ES6 ç®€å†™
const user2 = { name, age }
console.log(user2) // { name: 'å¼ ä¸‰', age: 25 }
```

### å®é™…åº”ç”¨

```javascript
// å‡½æ•°è¿”å›å€¼
function getUser() {
  const id = 1
  const name = 'å¼ ä¸‰'
  const email = 'test@test.com'
  return { id, name, email }
}

// æ¨¡å—å¯¼å‡º
const API_URL = 'https://api.example.com'
const timeout = 5000
export { API_URL, timeout }

// è§£æ„åé‡æ–°ç»„è£…
const { id, name, ...rest } = fullUser
const publicUser = { id, name }
```

## æ–¹æ³•ç®€å†™

å¯¹è±¡æ–¹æ³•å¯ä»¥çœç•¥ `function` å…³é”®å­—ï¼š

```javascript
// ES5
const obj1 = {
  sayHello: function () {
    console.log('Hello')
  },
}

// ES6 ç®€å†™
const obj2 = {
  sayHello() {
    console.log('Hello')
  },

  // Generator æ–¹æ³•
  *createIterator() {
    yield 1
    yield 2
  },

  // å¼‚æ­¥æ–¹æ³•
  async fetchData() {
    return await fetch('/api/data')
  },
}
```

### ğŸ”¶ æ–¹æ³•ç®€å†™ä¸èƒ½ä½œä¸ºæ„é€ å‡½æ•°

```javascript
const obj = {
  // æ–¹æ³•ç®€å†™
  method() {},
  // ä¼ ç»Ÿæ–¹æ³•
  traditional: function () {},
}

// new obj.method(); // TypeError: obj.method is not a constructor
new obj.traditional() // OKï¼ˆä½†ä¸æ¨èè¿™æ ·ç”¨ï¼‰
```

## è®¡ç®—å±æ€§å

å±æ€§åå¯ä»¥æ˜¯è¡¨è¾¾å¼ï¼š

```javascript
const key = 'name'
const prefix = 'user_'

const obj = {
  [key]: 'å¼ ä¸‰',
  [`${prefix}id`]: 1,
  ['say' + 'Hello']() {
    console.log('Hello')
  },
}

console.log(obj.name) // 'å¼ ä¸‰'
console.log(obj.user_id) // 1
obj.sayHello() // 'Hello'
```

### å®é™…åº”ç”¨

```javascript
// åŠ¨æ€åˆ›å»ºå¯¹è±¡
function createObject(key, value) {
  return { [key]: value }
}
createObject('name', 'å¼ ä¸‰') // { name: 'å¼ ä¸‰' }

// ä»¥ Symbol ä¸ºé”®
const ID = Symbol('id')
const obj = {
  [ID]: 123,
  name: 'å¼ ä¸‰',
}

// æ ¹æ®æ¡ä»¶åˆ›å»ºå±æ€§
const type = 'error'
const log = {
  message: 'Something went wrong',
  [`${type}Code`]: 500,
  [`is${type.charAt(0).toUpperCase() + type.slice(1)}`]: true,
}
// { message: '...', errorCode: 500, isError: true }
```

## å±æ€§åè¡¨è¾¾å¼ä¸ç®€å†™ä¸èƒ½åŒæ—¶ä½¿ç”¨

```javascript
const key = 'name'
const name = 'å¼ ä¸‰'

// ğŸ”¶ é”™è¯¯
// const obj = { [key] }; // SyntaxError

// æ­£ç¡®
const obj = { [key]: name } // { name: 'å¼ ä¸‰' }
```

## æ–¹æ³•çš„ name å±æ€§

å‡½æ•°æœ‰ `name` å±æ€§ï¼Œå¯¹è±¡æ–¹æ³•ä¹Ÿæœ‰ï¼š

```javascript
const obj = {
  sayHello() {},
  get name() {
    return 'å¼ ä¸‰'
  },
  set name(value) {},
}

obj.sayHello.name // 'sayHello'

// getter/setter çš„ name éœ€è¦é€šè¿‡æè¿°ç¬¦è·å–
const descriptor = Object.getOwnPropertyDescriptor(obj, 'name')
descriptor.get.name // 'get name'
descriptor.set.name // 'set name'
```

ç‰¹æ®Šæƒ…å†µï¼š

```javascript
// bind åˆ›å»ºçš„å‡½æ•°
function foo() {}
foo.bind({}).name // 'bound foo'

// åŒ¿åå‡½æ•°
;(function () {}).name // ''

// Symbol é”®çš„æ–¹æ³•
const sym = Symbol('description')
const obj = { [sym]() {} }
obj[sym].name // '[description]'
```

## super å…³é”®å­—

`super` åœ¨å¯¹è±¡æ–¹æ³•ä¸­æŒ‡å‘åŸå‹å¯¹è±¡ï¼š

```javascript
const parent = {
  greet() {
    return 'Hello from parent'
  },
}

const child = {
  __proto__: parent,

  greet() {
    // super æŒ‡å‘åŸå‹å¯¹è±¡ parent
    return super.greet() + ' and child'
  },
}

child.greet() // 'Hello from parent and child'
```

ğŸ”¶ `super` åªèƒ½ç”¨åœ¨å¯¹è±¡æ–¹æ³•ç®€å†™ä¸­ï¼š

```javascript
const obj = {
  // âœ… æ–¹æ³•ç®€å†™ä¸­å¯ä»¥ä½¿ç”¨ super
  method() {
    super.foo()
  },

  // âŒ ä¼ ç»Ÿæ–¹æ³•ä¸­ä¸èƒ½ä½¿ç”¨
  traditional: function () {
    // super.foo(); // SyntaxError
  },

  // âŒ ç®­å¤´å‡½æ•°ä¸­ä¸èƒ½ä½¿ç”¨
  arrow: () => {
    // super.foo(); // SyntaxError
  },
}
```

### å®é™…åº”ç”¨

```javascript
// æ··å…¥æ¨¡å¼
const Serializable = {
  toJSON() {
    return JSON.stringify(this)
  },
}

const user = {
  __proto__: Serializable,
  name: 'å¼ ä¸‰',
  age: 25,

  toJSON() {
    // è°ƒç”¨çˆ¶ç±»æ–¹æ³•ï¼Œä½†æ’é™¤æ•æ„Ÿä¿¡æ¯
    const { password, ...safe } = this
    return JSON.stringify(safe)
  },
}

// æ–¹æ³•è¦†ç›–ä¸è°ƒç”¨
const base = {
  init() {
    console.log('Base init')
  },
}

const extended = {
  __proto__: base,
  init() {
    super.init() // å…ˆè°ƒç”¨çˆ¶ç±»
    console.log('Extended init')
  },
}

extended.init()
// 'Base init'
// 'Extended init'
```

## å¯¹è±¡æ‰©å±•è¿ç®—ç¬¦

ES2018 å…è®¸åœ¨å¯¹è±¡ä¸­ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ï¼š

```javascript
// å¤åˆ¶å¯¹è±¡
const original = { a: 1, b: 2 }
const copy = { ...original }

// åˆå¹¶å¯¹è±¡
const obj1 = { a: 1, b: 2 }
const obj2 = { c: 3, d: 4 }
const merged = { ...obj1, ...obj2 } // { a: 1, b: 2, c: 3, d: 4 }

// è¦†ç›–å±æ€§
const defaults = { theme: 'light', lang: 'en' }
const settings = { ...defaults, lang: 'zh' } // { theme: 'light', lang: 'zh' }

// æ¡ä»¶å±æ€§
const isDev = true
const config = {
  api: '/api',
  ...(isDev && { debug: true }),
}
```

## è§£æ„ä¸ç®€å†™ç»“åˆ

```javascript
// æå–å¹¶é‡å‘½å
const response = {
  data: { user: { name: 'å¼ ä¸‰', age: 25 } },
  status: 200,
}

const {
  data: {
    user: { name, age },
  },
  status,
} = response
const result = { name, age, status }
// { name: 'å¼ ä¸‰', age: 25, status: 200 }

// å‡½æ•°å‚æ•°è§£æ„ + è¿”å›ç®€å†™
function processUser({ name, age, email }) {
  // å¤„ç†é€»è¾‘...
  const processed = true
  return { name, age, email, processed }
}
```

## å®æˆ˜åº”ç”¨

### é…ç½®å¯¹è±¡

```javascript
function createServer(options = {}) {
  const { port = 3000, host = 'localhost', https = false } = options

  // ä½¿ç”¨ç®€å†™è¿”å›é…ç½®
  return { port, host, https }
}
```

### çŠ¶æ€æ›´æ–°

```javascript
function reducer(state, action) {
  switch (action.type) {
    case 'SET_NAME':
      return { ...state, name: action.payload }
    case 'SET_AGE':
      return { ...state, age: action.payload }
    case 'RESET':
      return { ...initialState }
    default:
      return state
  }
}
```

### åŠ¨æ€è¡¨å•

```javascript
function handleChange(event) {
  const { name, value } = event.target
  setFormData((prev) => ({
    ...prev,
    [name]: value,
  }))
}
```

### API å“åº”å¤„ç†

```javascript
async function fetchUser(id) {
  const response = await fetch(`/api/users/${id}`)
  const { data: user, meta } = await response.json()

  return {
    ...user,
    fetchedAt: new Date(),
    ...meta,
  }
}
```

## å°ç»“

| ç‰¹æ€§       | è¯­æ³•                | è¯´æ˜                         |
| ---------- | ------------------- | ---------------------------- |
| å±æ€§ç®€å†™   | `{ name }`          | å˜é‡åä¸å±æ€§åç›¸åŒæ—¶         |
| æ–¹æ³•ç®€å†™   | `{ method() {} }`   | çœç•¥ function å…³é”®å­—         |
| è®¡ç®—å±æ€§å | `{ [expr]: value }` | å±æ€§åå¯ä»¥æ˜¯è¡¨è¾¾å¼           |
| super      | `super.method()`    | è®¿é—®åŸå‹å¯¹è±¡ï¼ˆä»…æ–¹æ³•ç®€å†™ä¸­ï¼‰ |
| æ‰©å±•è¿ç®—ç¬¦ | `{ ...obj }`        | å¤åˆ¶/åˆå¹¶å¯¹è±¡                |

è¿™äº›å¢å¼ºè®©å¯¹è±¡å­—é¢é‡æ›´åŠ å¼ºå¤§å’Œçµæ´»ï¼Œæ˜¯æ—¥å¸¸å¼€å‘ä¸­æœ€å¸¸ç”¨çš„è¯­æ³•ç³–ã€‚
