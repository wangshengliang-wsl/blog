---
title: 'let å’Œ const å‘½ä»¤'
description: 'æ·±å…¥ç†è§£ ES6 ä¸­ let å’Œ const çš„å—çº§ä½œç”¨åŸŸã€æš‚æ—¶æ€§æ­»åŒºä¸æœ€ä½³å®è·µ'
pubDate: 2024-01-01
toc: true
ogImage: true
category: 'ES6+'
tags: ['ES6', 'å˜é‡å£°æ˜', 'ä½œç”¨åŸŸ', 'let', 'const']
---

ES6 å¼•å…¥äº† `let` å’Œ `const` ä¸¤ä¸ªæ–°çš„å˜é‡å£°æ˜å…³é”®å­—ï¼Œå½»åº•æ”¹å˜äº† JavaScript çš„å˜é‡ä½œç”¨åŸŸè§„åˆ™ã€‚

## ğŸ¯ var çš„é—®é¢˜

å…ˆçœ‹ `var` å­˜åœ¨çš„é—®é¢˜ï¼š

```javascript
// é—®é¢˜1ï¼šå˜é‡æå‡
console.log(name) // undefinedï¼Œè€Œä¸æ˜¯æŠ¥é”™
var name = 'å¼ ä¸‰'

// é—®é¢˜2ï¼šæ²¡æœ‰å—çº§ä½œç”¨åŸŸ
for (var i = 0; i < 3; i++) {
  setTimeout(() => console.log(i), 100)
}
// è¾“å‡ºï¼š3, 3, 3ï¼ˆè€Œä¸æ˜¯ 0, 1, 2ï¼‰

// é—®é¢˜3ï¼šå¯ä»¥é‡å¤å£°æ˜
var count = 1
var count = 2 // ä¸æŠ¥é”™ï¼Œå®¹æ˜“é€ æˆ bug
```

## let å£°æ˜

### åŸºæœ¬ç”¨æ³•

```javascript
let age = 25
age = 26 // å¯ä»¥é‡æ–°èµ‹å€¼

let username = 'æå››'
// let username = 'ç‹äº”'; // SyntaxError: ä¸èƒ½é‡å¤å£°æ˜
```

### å—çº§ä½œç”¨åŸŸ

`let` å£°æ˜çš„å˜é‡åªåœ¨å½“å‰ä»£ç å—å†…æœ‰æ•ˆï¼š

```javascript
{
  let a = 10
  var b = 20
}
// console.log(a); // ReferenceError: a is not defined
console.log(b) // 20
```

ç»å…¸çš„å¾ªç¯é—®é¢˜ç”¨ `let` è½»æ¾è§£å†³ï¼š

```javascript
for (let i = 0; i < 3; i++) {
  setTimeout(() => console.log(i), 100)
}
// è¾“å‡ºï¼š0, 1, 2 âœ…
```

### æš‚æ—¶æ€§æ­»åŒºï¼ˆTDZï¼‰

ä»å—çš„å¼€å§‹åˆ° `let` å£°æ˜ä¹‹é—´çš„åŒºåŸŸå«åš"æš‚æ—¶æ€§æ­»åŒº"ï¼ˆTemporal Dead Zoneï¼‰ï¼š

```javascript
// TDZ å¼€å§‹
console.log(x) // ReferenceError: Cannot access 'x' before initialization
let x = 10 // TDZ ç»“æŸ
```

ğŸ”¶ TDZ çš„å­˜åœ¨è®©ä»£ç æ›´åŠ å¯é¢„æµ‹ï¼Œå¼ºåˆ¶ä½ å…ˆå£°æ˜åä½¿ç”¨ã€‚

ä¸€ä¸ªéšè”½çš„ TDZ åœºæ™¯ï¼š

```javascript
function foo(x = y, y = 2) {
  return [x, y]
}
foo() // ReferenceError: y åœ¨ TDZ ä¸­
```

## const å£°æ˜

### åŸºæœ¬ç”¨æ³•

`const` å£°æ˜ä¸€ä¸ªåªè¯»å¸¸é‡ï¼Œå¿…é¡»åœ¨å£°æ˜æ—¶åˆå§‹åŒ–ï¼š

```javascript
const PI = 3.14159
// PI = 3.14; // TypeError: Assignment to constant variable

// const MAX; // SyntaxError: Missing initializer
```

### å¯¹è±¡å’Œæ•°ç»„

ğŸ¤” `const` ä¿è¯çš„æ˜¯å˜é‡æŒ‡å‘çš„å†…å­˜åœ°å€ä¸å˜ï¼Œè€Œä¸æ˜¯å€¼ä¸å˜ï¼š

```javascript
const user = { name: 'å¼ ä¸‰' }
user.name = 'æå››' // âœ… å¯ä»¥ä¿®æ”¹å±æ€§
user.age = 25 // âœ… å¯ä»¥æ·»åŠ å±æ€§
// user = {}; // âŒ TypeError: ä¸èƒ½é‡æ–°èµ‹å€¼

const list = [1, 2, 3]
list.push(4) // âœ… å¯ä»¥ä¿®æ”¹æ•°ç»„å†…å®¹
// list = []; // âŒ TypeError
```

å¦‚æœéœ€è¦çœŸæ­£ä¸å¯å˜çš„å¯¹è±¡ï¼Œä½¿ç”¨ `Object.freeze()`ï¼š

```javascript
const frozen = Object.freeze({ name: 'å¼ ä¸‰' })
frozen.name = 'æå››' // é™é»˜å¤±è´¥ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹æŠ¥é”™
console.log(frozen.name) // 'å¼ ä¸‰'

// æ³¨æ„ï¼šfreeze æ˜¯æµ…å†»ç»“
const nested = Object.freeze({
  info: { age: 25 },
})
nested.info.age = 30 // ä»ç„¶å¯ä»¥ä¿®æ”¹
console.log(nested.info.age) // 30
```

æ·±åº¦å†»ç»“éœ€è¦é€’å½’å¤„ç†ï¼š

```javascript
function deepFreeze(obj) {
  Object.keys(obj).forEach((key) => {
    if (typeof obj[key] === 'object' && obj[key] !== null) {
      deepFreeze(obj[key])
    }
  })
  return Object.freeze(obj)
}

const config = deepFreeze({
  api: { url: 'https://api.example.com' },
})
config.api.url = 'xxx' // æ— æ•ˆ
```

## å—çº§ä½œç”¨åŸŸçš„åº”ç”¨

### æ›¿ä»£ IIFE

ES5 æ—¶ä»£ç”¨ IIFE åˆ›å»ºç§æœ‰ä½œç”¨åŸŸï¼š

```javascript
// ES5
;(function () {
  var private = 'ç§æœ‰å˜é‡'
})()
```

ES6 ç›´æ¥ç”¨å—ï¼š

```javascript
// ES6
{
  let private = 'ç§æœ‰å˜é‡'
}
```

### æ¡ä»¶å£°æ˜

```javascript
function process(condition) {
  if (condition) {
    let result = 'å¤„ç†ç»“æœ'
    return result
  }
  // result åœ¨è¿™é‡Œä¸å¯è®¿é—®ï¼Œé¿å…æ„å¤–ä½¿ç”¨
  return null
}
```

### switch è¯­å¥

```javascript
// ğŸ”¶ æ²¡æœ‰å—ä½œç”¨åŸŸä¼šæŠ¥é”™
switch (type) {
  case 'A':
    let msg = 'Type A' // æŠ¥é”™ï¼šé‡å¤å£°æ˜
    break
  case 'B':
    let msg = 'Type B'
    break
}

// âœ… æ­£ç¡®å†™æ³•ï¼šç”¨å—åŒ…è£¹
switch (type) {
  case 'A': {
    let msg = 'Type A'
    console.log(msg)
    break
  }
  case 'B': {
    let msg = 'Type B'
    console.log(msg)
    break
  }
}
```

## å…¨å±€å˜é‡

`var` å’Œ `function` å£°æ˜çš„å…¨å±€å˜é‡ä¼šæˆä¸º `window` çš„å±æ€§ï¼Œ`let` å’Œ `const` ä¸ä¼šï¼š

```javascript
var globalVar = 'var'
let globalLet = 'let'
const globalConst = 'const'

console.log(window.globalVar) // 'var'
console.log(window.globalLet) // undefined
console.log(window.globalConst) // undefined
```

## æœ€ä½³å®è·µ

### 1. é»˜è®¤ä½¿ç”¨ const

```javascript
// âœ… æ¨è
const config = { debug: true }
const API_URL = 'https://api.example.com'
const numbers = [1, 2, 3]

// åªæœ‰éœ€è¦é‡æ–°èµ‹å€¼æ—¶æ‰ç”¨ let
let count = 0
count++
```

### 2. ä¸å†ä½¿ç”¨ var

```javascript
// âŒ é¿å…
var name = 'å¼ ä¸‰'

// âœ… æ¨è
const name = 'å¼ ä¸‰'
```

### 3. åœ¨å—çš„é¡¶éƒ¨å£°æ˜

```javascript
function process(items) {
  // å˜é‡å£°æ˜æ”¾åœ¨å—çš„é¡¶éƒ¨
  const result = []
  let total = 0

  for (const item of items) {
    result.push(item.value)
    total += item.value
  }

  return { result, total }
}
```

### 4. å¾ªç¯ä¸­çš„é€‰æ‹©

```javascript
// for...of å’Œ for...in ä½¿ç”¨ const
for (const item of items) {
  console.log(item)
}

for (const key in obj) {
  console.log(key)
}

// ä¼ ç»Ÿ for å¾ªç¯ä½¿ç”¨ let
for (let i = 0; i < 10; i++) {
  console.log(i)
}
```

## å¸¸è§é—®é¢˜

### ğŸ™‹ let å’Œ const æœ‰å˜é‡æå‡å—ï¼Ÿ

æœ‰ï¼Œä½†è¡Œä¸ºä¸åŒã€‚å®ƒä»¬ä¼šè¢«æå‡åˆ°å—çš„é¡¶éƒ¨ï¼Œä½†åœ¨å£°æ˜ä¹‹å‰å¤„äº TDZï¼Œè®¿é—®ä¼šæŠ¥é”™ï¼š

```javascript
// JavaScript å¼•æ“çŸ¥é“ x å­˜åœ¨ï¼Œä½†ä¸è®©ä½ è®¿é—®
console.log(x) // ReferenceError
let x = 1
```

### ğŸ™‹ ä»€ä¹ˆæ—¶å€™ç”¨ letï¼Ÿ

åªæœ‰åœ¨éœ€è¦é‡æ–°èµ‹å€¼æ—¶æ‰ç”¨ letï¼š

```javascript
// è®¡æ•°å™¨
let count = 0
items.forEach(() => count++)

// ç´¯åŠ å™¨
let sum = 0
for (const num of numbers) {
  sum += num
}

// çŠ¶æ€æ ‡è®°
let isReady = false
// ... æŸäº›æ“ä½œå
isReady = true
```

### ğŸ™‹ const å£°æ˜çš„å¯¹è±¡å¦‚ä½•å®ç°ä¸å¯å˜ï¼Ÿ

```javascript
// æ–¹æ¡ˆ1ï¼šObject.freeze()ï¼ˆæµ…å†»ç»“ï¼‰
const obj = Object.freeze({ a: 1 })

// æ–¹æ¡ˆ2ï¼šæ·±å†»ç»“å‡½æ•°
// æ–¹æ¡ˆ3ï¼šä½¿ç”¨ Immutable.js ç­‰åº“
// æ–¹æ¡ˆ4ï¼šTypeScript çš„ Readonly ç±»å‹ï¼ˆç¼–è¯‘æ—¶æ£€æŸ¥ï¼‰
```

## æ€»ç»“å¯¹æ¯”

| ç‰¹æ€§       | var                      | let            | const          |
| ---------- | ------------------------ | -------------- | -------------- |
| ä½œç”¨åŸŸ     | å‡½æ•°ä½œç”¨åŸŸ               | å—çº§ä½œç”¨åŸŸ     | å—çº§ä½œç”¨åŸŸ     |
| å˜é‡æå‡   | æ˜¯ï¼ˆåˆå§‹åŒ–ä¸º undefinedï¼‰ | æ˜¯ï¼ˆä½†æœ‰ TDZï¼‰ | æ˜¯ï¼ˆä½†æœ‰ TDZï¼‰ |
| é‡å¤å£°æ˜   | å…è®¸                     | ä¸å…è®¸         | ä¸å…è®¸         |
| é‡æ–°èµ‹å€¼   | å…è®¸                     | å…è®¸           | ä¸å…è®¸         |
| å…¨å±€å±æ€§   | æ˜¯ï¼ˆæŒ‚è½½åˆ° windowï¼‰      | å¦             | å¦             |
| å¿…é¡»åˆå§‹åŒ– | å¦                       | å¦             | æ˜¯             |

**ç»“è®º**ï¼šé»˜è®¤ä½¿ç”¨ `const`ï¼Œéœ€è¦é‡æ–°èµ‹å€¼æ—¶ä½¿ç”¨ `let`ï¼Œä¸å†ä½¿ç”¨ `var`ã€‚
