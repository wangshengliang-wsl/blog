---
title: 'BigInt å¤§æ•´æ•°'
description: 'æ·±å…¥ç†è§£ ES2020 BigInt ç±»å‹ï¼šåˆ›å»ºæ–¹å¼ã€è¿ç®—è§„åˆ™ä¸å®é™…ä½¿ç”¨åœºæ™¯'
pubDate: 2024-01-08
toc: true
ogImage: true
category: 'ES6+'
tags: ['ES2020', 'BigInt', 'å¤§æ•´æ•°', 'æ•°å€¼']
---

JavaScript çš„ Number ç±»å‹åªèƒ½å®‰å…¨è¡¨ç¤º -(2^53 - 1) åˆ° 2^53 - 1 ä¹‹é—´çš„æ•´æ•°ã€‚ES2020 å¼•å…¥äº† BigInt ç±»å‹ï¼Œå¯ä»¥è¡¨ç¤ºä»»æ„å¤§çš„æ•´æ•°ã€‚

## ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦ BigInt

```javascript
// Number çš„å®‰å…¨æ•´æ•°èŒƒå›´
console.log(Number.MAX_SAFE_INTEGER) // 9007199254740991

// è¶…å‡ºèŒƒå›´ä¼šä¸¢å¤±ç²¾åº¦
console.log(9007199254740992 === 9007199254740993) // trueï¼ˆå±é™©ï¼ï¼‰
console.log(9007199254740992 + 1) // 9007199254740992ï¼ˆé”™è¯¯ç»“æœï¼‰
console.log(9007199254740992 + 2) // 9007199254740994

// å®é™…åœºæ™¯ï¼šTwitter IDã€æ•°æ®åº“ä¸»é”®ã€åŠ å¯†è¿ç®—
const twitterId = 1453486895483658244 // ä¼šä¸¢å¤±ç²¾åº¦
```

## åˆ›å»º BigInt

### å­—é¢é‡è¯­æ³•

åœ¨æ•°å­—ååŠ  `n`ï¼š

```javascript
const big = 9007199254740993n
console.log(big) // 9007199254740993n
console.log(typeof big) // 'bigint'

// å¯ä»¥è¡¨ç¤ºä»»æ„å¤§çš„æ•´æ•°
const huge = 123456789012345678901234567890n
console.log(huge) // 123456789012345678901234567890n
```

### BigInt() æ„é€ å‡½æ•°

```javascript
// ä»æ•°å­—åˆ›å»ºï¼ˆå¿…é¡»æ˜¯æ•´æ•°ï¼‰
BigInt(123) // 123n
// BigInt(1.5); // RangeError

// ä»å­—ç¬¦ä¸²åˆ›å»º
BigInt('9007199254740993') // 9007199254740993n

// ä¸åŒè¿›åˆ¶
BigInt('0xff') // 255n
BigInt('0o17') // 15n
BigInt('0b1010') // 10n
```

ğŸ”¶ æ³¨æ„ï¼šä¸èƒ½ä½¿ç”¨ `new BigInt()`ï¼š

```javascript
// new BigInt(1); // TypeError: BigInt is not a constructor
```

## è¿ç®—è§„åˆ™

### ç®—æœ¯è¿ç®—

```javascript
const a = 100n
const b = 30n

a + b // 130n
a - b // 70n
a * b // 3000n
a / b // 3nï¼ˆæ•´é™¤ï¼Œå‘é›¶å–æ•´ï¼‰
a % b // 10n
a ** 2n // 10000n

// ä¸€å…ƒè¿ç®—
;-a // -100n
// +a; // TypeErrorï¼ˆä¸æ”¯æŒä¸€å…ƒ+ï¼‰
```

### ğŸ”¶ ä¸èƒ½ä¸ Number æ··åˆè¿ç®—

```javascript
// 10n + 5; // TypeError: Cannot mix BigInt and other types

// å¿…é¡»æ˜¾å¼è½¬æ¢
10n + BigInt(5) // 15n
Number(10n) + 5 // 15
```

### æ¯”è¾ƒè¿ç®—

BigInt å¯ä»¥ä¸ Number æ¯”è¾ƒï¼š

```javascript
// ç›¸ç­‰æ¯”è¾ƒ
10n == 10 // trueï¼ˆå®½æ¾ç›¸ç­‰ï¼‰
10n === 10 // falseï¼ˆä¸¥æ ¼ç›¸ç­‰ï¼Œç±»å‹ä¸åŒï¼‰

// å¤§å°æ¯”è¾ƒ
10n > 5 // true
10n < 20 // true

// æ’åº
const mixed = [4n, 6, -12n, 10, 4, 0, 0n]
mixed.sort() // [-12n, 0, 0n, 4n, 4, 6, 10]
```

### ä½è¿ç®—

```javascript
const a = 0b1010n // 10n
const b = 0b1100n // 12n

a & b // 8n (0b1000)
a | b // 14n (0b1110)
a ^ b // 6n (0b0110)
~a // -11n
a << 2n // 40n
a >> 1n // 5n

// ğŸ”¶ ä½ç§»é‡å¿…é¡»æ˜¯ BigInt
// a << 2; // TypeError
```

### ğŸ”¶ ä¸æ”¯æŒçš„è¿ç®—

```javascript
// ä¸æ”¯æŒä¸€å…ƒ +
// +10n; // TypeError

// ä¸æ”¯æŒ Math æ–¹æ³•
// Math.sqrt(16n); // TypeError
// Math.max(1n, 2n); // TypeError

// ä¸æ”¯æŒæ— ç¬¦å·å³ç§»
// 10n >>> 1n; // TypeError
```

## ç±»å‹è½¬æ¢

### è½¬ä¸ºå…¶ä»–ç±»å‹

```javascript
const big = 123n

// è½¬å­—ç¬¦ä¸²
String(big) // '123'
big.toString() // '123'
big.toString(16) // '7b'ï¼ˆåå…­è¿›åˆ¶ï¼‰

// è½¬æ•°å­—ï¼ˆå¯èƒ½ä¸¢å¤±ç²¾åº¦ï¼‰
Number(big) // 123
Number(9007199254740993n) // 9007199254740992ï¼ˆä¸¢å¤±ç²¾åº¦ï¼ï¼‰

// è½¬å¸ƒå°”å€¼
Boolean(0n) // false
Boolean(1n) // true
```

### JSON åºåˆ—åŒ–

ğŸ”¶ BigInt ä¸èƒ½ç›´æ¥ JSON åºåˆ—åŒ–ï¼š

```javascript
// JSON.stringify({ id: 123n }); // TypeError

// æ–¹æ¡ˆ1ï¼šè½¬ä¸ºå­—ç¬¦ä¸²
JSON.stringify({ id: 123n }, (key, value) =>
  typeof value === 'bigint' ? value.toString() : value
)
// '{"id":"123"}'

// æ–¹æ¡ˆ2ï¼šè‡ªå®šä¹‰ toJSON
BigInt.prototype.toJSON = function () {
  return this.toString()
}
JSON.stringify({ id: 123n }) // '{"id":"123"}'
```

## å®é™…åº”ç”¨

### å¤„ç†å¤§ ID

```javascript
// API è¿”å›çš„å¤§ IDï¼ˆå­—ç¬¦ä¸²å½¢å¼ï¼‰
const response = {
  id: '9007199254740993',
  name: 'ç”¨æˆ·',
}

// è½¬ä¸º BigInt è¿›è¡Œè®¡ç®—
const id = BigInt(response.id)
const nextId = id + 1n
console.log(nextId.toString()) // '9007199254740994'
```

### ç²¾ç¡®çš„æ•´æ•°è¿ç®—

```javascript
// è®¡ç®—å¤§æ•°é˜¶ä¹˜
function factorial(n) {
  let result = 1n
  for (let i = 2n; i <= n; i++) {
    result *= i
  }
  return result
}

factorial(50n)
// 30414093201713378043612608166064768844377641568960512000000000000n

// è®¡ç®—å¤§æ•°å¹‚
function power(base, exp) {
  let result = 1n
  base = BigInt(base)
  while (exp > 0n) {
    if (exp % 2n === 1n) {
      result *= base
    }
    exp /= 2n
    base *= base
  }
  return result
}

power(2, 100n)
// 1267650600228229401496703205376n
```

### åŠ å¯†è¿ç®—

```javascript
// ç®€å•çš„æ¨¡å¹‚è¿ç®—ï¼ˆç”¨äº RSA ç­‰ç®—æ³•ï¼‰
function modPow(base, exp, mod) {
  base = BigInt(base)
  exp = BigInt(exp)
  mod = BigInt(mod)

  let result = 1n
  base = base % mod

  while (exp > 0n) {
    if (exp % 2n === 1n) {
      result = (result * base) % mod
    }
    exp = exp / 2n
    base = (base * base) % mod
  }

  return result
}

modPow(2, 10, 1000) // 24n (2^10 % 1000 = 1024 % 1000)
```

### æ—¶é—´æˆ³å¤„ç†

```javascript
// çº³ç§’çº§æ—¶é—´æˆ³
const nanoTimestamp = 1699000000000000000n

// è½¬æ¢ä¸ºæ¯«ç§’
const msTimestamp = nanoTimestamp / 1000000n
const date = new Date(Number(msTimestamp))

// é«˜ç²¾åº¦æ—¶é—´å·®
function hrtime() {
  const [seconds, nanoseconds] = process.hrtime()
  return BigInt(seconds) * 1000000000n + BigInt(nanoseconds)
}
```

### æ•°æ®åº“ ID å¤„ç†

```javascript
// Snowflake ID è§£æï¼ˆTwitter/Discord ä½¿ç”¨çš„ ID æ ¼å¼ï¼‰
function parseSnowflake(id) {
  const snowflake = BigInt(id)

  // æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼Œä» Discord çºªå…ƒå¼€å§‹ï¼‰
  const timestamp = (snowflake >> 22n) + 1420070400000n

  // å†…éƒ¨ Worker ID
  const workerId = (snowflake & 0x3e0000n) >> 17n

  // å†…éƒ¨è¿›ç¨‹ ID
  const processId = (snowflake & 0x1f000n) >> 12n

  // è‡ªå¢åºåˆ—
  const sequence = snowflake & 0xfffn

  return {
    timestamp: new Date(Number(timestamp)),
    workerId: Number(workerId),
    processId: Number(processId),
    sequence: Number(sequence),
  }
}

parseSnowflake('1453486895483658244')
```

## å…¼å®¹æ€§å¤„ç†

```javascript
// æ£€æŸ¥æ˜¯å¦æ”¯æŒ BigInt
const hasBigInt = typeof BigInt !== 'undefined'

// å®‰å…¨çš„å¤§æ•°å¤„ç†
function safeBigNumber(value) {
  if (hasBigInt) {
    return BigInt(value)
  }
  // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨å­—ç¬¦ä¸²æˆ–ç¬¬ä¸‰æ–¹åº“
  return value.toString()
}

// æ¯”è¾ƒå¤§å°ï¼ˆå…¼å®¹æ¨¡å¼ï¼‰
function compareBigNumbers(a, b) {
  if (hasBigInt) {
    const bigA = BigInt(a)
    const bigB = BigInt(b)
    if (bigA > bigB) return 1
    if (bigA < bigB) return -1
    return 0
  }
  // å­—ç¬¦ä¸²æ¯”è¾ƒï¼ˆåŒä½æ•°æƒ…å†µï¼‰
  if (a.length !== b.length) {
    return a.length - b.length
  }
  return a.localeCompare(b)
}
```

## å¸¸è§é—®é¢˜

### ğŸ™‹ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ BigIntï¼Ÿ

- å¤„ç†è¶…è¿‡ `Number.MAX_SAFE_INTEGER` çš„æ•´æ•°
- éœ€è¦ç²¾ç¡®æ•´æ•°è¿ç®—çš„åœºæ™¯
- å¤„ç†æ¥è‡ªå¤–éƒ¨ç³»ç»Ÿçš„å¤§ IDï¼ˆæ•°æ®åº“ã€ç¬¬ä¸‰æ–¹ APIï¼‰
- åŠ å¯†å’Œå“ˆå¸Œè¿ç®—

### ğŸ™‹ ä¸ºä»€ä¹ˆä¸é»˜è®¤ä½¿ç”¨ BigIntï¼Ÿ

- æ€§èƒ½æ¯” Number ç¨å·®
- ä¸èƒ½ä¸ Number ç›´æ¥æ··åˆè¿ç®—
- ä¸æ”¯æŒ Math æ–¹æ³•
- JSON åºåˆ—åŒ–éœ€è¦é¢å¤–å¤„ç†

### ğŸ™‹ å¦‚ä½•å®‰å…¨åœ°è½¬æ¢ä¸º Numberï¼Ÿ

```javascript
function bigIntToNumber(big) {
  if (
    big > BigInt(Number.MAX_SAFE_INTEGER) ||
    big < BigInt(Number.MIN_SAFE_INTEGER)
  ) {
    throw new Error('BigInt å€¼è¶…å‡º Number å®‰å…¨èŒƒå›´')
  }
  return Number(big)
}
```

## å°ç»“

| ç‰¹æ€§ | è¯´æ˜                                |
| ---- | ----------------------------------- |
| åˆ›å»º | `123n` æˆ– `BigInt('123')`           |
| è¿ç®— | æ”¯æŒç®—æœ¯ã€æ¯”è¾ƒã€ä½è¿ç®—              |
| é™åˆ¶ | ä¸èƒ½ä¸ Number æ··åˆè¿ç®—              |
| è½¬æ¢ | `String()`ã€`Number()`ã€`Boolean()` |
| JSON | éœ€è¦è‡ªå®šä¹‰åºåˆ—åŒ–                    |

BigInt è§£å†³äº† JavaScript é•¿æœŸä»¥æ¥çš„å¤§æ•´æ•°å¤„ç†éš¾é¢˜ï¼Œåœ¨å¤„ç†æ•°æ®åº“ IDã€åŠ å¯†è¿ç®—ç­‰åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ã€‚
