---
title: 'rest å‚æ•°ä¸æ‰©å±•è¿ç®—ç¬¦'
description: 'å…¨é¢ç†è§£ ES6 rest å‚æ•°æ”¶é›†å’Œæ‰©å±•è¿ç®—ç¬¦å±•å¼€çš„è¯­æ³•ä¸åº”ç”¨åœºæ™¯'
pubDate: 2024-01-10
toc: true
ogImage: true
category: 'ES6+'
tags: ['ES6', 'restå‚æ•°', 'æ‰©å±•è¿ç®—ç¬¦', 'å‡½æ•°']
---

ES6 å¼•å…¥äº† `...` è¯­æ³•ï¼Œæ ¹æ®ä¸Šä¸‹æ–‡æœ‰ä¸¤ç§ç”¨é€”ï¼šæ”¶é›†ï¼ˆrestï¼‰å’Œå±•å¼€ï¼ˆspreadï¼‰ã€‚

## rest å‚æ•°

### åŸºæœ¬è¯­æ³•

ç”¨ `...` å°†å‰©ä½™å‚æ•°æ”¶é›†ä¸ºæ•°ç»„ï¼š

```javascript
function sum(...numbers) {
  return numbers.reduce((a, b) => a + b, 0)
}

sum(1, 2, 3) // 6
sum(1, 2, 3, 4, 5) // 15
```

### ä¸æ™®é€šå‚æ•°ç»“åˆ

```javascript
function log(level, ...messages) {
  console.log(`[${level}]`, ...messages)
}

log('INFO', 'ç”¨æˆ·ç™»å½•', 'å¼ ä¸‰') // [INFO] ç”¨æˆ·ç™»å½• å¼ ä¸‰
log('ERROR', 'è¯·æ±‚å¤±è´¥', 404, 'èµ„æºä¸å­˜åœ¨') // [ERROR] è¯·æ±‚å¤±è´¥ 404 èµ„æºä¸å­˜åœ¨
```

ğŸ”¶ rest å‚æ•°å¿…é¡»æ˜¯æœ€åä¸€ä¸ªï¼š

```javascript
// function bad(...rest, last) {} // SyntaxError
```

### æ›¿ä»£ arguments

```javascript
// ES5 ä½¿ç”¨ arguments
function oldWay() {
  // arguments æ˜¯ç±»æ•°ç»„ï¼Œä¸æ˜¯çœŸæ­£çš„æ•°ç»„
  var args = Array.prototype.slice.call(arguments)
  return args.join('-')
}

// ES6 ä½¿ç”¨ rest
function newWay(...args) {
  // args æ˜¯çœŸæ­£çš„æ•°ç»„
  return args.join('-')
}

oldWay(1, 2, 3) // '1-2-3'
newWay(1, 2, 3) // '1-2-3'
```

rest å‚æ•°çš„ä¼˜åŠ¿ï¼š

```javascript
// rest å‚æ•°æ˜¯çœŸæ­£çš„æ•°ç»„
function test(...args) {
  args.forEach(console.log) // âœ… ç›´æ¥ä½¿ç”¨æ•°ç»„æ–¹æ³•
  args.map((x) => x * 2) // âœ…
  args.filter((x) => x > 0) // âœ…
}

// arguments ä¸æ˜¯æ•°ç»„
function oldTest() {
  // arguments.forEach(console.log); // âŒ TypeError
  Array.from(arguments).forEach(console.log) // éœ€è¦è½¬æ¢
}
```

### è§£æ„ä¸­çš„ rest

```javascript
// æ•°ç»„è§£æ„
const [first, second, ...rest] = [1, 2, 3, 4, 5]
console.log(first) // 1
console.log(second) // 2
console.log(rest) // [3, 4, 5]

// å¯¹è±¡è§£æ„
const { name, ...others } = { name: 'å¼ ä¸‰', age: 25, city: 'åŒ—äº¬' }
console.log(name) // 'å¼ ä¸‰'
console.log(others) // { age: 25, city: 'åŒ—äº¬' }
```

## æ‰©å±•è¿ç®—ç¬¦

### æ•°ç»„å±•å¼€

```javascript
const arr = [1, 2, 3]

// å±•å¼€ä¸ºå‚æ•°
Math.max(...arr) // 3

// å±•å¼€ä¸ºæ•°ç»„å…ƒç´ 
const newArr = [0, ...arr, 4]
console.log(newArr) // [0, 1, 2, 3, 4]

// åˆå¹¶æ•°ç»„
const a = [1, 2]
const b = [3, 4]
const merged = [...a, ...b] // [1, 2, 3, 4]
```

### æ•°ç»„å¤åˆ¶

```javascript
const original = [1, 2, 3]

// æµ…å¤åˆ¶
const copy = [...original]
copy.push(4)

console.log(original) // [1, 2, 3]
console.log(copy) // [1, 2, 3, 4]

// ğŸ”¶ æ³¨æ„ï¼šåªæ˜¯æµ…å¤åˆ¶
const nested = [[1], [2]]
const nestedCopy = [...nested]
nestedCopy[0].push(10)
console.log(nested[0]) // [1, 10]ï¼ˆåŸæ•°ç»„ä¹Ÿè¢«ä¿®æ”¹ï¼‰
```

### å­—ç¬¦ä¸²å±•å¼€

```javascript
const str = 'hello'
const chars = [...str]
console.log(chars) // ['h', 'e', 'l', 'l', 'o']

// æ­£ç¡®å¤„ç† Unicode
const emoji = 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§'
console.log([...emoji]) // ['ğŸ‘¨', 'â€', 'ğŸ‘©', 'â€', 'ğŸ‘§']
```

### å¯¹è±¡å±•å¼€

ES2018 å¼€å§‹æ”¯æŒå¯¹è±¡å±•å¼€ï¼š

```javascript
const obj = { a: 1, b: 2 }

// å¤åˆ¶å¯¹è±¡
const copy = { ...obj }
console.log(copy) // { a: 1, b: 2 }

// åˆå¹¶å¯¹è±¡
const merged = { ...obj, c: 3 }
console.log(merged) // { a: 1, b: 2, c: 3 }

// åé¢çš„å±æ€§è¦†ç›–å‰é¢çš„
const overwrite = { ...obj, b: 20 }
console.log(overwrite) // { a: 1, b: 20 }
```

ğŸ”¶ å¯¹è±¡å±•å¼€åªå¤åˆ¶å¯æšä¸¾çš„è‡ªæœ‰å±æ€§ï¼š

```javascript
const proto = { inherited: true }
const obj = Object.create(proto)
obj.own = true
Object.defineProperty(obj, 'nonEnum', {
  value: 'hidden',
  enumerable: false,
})

const copy = { ...obj }
console.log(copy) // { own: true }
// æ²¡æœ‰ inheritedï¼ˆç»§æ‰¿å±æ€§ï¼‰
// æ²¡æœ‰ nonEnumï¼ˆä¸å¯æšä¸¾å±æ€§ï¼‰
```

## å®æˆ˜åº”ç”¨

### å‡½æ•°æŸ¯é‡ŒåŒ–

```javascript
function curry(fn) {
  return function curried(...args) {
    if (args.length >= fn.length) {
      return fn.apply(this, args)
    }
    return function (...more) {
      return curried.apply(this, [...args, ...more])
    }
  }
}

const add = (a, b, c) => a + b + c
const curriedAdd = curry(add)

curriedAdd(1)(2)(3) // 6
curriedAdd(1, 2)(3) // 6
curriedAdd(1)(2, 3) // 6
```

### æ•°ç»„å»é‡

```javascript
const arr = [1, 2, 2, 3, 3, 3]
const unique = [...new Set(arr)]
console.log(unique) // [1, 2, 3]
```

### æ•°ç»„æœ€å¤§æœ€å°å€¼

```javascript
const numbers = [5, 2, 8, 1, 9]

// ä¼ ç»Ÿæ–¹å¼
Math.max.apply(null, numbers) // 9

// æ‰©å±•è¿ç®—ç¬¦
Math.max(...numbers) // 9
Math.min(...numbers) // 1
```

### å°†ç±»æ•°ç»„è½¬ä¸ºæ•°ç»„

```javascript
// NodeList
const divs = document.querySelectorAll('div')
const divsArray = [...divs]

// argumentsï¼ˆç®­å¤´å‡½æ•°æ²¡æœ‰ argumentsï¼‰
function toArray() {
  return [...arguments]
}

// ç±»æ•°ç»„å¯¹è±¡
const arrayLike = { 0: 'a', 1: 'b', 2: 'c', length: 3 }
// [...arrayLike]; // TypeError: ä¸å¯è¿­ä»£
Array.from(arrayLike) // ['a', 'b', 'c']
```

### æ·±å±‚å±æ€§æ›´æ–°ï¼ˆä¸å¯å˜æ›´æ–°ï¼‰

```javascript
const state = {
  user: {
    name: 'å¼ ä¸‰',
    settings: {
      theme: 'light',
      language: 'zh',
    },
  },
}

// æ›´æ–°æ·±å±‚å±æ€§
const newState = {
  ...state,
  user: {
    ...state.user,
    settings: {
      ...state.user.settings,
      theme: 'dark',
    },
  },
}

console.log(state.user.settings.theme) // 'light'ï¼ˆåŸå¯¹è±¡ä¸å˜ï¼‰
console.log(newState.user.settings.theme) // 'dark'
```

### æ¡ä»¶å±æ€§

```javascript
const isDev = true
const config = {
  api: '/api',
  ...(isDev && { debug: true }),
  ...(isDev ? { sourcemap: true } : {}),
}

console.log(config)
// { api: '/api', debug: true, sourcemap: true }
```

### å‡½æ•°å‚æ•°è½¬å‘

```javascript
function log(fn) {
  return function (...args) {
    console.log('è°ƒç”¨å‚æ•°:', args)
    const result = fn(...args)
    console.log('è¿”å›ç»“æœ:', result)
    return result
  }
}

const add = (a, b) => a + b
const loggedAdd = log(add)
loggedAdd(1, 2)
// è°ƒç”¨å‚æ•°: [1, 2]
// è¿”å›ç»“æœ: 3
```

### åˆå¹¶é»˜è®¤é…ç½®

```javascript
function createRequest(options) {
  const defaults = {
    method: 'GET',
    headers: {
      'Content-Type': 'application/json',
    },
    timeout: 5000,
  }

  return {
    ...defaults,
    ...options,
    headers: {
      ...defaults.headers,
      ...options.headers,
    },
  }
}

createRequest({
  url: '/api/users',
  headers: { Authorization: 'Bearer token' },
})
// {
//   method: 'GET',
//   headers: {
//     'Content-Type': 'application/json',
//     'Authorization': 'Bearer token'
//   },
//   timeout: 5000,
//   url: '/api/users'
// }
```

### æ•°ç»„æ“ä½œ

```javascript
// æ’å…¥å…ƒç´ 
function insert(arr, index, ...items) {
  return [...arr.slice(0, index), ...items, ...arr.slice(index)]
}
insert([1, 2, 5], 2, 3, 4) // [1, 2, 3, 4, 5]

// ç§»é™¤å…ƒç´ 
function remove(arr, index) {
  return [...arr.slice(0, index), ...arr.slice(index + 1)]
}
remove([1, 2, 3, 4], 2) // [1, 2, 4]

// æ›¿æ¢å…ƒç´ 
function replace(arr, index, item) {
  return [...arr.slice(0, index), item, ...arr.slice(index + 1)]
}
replace([1, 2, 3, 4], 2, 'X') // [1, 2, 'X', 4]
```

## rest ä¸ spread å¯¹æ¯”

| ç‰¹æ€§       | rest å‚æ•°             | æ‰©å±•è¿ç®—ç¬¦                 |
| ---------- | --------------------- | -------------------------- |
| è¯­æ³•       | `...name`             | `...expr`                  |
| ä½ç½®       | å‡½æ•°å‚æ•°ã€è§£æ„        | æ•°ç»„ã€å¯¹è±¡å­—é¢é‡ã€å‡½æ•°è°ƒç”¨ |
| ä½œç”¨       | æ”¶é›†å¤šä¸ªå€¼ä¸ºæ•°ç»„/å¯¹è±¡ | å±•å¼€æ•°ç»„/å¯¹è±¡ä¸ºå•ç‹¬çš„å€¼    |
| å¿…é¡»åœ¨æœ«å°¾ | æ˜¯                    | å¦                         |

```javascript
// restï¼šæ”¶é›†
function collect(...items) {
  // æ”¶é›†å‚æ•°ä¸ºæ•°ç»„
  return items
}

// spreadï¼šå±•å¼€
const arr = [1, 2, 3]
console.log(...arr) // å±•å¼€æ•°ç»„ä¸ºå•ç‹¬çš„å€¼
```

## å°ç»“

`...` è¯­æ³•è®©æ•°ç»„å’Œå¯¹è±¡æ“ä½œæ›´åŠ ç®€æ´ï¼š

- **rest å‚æ•°**ï¼šæ”¶é›†å‰©ä½™å‚æ•°/å…ƒç´ ä¸ºæ•°ç»„ï¼Œæ›¿ä»£ `arguments`
- **æ‰©å±•è¿ç®—ç¬¦**ï¼šå±•å¼€æ•°ç»„/å¯¹è±¡ï¼Œç®€åŒ–å¤åˆ¶ã€åˆå¹¶ã€ä¼ å‚

è¿™ä¸¤ä¸ªç‰¹æ€§æ˜¯ç°ä»£ JavaScript å¼€å‘ä¸­ä½¿ç”¨é¢‘ç‡æé«˜çš„è¯­æ³•ï¼Œç†Ÿç»ƒæŒæ¡å¯ä»¥å†™å‡ºæ›´ç®€æ´ä¼˜é›…çš„ä»£ç ã€‚
