---
title: 'Symbol åŸºç¡€'
description: 'æŒæ¡ ES6 Symbol åŸå§‹ç±»å‹çš„åˆ›å»ºæ–¹å¼ã€ä½œä¸ºå±æ€§é”®çš„ç”¨æ³•ä¸åŸºæœ¬ç‰¹æ€§'
pubDate: 2024-01-18
toc: true
ogImage: true
category: 'ES6+'
tags: ['ES6', 'Symbol', 'åŸå§‹ç±»å‹', 'å”¯ä¸€æ ‡è¯†']
---

ES6 å¼•å…¥äº†ç¬¬ä¸ƒç§åŸå§‹æ•°æ®ç±»å‹ Symbolï¼Œç”¨äºåˆ›å»ºå”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚

## ä¸ºä»€ä¹ˆéœ€è¦ Symbol

åœ¨ JavaScript ä¸­ï¼Œå¯¹è±¡å±æ€§ååªèƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œè¿™ä¼šå¯¼è‡´å‘½åå†²çªï¼š

```javascript
// ä¸¤ä¸ªåº“éƒ½æƒ³ç»™å¯¹è±¡æ·»åŠ  id å±æ€§
const obj = {}
library1.addId(obj) // obj.id = 'lib1-123'
library2.addId(obj) // obj.id = 'lib2-456'ï¼ˆè¦†ç›–äº†ï¼ï¼‰

// ä½¿ç”¨ Symbol å¯ä»¥é¿å…å†²çª
const id1 = Symbol('id')
const id2 = Symbol('id')
obj[id1] = 'lib1-123'
obj[id2] = 'lib2-456'
// ä¸¤ä¸ªå±æ€§äº’ä¸å½±å“
```

## åˆ›å»º Symbol

### åŸºæœ¬åˆ›å»º

```javascript
const sym1 = Symbol()
const sym2 = Symbol()
console.log(sym1 === sym2) // falseï¼ˆæ¯ä¸ª Symbol éƒ½æ˜¯å”¯ä¸€çš„ï¼‰

// å¸¦æè¿°ç¬¦
const sym3 = Symbol('description')
console.log(sym3.toString()) // 'Symbol(description)'
console.log(sym3.description) // 'description'
```

### ğŸ”¶ ä¸èƒ½ä½¿ç”¨ new

```javascript
// new Symbol(); // TypeError: Symbol is not a constructor
```

### æè¿°ç¬¦åªæ˜¯å¤‡æ³¨

```javascript
const sym1 = Symbol('id')
const sym2 = Symbol('id')
console.log(sym1 === sym2) // falseï¼ˆå³ä½¿æè¿°ç¬¦ç›¸åŒï¼‰
```

## ä½œä¸ºå±æ€§é”®

### å®šä¹‰ Symbol å±æ€§

```javascript
const ID = Symbol('id')
const NAME = Symbol('name')

// æ–¹å¼1ï¼šå¯¹è±¡å­—é¢é‡
const user = {
  [ID]: 1,
  [NAME]: 'å¼ ä¸‰',
  age: 25,
}

// æ–¹å¼2ï¼šç‚¹å·ä¸è¡Œï¼Œå¿…é¡»ç”¨æ–¹æ‹¬å·
user[ID] // 1
// user.ID; // undefinedï¼ˆè¿™æ˜¯è®¿é—®å­—ç¬¦ä¸²é”® 'ID'ï¼‰

// æ–¹å¼3ï¼šObject.defineProperty
Object.defineProperty(user, Symbol('email'), {
  value: 'test@test.com',
})
```

### Symbol å±æ€§ä¸å¯æšä¸¾

```javascript
const ID = Symbol('id')
const user = {
  [ID]: 1,
  name: 'å¼ ä¸‰',
  age: 25,
}

// for...in ä¸ä¼šéå† Symbol å±æ€§
for (const key in user) {
  console.log(key) // 'name', 'age'ï¼ˆæ²¡æœ‰ Symbolï¼‰
}

// Object.keys ä¹Ÿä¸åŒ…å«
Object.keys(user) // ['name', 'age']

// Object.getOwnPropertyNames ä¹Ÿä¸åŒ…å«
Object.getOwnPropertyNames(user) // ['name', 'age']

// éœ€è¦ä½¿ç”¨ä¸“é—¨çš„æ–¹æ³•
Object.getOwnPropertySymbols(user) // [Symbol(id)]

// æˆ–è€… Reflect.ownKeys è·å–æ‰€æœ‰é”®
Reflect.ownKeys(user) // ['name', 'age', Symbol(id)]
```

## å®é™…åº”ç”¨

### ç§æœ‰å±æ€§æ¨¡æ‹Ÿ

```javascript
const _count = Symbol('count')
const _increment = Symbol('increment')

class Counter {
  constructor() {
    this[_count] = 0
  }

  [_increment]() {
    this[_count]++
  }

  tick() {
    this[_increment]()
  }

  get value() {
    return this[_count]
  }
}

const counter = new Counter()
counter.tick()
counter.tick()
console.log(counter.value) // 2
console.log(counter[_count]) // å¦‚æœèƒ½è®¿é—®åˆ° Symbolï¼Œä»ç„¶å¯ä»¥è¯»å–
// ä½†å¤–éƒ¨ä»£ç é€šå¸¸æ— æ³•è·å–è¿™ä¸ª Symbol
```

### é˜²æ­¢å±æ€§è¦†ç›–

```javascript
// æ¡†æ¶å®šä¹‰çš„å±æ€§
const INTERNAL = Symbol('internal')

function createComponent(options) {
  const component = {
    ...options,
    [INTERNAL]: {
      mounted: false,
      listeners: [],
    },
  }
  return component
}

// ç”¨æˆ·ä¸ä¼šæ„å¤–è¦†ç›–å†…éƒ¨å±æ€§
const comp = createComponent({
  name: 'MyComponent',
  internal: 'user data', // ä¸ä¼šä¸ INTERNAL å†²çª
})
```

### å¸¸é‡å®šä¹‰

```javascript
// ä¼ ç»Ÿæ–¹å¼å¯èƒ½ä¼šå†²çª
const STATUS_PENDING = 'pending'
const STATUS_SUCCESS = 'success'
const STATUS_ERROR = 'error'

// å¦‚æœå…¶ä»–åœ°æ–¹ä¹Ÿå®šä¹‰äº† 'pending'ï¼Œæ¯”è¾ƒæ—¶ä¼šç›¸ç­‰

// ä½¿ç”¨ Symbol ç¡®ä¿å”¯ä¸€
const STATUS = {
  PENDING: Symbol('pending'),
  SUCCESS: Symbol('success'),
  ERROR: Symbol('error'),
}

function handleStatus(status) {
  switch (status) {
    case STATUS.PENDING:
      return 'å¤„ç†ä¸­...'
    case STATUS.SUCCESS:
      return 'æˆåŠŸ'
    case STATUS.ERROR:
      return 'é”™è¯¯'
    default:
      throw new Error('æœªçŸ¥çŠ¶æ€')
  }
}
```

### æ¶ˆé™¤é­”æœ¯å­—ç¬¦ä¸²

```javascript
// é­”æœ¯å­—ç¬¦ä¸²
function getArea(shape, options) {
  switch (shape) {
    case 'circle': // é­”æœ¯å­—ç¬¦ä¸²
      return Math.PI * options.radius ** 2
    case 'rectangle':
      return options.width * options.height
  }
}

// ä½¿ç”¨ Symbol
const SHAPES = {
  CIRCLE: Symbol('circle'),
  RECTANGLE: Symbol('rectangle'),
}

function getArea(shape, options) {
  switch (shape) {
    case SHAPES.CIRCLE:
      return Math.PI * options.radius ** 2
    case SHAPES.RECTANGLE:
      return options.width * options.height
  }
}

getArea(SHAPES.CIRCLE, { radius: 5 })
```

## ç±»å‹è½¬æ¢

### è½¬å­—ç¬¦ä¸²

```javascript
const sym = Symbol('foo')

String(sym) // 'Symbol(foo)'
sym.toString() // 'Symbol(foo)'

// ä¸èƒ½éšå¼è½¬æ¢
// 'symbol: ' + sym; // TypeError
// `symbol: ${sym}`; // TypeError

// å¿…é¡»æ˜¾å¼è½¬æ¢
;`symbol: ${String(sym)}` // 'symbol: Symbol(foo)'
;`symbol: ${sym.toString()}` // 'symbol: Symbol(foo)'
```

### è½¬å¸ƒå°”å€¼

```javascript
const sym = Symbol()
Boolean(sym) // true
!sym // false

if (sym) {
  console.log('Symbol æ˜¯çœŸå€¼')
}
```

### ğŸ”¶ ä¸èƒ½è½¬æ•°å­—

```javascript
const sym = Symbol()
// Number(sym); // TypeError
// sym + 1; // TypeError
```

## JSON åºåˆ—åŒ–

Symbol å±æ€§ä¸ä¼šè¢« JSON.stringify åºåˆ—åŒ–ï¼š

```javascript
const ID = Symbol('id')
const user = {
  [ID]: 1,
  name: 'å¼ ä¸‰',
}

JSON.stringify(user) // '{"name":"å¼ ä¸‰"}'ï¼ˆæ²¡æœ‰ Symbol å±æ€§ï¼‰
```

## å¸¸è§é—®é¢˜

### ğŸ™‹ Symbol å’Œå­—ç¬¦ä¸²æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

| ç‰¹æ€§     | Symbol           | å­—ç¬¦ä¸²                |
| -------- | ---------------- | --------------------- |
| å”¯ä¸€æ€§   | æ¯ä¸ª Symbol å”¯ä¸€ | ç›¸åŒå­—ç¬¦ä¸²ç›¸ç­‰        |
| åˆ›å»º     | Symbol()         | '...' æˆ– new String() |
| ç±»å‹     | symbol           | string                |
| å¯æšä¸¾æ€§ | é»˜è®¤ä¸å¯æšä¸¾     | é»˜è®¤å¯æšä¸¾            |
| JSON     | ä¸åºåˆ—åŒ–         | æ­£å¸¸åºåˆ—åŒ–            |

### ğŸ™‹ ä»€ä¹ˆæ—¶å€™ç”¨ Symbolï¼Ÿ

- éœ€è¦å”¯ä¸€æ ‡è¯†ç¬¦æ—¶
- å®šä¹‰å¯¹è±¡å†…éƒ¨å±æ€§ï¼Œä¸å¸Œæœ›è¢«æ„å¤–è®¿é—®æˆ–è¦†ç›–
- å®šä¹‰å¸¸é‡ï¼Œé¿å…é­”æœ¯å­—ç¬¦ä¸²
- å®ç°ç‰¹æ®Šè¡Œä¸ºï¼ˆå†…ç½® Symbolï¼‰

### ğŸ™‹ Symbol æ˜¯çœŸæ­£çš„ç§æœ‰å±æ€§å—ï¼Ÿ

ä¸æ˜¯ã€‚Symbol å±æ€§å¯ä»¥é€šè¿‡ `Object.getOwnPropertySymbols()` æˆ– `Reflect.ownKeys()` è·å–ã€‚å®ƒåªæ˜¯"éšè—"äº†å±æ€§ï¼Œä½†æ²¡æœ‰çœŸæ­£çš„è®¿é—®æ§åˆ¶ã€‚

çœŸæ­£çš„ç§æœ‰å±æ€§åº”è¯¥ä½¿ç”¨ ES2022 çš„ `#` è¯­æ³•ï¼š

```javascript
class Counter {
  #count = 0 // çœŸæ­£çš„ç§æœ‰å±æ€§

  increment() {
    this.#count++
  }
}
```

## å°ç»“

| ç‰¹æ€§     | è¯´æ˜                              |
| -------- | --------------------------------- |
| å”¯ä¸€æ€§   | æ¯ä¸ª Symbol éƒ½æ˜¯å”¯ä¸€çš„            |
| åˆ›å»º     | Symbol() æˆ– Symbol('description') |
| å±æ€§é”®   | åªèƒ½ç”¨æ–¹æ‹¬å·è¯­æ³• obj[sym]         |
| å¯æšä¸¾   | ä¸è¢« for...inã€Object.keys ç­‰éå† |
| è·å–     | Object.getOwnPropertySymbols()    |
| ç±»å‹è½¬æ¢ | å¯è½¬å­—ç¬¦ä¸²å’Œå¸ƒå°”å€¼ï¼Œä¸èƒ½è½¬æ•°å­—    |

Symbol ä¸º JavaScript æä¾›äº†åˆ›å»ºå”¯ä¸€æ ‡è¯†ç¬¦çš„èƒ½åŠ›ï¼Œåœ¨æ¡†æ¶å¼€å‘å’Œå…ƒç¼–ç¨‹ä¸­éå¸¸æœ‰ç”¨ã€‚
