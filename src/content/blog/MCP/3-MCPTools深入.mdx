---
title: 'MCP Tools æ·±å…¥ï¼šè®© AI å…·å¤‡è¡ŒåŠ¨èƒ½åŠ›'
description: 'æŒæ¡ MCP Tool çš„é«˜çº§ç”¨æ³•ï¼ŒåŒ…æ‹¬ Schema è®¾è®¡ã€å¼‚æ­¥æ“ä½œã€é”™è¯¯å¤„ç†ã€åŠ¨æ€ç®¡ç†å’Œæœ€ä½³å®è·µ'
pubDate: 2025-12-03
toc: true
ogImage: true
category: 'MCP'
tags: ['MCP', 'Model Context Protocol', 'TypeScript', 'Tools', 'Zod']
---

Tool æ˜¯ MCP æœ€æ ¸å¿ƒçš„èƒ½åŠ›â€”â€”å®ƒè®© AI ä»"åªèƒ½è¯´"å˜æˆ"èƒ½åšäº‹"ã€‚è¿™ç¯‡æ–‡ç« å°†æ·±å…¥æ¢è®¨ Tool çš„è®¾è®¡ä¸å®ç°ã€‚

## ğŸ¯ Tool çš„æœ¬è´¨

Tool å°±æ˜¯ä¸€ä¸ªå¸¦æœ‰ schema æè¿°çš„å¼‚æ­¥å‡½æ•°ï¼š

```typescript
// ä¼ªä»£ç è¡¨ç¤º Tool çš„ç»“æ„
interface Tool {
  name: string // å”¯ä¸€æ ‡è¯†
  description: string // å‘Šè¯‰ AI è¿™ä¸ª Tool åšä»€ä¹ˆ
  inputSchema: Schema // å‚æ•°å®šä¹‰
  outputSchema?: Schema // è¿”å›å€¼å®šä¹‰
  handler: (args) => Promise<Result>
}
```

AI é€šè¿‡é˜…è¯» `description` å’Œ `inputSchema` æ¥å†³å®šä½•æ—¶è°ƒç”¨ã€å¦‚ä½•ä¼ å‚ã€‚

## Schema è®¾è®¡

å¥½çš„ schema è®¾è®¡ç›´æ¥å½±å“ AI å¯¹ Tool çš„ç†è§£å’Œä½¿ç”¨å‡†ç¡®ç‡ã€‚

### åŸºç¡€ç±»å‹

```typescript
import { z } from 'zod'

// å­—ç¬¦ä¸²
z.string()
z.string().min(1).max(100) // é•¿åº¦é™åˆ¶
z.string().email() // é‚®ç®±æ ¼å¼
z.string().url() // URL æ ¼å¼

// æ•°å­—
z.number()
z.number().int() // æ•´æ•°
z.number().min(0).max(100) // èŒƒå›´é™åˆ¶
z.number().positive() // æ­£æ•°

// å¸ƒå°”
z.boolean()

// æšä¸¾
z.enum(['low', 'medium', 'high'])

// å¯é€‰
z.string().optional()
z.string().default('default value')
```

### å¤æ‚ç±»å‹

```typescript
// æ•°ç»„
z.array(z.string()) // string[]
z.array(z.number()).min(1).max(10) // é™åˆ¶æ•°ç»„é•¿åº¦

// å¯¹è±¡
z.object({
  name: z.string(),
  age: z.number().optional(),
})

// è”åˆç±»å‹
z.union([z.string(), z.number()])

// è®°å½•ç±»å‹
z.record(z.string(), z.number()) // { [key: string]: number }
```

### æè¿°çš„é‡è¦æ€§

```typescript
// âŒ ä¸å¥½ï¼šç¼ºå°‘æè¿°
server.registerTool(
  'search',
  {
    inputSchema: {
      q: z.string(),
      n: z.number(),
    },
  },
  async ({ q, n }) => {
    /* ... */
  }
)

// âœ… å¥½ï¼šè¯¦ç»†æè¿°
server.registerTool(
  'search_documents',
  {
    title: 'æ–‡æ¡£æœç´¢',
    description: 'åœ¨çŸ¥è¯†åº“ä¸­æœç´¢ç›¸å…³æ–‡æ¡£ï¼Œè¿”å›æœ€åŒ¹é…çš„ç»“æœ',
    inputSchema: {
      query: z.string().min(1).describe('æœç´¢å…³é”®è¯ï¼Œæ”¯æŒè‡ªç„¶è¯­è¨€æŸ¥è¯¢'),
      limit: z
        .number()
        .int()
        .min(1)
        .max(50)
        .default(10)
        .describe('è¿”å›ç»“æœæ•°é‡ä¸Šé™'),
    },
  },
  async ({ query, limit }) => {
    /* ... */
  }
)
```

ğŸ”¶ **å…³é”®**ï¼š`description` å’Œæ¯ä¸ªå‚æ•°çš„ `.describe()` æ˜¯ AI ç†è§£ Tool çš„ä¸»è¦ä¾æ®ã€‚

## ç»“æ„åŒ–è¾“å‡º

Tool å¯ä»¥è¿”å›ä¸¤ç§æ ¼å¼çš„ç»“æœï¼š

### æ–‡æœ¬è¾“å‡ºï¼ˆç»™ AI çœ‹ï¼‰

```typescript
return {
  content: [{ type: 'text', text: 'æœç´¢ç»“æœï¼šæ‰¾åˆ° 5 ä¸ªç›¸å…³æ–‡æ¡£...' }],
}
```

### ç»“æ„åŒ–è¾“å‡ºï¼ˆç¨‹åºå¯ç”¨ï¼‰

```typescript
return {
  content: [{ type: 'text', text: JSON.stringify(output) }],
  structuredContent: {
    count: 5,
    documents: [
      { id: '1', title: 'æ–‡æ¡£A', score: 0.95 },
      // ...
    ],
  },
}
```

### è¿”å›å›¾ç‰‡

```typescript
import { readFileSync } from 'fs'

return {
  content: [
    {
      type: 'image',
      data: readFileSync('chart.png').toString('base64'),
      mimeType: 'image/png',
    },
  ],
}
```

### è¿”å›èµ„æºé“¾æ¥

å½“æ•°æ®é‡å¤§æ—¶ï¼Œå¯ä»¥è¿”å› `ResourceLink` è€ŒéåµŒå…¥å†…å®¹ï¼š

```typescript
return {
  content: [
    { type: 'text', text: 'ç”Ÿæˆäº† 3 ä¸ªæ–‡ä»¶' },
    {
      type: 'resource_link',
      uri: 'file:///output/report.pdf',
      name: 'åˆ†ææŠ¥å‘Š',
      mimeType: 'application/pdf',
    },
  ],
}
```

## é”™è¯¯å¤„ç†

### æ ‡è®°é”™è¯¯ç»“æœ

```typescript
server.registerTool(
  'divide',
  {
    /* schema */
  },
  async ({ a, b }) => {
    if (b === 0) {
      return {
        content: [{ type: 'text', text: 'é”™è¯¯ï¼šé™¤æ•°ä¸èƒ½ä¸ºé›¶' }],
        isError: true, // å‘ŠçŸ¥ AI è¿™æ˜¯é”™è¯¯
      }
    }
    // ...
  }
)
```

### å¼‚å¸¸å¤„ç†

```typescript
server.registerTool(
  'fetch_data',
  {
    /* schema */
  },
  async ({ url }) => {
    try {
      const response = await fetch(url)
      if (!response.ok) {
        return {
          content: [{ type: 'text', text: `HTTP é”™è¯¯ï¼š${response.status}` }],
          isError: true,
        }
      }
      const data = await response.json()
      return {
        content: [{ type: 'text', text: JSON.stringify(data, null, 2) }],
        structuredContent: data,
      }
    } catch (error) {
      return {
        content: [
          {
            type: 'text',
            text: `è¯·æ±‚å¤±è´¥ï¼š${error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'}`,
          },
        ],
        isError: true,
      }
    }
  }
)
```

## å¼‚æ­¥æ“ä½œä¸é•¿æ—¶é—´ä»»åŠ¡

### è¿›åº¦é€šçŸ¥

å¯¹äºè€—æ—¶ä»»åŠ¡ï¼Œå¯ä»¥å‘é€è¿›åº¦é€šçŸ¥ï¼š

```typescript
server.registerTool(
  'process_files',
  {
    inputSchema: {
      files: z.array(z.string()).describe('è¦å¤„ç†çš„æ–‡ä»¶åˆ—è¡¨'),
    },
  },
  async ({ files }, { progressToken }) => {
    const results = []

    for (let i = 0; i < files.length; i++) {
      // å‘é€è¿›åº¦é€šçŸ¥
      if (progressToken) {
        await server.server.notification({
          method: 'notifications/progress',
          params: {
            progressToken,
            progress: i,
            total: files.length,
            message: `å¤„ç†ä¸­ï¼š${files[i]}`,
          },
        })
      }

      // å®é™…å¤„ç†é€»è¾‘
      const result = await processFile(files[i])
      results.push(result)
    }

    return {
      content: [{ type: 'text', text: `å®Œæˆå¤„ç† ${files.length} ä¸ªæ–‡ä»¶` }],
      structuredContent: { results },
    }
  }
)
```

### å¹¶å‘æ§åˆ¶

```typescript
import pLimit from 'p-limit'

const limit = pLimit(5) // æœ€å¤š 5 ä¸ªå¹¶å‘

server.registerTool(
  'batch_process',
  {
    /* schema */
  },
  async ({ items }) => {
    const results = await Promise.all(
      items.map((item) => limit(() => processItem(item)))
    )
    return {
      content: [{ type: 'text', text: `å¤„ç†å®Œæˆï¼š${results.length} é¡¹` }],
      structuredContent: { results },
    }
  }
)
```

## åŠ¨æ€ Tool ç®¡ç†

æ³¨å†Œ Tool åä¼šè¿”å›ä¸€ä¸ªå¥æŸ„ï¼Œå¯ä»¥ç”¨æ¥åŠ¨æ€ç®¡ç†ï¼š

### å¯ç”¨/ç¦ç”¨

```typescript
const writeTool = server.registerTool(
  'write_file',
  {
    /* schema */
  },
  async ({ path, content }) => {
    /* ... */
  }
)

// åˆå§‹ç¦ç”¨ï¼ˆä¸ä¼šå‡ºç°åœ¨ listTools ç»“æœä¸­ï¼‰
writeTool.disable()

// æ ¹æ®æƒé™å¯ç”¨
async function onUserAuthenticated(permissions: string[]) {
  if (permissions.includes('write')) {
    writeTool.enable()
  }
}
```

### æ›´æ–° Tool

```typescript
const searchTool = server.registerTool(
  'search',
  {
    inputSchema: {
      query: z.string(),
      scope: z.enum(['local', 'global']),
    },
  },
  async (args) => {
    /* ... */
  }
)

// åç»­æ·»åŠ æ–°çš„æœç´¢èŒƒå›´
searchTool.update({
  inputSchema: {
    query: z.string(),
    scope: z.enum(['local', 'global', 'archive']), // æ–°å¢ archive
  },
})
// SDK ä¼šè‡ªåŠ¨å‘é€ listChanged é€šçŸ¥
```

### ç§»é™¤ Tool

```typescript
// å®Œå…¨ç§»é™¤ Tool
searchTool.remove()
```

### å®é™…åœºæ™¯ï¼šæƒé™å‡çº§

```typescript
const viewTool = server.registerTool(
  'view',
  {
    /* ... */
  },
  viewHandler
)
const editTool = server.registerTool(
  'edit',
  {
    /* ... */
  },
  editHandler
)
const adminTool = server.registerTool(
  'admin',
  {
    /* ... */
  },
  adminHandler
)

// åˆå§‹åªæœ‰æŸ¥çœ‹æƒé™
editTool.disable()
adminTool.disable()

server.registerTool(
  'upgrade_permission',
  {
    inputSchema: {
      level: z.enum(['editor', 'admin']),
    },
  },
  async ({ level }) => {
    const success = await requestPermissionUpgrade(level)
    if (!success) {
      return {
        content: [{ type: 'text', text: 'æƒé™å‡çº§å¤±è´¥' }],
        isError: true,
      }
    }

    if (level === 'editor') {
      editTool.enable()
    } else if (level === 'admin') {
      editTool.enable()
      adminTool.enable()
    }

    return {
      content: [{ type: 'text', text: `å·²å‡çº§åˆ° ${level} æƒé™` }],
    }
  }
)
```

## æœ€ä½³å®è·µ

### 1. å‘½åè§„èŒƒ

```typescript
// âœ… å¥½ï¼šåŠ¨è¯_åè¯ï¼Œæ¸…æ™°è¡¨è¾¾è¡Œä¸º
'search_documents'
'create_user'
'send_email'
'get_weather'

// âŒ ä¸å¥½ï¼šå«ç³Šæˆ–è¿‡äºé€šç”¨
'search' // æœç´¢ä»€ä¹ˆï¼Ÿ
'do_thing' // åšä»€ä¹ˆäº‹ï¼Ÿ
'handler' // ä¸æ˜¯åŠ¨è¯
```

### 2. å•ä¸€èŒè´£

```typescript
// âŒ ä¸å¥½ï¼šä¸€ä¸ª Tool åšå¤ªå¤šäº‹
server.registerTool(
  'manage_files',
  {
    /* ... */
  },
  async ({ action, path, content }) => {
    if (action === 'read') {
      /* ... */
    }
    if (action === 'write') {
      /* ... */
    }
    if (action === 'delete') {
      /* ... */
    }
  }
)

// âœ… å¥½ï¼šæ‹†åˆ†æˆç‹¬ç«‹çš„ Tools
server.registerTool(
  'read_file',
  {
    /* ... */
  },
  readHandler
)
server.registerTool(
  'write_file',
  {
    /* ... */
  },
  writeHandler
)
server.registerTool(
  'delete_file',
  {
    /* ... */
  },
  deleteHandler
)
```

### 3. å‚æ•°éªŒè¯

```typescript
// ä½¿ç”¨ Zod çš„ refine è¿›è¡Œå¤æ‚éªŒè¯
server.registerTool(
  'create_event',
  {
    inputSchema: {
      title: z.string().min(1).max(100),
      startTime: z.string().datetime(),
      endTime: z.string().datetime(),
    },
  },
  async ({ title, startTime, endTime }) => {
    // é¢å¤–éªŒè¯
    if (new Date(endTime) <= new Date(startTime)) {
      return {
        content: [{ type: 'text', text: 'ç»“æŸæ—¶é—´å¿…é¡»æ™šäºå¼€å§‹æ—¶é—´' }],
        isError: true,
      }
    }
    // ...
  }
)
```

### 4. å¹‚ç­‰æ€§è®¾è®¡

å¯¹äºå†™æ“ä½œï¼Œè€ƒè™‘å¹‚ç­‰æ€§ï¼š

```typescript
server.registerTool(
  'ensure_directory',
  {
    description: 'ç¡®ä¿ç›®å½•å­˜åœ¨ï¼Œå¦‚å·²å­˜åœ¨åˆ™ä¸åšä»»ä½•æ“ä½œ',
    inputSchema: {
      path: z.string().describe('ç›®å½•è·¯å¾„'),
    },
  },
  async ({ path }) => {
    await fs.mkdir(path, { recursive: true })
    return {
      content: [{ type: 'text', text: `ç›®å½•å·²å°±ç»ªï¼š${path}` }],
    }
  }
)
```

### 5. æ—¥å¿—è®°å½•

```typescript
server.registerTool(
  'important_action',
  {
    /* ... */
  },
  async (args) => {
    console.error(`[Tool] important_action called with:`, JSON.stringify(args))

    try {
      const result = await doImportantThing(args)
      console.error(`[Tool] important_action succeeded`)
      return { content: [{ type: 'text', text: 'Done' }] }
    } catch (error) {
      console.error(`[Tool] important_action failed:`, error)
      throw error
    }
  }
)
```

## å®Œæ•´ç¤ºä¾‹ï¼šæ–‡ä»¶æ“ä½œ Tools

```typescript
import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js'
import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js'
import { z } from 'zod'
import { readFile, writeFile, readdir, stat } from 'fs/promises'
import { join, resolve } from 'path'

const server = new McpServer({
  name: 'file-tools',
  version: '1.0.0',
})

// å®‰å…¨çš„è·¯å¾„è§£æï¼ˆé˜²æ­¢è·¯å¾„éå†æ”»å‡»ï¼‰
const BASE_DIR = '/allowed/directory'

function safePath(userPath: string): string {
  const resolved = resolve(BASE_DIR, userPath)
  if (!resolved.startsWith(BASE_DIR)) {
    throw new Error('ä¸å…è®¸è®¿é—®è¯¥è·¯å¾„')
  }
  return resolved
}

// åˆ—å‡ºç›®å½•
server.registerTool(
  'list_directory',
  {
    title: 'åˆ—å‡ºç›®å½•',
    description: 'åˆ—å‡ºæŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶å’Œå­ç›®å½•',
    inputSchema: {
      path: z.string().default('.').describe('ç›¸å¯¹äºå·¥ä½œç›®å½•çš„è·¯å¾„'),
    },
    outputSchema: {
      entries: z.array(
        z.object({
          name: z.string(),
          type: z.enum(['file', 'directory']),
          size: z.number().optional(),
        })
      ),
    },
  },
  async ({ path }) => {
    try {
      const fullPath = safePath(path)
      const entries = await readdir(fullPath, { withFileTypes: true })

      const result = await Promise.all(
        entries.map(async (entry) => {
          const entryPath = join(fullPath, entry.name)
          const stats = await stat(entryPath)
          return {
            name: entry.name,
            type: entry.isDirectory() ? 'directory' : 'file',
            size: entry.isFile() ? stats.size : undefined,
          }
        })
      )

      return {
        content: [
          {
            type: 'text',
            text: result
              .map((e) => `${e.type === 'directory' ? 'ğŸ“' : 'ğŸ“„'} ${e.name}`)
              .join('\n'),
          },
        ],
        structuredContent: { entries: result },
      }
    } catch (error) {
      return {
        content: [{ type: 'text', text: `é”™è¯¯ï¼š${error}` }],
        isError: true,
      }
    }
  }
)

// è¯»å–æ–‡ä»¶
server.registerTool(
  'read_file',
  {
    title: 'è¯»å–æ–‡ä»¶',
    description: 'è¯»å–æ–‡æœ¬æ–‡ä»¶å†…å®¹',
    inputSchema: {
      path: z.string().describe('æ–‡ä»¶è·¯å¾„'),
      encoding: z.enum(['utf-8', 'ascii', 'base64']).default('utf-8'),
    },
  },
  async ({ path, encoding }) => {
    try {
      const fullPath = safePath(path)
      const content = await readFile(fullPath, encoding as BufferEncoding)
      return {
        content: [{ type: 'text', text: content }],
      }
    } catch (error) {
      return {
        content: [{ type: 'text', text: `è¯»å–å¤±è´¥ï¼š${error}` }],
        isError: true,
      }
    }
  }
)

// å†™å…¥æ–‡ä»¶
server.registerTool(
  'write_file',
  {
    title: 'å†™å…¥æ–‡ä»¶',
    description: 'å°†å†…å®¹å†™å…¥æ–‡ä»¶ï¼Œå¦‚æ–‡ä»¶å­˜åœ¨åˆ™è¦†ç›–',
    inputSchema: {
      path: z.string().describe('æ–‡ä»¶è·¯å¾„'),
      content: z.string().describe('è¦å†™å…¥çš„å†…å®¹'),
    },
  },
  async ({ path, content }) => {
    try {
      const fullPath = safePath(path)
      await writeFile(fullPath, content, 'utf-8')
      return {
        content: [{ type: 'text', text: `å·²å†™å…¥ï¼š${path}` }],
      }
    } catch (error) {
      return {
        content: [{ type: 'text', text: `å†™å…¥å¤±è´¥ï¼š${error}` }],
        isError: true,
      }
    }
  }
)

const transport = new StdioServerTransport()
await server.connect(transport)
```

## å°ç»“

è¿™ç¯‡æ–‡ç« æˆ‘ä»¬æ·±å…¥å­¦ä¹ äº† MCP Tool çš„é«˜çº§ç”¨æ³•ï¼š

âœ… Schema è®¾è®¡åŸåˆ™ä¸æœ€ä½³å®è·µ
âœ… å¤šç§è¾“å‡ºæ ¼å¼ï¼šæ–‡æœ¬ã€ç»“æ„åŒ–ã€å›¾ç‰‡ã€èµ„æºé“¾æ¥
âœ… é”™è¯¯å¤„ç†ä¸å¼‚å¸¸æ•è·
âœ… å¼‚æ­¥æ“ä½œä¸è¿›åº¦é€šçŸ¥
âœ… åŠ¨æ€ Tool ç®¡ç†ï¼šå¯ç”¨ã€ç¦ç”¨ã€æ›´æ–°ã€ç§»é™¤
âœ… å‘½åè§„èŒƒä¸è®¾è®¡åŸåˆ™

ä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†æ¢ç´¢ MCP Resourcesï¼Œå­¦ä¹ å¦‚ä½•å‘ AI æš´éœ²æ•°æ®ã€‚

## å‚è€ƒèµ„æ–™

- [Zod æ–‡æ¡£](https://zod.dev)
- [MCP Tools è§„èŒƒ](https://modelcontextprotocol.io/docs/concepts/tools)
