---
title: 'æ­å»ºç¬¬ä¸€ä¸ª MCP Server'
description: 'ä½¿ç”¨ TypeScript SDK ä»é›¶æ­å»º MCP Serverï¼Œæ³¨å†Œ Tool å¹¶åœ¨ Claude Desktop ä¸­æµ‹è¯•ï¼ŒæŒæ¡ MCP Server å¼€å‘çš„å®Œæ•´æµç¨‹'
pubDate: 2025-12-03
toc: true
ogImage: true
category: 'MCP'
tags: ['MCP', 'Model Context Protocol', 'TypeScript', 'Server', 'Tool']
---

ä¸Šä¸€ç¯‡æˆ‘ä»¬äº†è§£äº† MCP çš„æ ¸å¿ƒæ¦‚å¿µï¼Œç°åœ¨è®©æˆ‘ä»¬åŠ¨æ‰‹æ­å»ºç¬¬ä¸€ä¸ª MCP Serverã€‚è¿™ç¯‡æ–‡ç« å°†å¸¦ä½ å®Œæˆä»é¡¹ç›®åˆå§‹åŒ–åˆ°åœ¨ Claude Desktop ä¸­æµ‹è¯•çš„å…¨è¿‡ç¨‹ã€‚

## ğŸ¯ ç›®æ ‡

åˆ›å»ºä¸€ä¸ªç®€å•çš„è®¡ç®—å™¨ MCP Serverï¼Œè®© AI èƒ½å¤Ÿæ‰§è¡Œæ•°å­¦è¿ç®—ã€‚

## ç¯å¢ƒå‡†å¤‡

**å¿…éœ€ç¯å¢ƒ**ï¼š

- Node.js 18+ï¼ˆæ¨è 20 LTSï¼‰
- pnpm / npm / yarn
- Claude Desktopï¼ˆç”¨äºæµ‹è¯•ï¼‰

æ£€æŸ¥ Node.js ç‰ˆæœ¬ï¼š

```bash
node --version  # åº”è¯¥ >= 18.0.0
```

## é¡¹ç›®åˆå§‹åŒ–

### 1. åˆ›å»ºé¡¹ç›®ç›®å½•

```bash
mkdir mcp-calculator && cd mcp-calculator
pnpm init
```

### 2. å®‰è£…ä¾èµ–

```bash
# MCP SDK å’Œ Zodï¼ˆç”¨äº schema éªŒè¯ï¼‰
pnpm add @modelcontextprotocol/sdk zod

# TypeScript å¼€å‘ä¾èµ–
pnpm add -D typescript @types/node tsx
```

**ä¾èµ–è¯´æ˜**ï¼š

- `@modelcontextprotocol/sdk` - MCP å®˜æ–¹ TypeScript SDK
- `zod` - ç±»å‹å®‰å…¨çš„ schema éªŒè¯åº“
- `tsx` - ç›´æ¥è¿è¡Œ TypeScript æ–‡ä»¶

### 3. é…ç½® TypeScript

åˆ›å»º `tsconfig.json`ï¼š

```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "Node16",
    "moduleResolution": "Node16",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "outDir": "./dist"
  },
  "include": ["src/**/*"]
}
```

### 4. é…ç½® package.json

```json
{
  "name": "mcp-calculator",
  "version": "1.0.0",
  "type": "module",
  "main": "dist/index.js",
  "scripts": {
    "build": "tsc",
    "start": "node dist/index.js",
    "dev": "tsx src/index.ts"
  }
}
```

## æœ€å°å¯è¡Œ Server

åˆ›å»º `src/index.ts`ï¼š

```typescript
// src/index.ts
// Node.js 18+ | @modelcontextprotocol/sdk ^1.0.0

import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js'
import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js'
import { z } from 'zod'

// 1. åˆ›å»º Server å®ä¾‹
const server = new McpServer({
  name: 'calculator',
  version: '1.0.0',
})

// 2. æ³¨å†Œä¸€ä¸ª Tool
server.registerTool(
  'add',
  {
    title: 'åŠ æ³•è®¡ç®—',
    description: 'è®¡ç®—ä¸¤ä¸ªæ•°å­—çš„å’Œ',
    inputSchema: {
      a: z.number().describe('ç¬¬ä¸€ä¸ªæ•°å­—'),
      b: z.number().describe('ç¬¬äºŒä¸ªæ•°å­—'),
    },
    outputSchema: {
      result: z.number(),
    },
  },
  async ({ a, b }) => {
    const result = a + b
    return {
      content: [{ type: 'text', text: `${a} + ${b} = ${result}` }],
      structuredContent: { result },
    }
  }
)

// 3. ä½¿ç”¨ stdio ä¼ è¾“å¯åŠ¨ Server
const transport = new StdioServerTransport()
await server.connect(transport)
console.error('Calculator MCP Server running on stdio')
```

**ä»£ç è§£æ**ï¼š

1. **åˆ›å»º McpServer** - æŒ‡å®š name å’Œ versionï¼Œè¿™äº›ä¼šåœ¨å®¢æˆ·ç«¯æ˜¾ç¤º
2. **registerTool** - æ³¨å†Œä¸€ä¸ªåä¸º `add` çš„å·¥å…·
   - `inputSchema` ä½¿ç”¨ Zod å®šä¹‰å‚æ•°ç±»å‹
   - `outputSchema` å®šä¹‰è¿”å›ç»“æ„
   - å¤„ç†å‡½æ•°è¿”å› `content`ï¼ˆç»™ AI çœ‹çš„æ–‡æœ¬ï¼‰å’Œ `structuredContent`ï¼ˆç»“æ„åŒ–æ•°æ®ï¼‰
3. **StdioServerTransport** - ä½¿ç”¨æ ‡å‡†è¾“å…¥è¾“å‡ºé€šä¿¡

ğŸ”¶ **æ³¨æ„**ï¼š`console.error` ç”¨äºæ—¥å¿—è¾“å‡ºï¼Œå› ä¸º `stdout` è¢« MCP åè®®å ç”¨ã€‚

## æµ‹è¯•è¿è¡Œ

```bash
pnpm dev
```

Server å¯åŠ¨åä¼šç­‰å¾… stdin è¾“å…¥ã€‚ç°åœ¨è®©æˆ‘ä»¬é…ç½® Claude Desktop æ¥è¿æ¥å®ƒã€‚

## é…ç½® Claude Desktop

### 1. æ‰¾åˆ°é…ç½®æ–‡ä»¶

- **macOS**: `~/Library/Application Support/Claude/claude_desktop_config.json`
- **Windows**: `%APPDATA%\Claude\claude_desktop_config.json`

### 2. æ·»åŠ  Server é…ç½®

```json
{
  "mcpServers": {
    "calculator": {
      "command": "npx",
      "args": ["tsx", "/å®Œæ•´è·¯å¾„/mcp-calculator/src/index.ts"]
    }
  }
}
```

æˆ–è€…ä½¿ç”¨ç¼–è¯‘åçš„ç‰ˆæœ¬ï¼š

```json
{
  "mcpServers": {
    "calculator": {
      "command": "node",
      "args": ["/å®Œæ•´è·¯å¾„/mcp-calculator/dist/index.js"]
    }
  }
}
```

ğŸ”¶ **æ³¨æ„**ï¼šè·¯å¾„å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„ã€‚

### 3. é‡å¯ Claude Desktop

é‡å¯åï¼Œåœ¨æ–°å¯¹è¯ä¸­è¾“å…¥ï¼š

> "è¯·å¸®æˆ‘è®¡ç®— 123 + 456"

Claude ä¼šè¯†åˆ«åˆ°å¯ç”¨çš„ `add` Toolï¼Œå¹¶è°ƒç”¨å®ƒå®Œæˆè®¡ç®—ã€‚

## æ‰©å±•ï¼šå®Œæ•´è®¡ç®—å™¨

è®©æˆ‘ä»¬æ·»åŠ æ›´å¤šè¿ç®—ï¼š

```typescript
// src/index.ts
import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js'
import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js'
import { z } from 'zod'

const server = new McpServer({
  name: 'calculator',
  version: '1.0.0',
})

// é€šç”¨çš„åŒå‚æ•°æ•°å­¦è¿ç®— schema
const mathSchema = {
  inputSchema: {
    a: z.number().describe('ç¬¬ä¸€ä¸ªæ•°å­—'),
    b: z.number().describe('ç¬¬äºŒä¸ªæ•°å­—'),
  },
  outputSchema: {
    result: z.number(),
  },
}

// åŠ æ³•
server.registerTool(
  'add',
  { title: 'åŠ æ³•', description: 'è®¡ç®— a + b', ...mathSchema },
  async ({ a, b }) => {
    const result = a + b
    return {
      content: [{ type: 'text', text: `${a} + ${b} = ${result}` }],
      structuredContent: { result },
    }
  }
)

// å‡æ³•
server.registerTool(
  'subtract',
  { title: 'å‡æ³•', description: 'è®¡ç®— a - b', ...mathSchema },
  async ({ a, b }) => {
    const result = a - b
    return {
      content: [{ type: 'text', text: `${a} - ${b} = ${result}` }],
      structuredContent: { result },
    }
  }
)

// ä¹˜æ³•
server.registerTool(
  'multiply',
  { title: 'ä¹˜æ³•', description: 'è®¡ç®— a Ã— b', ...mathSchema },
  async ({ a, b }) => {
    const result = a * b
    return {
      content: [{ type: 'text', text: `${a} Ã— ${b} = ${result}` }],
      structuredContent: { result },
    }
  }
)

// é™¤æ³•ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
server.registerTool(
  'divide',
  { title: 'é™¤æ³•', description: 'è®¡ç®— a Ã· b', ...mathSchema },
  async ({ a, b }) => {
    if (b === 0) {
      return {
        content: [{ type: 'text', text: 'é”™è¯¯ï¼šé™¤æ•°ä¸èƒ½ä¸ºé›¶' }],
        isError: true,
      }
    }
    const result = a / b
    return {
      content: [{ type: 'text', text: `${a} Ã· ${b} = ${result}` }],
      structuredContent: { result },
    }
  }
)

// å¯åŠ¨ Server
const transport = new StdioServerTransport()
await server.connect(transport)
console.error('Calculator MCP Server running on stdio')
```

**æ–°å¢å†…å®¹**ï¼š

1. **å¤ç”¨ schema** - é¿å…é‡å¤å®šä¹‰ç›¸åŒçš„è¾“å…¥è¾“å‡ºç»“æ„
2. **é”™è¯¯å¤„ç†** - é™¤æ³•æ£€æŸ¥é™¤æ•°ä¸ºé›¶ï¼Œè¿”å› `isError: true` å‘ŠçŸ¥ AI è¿™æ˜¯é”™è¯¯ç»“æœ
3. **å®Œæ•´çš„å››åˆ™è¿ç®—** - AI ç°åœ¨å¯ä»¥æ ¹æ®ç”¨æˆ·éœ€æ±‚é€‰æ‹©åˆé€‚çš„è¿ç®—

## è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹ Server æ—¥å¿—

ä½¿ç”¨ `console.error` è¾“å‡ºæ—¥å¿—ï¼Œå¯ä»¥åœ¨ Claude Desktop çš„å¼€å‘è€…å·¥å…·ä¸­æŸ¥çœ‹ã€‚

### 2. MCP Inspector

ä½¿ç”¨å®˜æ–¹çš„ MCP Inspector è°ƒè¯•å·¥å…·ï¼š

```bash
npx @modelcontextprotocol/inspector npx tsx src/index.ts
```

è¿™ä¼šæ‰“å¼€ä¸€ä¸ª Web UIï¼Œè®©ä½ å¯ä»¥æ‰‹åŠ¨æµ‹è¯• Toolsã€‚

### 3. å¸¸è§é—®é¢˜

**é—®é¢˜ï¼šClaude Desktop æ²¡æœ‰æ˜¾ç¤º Tool**

- æ£€æŸ¥é…ç½®æ–‡ä»¶ JSON è¯­æ³•
- ç¡®è®¤è·¯å¾„æ˜¯ç»å¯¹è·¯å¾„
- é‡å¯ Claude Desktop

**é—®é¢˜ï¼šTool è°ƒç”¨å¤±è´¥**

- æ£€æŸ¥ `console.error` è¾“å‡º
- ç¡®è®¤å‚æ•°ç±»å‹ä¸ schema åŒ¹é…

## é¡¹ç›®ç»“æ„

å®Œæˆåçš„é¡¹ç›®ç»“æ„ï¼š

```
mcp-calculator/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ index.ts          # Server ä¸»æ–‡ä»¶
â”œâ”€â”€ dist/                  # ç¼–è¯‘è¾“å‡º
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ pnpm-lock.yaml
```

## å°ç»“

è¿™ç¯‡æ–‡ç« æˆ‘ä»¬å®Œæˆäº†ï¼š

âœ… é¡¹ç›®åˆå§‹åŒ–ä¸ä¾èµ–é…ç½®
âœ… ä½¿ç”¨ McpServer åˆ›å»º Server
âœ… ä½¿ç”¨ Zod å®šä¹‰ Tool schema
âœ… å®ç° Tool å¤„ç†å‡½æ•°
âœ… é…ç½® Claude Desktop è¿æ¥
âœ… é”™è¯¯å¤„ç†

ä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ Tool çš„é«˜çº§ç”¨æ³•ï¼ŒåŒ…æ‹¬ï¼š

- å¼‚æ­¥æ“ä½œä¸é•¿æ—¶é—´ä»»åŠ¡
- åŠ¨æ€ Tool ç®¡ç†
- å¤æ‚å‚æ•°éªŒè¯

## å‚è€ƒèµ„æ–™

- [MCP TypeScript SDK](https://github.com/modelcontextprotocol/typescript-sdk)
- [Zod æ–‡æ¡£](https://zod.dev)
- [MCP Inspector](https://github.com/modelcontextprotocol/inspector)
