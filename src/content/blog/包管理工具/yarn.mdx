---
title: Yarn å®Œå…¨æŒ‡å—
description: Yarn æ˜¯ Facebook å¼€æºçš„ JavaScript åŒ…ç®¡ç†å™¨ï¼Œæœ¬æ–‡æ¶µç›– Yarn Classic ä¸ Yarn Berry çš„å®‰è£…é…ç½®ã€ä¾èµ–ç®¡ç†ã€Plug'n'Play æ¨¡å¼ä¸ Workspaces å®è·µ
pubDate: 2025-11-09
toc: true
ogImage: true
category: åŒ…ç®¡ç†å·¥å…·
tags: ['Yarn', 'Node.js', 'åŒ…ç®¡ç†å™¨', 'JavaScript', 'Monorepo']
---

Yarn ç”± Facebook äº 2016 å¹´å‘å¸ƒï¼Œæ—¨åœ¨è§£å†³å½“æ—¶ npm çš„æ€§èƒ½å’Œä¸€è‡´æ€§é—®é¢˜ã€‚å¦‚ä»Š Yarn åˆ†ä¸ºä¸¤ä¸ªä¸»è¦ç‰ˆæœ¬çº¿ï¼šYarn Classicï¼ˆ1.xï¼‰å’Œ Yarn Berryï¼ˆ2.x+ï¼Œä¹Ÿç§° Yarn Modernï¼‰ã€‚ä¸¤è€…åœ¨æ¶æ„å’Œä½¿ç”¨æ–¹å¼ä¸Šæœ‰æ˜¾è‘—å·®å¼‚ã€‚

ğŸ¯ **ç¯å¢ƒè¯´æ˜**ï¼šæœ¬æ–‡åŸºäº Yarn v1.22.xï¼ˆClassicï¼‰å’Œ Yarn v4.xï¼ˆBerryï¼‰ç¼–å†™ï¼ŒNode.js v20.x ç¯å¢ƒã€‚

## Yarn Classic vs Yarn Berry

| ç‰¹æ€§         | Yarn Classic (1.x) | Yarn Berry (2.x+)   |
| ------------ | ------------------ | ------------------- |
| node_modules | âœ… ä¼ ç»Ÿç›®å½•ç»“æ„    | âŒ é»˜è®¤ç¦ç”¨         |
| Plug'n'Play  | âŒ                 | âœ… é»˜è®¤å¯ç”¨         |
| é›¶å®‰è£…       | âŒ                 | âœ… å¯æäº¤ä¾èµ–åˆ° Git |
| é…ç½®æ–‡ä»¶     | .yarnrc            | .yarnrc.yml         |
| é”æ–‡ä»¶       | yarn.lock (v1)     | yarn.lock (v8)      |

ğŸ¤” å¦‚æœé¡¹ç›®å¯¹å…¼å®¹æ€§è¦æ±‚è¾ƒé«˜ï¼Œå»ºè®®ä½¿ç”¨ Yarn Classicï¼›è¿½æ±‚æ›´æ¿€è¿›çš„ä¼˜åŒ–å¯å°è¯• Yarn Berryã€‚

## å®‰è£… Yarn

### é€šè¿‡ Corepackï¼ˆæ¨èï¼‰

Node.js v16.10+ å†…ç½® Corepackï¼Œå¯ç›´æ¥ç®¡ç† Yarnï¼š

```bash
# å¯ç”¨ Corepack
$ corepack enable

# æ¿€æ´»æœ€æ–°ç¨³å®šç‰ˆ Yarn
$ corepack prepare yarn@stable --activate

# éªŒè¯å®‰è£…
$ yarn -v
4.5.3
```

### é€šè¿‡ npm å®‰è£…

```bash
# å®‰è£… Yarn Classic
$ npm install -g yarn

# éªŒè¯
$ yarn -v
1.22.22
```

### æŒ‡å®šé¡¹ç›®ä½¿ç”¨çš„ Yarn ç‰ˆæœ¬

åœ¨é¡¹ç›®ä¸­é”å®š Yarn ç‰ˆæœ¬ï¼ˆYarn Berry ç‰¹æ€§ï¼‰ï¼š

```bash
# è®¾ç½®é¡¹ç›®ä½¿ç”¨ Yarn 4.x
$ yarn set version stable

# è®¾ç½®ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬
$ yarn set version 4.5.3

# è®¾ç½®ä½¿ç”¨ Classic
$ yarn set version classic
```

æ‰§è¡Œåä¼šåœ¨é¡¹ç›®ä¸­ç”Ÿæˆ `.yarn/releases/` ç›®å½•å’Œ `.yarnrc.yml` é…ç½®ã€‚

## é¡¹ç›®åˆå§‹åŒ–

```bash
$ mkdir my-project && cd my-project
$ yarn init
```

äº¤äº’å¼å¡«å†™é¡¹ç›®ä¿¡æ¯ï¼Œæˆ–ä½¿ç”¨ `-y` è·³è¿‡ï¼š

```bash
$ yarn init -y
```

### Yarn Berry åˆå§‹åŒ–

è‹¥è¦ä»é›¶å¼€å§‹ä½¿ç”¨ Yarn Berryï¼š

```bash
$ yarn init -2
```

è¿™ä¼šåˆå§‹åŒ–ä¸€ä¸ªä½¿ç”¨ Yarn Berry çš„é¡¹ç›®ï¼Œå¹¶è‡ªåŠ¨åˆ›å»º `.yarnrc.yml`ã€‚

## ä¾èµ–ç®¡ç†

### å®‰è£…ä¾èµ–

```bash
# å®‰è£… package.json ä¸­çš„æ‰€æœ‰ä¾èµ–
$ yarn
# æˆ–
$ yarn install

# å®‰è£…ç”Ÿäº§ä¾èµ–
$ yarn add lodash

# å®‰è£…å¼€å‘ä¾èµ–
$ yarn add -D typescript

# å®‰è£…æŒ‡å®šç‰ˆæœ¬
$ yarn add lodash@4.17.21

# å…¨å±€å®‰è£…
$ yarn global add typescript
```

### ç§»é™¤ä¾èµ–

```bash
$ yarn remove lodash

# å…¨å±€ç§»é™¤
$ yarn global remove typescript
```

### æ›´æ–°ä¾èµ–

```bash
# äº¤äº’å¼æ›´æ–°
$ yarn upgrade-interactive

# æ›´æ–°æŒ‡å®šåŒ…
$ yarn upgrade lodash

# æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼ˆå¿½ç•¥ semver èŒƒå›´ï¼‰
$ yarn upgrade lodash --latest
```

### Yarn Berry çš„ä¾èµ–å‘½ä»¤

Yarn Berry å¯¹éƒ¨åˆ†å‘½ä»¤åšäº†è°ƒæ•´ï¼š

```bash
# æ·»åŠ ä¾èµ–ï¼ˆåŒ Classicï¼‰
$ yarn add lodash

# æ›´æ–°ä¾èµ–
$ yarn up lodash

# äº¤äº’å¼æ›´æ–°
$ yarn upgrade-interactive
```

## yarn.lock

`yarn.lock` é”å®šä¾èµ–çš„ç²¾ç¡®ç‰ˆæœ¬ã€‚ä¸ npm çš„ `package-lock.json` ç±»ä¼¼ï¼Œä½†æ ¼å¼ä¸åŒã€‚

ğŸ”¶ **é‡è¦**ï¼šåŠ¡å¿…å°† `yarn.lock` æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ï¼Œç¡®ä¿å›¢é˜Ÿç¯å¢ƒä¸€è‡´ã€‚

```bash
# è‹¥ lock æ–‡ä»¶ä¸ package.json å†²çªï¼Œé‡æ–°ç”Ÿæˆ
$ rm yarn.lock
$ yarn install
```

## Yarn Scripts

åœ¨ `package.json` ä¸­å®šä¹‰è„šæœ¬ï¼š

```json
{
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "test": "vitest"
  }
}
```

è¿è¡Œè„šæœ¬ï¼š

```bash
$ yarn dev
$ yarn build
$ yarn test
```

ä¸ npm ä¸åŒï¼ŒYarn è¿è¡Œè‡ªå®šä¹‰è„šæœ¬æ— éœ€ `run` å…³é”®å­—ï¼ˆé™¤éè„šæœ¬åä¸ Yarn å†…ç½®å‘½ä»¤å†²çªï¼‰ã€‚

ä¼ é€’å‚æ•°æ—¶æ— éœ€ `--`ï¼š

```bash
$ yarn test --watch --coverage
```

## Plug'n'Play (PnP)

Yarn Berry é»˜è®¤å¯ç”¨ Plug'n'Play æ¨¡å¼ï¼Œä¸å†ç”Ÿæˆ `node_modules` ç›®å½•ã€‚ä¾èµ–ä»¥ zip æ–‡ä»¶å½¢å¼å­˜å‚¨åœ¨ `.yarn/cache/` ä¸­ï¼Œé€šè¿‡ `.pnp.cjs` æ–‡ä»¶è¿›è¡Œæ¨¡å—è§£æã€‚

### PnP çš„ä¼˜åŠ¿

âœ… **å®‰è£…é€Ÿåº¦å¿«**ï¼šæ— éœ€å†™å…¥å¤§é‡å°æ–‡ä»¶

âœ… **é›¶å®‰è£…**ï¼šå¯å°† `.yarn/cache/` æäº¤åˆ° Gitï¼Œå›¢é˜Ÿæˆå‘˜æ— éœ€æ‰§è¡Œ `yarn install`

âœ… **ç¡®å®šæ€§**ï¼šæœç»å¹½çµä¾èµ–ï¼ˆPhantom Dependenciesï¼‰

### å…¼å®¹æ€§é—®é¢˜

ğŸ”¶ éƒ¨åˆ†å·¥å…·ä¸æ”¯æŒ PnPï¼Œéœ€è¦é…ç½® SDK æˆ–å›é€€åˆ° node_modulesï¼š

```bash
# å®‰è£… IDE SDKï¼ˆVS Codeã€WebStorm ç­‰ï¼‰
$ yarn dlx @yarnpkg/sdks vscode
```

è‹¥å·¥å…·å®Œå…¨ä¸å…¼å®¹ï¼Œå¯åœ¨ `.yarnrc.yml` ä¸­ç¦ç”¨ PnPï¼š

```yaml
nodeLinker: node-modules
```

### .yarnrc.yml å¸¸ç”¨é…ç½®

```yaml
# ä½¿ç”¨ node_modules æ¨¡å¼
nodeLinker: node-modules

# è®¾ç½® npm æº
npmRegistryServer: 'https://registry.npmmirror.com'

# å¯ç”¨å…¨å±€ç¼“å­˜
enableGlobalCache: true

# è®¾ç½®ç¼“å­˜ç›®å½•
cacheFolder: './.yarn/cache'
```

## Workspaces

Yarn åŸç”Ÿæ”¯æŒ Workspacesï¼Œé€‚åˆ Monorepo é¡¹ç›®ç®¡ç†ã€‚

### é…ç½®

åœ¨æ ¹ç›®å½• `package.json` ä¸­å£°æ˜ï¼š

```json
{
  "name": "my-monorepo",
  "private": true,
  "workspaces": ["packages/*", "apps/*"]
}
```

ç›®å½•ç»“æ„ç¤ºä¾‹ï¼š

```
my-monorepo/
â”œâ”€â”€ package.json
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ shared/
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ package.json
â””â”€â”€ apps/
    â”œâ”€â”€ web/
    â”‚   â””â”€â”€ package.json
    â””â”€â”€ api/
        â””â”€â”€ package.json
```

### Workspaces å‘½ä»¤

```bash
# åœ¨æ ¹ç›®å½•å®‰è£…æ‰€æœ‰ workspace ä¾èµ–
$ yarn install

# åœ¨æŒ‡å®š workspace æ‰§è¡Œå‘½ä»¤
$ yarn workspace @my-monorepo/web dev

# åœ¨æ‰€æœ‰ workspace æ‰§è¡Œå‘½ä»¤
$ yarn workspaces foreach run build

# Yarn Berry è¯­æ³•
$ yarn workspaces foreach -A run build
```

### èšç„¦å®‰è£…ï¼ˆYarn Berryï¼‰

`yarn workspaces focus` å¯ä»¥åªå®‰è£…æŒ‡å®š workspace åŠå…¶ä¾èµ–ï¼š

```bash
# åªå®‰è£…æŒ‡å®š workspace çš„ä¾èµ–
$ yarn workspaces focus @my-org/app

# å®‰è£…æ‰€æœ‰ workspaceï¼Œä½†åªå®‰è£…ç”Ÿäº§ä¾èµ–
$ yarn workspaces focus -A --production
```

### æ‰¹é‡æ‰§è¡Œå‘½ä»¤

```bash
# å¹¶è¡Œæ‰§è¡Œï¼ŒæŒ‰æ‹“æ‰‘é¡ºåº
$ yarn workspaces foreach --all -pt npm publish

# åªå¯¹æœ‰å˜æ›´çš„ workspace æ‰§è¡Œ
$ yarn workspaces foreach --since run lint

# é€’å½’æ‰§è¡Œï¼ˆåŒ…å«ä¾èµ–çš„ workspaceï¼‰
$ yarn workspaces foreach -R run build
```

### è·¨ Workspace ä¾èµ–

åœ¨ä¸€ä¸ª workspace ä¸­å¼•ç”¨å¦ä¸€ä¸ªï¼š

```json
{
  "name": "@my-monorepo/web",
  "dependencies": {
    "@my-monorepo/shared": "workspace:*"
  }
}
```

`workspace:*` åè®®è¡¨ç¤ºä½¿ç”¨æœ¬åœ° workspace ç‰ˆæœ¬ã€‚

## ç¦»çº¿æ¨¡å¼

Yarn æ”¯æŒç¦»çº¿å®‰è£…ï¼Œå‰ææ˜¯ä¾èµ–å·²è¢«ç¼“å­˜ï¼š

```bash
$ yarn install --offline
```

Yarn Berry çš„é›¶å®‰è£…ç‰¹æ€§å¯ä»¥å°†æ•´ä¸ª `.yarn/cache/` æäº¤åˆ° Gitï¼Œå®ç°çœŸæ­£çš„ç¦»çº¿å®‰è£…ã€‚

## ç¼“å­˜ç®¡ç†

```bash
# æŸ¥çœ‹ç¼“å­˜ç›®å½•
$ yarn cache dir

# æ¸…ç†ç¼“å­˜
$ yarn cache clean

# Yarn Berry
$ yarn cache clean --all
```

## å¸¸ç”¨å‘½ä»¤å¯¹æ¯”

| æ“ä½œ         | npm                  | Yarn Classic          | Yarn Berry        |
| ------------ | -------------------- | --------------------- | ----------------- |
| å®‰è£…æ‰€æœ‰ä¾èµ– | `npm install`        | `yarn`                | `yarn`            |
| æ·»åŠ ä¾èµ–     | `npm install pkg`    | `yarn add pkg`        | `yarn add pkg`    |
| æ·»åŠ å¼€å‘ä¾èµ– | `npm install -D pkg` | `yarn add -D pkg`     | `yarn add -D pkg` |
| ç§»é™¤ä¾èµ–     | `npm uninstall pkg`  | `yarn remove pkg`     | `yarn remove pkg` |
| æ›´æ–°ä¾èµ–     | `npm update pkg`     | `yarn upgrade pkg`    | `yarn up pkg`     |
| è¿è¡Œè„šæœ¬     | `npm run dev`        | `yarn dev`            | `yarn dev`        |
| æ‰§è¡ŒäºŒè¿›åˆ¶   | `npx pkg`            | `yarn dlx pkg`        | `yarn dlx pkg`    |
| å…¨å±€å®‰è£…     | `npm install -g pkg` | `yarn global add pkg` | ä¸æ¨èå…¨å±€å®‰è£…    |

## ä» npm è¿ç§»

è‹¥é¡¹ç›®åŸå…ˆä½¿ç”¨ npmï¼Œè¿ç§»åˆ° Yarnï¼š

```bash
# åˆ é™¤ npm é”æ–‡ä»¶
$ rm package-lock.json

# åˆ é™¤ node_modules
$ rm -rf node_modules

# ä½¿ç”¨ Yarn å®‰è£…
$ yarn install
```

Yarn ä¼šæ ¹æ® `package.json` ç”Ÿæˆ `yarn.lock`ã€‚

## å¸¸è§é—®é¢˜

### ä¾èµ–å®‰è£…å¤±è´¥

```bash
# æ¸…ç†ç¼“å­˜åé‡è¯•
$ yarn cache clean
$ rm -rf node_modules yarn.lock
$ yarn install
```

### PnP æ¨¡å¼ä¸‹æ¨¡å—æ‰¾ä¸åˆ°

ç¡®ä¿ IDE å®‰è£…äº†å¯¹åº” SDKï¼š

```bash
$ yarn dlx @yarnpkg/sdks vscode
```

ç„¶ååœ¨ VS Code ä¸­é€‰æ‹©ã€Œä½¿ç”¨å·¥ä½œåŒºç‰ˆæœ¬çš„ TypeScriptã€ã€‚

### åˆ‡æ¢å› node_modules æ¨¡å¼

åœ¨ `.yarnrc.yml` ä¸­æ·»åŠ ï¼š

```yaml
nodeLinker: node-modules
```

ç„¶åé‡æ–°å®‰è£…ï¼š

```bash
$ rm -rf .yarn/cache .pnp.cjs
$ yarn install
```

## å‚è€ƒèµ„æ–™

- [Yarn å®˜æ–¹æ–‡æ¡£](https://yarnpkg.com/)
- [Yarn Classic æ–‡æ¡£](https://classic.yarnpkg.com/)
- [Plug'n'Play è¯´æ˜](https://yarnpkg.com/features/pnp)
- [Workspaces æŒ‡å—](https://yarnpkg.com/features/workspaces)
